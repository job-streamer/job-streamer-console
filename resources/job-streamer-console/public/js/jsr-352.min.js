!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var JSR352Modeler=require("./jsr352-modeler"),propertiesPanelModule=require("bpmn-js-properties-panel"),propertiesProviderModule=require("./jsr352-properties-panel/provider"),camundaModdleDescriptor=require("camunda-bpmn-moddle/resources/camunda"),jsr352ModdleDescriptor=require("./descriptors/jsr352"),minimapModule=require("./diagram-js-minimap"),copypasteModule=require("./copy-paste"),modeler=new JSR352Modeler({container:"#canvas",keyboard:{bindTo:document},propertiesPanel:{parent:"#js-properties-panel"},additionalModules:[propertiesPanelModule,propertiesProviderModule,minimapModule,copypasteModule],moddleExtensions:{jsr352:jsr352ModdleDescriptor,camunda:camundaModdleDescriptor}});window.bpmnjs=modeler},{"./copy-paste":3,"./descriptors/jsr352":4,"./diagram-js-minimap":5,"./jsr352-modeler":9,"./jsr352-properties-panel/provider":19,"bpmn-js-properties-panel":28,"camunda-bpmn-moddle/resources/camunda":169}],2:[function(require,module,exports){"use strict";function setProperties(descriptor,data,properties){forEach(properties,function(property){void 0!==data[property]&&(descriptor[property]=data[property])})}function removeProperties(element,properties){forEach(properties,function(prop){element[prop]&&delete element[prop]})}function JSR352CopyPaste(bpmnFactory,eventBus,copyPaste,clipboard,moddle,canvas,bpmnRules){copyPaste.registerDescriptor(function(element,descriptor){var conditionExpression,eventDefinitions,businessObject=getBusinessObject(element);return descriptor.type=element.type,"label"===element.type?descriptor:(setProperties(descriptor,businessObject,copiedProperties),businessObject.default&&(descriptor.default=businessObject.default.id),businessObject.loopCharacteristics&&(descriptor.loopCharacteristics={type:businessObject.loopCharacteristics.$type,isSequential:businessObject.loopCharacteristics.isSequential}),setProperties(descriptor,businessObject.di,["isExpanded"]),is(businessObject,"bpmn:SequenceFlow")&&(conditionExpression=businessObject.get("conditionExpression"))&&(descriptor.conditionExpression={type:conditionExpression.$type,body:conditionExpression.body}),eventDefinitions=businessObject.get("eventDefinitions")||[],eventDefinitions.length&&(descriptor.eventDefinitions=map(eventDefinitions,function(defs){return defs.$type})),descriptor)}),eventBus.on("element.paste",function(context){var businessObject,newEventDefinition,conditionExpression,loopCharacteristics,source,target,canConnect,descriptor=context.descriptor,createdElements=context.createdElements,parent=descriptor.parent,rootElement=canvas.getRootElement();"label"!==descriptor.type&&(is(parent,"bpmn:Process")&&(descriptor.parent=is(rootElement,"bpmn:Collaboration")?rootElement:parent),"bpmn:DataOutputAssociation"!==descriptor.type&&"bpmn:DataInputAssociation"!==descriptor.type&&"bpmn:MessageFlow"!==descriptor.type||(descriptor.parent=rootElement),is(parent,"bpmn:Lane")&&(descriptor.parent=parent.parent),descriptor.waypoints&&(source=createdElements[descriptor.source],target=createdElements[descriptor.target],source&&target&&(source=source.element,target=target.element),(canConnect=bpmnRules.canConnect(source,target))&&(descriptor.type=canConnect.type)),descriptor.businessObject=businessObject=bpmnFactory.create(descriptor.type),"bpmn:Participant"===descriptor.type&&descriptor.processRef&&(descriptor.processRef=businessObject.processRef=bpmnFactory.create("bpmn:Process")),setProperties(businessObject,descriptor,pastedProperties),"jsr352:Chunk"===descriptor.type&&(businessObject.copied=!0),descriptor.loopCharacteristics&&(loopCharacteristics=descriptor.loopCharacteristics,businessObject.loopCharacteristics=moddle.create(loopCharacteristics.type),loopCharacteristics.isSequential&&(businessObject.loopCharacteristics.isSequential=!0),businessObject.loopCharacteristics.$parent=businessObject),descriptor.conditionExpression&&(conditionExpression=descriptor.conditionExpression,businessObject.conditionExpression=moddle.create(conditionExpression.type,{body:conditionExpression.body}),businessObject.conditionExpression.$parent=businessObject),descriptor.eventDefinitions&&(businessObject.eventDefinitions=map(descriptor.eventDefinitions,function(type){return newEventDefinition=moddle.create(type),newEventDefinition.$parent=businessObject,newEventDefinition})),removeProperties(descriptor,removedProperties))})}var ModelUtil=require("bpmn-js/lib/util/ModelUtil"),getBusinessObject=ModelUtil.getBusinessObject,is=ModelUtil.is,map=require("lodash/collection/map"),forEach=require("lodash/collection/forEach"),copiedProperties=["name","text","ref","isInterrupting","isForCompensation","associationDirection","triggeredByEvent","cancelActivity"],pastedProperties=["name","text","ref","isExpanded","isInterrupting","cancelActivity","triggeredByEvent"],removedProperties=["name","text","ref","eventDefinitions","conditionExpression","loopCharacteristics","isInterrupting","cancelActivity","triggeredByEvent"];require("bpmn-js/lib/features/copy-paste/BpmnCopyPaste");JSR352CopyPaste.$inject=["bpmnFactory","eventBus","copyPaste","clipboard","moddle","canvas","bpmnRules"],JSR352CopyPaste.appendCopiedProperties=function(properties){properties.forEach(function(property){copiedProperties.push(property)})},JSR352CopyPaste.appendPastedProperties=function(properties){properties.forEach(function(property){pastedProperties.push(property)})},JSR352CopyPaste.appendRemovedProperties=function(properties){properties.forEach(function(property){removedProperties.push(property)})},module.exports=JSR352CopyPaste},{"bpmn-js/lib/features/copy-paste/BpmnCopyPaste":80,"bpmn-js/lib/util/ModelUtil":160,"lodash/collection/forEach":369,"lodash/collection/map":373}],3:[function(require,module,exports){module.exports={__depends__:[require("bpmn-js/lib/features/copy-paste")],__init__:["bpmnCopyPaste"],bpmnCopyPaste:["type",require("./JSR352CopyPaste")]}},{"./JSR352CopyPaste":2,"bpmn-js/lib/features/copy-paste":81}],4:[function(require,module,exports){module.exports={name:"jsr352",prefix:"jsr352",uri:"http://jsr352",xml:{tagAlias:"lowerCase"},associations:[],types:[{name:"Job",superClass:["bpmn:Process"],properties:[{name:"restartable",isAttr:!0,type:"Boolean",default:!0}]},{name:"BatchComponent",superClass:["bpmn:FlowElement","bpmn:FlowNode"]},{name:"Step",superClass:["jsr352:BatchComponent","bpmn:SubProcess"],properties:[{name:"start-limit",isAttr:!0,type:"String",default:"0"},{name:"allow-start-if-complete",isAttr:!0,type:"String"}]},{name:"Flow",superClass:["jsr352:BatchComponent","bpmn:SubProcess"]},{name:"Split",superClass:["jsr352:BatchComponent","bpmn:SubProcess"]},{name:"Transition",superClass:["bpmn:SequenceFlow"],properties:[{name:"on",isAttr:!0,type:"String",default:"*"}]},{name:"Chunk",superClass:["bpmn:SubProcess","bpmn:FlowElement","bpmn:FlowNode"],properties:[{name:"checkpoint-policy",isAttr:!0,type:"String",default:"item"},{name:"item-count",isAttr:!0,type:"String",default:"10"},{name:"time-limit",isAttr:!0,type:"String",default:"0"},{name:"skip-limit",isAttr:!0,type:"String"},{name:"retry-limit",isAttr:!0,type:"String"}]},{name:"Batchlet",superClass:["bpmn:FlowElement","bpmn:FlowNode"],properties:[{name:"ref",isAttr:!0,type:"String"}]},{name:"Reader",superClass:["bpmn:FlowElement","bpmn:FlowNode"],properties:[{name:"ref",isAttr:!0,type:"String"}]},{name:"Processor",superClass:["bpmn:FlowElement","bpmn:FlowNode"],properties:[{name:"ref",isAttr:!0,type:"String"}]},{name:"Writer",superClass:["bpmn:FlowElement","bpmn:FlowNode"],properties:[{name:"ref",isAttr:!0,type:"String"}]},{name:"Listener",superClass:["bpmn:FlowElement","bpmn:FlowNode"],properties:[{name:"ref",isAttr:!0,type:"String"}]},{name:"Start",superClass:["bpmn:StartEvent"]},{name:"End",superClass:["bpmn:EndEvent"],properties:[{name:"exit-status",isAttr:!0,type:"String"}]},{name:"Fail",superClass:["bpmn:EndEvent"],properties:[{name:"exit-status",isAttr:!0,type:"String"}]},{name:"Stop",superClass:["bpmn:EndEvent"],properties:[{name:"exit-status",isAttr:!0,type:"String"},{name:"restart",isAttr:!0,type:"String"}]}]}},{}],5:[function(require,module,exports){module.exports=require("./lib")},{"./lib":8}],6:[function(require,module,exports){function GraphicsUtil(elementRegistry){this.createElement=function(element){var gfx=elementRegistry.getGraphics(element);if(gfx){var djsVisual=getDjsVisual(gfx);if(djsVisual){var elementGfx=svgClone(djsVisual);return svgAttr(elementGfx,{id:element.id}),elementGfx}console.log("djsVisual not found")}else console.log("gfx not found")}}function getDjsVisual(gfx){return[].slice.call(gfx.childNodes).filter(function(childNode){return"djs-visual"===childNode.getAttribute("class")})[0]}var svgAttr=require("tiny-svg/lib/attr"),svgClone=require("tiny-svg/lib/clone");module.exports=GraphicsUtil},{"tiny-svg/lib/attr":548,"tiny-svg/lib/clone":551}],7:[function(require,module,exports){"use strict";function Minimap(canvas,elementRegistry,eventBus,injector,config){var self=this;this._canvas=canvas,this._elementRegistry=elementRegistry,this._eventBus=eventBus,this._injector=injector,this._graphicsUtil=new GraphicsUtil(elementRegistry),this._state={isOpen:void 0,isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null,svgClientRect:null},this._init(),this.toggle(!0),domEvent.bind(this._viewport,"mouseenter",function(){setCursor(self._parent,MOVE_CURSOR)},this),domEvent.bind(this._viewport,"mouseleave",function(){self._state.isDragging||setCursor(self._parent,CROSSHAIR_CURSOR)},this),domEvent.bind(this._map,"mouseenter",function(){self._state.isDragging?setCursor(self._parent,MOVE_CURSOR):setCursor(self._parent,CROSSHAIR_CURSOR)},this),domEvent.bind(this._map,"mouseleave",function(){self._state.isDragging||setCursor(self._parent,DEFAULT_CURSOR)},this),domEvent.bind(this._parent,"mouseleave",function(event){self._state.isDragging&&setCursor(self._parent.parentNode,MOVE_CURSOR)},this),domEvent.bind(this._svg,"click",function(event){var boundingClientRect=self._svg.getBoundingClientRect();setViewboxCenteredAroundPoint(mapMousePositionToDiagramPoint({x:event.clientX-boundingClientRect.left,y:event.clientY-boundingClientRect.top},self._canvas,self._svg),self._canvas)},this),domEvent.bind(this._viewport,"mousedown",function(event){var dragger=svgClone(self._viewport);svgAppend(self._svg,dragger),self._svgClientRect||(self._svgClientRect=self._svg.getBoundingClientRect());var diagramPoint=mapMousePositionToDiagramPoint({x:event.clientX-self._svgClientRect.left,y:event.clientY-self._svgClientRect.top},self._canvas,self._svg),viewbox=canvas.viewbox(),offsetViewport=getOffsetViewport(diagramPoint,viewbox);assign(self._state,{isDragging:!0,initialDragPosition:{x:event.clientX,y:event.clientY},offsetViewport:offsetViewport,cachedViewbox:viewbox,dragger:dragger}),svgAttr(self._viewport,"visibility","hidden")},this),domEvent.bind(document,"mousemove",function(event){if(self._svgClientRect||(self._svgClientRect=self._svg.getBoundingClientRect()),self._state.isDragging){var diagramPoint=mapMousePositionToDiagramPoint({x:event.clientX-self._svgClientRect.left,y:event.clientY-self._svgClientRect.top},self._canvas,self._svg),viewbox=self._state.cachedViewbox;setViewboxCenteredAroundPoint({x:diagramPoint.x-self._state.offsetViewport.x,y:diagramPoint.y-self._state.offsetViewport.y},self._canvas),svgAttr(self._state.dragger,{x:Math.round(diagramPoint.x-viewbox.width/2)-self._state.offsetViewport.x,y:Math.round(diagramPoint.y-viewbox.height/2)-self._state.offsetViewport.y})}},this),domEvent.bind(document,"mouseup",function(event){self._state.isDragging&&(svgRemove(self._state.dragger),svgAttr(self._viewport,{visibility:"visible"}),self._update(),assign(self._state,{isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null}),setCursor(self._parent.parentNode,DEFAULT_CURSOR))},this),domEvent.bind(this._svg,"wheel",function(event){event.preventDefault(),event.stopImmediatePropagation()}),domEvent.bind(this._toggle,"mouseenter",function(){self._state.isDragging||assign(self._toggle.style,MINIMAP_TOGGLE_HOVER_STYLES)}),domEvent.bind(this._toggle,"mouseleave",function(){self._state.isDragging||assign(self._toggle.style,MINIMAP_TOGGLE_STYLES)}),domEvent.bind(this._toggle,"click",function(){self.toggle()}),eventBus.on(["shape.added","connection.added"],function(ctx){var element=ctx.element;self._addElement(element),self._update()}),eventBus.on(["shape.removed","connection.removed"],function(ctx){var element=ctx.element;self._removeElement(element),self._update()}),eventBus.on("elements.changed",function(ctx){ctx.elements.forEach(function(element){self._updateElement(element)}),self._update()}),eventBus.on("element.updateId",function(ctx){var element=ctx.element,newId=ctx.newId;self._updateElementId(element,newId)})}function setCursor(node,cursor){node.style.cursor=cursor}function isConnection(element){return element.waypoints}function getHorizontalPosition(position){return getPositions(position).horizontal}function getVerticalPosition(position){return getPositions(position).vertical}function getPositions(position){var split=position.split("-");return{horizontal:split[0]||"right",vertical:split[1]||"top"}}function getOffsetViewport(diagramPoint,viewbox){var centerViewbox={x:viewbox.x+viewbox.width/2,y:viewbox.y+viewbox.height/2};return{x:diagramPoint.x-centerViewbox.x,y:diagramPoint.y-centerViewbox.y}}function mapMousePositionToDiagramPoint(position,canvas,svg){var boundingClientRect=svg.getBoundingClientRect(),bBox=fitAspectRatio(canvas.getDefaultLayer().getBBox(),boundingClientRect.width/boundingClientRect.height);return{x:map(position.x,0,boundingClientRect.width,bBox.x,bBox.x+bBox.width),y:map(position.y,0,boundingClientRect.height,bBox.y,bBox.y+bBox.height)}}function setViewboxCenteredAroundPoint(point,canvas){var cachedViewbox=canvas.viewbox(),cachedViewboxWidth=cachedViewbox.width,cachedViewboxHeight=cachedViewbox.height;canvas.viewbox({x:point.x-cachedViewboxWidth/2,y:point.y-cachedViewboxHeight/2,width:cachedViewboxWidth,height:cachedViewboxHeight})}function fitAspectRatio(bounds,targetAspectRatio){var aspectRatio=bounds.width/bounds.height,newBounds=assign({},{x:bounds.x,y:bounds.y,width:bounds.width,height:bounds.height});if(aspectRatio>targetAspectRatio){var height=newBounds.width*(1/targetAspectRatio),y=newBounds.y-(height-newBounds.height)/2;assign(newBounds,{y:y,height:height})}else if(aspectRatio<targetAspectRatio){var width=newBounds.height*targetAspectRatio,x=newBounds.x-(width-newBounds.width)/2;assign(newBounds,{x:x,width:width})}return newBounds}function map(x,inMin,inMax,outMin,outMax){return(x-inMin)*(outMax-outMin)/(inMax-inMin)+outMin}function getIndexOfChildInParentChildren(childGfx,parentGfx){var childrenGroup=domQuery(".djs-children",parentGfx.parentNode);if(childrenGroup){var childrenArray=[].slice.call(childrenGroup.childNodes),indexOfChild=-1;return childrenArray.forEach(function(childGroup,index){domQuery(".djs-element",childGroup)===childGfx&&(indexOfChild=index)}),indexOfChild}}function insertChildAtIndex(childGfx,parentGfx,index){var childrenArray=[].slice.call(parentGfx.childNodes),childAtIndex=childrenArray[index];parentGfx.insertBefore(childGfx,childAtIndex.nextSibling)}var domAttr=require("min-dom/lib/attr"),domClasses=require("min-dom/lib/classes"),domEvent=require("min-dom/lib/event"),domQuery=require("min-dom/lib/query"),svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClone=require("tiny-svg/lib/clone"),svgCreate=require("tiny-svg/lib/create"),svgRemove=require("tiny-svg/lib/remove"),assign=require("lodash/object/assign"),GraphicsUtil=require("./GraphicsUtil"),MINIMAP_DIMENSIONS={width:"300px",height:"160px"},MINIMAP_STYLES={position:"absolute",overflow:"hidden","background-color":"#fff",border:"solid 1px #CCC",borderRadius:"2px",boxShadow:"0 1px 2px rgba(0,0,0,0.3)",boxSizing:"border-box",userSelect:"none","-moz-user-select":"none"},MINIMAP_OPEN_MAP_STYLES={display:"block"},MINIMAP_CLOSED_MAP_STYLES={display:"none"},MINIMAP_MAP_STYLES={width:MINIMAP_DIMENSIONS.width,height:MINIMAP_DIMENSIONS.height},MINIMAP_TOGGLE_STYLES={"background-color":"rgb(250, 250, 250)"},MINIMAP_OPEN_TOGGLE_STYLES={width:"100%",height:"10px"},MINIMAP_CLOSED_TOGGLE_STYLES={width:"46px",height:"46px"},MINIMAP_TOGGLE_HOVER_STYLES={"background-color":"#666"},CROSSHAIR_CURSOR="crosshair",DEFAULT_CURSOR="inherit",MOVE_CURSOR="move";Minimap.$inject=["canvas","elementRegistry","eventBus","injector","config.minimap"],module.exports=Minimap,Minimap.prototype._init=function(){var canvas=this._canvas,container=canvas.getContainer(),parent=this._parent=document.createElement("div");switch(domClasses(parent).add("djs-minimap"),getHorizontalPosition("right-top")){case"left":assign(MINIMAP_STYLES,{left:"20px"});break;default:assign(MINIMAP_STYLES,{right:"20px"})}switch(getVerticalPosition("right-top")){case"bottom":assign(MINIMAP_STYLES,{bottom:"20px"});break;default:assign(MINIMAP_STYLES,{top:"20px"})}assign(parent.style,MINIMAP_STYLES),container.appendChild(parent);var map=this._map=document.createElement("div");domClasses(map).add("djs-minimap-map"),assign(map.style,MINIMAP_MAP_STYLES),parent.appendChild(map);var svg=this._svg=svgCreate("svg");svgAttr(svg,{width:"100%",height:"100%"}),svgAppend(map,svg);var elementsGroup=this._elementsGroup=svgCreate("g");svgAppend(svg,elementsGroup);var viewportGroup=this._viewportGroup=svgCreate("g");svgAppend(svg,viewportGroup);var toggle=(this._viewport=svgCreate("rect"),this._toggle=document.createElement("div"));domClasses(toggle).add("djs-minimap-toggle");var translate=this._injector.get("translate",!1)||function(s){return s};domAttr(toggle,"title",translate("Toggle minimap")),assign(toggle.style,MINIMAP_TOGGLE_STYLES),parent.appendChild(toggle),domEvent.bind(parent,"mousedown",function(event){event.stopPropagation()})},Minimap.prototype._update=function(){var bBox=this._canvas.getDefaultLayer().getBBox(),viewbox=this._canvas.viewbox();bBox.width<viewbox.width&&bBox.height<viewbox.height?svgAttr(this._svg,{viewBox:viewbox.x+", "+viewbox.y+", "+viewbox.width+", "+viewbox.height}):svgAttr(this._svg,{viewBox:bBox.x+", "+bBox.y+", "+bBox.width+", "+bBox.height}),svgAttr(this._viewport,{x:viewbox.x,y:viewbox.y,width:viewbox.width,height:viewbox.height})},Minimap.prototype.open=function(){assign(this._map.style,MINIMAP_OPEN_MAP_STYLES),assign(this._toggle.style,MINIMAP_OPEN_TOGGLE_STYLES),assign(this._state,{isOpen:!0}),domClasses(this._parent).add("open"),this._eventBus.fire("minimap.toggle",{open:!0})},Minimap.prototype.close=function(){assign(this._map.style,MINIMAP_CLOSED_MAP_STYLES),assign(this._toggle.style,MINIMAP_CLOSED_TOGGLE_STYLES),assign(this._state,{isOpen:!1}),domClasses(this._parent).remove("open"),this._eventBus.fire("minimap.toggle",{open:!1})},Minimap.prototype.toggle=function(open){var currentOpen=this.isOpen();void 0===open&&(open=!currentOpen),open!=currentOpen&&(open?this.open():this.close())},Minimap.prototype.isOpen=function(){return this._state.isOpen},Minimap.prototype._updateElement=function(element){void 0!==element.parent&&null!==element.parent&&(this._removeElement(element),this._addElement(element))},Minimap.prototype._updateElementId=function(element,newId){var elementGfx=domQuery("#"+element.id,this._elementsGroup);elementGfx&&(elementGfx.id=newId)},Minimap.prototype._addElement=function(element){var self=this;this._removeElement(element);var newElementGfx=this._graphicsUtil.createElement(element),newElementParentGfx=domQuery("#"+element.parent.id,this._elementsGroup);if(newElementGfx){var elementGfx=this._elementRegistry.getGraphics(element),parentGfx=this._elementRegistry.getGraphics(element.parent),index=getIndexOfChildInParentChildren(elementGfx,parentGfx);if(void 0!==index&&newElementParentGfx?insertChildAtIndex(newElementGfx,newElementParentGfx,index):this._elementsGroup.appendChild(newElementGfx),isConnection(element)){var parent=element.parent,x=0,y=0;void 0!==parent.x&&void 0!==parent.y&&(x=-parent.x,y=-parent.y),svgAttr(newElementGfx,{transform:"translate("+x+" "+y+")"})}else{var x=element.x,y=element.y;if(newElementParentGfx){var parent=element.parent;x-=parent.x,y-=parent.y}svgAttr(newElementGfx,{transform:"translate("+x+" "+y+")"})}return element.children&&element.children.length&&element.children.forEach(function(child){self._addElement(child)}),newElementGfx}},Minimap.prototype._removeElement=function(element){var elementGfx=this._svg.getElementById(element.id);elementGfx&&svgRemove(elementGfx)}},{"./GraphicsUtil":6,"lodash/object/assign":502,"min-dom/lib/attr":517,"min-dom/lib/classes":518,"min-dom/lib/event":523,"min-dom/lib/query":525,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/clone":551,"tiny-svg/lib/create":552,"tiny-svg/lib/remove":555}],8:[function(require,module,exports){module.exports={__init__:["minimap"],minimap:["type",require("./Minimap")]}},{"./Minimap":7}],9:[function(require,module,exports){"use strict";function JSR352Modeler(options){Modeler.call(this,options),this._customElements=[]}function isJSR352Connection(element){return"jsr352:Transition"===element.type}var Modeler=require("bpmn-js/lib/Modeler"),assign=require("lodash/object/assign"),isArray=require("lodash/lang/isArray");require("inherits")(JSR352Modeler,Modeler),JSR352Modeler.prototype._modules=[].concat(JSR352Modeler.prototype._modules,[require("./jsr352")]),JSR352Modeler.prototype._addCustomShape=function(element){this._customElements.push(element);var canvas=this.get("canvas"),elementFactory=this.get("elementFactory"),customAttrs=assign({businessObject:element},element),customShape=elementFactory.create("shape",customAttrs);return canvas.addShape(customShape)},JSR352Modeler.prototype._addCustomConnection=function(customElement){this._customElements.push(customElement);var canvas=this.get("canvas"),elementFactory=this.get("elementFactory"),elementRegistry=this.get("elementRegistry"),customAttrs=assign({businessObject:customElement},customElement),connection=elementFactory.create("connection",assign(customAttrs,{source:elementRegistry.get(customElement.source),target:elementRegistry.get(customElement.target)}),elementRegistry.get(customElement.source).parent);return canvas.addConnection(connection)},JSR352Modeler.prototype.addCustomElements=function(customElements){if(!isArray(customElements))throw new Error("argument must be an array");var shapes=[],connections=[];customElements.forEach(function(customElement){isJSR352Connection(customElement)?connections.push(customElement):shapes.push(customElement)}),shapes.forEach(this._addCustomShape,this),connections.forEach(this._addCustomConnection,this)},JSR352Modeler.prototype.getCustomElements=function(){return this._customElements},module.exports=JSR352Modeler},{"./jsr352":16,"bpmn-js/lib/Modeler":68,inherits:354,"lodash/lang/isArray":492,"lodash/object/assign":502}],10:[function(require,module,exports){"use strict";function JSR352ContextPadProvider(eventBus,contextPad,modeling,elementFactory,connect,create,popupMenu,canvas,rules,translate){ContextPadProvider.call(this,eventBus,contextPad,modeling,elementFactory,connect,create,popupMenu,canvas,rules,translate);var cached=bind(this.getContextPadEntries,this);this.getContextPadEntries=function(element){function startConnect(event,element,autoActivate){connect.start(event,element,autoActivate)}function appendAction(type,className,title,options){function appendListener(event,element){var shape=elementFactory.createShape(assign({type:type,isExpanded:!0},options));create.start(event,shape,element)}return"string"!=typeof title&&(options=title,title=translate("Append {type}",{type:type.replace(/^jsr352\:/,"")})),{group:"model",className:className,title:title,action:{dragstart:appendListener,click:appendListener}}}function appendBatchComponentMenu(actions){assign(actions,{"append.step":appendAction("jsr352:Step","icon-jsr352-step","Append step"),"append.flow":appendAction("jsr352:Flow","icon-jsr352-flow","Append flow"),"append.split":appendAction("jsr352:Split","icon-jsr352-split","Append split"),"append.end-event":appendAction("jsr352:End","bpmn-icon-end-event-terminate"),"append.fail-event":appendAction("jsr352:Fail","bpmn-icon-end-event-error"),"append.stop-event":appendAction("jsr352:Stop","bpmn-icon-intermediate-event-none"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:translate("Connect using DataInputAssociation"),action:{click:startConnect,dragstart:startConnect}}})}var actions=cached(element),businessObject=element.businessObject;return isAny(businessObject,["jsr352:Step","jsr352:Flow","jsr352:Split"])?(actions=pick(actions,["connect","delete"]),appendBatchComponentMenu(actions)):isAny(businessObject,["jsr352:Start"])?(actions=pick(actions,["connect","delete"]),appendBatchComponentMenu(actions)):actions=pick(actions,["delete"]),actions}}var inherits=require("inherits"),ContextPadProvider=require("bpmn-js/lib/features/context-pad/ContextPadProvider"),isAny=require("bpmn-js/lib/features/modeling/util/ModelingUtil").isAny,assign=require("lodash/object/assign"),pick=require("lodash/object/pick"),bind=require("lodash/function/bind");inherits(JSR352ContextPadProvider,ContextPadProvider),JSR352ContextPadProvider.$inject=["eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate"],module.exports=JSR352ContextPadProvider},{"bpmn-js/lib/features/context-pad/ContextPadProvider":78,"bpmn-js/lib/features/modeling/util/ModelingUtil":133,inherits:354,"lodash/function/bind":380,"lodash/object/assign":502,"lodash/object/pick":511}],11:[function(require,module,exports){"use strict";function JSR352ElementFactory(bpmnFactory,moddle,translate){BpmnElementFactory.call(this,bpmnFactory,moddle,translate);var self=this;this.create=function(elementType,attrs){var type=attrs.type;if("label"===elementType)return self.baseCreate(elementType,assign({type:"label"},LabelUtil.DEFAULT_LABEL_SIZE,attrs));if(/^jsr352\:/.test(type)){var businessObject=attrs.businessObject;return businessObject||(businessObject=this._bpmnFactory.create(type,attrs),attrs.id&&assign(businessObject,{id:attrs.id})),/\:Connection$/.test(type)||defaults(attrs,self._getCustomElementSize(type)),attrs=assign({businessObject:businessObject,id:businessObject.id},attrs),self.createBpmnElement(elementType,attrs)}return self.createBpmnElement(elementType,attrs)}}var assign=require("lodash/object/assign"),defaults=require("lodash/object/defaults"),inherits=require("inherits"),BpmnElementFactory=(require("bpmn-js/lib/util/ModelUtil").is,require("bpmn-js/lib/features/modeling/util/ModelingUtil").isAny,require("bpmn-js/lib/features/modeling/ElementFactory")),LabelUtil=require("bpmn-js/lib/util/LabelUtil");inherits(JSR352ElementFactory,BpmnElementFactory),module.exports=JSR352ElementFactory,JSR352ElementFactory.$inject=["bpmnFactory","moddle","translate"],JSR352ElementFactory.prototype._getCustomElementSize=function(type){var shapes={__default:{width:100,height:80},"jsr352:Split":{width:600,height:400},"jsr352:Flow":{width:400,height:240},"jsr352:Step":{width:120,height:100},"jsr352:Batchlet":{width:220,height:20},"jsr352:Chunk":{width:230,height:80},"jsr352:Reader":{width:220,height:20},"jsr352:Processor":{width:220,height:20},"jsr352:Writer":{width:220,height:20},"jsr352:Start":{width:40,height:40},"jsr352:End":{width:40,height:40},"jsr352:Fail":{width:40,height:40},"jsr352:Stop":{width:40,height:40},"jsr352:Listener":{width:220,height:20}};return shapes[type]||shapes.__default}},{"bpmn-js/lib/features/modeling/ElementFactory":97,"bpmn-js/lib/features/modeling/util/ModelingUtil":133,"bpmn-js/lib/util/LabelUtil":159,"bpmn-js/lib/util/ModelUtil":160,inherits:354,"lodash/object/assign":502,"lodash/object/defaults":503}],12:[function(require,module,exports){"use strict";function PaletteProvider(palette,create,elementFactory,spaceTool,lassoTool,translate){this._create=create,this._elementFactory=elementFactory,this._spaceTool=spaceTool,this._lassoTool=lassoTool,this._translate=translate,palette.registerProvider(this)}var assign=require("lodash/object/assign");module.exports=PaletteProvider,PaletteProvider.$inject=["palette","create","elementFactory","spaceTool","lassoTool","translate"],PaletteProvider.prototype.getPaletteEntries=function(element){function createAction(type,group,className,title,options){function createListener(event){var shape=elementFactory.createShape(assign({type:type},options));options&&(shape.businessObject.di.isExpanded=options.isExpanded),create.start(event,shape)}var shortType=type.replace(/^[^\:]*\:/,"");return{group:group,className:className,title:title||"Create "+shortType,action:{dragstart:createListener,click:createListener}}}var actions={},create=this._create,elementFactory=this._elementFactory,spaceTool=this._spaceTool,lassoTool=this._lassoTool;this._translate;return assign(actions,{"jsr352-step":createAction("jsr352:Step","custom","icon-jsr352-step"),"jsr352-flow":createAction("jsr352:Flow","custom","icon-jsr352-flow"),"jsr352-split":createAction("jsr352:Split","custom","icon-jsr352-split"),"batch-component-separator":{group:"custom",separator:!0},"jsr352-batchlet":createAction("jsr352:Batchlet","custom","icon-jsr352-batchlet"),"jsr352-chunk":createAction("jsr352:Chunk","custom","icon-jsr352-chunk"),"jsr352-listener":createAction("jsr352:Listener","custom","icon-jsr352-listener"),"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:"Activate the lasso tool",action:{click:function(event){lassoTool.activateSelection(event)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:"Activate the create/remove space tool",action:{click:function(event){spaceTool.activateSelection(event)}}},"tool-separator":{group:"tools",separator:!0},"create.start":createAction("jsr352:Start","event","bpmn-icon-start-event-none"),"create.end-event":createAction("jsr352:End","event","bpmn-icon-end-event-terminate"),"create.fail-event":createAction("jsr352:Fail","event","bpmn-icon-end-event-error"),"create.stop-event":createAction("jsr352:Stop","event","bpmn-icon-intermediate-event-none")}),actions}},{"lodash/object/assign":502}],13:[function(require,module,exports){"use strict";function extractClassName(str){if(!str)return"";var array=str.split(".");return array[array.length-1]}function JSR352Renderer(eventBus,styles,bpmnRenderer){BaseRenderer.call(this,eventBus,2e3);var computeStyle=styles.computeStyle,textUtil=new TextUtil({style:LABEL_STYLE,size:{width:100}});this.renderLabel=function(p,label,options){return textUtil.createText(p,label||"",options)},this.drawRect=function(parentGfx,width,height,r,offset,attrs){isObject(offset)&&(attrs=offset,offset=0),offset=offset||0,attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"});var rect=svgCreate("rect");return svgAttr(rect,{x:offset,y:offset,width:width-2*offset,height:height-2*offset,rx:r,ry:r}),svgAttr(rect,attrs),svgAppend(parentGfx,rect),rect},this.drawShapeByType=function(p,element,type){return(0,bpmnRenderer.handlers[type])(p,element)},this.getCustomConnectionPath=function(connection){var waypoints=connection.waypoints.map(function(p){return p.original||p}),connectionPath=[["M",waypoints[0].x,waypoints[0].y]];return waypoints.forEach(function(waypoint,index){0!==index&&connectionPath.push(["L",waypoint.x,waypoint.y])}),componentsToPath(connectionPath)},this.getRoundRectPath=function(shape,borderRadius){
var x=shape.x,y=shape.y,width=shape.width,height=shape.height;return componentsToPath([["M",x+borderRadius,y],["l",width-2*borderRadius,0],["a",borderRadius,borderRadius,0,0,1,borderRadius,borderRadius],["l",0,height-2*borderRadius],["a",borderRadius,borderRadius,0,0,1,-borderRadius,borderRadius],["l",2*borderRadius-width,0],["a",borderRadius,borderRadius,0,0,1,-borderRadius,-borderRadius],["l",0,2*borderRadius-height],["a",borderRadius,borderRadius,0,0,1,borderRadius,-borderRadius],["z"]])}}var inherits=require("inherits"),isObject=require("lodash/lang/isObject"),is=require("bpmn-js/lib/util/ModelUtil").is,isAny=require("bpmn-js/lib/features/modeling/util/ModelingUtil").isAny,BaseRenderer=require("diagram-js/lib/draw/BaseRenderer"),componentsToPath=require("diagram-js/lib/util/RenderUtil").componentsToPath,TextUtil=(require("diagram-js/lib/util/RenderUtil").createLine,require("diagram-js/lib/util/Text")),svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create"),LABEL_STYLE={fontFamily:"Arial, sans-serif",fontSize:"12px"};inherits(JSR352Renderer,BaseRenderer),module.exports=JSR352Renderer,JSR352Renderer.$inject=["eventBus","styles","bpmnRenderer"],JSR352Renderer.prototype.canRender=function(element){return/^jsr352\:/.test(element.type)},JSR352Renderer.prototype.drawShape=function(p,element){var type=element.type;if(/^jsr352\:/.test(type)&&(element.collapsed=!1),is(element,"jsr352:Step")){var step=this.drawRect(p,element.width,element.height,10,0);return this.drawRect(p,40,20,0,0),this.renderLabel(p,"Step",{box:{width:40,height:20,x:0,y:0},align:"center-middle",padding:1,style:{fill:"#000000"}}),this.renderLabel(p,element.businessObject.name,{box:element,align:"center-top",padding:1}),step}if("jsr352:Batchlet"===type){var batchlet=this.drawRect(p,element.width,element.height,0,0);this.drawRect(p,20,element.height,0,0,{fill:"#000000"});return this.renderLabel(p,"B",{box:{width:20,height:20,x:0,y:0},align:"center-middle",padding:1,style:{fill:"#ffffff"}}),this.renderLabel(p,extractClassName(element.businessObject.ref),{box:{width:element.width-20,height:element.height,x:20,y:0},align:"center-middle",padding:{left:22},style:{fill:"#000000"}}),batchlet}if("jsr352:Chunk"===type)return this.drawRect(p,element.width,element.height,10,0);if("jsr352:Reader"===type){var reader=this.drawRect(p,element.width,element.height,0,0);this.drawRect(p,20,element.height,0,0,{fill:"#fc9303"});return this.renderLabel(p,"R",{box:{width:20,height:20,x:0,y:0},align:"center-middle",padding:1,style:{fill:"#ffffff"}}),this.renderLabel(p,extractClassName(element.businessObject.ref),{box:{width:element.width-20,height:element.height,x:20,y:0},align:"center-middle",padding:{left:22},style:{fill:"#000000"}}),reader}if("jsr352:Processor"===type){var reader=this.drawRect(p,element.width,element.height,0,0);this.drawRect(p,20,element.height,0,0,{fill:"#b1d412"});return this.renderLabel(p,"P",{box:{width:20,height:20,x:0,y:0},align:"center-middle",padding:1,style:{fill:"#ffffff"}}),this.renderLabel(p,extractClassName(element.businessObject.ref),{box:{width:element.width-20,height:element.height,x:20,y:0},align:"center-middle",padding:{left:22},style:{fill:"#000000"}}),reader}if("jsr352:Writer"===type){var writer=this.drawRect(p,element.width,element.height,0,0);this.drawRect(p,20,element.height,0,0,{fill:"#a1e0fc"});return this.renderLabel(p,"W",{box:{width:20,height:20,x:0,y:0},align:"center-middle",padding:1,style:{fill:"#ffffff"}}),this.renderLabel(p,extractClassName(element.businessObject.ref),{box:{width:element.width-20,height:element.height,x:20,y:0},align:"center-middle",padding:{left:22},style:{fill:"#000000"}}),writer}if("jsr352:Listener"===type){var listener=this.drawRect(p,element.width,element.height,0,0);this.drawRect(p,20,element.height,0,0,{fill:"#e8e7e0"});return this.renderLabel(p,"L",{box:{width:20,height:20,x:0,y:0},align:"center-middle",padding:1,style:{fill:"#ffffff"}}),this.renderLabel(p,extractClassName(element.businessObject.ref),{box:{width:element.width-20,height:element.height,x:20,y:0},align:"center-middle",padding:{left:22},style:{fill:"#000000"}}),listener}if("jsr352:Flow"===type){var flow=this.drawShapeByType(p,element,"bpmn:Activity");return this.drawRect(p,40,20,0,0),this.renderLabel(p,"Flow",{box:{width:40,height:20,x:0,y:0},align:"center-middle",padding:1,style:{fill:"#000000"}}),this.renderLabel(p,element.businessObject.name,{box:element,align:"center-top",padding:1}),flow}if("jsr352:Split"===type){var split=this.drawShapeByType(p,element,"bpmn:Lane");return this.drawRect(p,40,20,0,0),this.renderLabel(p,"Split",{box:{width:40,height:20,x:0,y:0},align:"center-middle",padding:1,style:{fill:"#000000"}}),this.renderLabel(p,element.businessObject.name,{box:element,align:"center-top",padding:1}),split}return"jsr352:Start"===type?this.drawShapeByType(p,element,"bpmn:StartEvent"):"jsr352:End"===type?(this.drawShapeByType(p,element,"bpmn:EndEvent"),this.drawShapeByType(p,element,"bpmn:TerminateEventDefinition")):"jsr352:Fail"===type?(this.drawShapeByType(p,element,"bpmn:EndEvent"),this.drawShapeByType(p,element,"bpmn:ErrorEventDefinition")):"jsr352:Stop"===type?this.drawShapeByType(p,element,"bpmn:IntermediateEvent"):void 0},JSR352Renderer.prototype.getShapePath=function(shape){var type=shape.type;return isAny["jsr352:Writer"]?this.getRoundRectPath(shape,10):"jsr352:Flow"===type?this.getRoundRectPath(shape,10):"jsr352:Split"===type?this.getRoundRectPath(shape,10):"jsr352:Start"===type?this.getRoundRectPath(shape,10):"jsr352:End"===type?this.getRoundRectPath(shape,10):"jsr352:Fail"===type?this.getRoundRectPath(shape,10):"jsr352:Stop"===type?this.getRoundRectPath(shape,10):"jsr352:Listener"===type?this.getRoundRectPath(shape,10):void 0},JSR352Renderer.prototype.drawConnection=function(p,element){if("jsr352:Transition"===element.type)return this.drawShapeByType(p,element,"bpmn:SequenceFlow")},JSR352Renderer.prototype.getConnectionPath=function(connection){if("jsr352:Transition"===connection.type)return this.getCustomConnectionPath(connection)}},{"bpmn-js/lib/features/modeling/util/ModelingUtil":133,"bpmn-js/lib/util/ModelUtil":160,"diagram-js/lib/draw/BaseRenderer":191,"diagram-js/lib/util/RenderUtil":341,"diagram-js/lib/util/Text":343,inherits:354,"lodash/lang/isObject":497,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/create":552}],14:[function(require,module,exports){"use strict";function isJSR352(element){return element&&new RegExp("^jsr352:").test(element.type)}function JSR352Rules(eventBus){BpmnRules.call(this,eventBus)}function canConnect(source,target){return isJSR352(source)||isJSR352(target)?isJSR352(source)?!!isAny(target,["jsr352:BatchComponent","jsr352:End","jsr352:Fail","jsr352:Stop"])&&{type:"jsr352:Transition"}:isJSR352(target)?!!isAny(source,["jsr352:BatchComponent","jsr352:Start"])&&{type:"jsr352:Transition"}:void 0:{}}function hasNoChildren(element,self){return every(element.children,function(child){return child==self||!isAny(child,["jsr352:Batchlet","jsr352:Chunk"])})}var reduce=require("lodash/collection/reduce"),any=require("lodash/collection/any"),every=require("lodash/collection/every"),inherits=require("inherits"),is=require("bpmn-js/lib/util/ModelUtil").is,isAny=require("bpmn-js/lib/features/modeling/util/ModelingUtil").isAny,isExpanded=require("bpmn-js/lib/util/DiUtil").isExpanded,BpmnRules=require("bpmn-js/lib/features/rules/BpmnRules");inherits(JSR352Rules,BpmnRules),JSR352Rules.$inject=["eventBus"],module.exports=JSR352Rules,JSR352Rules.prototype.init=function(){function canCreate(shape,target){if(isJSR352(shape)&&target)return isAny(shape,["jsr352:Step"])?isAny(target,["jsr352:Flow","jsr352:Job"]):is(shape,"jsr352:Listener")?isAny(target,["jsr352:Step","jsr352:Job"]):is(shape,"jsr352:Flow")?isAny(target,["jsr352:Split","jsr352:Job","jsr352:Flow"]):isAny(shape,["jsr352:Batchlet","jsr352:Chunk"])?isAny(target,["jsr352:Step"])&&hasNoChildren(target,shape):isAny(shape,["jsr352:Reader","jsr352:Processor","jsr352:Writer"])?isAny(target,["jsr352:Chunk"]):isAny(shape,["jsr352:Split"])?isAny(target,["jsr352:Flow","jsr352:Job"]):isAny(target,["jsr352:Job"])}function canAttach(shape,target){if(isJSR352(shape)&&target)return isAny(shape,["jsr352:Step"])?isAny(target,["jsr352:Flow","jsr352:Job"]):is(shape,"jsr352:Listener")?isAny(target,["jsr352:Step","jsr352:Job"]):is(shape,"jsr352:Flow")?isAny(target,["jsr352:Split","jsr352:Job","jsr352:Flow"]):isAny(shape,["jsr352:Batchlet","jsr352:Chunk"])?isAny(target,["jsr352:Step"])&&hasNoChildren(target,shape):isAny(shape,["jsr352:Reader","jsr352:Processor","jsr352:Writer"])?isAny(target,["jsr352:Chunk"]):isAny(target,["jsr352:Job"])}function canCopy(collection,element){return!(is(element,"bpmn:Lane")&&!contains(collection,element.parent))&&!(is(element,"bpmn:BoundaryEvent")&&!contains(collection,element.host))}function canPaste(tree,target){var topLevel=tree[0];return is(target,"bpmn:Collaboration")?every(topLevel,function(e){return"bpmn:Participant"===e.type}):is(target,"bpmn:Process")?!(any(topLevel,function(e){return"bpmn:Participant"===e.type})&&target.children.length>0):!(is(target,"bpmn:Participant")&&!isExpanded(target))&&(is(target,"bpmn:FlowElementsContainer")?isExpanded(target):isAny(target,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]))}this.addRule("elements.move",1500,function(context){var type,target=context.target,shapes=context.shapes;return reduce(shapes,function(result,s){return void 0===type&&(type=isJSR352(s)),type===isJSR352(s)&&!1!==result&&canCreate(s,target)},void 0)}),this.addRule("shape.create",1500,function(context){var target=context.target;return canCreate(context.shape,target)}),this.addRule("shape.resize",1500,function(context){var shape=context.shape;if(isJSR352(shape)&&!isAny(shape,["jsr352:Flow","jsr352:Split","jsr352:Step","jsr352:TextBox","jsr352:Listener","jsr352:Reader","jsr352:Writer","jsr352:Processor","jsr352:Chunk","jsr352:Batchlet"]))return!1}),this.addRule("connection.create",1500,function(context){return canConnect(context.source,context.target)}),this.addRule("connection.reconnectStart",1500,function(context){var connection=context.connection;return canConnect(context.hover||context.source,connection.target)}),this.addRule("connection.reconnectEnd",1500,function(context){var connection=context.connection;return canConnect(connection.source,context.hover||context.target)}),this.addRule("element.copy",1500,function(context){return canCopy(context.collection,context.element)}),this.addRule("element.paste",function(context){var parent=context.parent,element=context.element,source=(context.position,context.source),target=context.target;return source||target?canConnect(source,target):canAttach([element],parent)||canCreate(element,parent)}),this.addRule("elements.paste",function(context){return canPaste(context.tree,context.target)})},JSR352Rules.prototype.canConnect=canConnect},{"bpmn-js/lib/features/modeling/util/ModelingUtil":133,"bpmn-js/lib/features/rules/BpmnRules":146,"bpmn-js/lib/util/DiUtil":158,"bpmn-js/lib/util/ModelUtil":160,inherits:354,"lodash/collection/any":365,"lodash/collection/every":366,"lodash/collection/reduce":374}],15:[function(require,module,exports){"use strict";function JSR352Updater(eventBus,bpmnjs,elementFactory,bpmnFactory){function createChildShape(type,parent,offset){offset||(offset={x:0,y:0});var shape=elementFactory.create("shape",{type:type,x:parent.x+offset.x,y:parent.y+offset.y,parent:parent});bpmnjs.get("canvas").addShape(shape,parent),parent.businessObject.flowElements||(parent.businessObject.flowElements=[]),shape.businessObject.$parent=parent.businessObject,assign(shape.businessObject,pick(shape,["x","y"])),Collections.add(parent.businessObject.flowElements,shape.businessObject),Collections.add(bpmnjs._customElements,shape.businessObject),assign(shape.businessObject.di.bounds,pick(shape,["x","y","width","height"])),shape.businessObject.di.$parent=parent.businessObject.di.$parent,Collections.add(bpmnjs.definitions.diagrams[0].plane.planeElement,shape.businessObject.di)}function updateCustomElement(e){var context=e.context,shape=context.shape,businessObject=shape.businessObject;if(isCustom(shape)){var parent=shape.parent,customElements=bpmnjs._customElements;parent?(Collections.add(customElements,businessObject),"shape.create"==e.command&&is(shape,"jsr352:Chunk")&&(shape.businessObject.copied||(createChildShape("jsr352:Reader",shape,{x:5,y:5}),createChildShape("jsr352:Writer",shape,{x:5,y:30}),createChildShape("jsr352:Processor",shape,{x:5,y:55})))):Collections.remove(customElements,businessObject),assign(businessObject,pick(shape,["x","y"]))}}function updateCustomConnection(e){var context=e.context,connection=context.connection,source=connection.source,target=connection.target,businessObject=connection.businessObject,parent=connection.parent,customElements=bpmnjs._customElements;parent?Collections.add(customElements,businessObject):Collections.remove(customElements,businessObject),assign(businessObject,{waypoints:copyWaypoints(connection)}),source&&target&&assign(businessObject,{source:source.id,target:target.id})}CommandInterceptor.call(this,eventBus),this.executed(["shape.create","shape.move","shape.delete"],ifCustomElement(updateCustomElement)),this.reverted(["shape.create","shape.move","shape.delete"],ifCustomElement(updateCustomElement)),this.executed(["connection.create","connection.reconnectStart","connection.reconnectEnd","connection.updateWaypoints","connection.delete","connection.layout","connection.move"],ifCustomElement(updateCustomConnection)),this.reverted(["connection.create","connection.reconnectStart","connection.reconnectEnd","connection.updateWaypoints","connection.delete","connection.layout","connection.move"],ifCustomElement(updateCustomConnection))}function copyWaypoints(connection){return connection.waypoints.map(function(p){return{x:p.x,y:p.y}})}function isCustom(element){return element&&/^jsr352\:/.test(element.type)}function ifCustomElement(fn){return function(event){var context=event.context;isCustom(context.shape||context.connection)&&fn(event)}}var inherits=require("inherits"),pick=require("lodash/object/pick"),assign=require("lodash/object/assign"),is=require("bpmn-js/lib/util/ModelUtil").is,CommandInterceptor=(require("bpmn-js/lib/features/modeling/util/ModelingUtil").isAny,require("diagram-js/lib/command/CommandInterceptor")),Collections=require("diagram-js/lib/util/Collections");inherits(JSR352Updater,CommandInterceptor),module.exports=JSR352Updater,JSR352Updater.$inject=["eventBus","bpmnjs","elementFactory","bpmnFactory"]},{"bpmn-js/lib/features/modeling/util/ModelingUtil":133,"bpmn-js/lib/util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,"diagram-js/lib/util/Collections":326,inherits:354,"lodash/object/assign":502,"lodash/object/pick":511}],16:[function(require,module,exports){module.exports={__init__:["customRenderer","paletteProvider","customUpdater","contextPadProvider"],elementFactory:["type",require("./JSR352ElementFactory")],customRenderer:["type",require("./JSR352Renderer")],paletteProvider:["type",require("./JSR352Palette")],bpmnRules:["type",require("./JSR352Rules")],customUpdater:["type",require("./JSR352Updater")],contextPadProvider:["type",require("./JSR352ContextPadProvider")]}},{"./JSR352ContextPadProvider":10,"./JSR352ElementFactory":11,"./JSR352Palette":12,"./JSR352Renderer":13,"./JSR352Rules":14,"./JSR352Updater":15}],17:[function(require,module,exports){"use strict";var factory=(require("lodash/collection/forEach"),require("bpmn-js/lib/util/ModelUtil").getBusinessObject,require("bpmn-js-properties-panel/lib/factory/EntryFieldDescription"),require("bpmn-js-properties-panel/lib/factory/EntryFactory")),multiselectbox=(require("bpmn-js-properties-panel/lib/helper/CmdHelper"),function(options){return factory.table(options)});module.exports=multiselectbox},{"bpmn-js-properties-panel/lib/factory/EntryFactory":40,"bpmn-js-properties-panel/lib/factory/EntryFieldDescription":41,"bpmn-js-properties-panel/lib/helper/CmdHelper":49,"bpmn-js/lib/util/ModelUtil":160,"lodash/collection/forEach":369}],18:[function(require,module,exports){"use strict";function createGeneralTabGroups(element,bpmnFactory,elementRegistry){var generalGroup={id:"general",label:"General",entries:[]};isAny(element,["jsr352:BatchComponent","jsr352:Job"])&&nameProps(generalGroup,element),stepProps(generalGroup,element,bpmnFactory),listenerProps(generalGroup,element,bpmnFactory),transitionProps(generalGroup,element),restartbleProps(generalGroup,element),restartProps(generalGroup,element);var detailsGroup={id:"details",label:"Details",entries:[]};linkProps(detailsGroup,element),eventProps(detailsGroup,element,bpmnFactory,elementRegistry);var documentationGroup={id:"documentation",label:"Documentation",entries:[]};return documentationProps(documentationGroup,element,bpmnFactory),[generalGroup,detailsGroup,documentationGroup]}function createExtensionElementsGroups(element,bpmnFactory,elementRegistry){var propertiesGroup={id:"extensionElements-properties",label:"Properties",entries:[],enabled:function(element){return isAny(element,["jsr352:Job","jsr352:Step","jsr352:Listener","jsr352:Batchlet","jsr352:Reader","jsr352:Processor","jsr352:Writer"])}};return properties(propertiesGroup,element,bpmnFactory),[propertiesGroup]}function CustomPropertiesProvider(eventBus,bpmnFactory,elementRegistry){PropertiesActivator.call(this,eventBus),this.getTabs=function(element){return[{id:"general",label:"General",groups:createGeneralTabGroups(element,bpmnFactory,elementRegistry)},{id:"PropertyElements",label:"Properties",groups:createExtensionElementsGroups(element,bpmnFactory,elementRegistry)}]}}var inherits=require("inherits"),isAny=require("bpmn-js/lib/features/modeling/util/ModelingUtil").isAny,PropertiesActivator=require("bpmn-js-properties-panel/lib/PropertiesActivator"),eventProps=require("bpmn-js-properties-panel/lib/provider/bpmn/parts/EventProps"),linkProps=require("bpmn-js-properties-panel/lib/provider/bpmn/parts/LinkProps"),documentationProps=require("bpmn-js-properties-panel/lib/provider/bpmn/parts/DocumentationProps"),properties=require("bpmn-js-properties-panel/lib/provider/camunda/parts/PropertiesProps"),nameProps=require("./parts/NameProps"),stepProps=require("./parts/StepProps"),listenerProps=require("./parts/ListenerProps"),restartbleProps=require("./parts/RestartableProps"),transitionProps=require("./parts/TransitionProps"),restartProps=require("./parts/RestartProps");inherits(CustomPropertiesProvider,PropertiesActivator),module.exports=CustomPropertiesProvider},{"./parts/ListenerProps":20,"./parts/NameProps":21,"./parts/RestartProps":22,"./parts/RestartableProps":23,"./parts/StepProps":24,"./parts/TransitionProps":25,"bpmn-js-properties-panel/lib/PropertiesActivator":29,"bpmn-js-properties-panel/lib/provider/bpmn/parts/DocumentationProps":54,"bpmn-js-properties-panel/lib/provider/bpmn/parts/EventProps":55,"bpmn-js-properties-panel/lib/provider/bpmn/parts/LinkProps":56,"bpmn-js-properties-panel/lib/provider/camunda/parts/PropertiesProps":66,"bpmn-js/lib/features/modeling/util/ModelingUtil":133,inherits:354}],19:[function(require,module,exports){module.exports={__init__:["propertiesProvider"],propertiesProvider:["type",require("./CustomPropertyProvider")]}},{"./CustomPropertyProvider":18}],20:[function(require,module,exports){"use strict";var entryFactory=require("bpmn-js-properties-panel/lib/factory/EntryFactory"),is=(require("bpmn-js-properties-panel/lib/helper/CmdHelper"),require("bpmn-js/lib/util/ModelUtil").is),componentProvider=(require("bpmn-js/lib/util/ModelUtil").getBusinessObject,require("../../../util/ComponentProvider")),selectOptionUtil=require("../../../util/SelectOptionUtil");module.exports=function(group,element,bpmnFactory){is(element,"jsr352:Listener")&&group.entries.push(entryFactory.selectBox({id:"ref",description:"Specifies the name of a batch artifact",label:"Ref",modelProperty:"ref",selectOptions:selectOptionUtil.toSelectOption(componentProvider.getListeners())}))}},{"../../../util/ComponentProvider":26,"../../../util/SelectOptionUtil":27,"bpmn-js-properties-panel/lib/factory/EntryFactory":40,"bpmn-js-properties-panel/lib/helper/CmdHelper":49,"bpmn-js/lib/util/ModelUtil":160}],21:[function(require,module,exports){"use strict";var entryFactory=require("bpmn-js-properties-panel/lib/factory/EntryFactory");module.exports=function(group,element,bpmnFactory){group.entries.push(entryFactory.textField({id:"name",label:"name",modelProperty:"name"}))}},{"bpmn-js-properties-panel/lib/factory/EntryFactory":40}],22:[function(require,module,exports){"use strict";var entryFactory=require("bpmn-js-properties-panel/lib/factory/EntryFactory"),is=require("bpmn-js/lib/util/ModelUtil").is;module.exports=function(group,element,bpmnFactory){is(element,"jsr352:Stop")&&group.entries.push(entryFactory.textField({id:"restart",description:"Specifies the job-level step, flow, or split at which to restart when the job is restarted.",label:"restart",modelProperty:"restart"}))}},{"bpmn-js-properties-panel/lib/factory/EntryFactory":40,"bpmn-js/lib/util/ModelUtil":160}],23:[function(require,module,exports){"use strict";var entryFactory=require("bpmn-js-properties-panel/lib/factory/EntryFactory"),is=require("bpmn-js/lib/util/ModelUtil").is;module.exports=function(group,element){is(element,"jsr352:Job")&&group.entries.push(entryFactory.checkbox({id:"restartable",description:"Specifies whether or not this job is restartable.",label:"restartable",modelProperty:"restartable"}))}},{"bpmn-js-properties-panel/lib/factory/EntryFactory":40,"bpmn-js/lib/util/ModelUtil":160}],24:[function(require,module,exports){"use strict";var entryFactory=require("bpmn-js-properties-panel/lib/factory/EntryFactory"),cmdHelper=require("bpmn-js-properties-panel/lib/helper/CmdHelper"),is=(require("../../factory/MultiSelectEntryFactory"),require("bpmn-js/lib/util/ModelUtil").is),getBusinessObject=(require("bpmn-js/lib/features/modeling/util/ModelingUtil").isAny,require("bpmn-js/lib/util/ModelUtil").getBusinessObject),componentProvider=require("../../../util/ComponentProvider"),selectOptionUtil=require("../../../util/SelectOptionUtil");module.exports=function(group,element,bpmnFactory){is(element,"jsr352:Step")&&(group.entries.push(entryFactory.validationAwareTextField({id:"start-limit",description:"Specifies the number of times this step may be started or restarted. It must be a valid XML integer value",label:"Start Limit",modelProperty:"start-limit",getProperty:function(element){return getBusinessObject(element)["start-limit"]},setProperty:function(element,properties){return cmdHelper.updateProperties(element,properties)},validate:function(element,values){return/^[0-9]+$/.test(values["start-limit"])?{}:{"start-limit":"Must be integer"}}})),group.entries.push(entryFactory.checkbox({id:"allow-start-if-complete",description:"Specifies whether this step is allowed to start during job restart, even if the step completed in a previous execution. ",label:"Allow start if complete",modelProperty:"allow-start-if-complete",getProperty:function(element){return getBusinessObject(element)["allow-start-if-complete"]},setProperty:function(element,properties){return cmdHelper.updateProperties(element,properties)}}))),is(element,"jsr352:Batchlet")&&group.entries.push(entryFactory.selectBox({id:"ref",description:"Specifies the name of a batch artifact.",label:"Ref",modelProperty:"ref",selectOptions:selectOptionUtil.toSelectOption(componentProvider.getBatchlets())})),is(element,"jsr352:Reader")&&group.entries.push(entryFactory.selectBox({id:"ref",description:"Specifies the name of a batch artifact.",label:"Ref",modelProperty:"ref",selectOptions:selectOptionUtil.toSelectOption(componentProvider.getItemReaders())})),is(element,"jsr352:Writer")&&group.entries.push(entryFactory.selectBox({id:"ref",description:"Specifies the name of a batch artifact.",label:"Ref",modelProperty:"ref",selectOptions:selectOptionUtil.toSelectOption(componentProvider.getItemWriters())})),is(element,"jsr352:Processor")&&group.entries.push(entryFactory.selectBox({id:"ref",description:"Specifies the name of a batch artifact.",label:"Ref",modelProperty:"ref",selectOptions:selectOptionUtil.toSelectOption(componentProvider.getItemProcessors())})),is(element,"jsr352:Chunk")&&(group.entries.push(entryFactory.selectBox({id:"checkpoint-policy",description:"Specifies the checkpoint policy that governs commit behavior for this chunk.",label:"Checkpoint Policy",modelProperty:"checkpoint-policy",selectOptions:[{name:"item",value:"item"},{name:"custom",value:"custom"}]})),group.entries.push(entryFactory.validationAwareTextField({id:"item-count",description:"Specifies the number of items to process per chunk when using the item checkpoint policy. ",label:"Item count",modelProperty:"item-count",getProperty:function(element){return getBusinessObject(element)["item-count"]},setProperty:function(element,properties){var bo=getBusinessObject(element);return cmdHelper.updateBusinessObject(element,bo,properties)},validate:function(element,values){return/^[0-9]+$/.test(values["item-count"])?{}:{"item-count":"Must be integer"}}})))}},{"../../../util/ComponentProvider":26,"../../../util/SelectOptionUtil":27,"../../factory/MultiSelectEntryFactory":17,"bpmn-js-properties-panel/lib/factory/EntryFactory":40,"bpmn-js-properties-panel/lib/helper/CmdHelper":49,"bpmn-js/lib/features/modeling/util/ModelingUtil":133,"bpmn-js/lib/util/ModelUtil":160}],25:[function(require,module,exports){"use strict";var entryFactory=require("bpmn-js-properties-panel/lib/factory/EntryFactory"),cmdHelper=require("bpmn-js-properties-panel/lib/helper/CmdHelper"),is=require("bpmn-js/lib/util/ModelUtil").is,getBusinessObject=require("bpmn-js/lib/util/ModelUtil").getBusinessObject;module.exports=function(group,element){is(element,"jsr352:Transition")&&group.entries.push(entryFactory.validationAwareTextField({id:"on",description:"Specifies the exit status value that activates this end element.",label:"on",modelProperty:"on",getProperty:function(element){return getBusinessObject(element).on},setProperty:function(element,properties){return properties.on&&(properties.name=properties.on),cmdHelper.updateProperties(element,properties)},validate:function(element,values){return/^.+$/.test(values.startLimit)?{}:{on:"Required"}}})),(is(element,"jsr352:Fail")||is(element,"jsr352:End")||is(element,"jsr352:Stop"))&&group.entries.push(entryFactory.textField({id:"exit-status",description:"Specifies the new exit status for the step. ",label:"exit-status",modelProperty:"exit-status"}))}},{"bpmn-js-properties-panel/lib/factory/EntryFactory":40,"bpmn-js-properties-panel/lib/helper/CmdHelper":49,"bpmn-js/lib/util/ModelUtil":160}],26:[function(require,module,exports){"use strict";function ComponentProvider(){}var controlBusNotFound,edn=require("edn"),controlBusMetaData=document.querySelector("meta[name=control-bus-url]"),controlBusURL=controlBusMetaData?document.querySelector("meta[name=control-bus-url]").getAttribute("content"):"http://localhost:45102";if(controlBusMetaData){var xhr=new XMLHttpRequest;xhr.withCredentials=!0;var componentJSON;xhr.addEventListener("load",function(ev){if(404===xhr.status)return void(controlBusNotFound=!0);componentJSON=edn.valueOf(edn.parse(xhr.responseText))}),xhr.open("GET",controlBusURL+"/default/batch-components"),xhr.send()}ComponentProvider.getBatchlets=function(){return controlBusMetaData&&!controlBusNotFound?componentJSON["batch-component/batchlet"]:[]},ComponentProvider.getItemReaders=function(){return controlBusMetaData&&!controlBusNotFound?componentJSON["batch-component/item-reader"]:[]},ComponentProvider.getItemProcessors=function(){return controlBusMetaData&&!controlBusNotFound?componentJSON["batch-component/item-processor"]:[]},ComponentProvider.getItemWriters=function(){return controlBusMetaData&&!controlBusNotFound?componentJSON["batch-component/item-writer"]:[]},ComponentProvider.getListeners=function(){return controlBusMetaData&&!controlBusNotFound?componentJSON["batch-component/listener"]:[]},module.exports=ComponentProvider},{edn:349}],27:[function(require,module,exports){"use strict";function SelectOptionUtil(){}SelectOptionUtil.toSelectOption=function(array){return[""].concat(array).map(function(value){return{name:value,value:value}})},module.exports=SelectOptionUtil},{}],28:[function(require,module,exports){module.exports=require("./lib")},{"./lib":53}],29:[function(require,module,exports){"use strict";function PropertiesActivator(eventBus,priority){var self=this;priority=priority||DEFAULT_PRIORITY,eventBus.on("propertiesPanel.isEntryVisible",priority,function(e){return self.isEntryVisible(e.entry,e.element)}),eventBus.on("propertiesPanel.isPropertyEditable",priority,function(e){return self.isPropertyEditable(e.entry,e.propertyName,e.element)})}var DEFAULT_PRIORITY=1e3;PropertiesActivator.$inject=["eventBus"],module.exports=PropertiesActivator,PropertiesActivator.prototype.isEntryVisible=function(entry,element){return!0},PropertiesActivator.prototype.isPropertyEditable=function(entry,propertyName,element){return!0}},{}],30:[function(require,module,exports){"use strict";function isToggle(node){return"checkbox"===node.type||"radio"===node.type}function isSelect(node){return"select-one"===node.type}function isContentEditable(node){return domAttr(node,"contenteditable")}function getPropertyPlaceholders(node){var selector="input[name], textarea[name], [data-value], [contenteditable]",placeholders=domQuery.all(selector,node);return placeholders&&placeholders.length||!domMatches(node,selector)||(placeholders=[node]),placeholders}function getFormControls(node,all){var controls=domQuery.all("input[name], textarea[name], select[name], [contenteditable]",node);return controls&&controls.length||(controls=domMatches(node,"option")?[node]:controls),all||(controls=filter(controls,function(node){return!domClosest(node,"."+HIDE_CLASS)})),controls}function getFormControlValuesInScope(entryNode){var values={},controlNodes=getFormControls(entryNode);return forEach(controlNodes,function(controlNode){var value=controlNode.value,name=domAttr(controlNode,"name")||domAttr(controlNode,"data-name");isToggle(controlNode)?value=controlNode.checked?!domAttr(controlNode,"value")||controlNode.value:null:isContentEditable(controlNode)&&(value=controlNode.innerText),null!==value&&(values[name]=value)}),values}function getFormControlValues(entryNode){var values,listContainer=domQuery("[data-list-entry-container]",entryNode);if(listContainer){values=[];var listNodes=listContainer.children||[];forEach(listNodes,function(listNode){values.push(getFormControlValuesInScope(listNode))})}else values=getFormControlValuesInScope(entryNode);return values}function valueEqual(value,oldValue){return!(value&&!oldValue)&&keys(value).concat(keys(oldValue)).every(function(key){return value[key]===oldValue[key]})}function valuesEqual(values,oldValues){return isArray(values)?values.length===oldValues.length&&values.every(function(v,idx){return valueEqual(v,oldValues[idx])}):valueEqual(values,oldValues)}function extractEntries(tabs){return indexBy(flattenDeep(map(flattenDeep(map(tabs,"groups")),"entries")),"id")}function extractGroups(tabs){return indexBy(flattenDeep(map(tabs,"groups")),"id")}function PropertiesPanel(config,eventBus,modeling,propertiesProvider,commandStack,canvas){this._eventBus=eventBus,this._modeling=modeling,this._commandStack=commandStack,this._canvas=canvas,this._propertiesProvider=propertiesProvider,this._init(config)}function setInputValue(node,value){var selection,contentEditable=isContentEditable(node),oldValue=contentEditable?node.innerText:node.value;void 0===value&&(value=""),oldValue!==value&&(document.activeElement===node&&(selection=updateSelection(getSelection(node),oldValue,value)),contentEditable?node.innerText=value:node.value=value,
selection&&setSelection(node,selection))}function setSelectValue(node,value){void 0!==value&&(node.value=value)}function setToggleValue(node,value){var nodeValue=node.value;node.checked=value===nodeValue||!domAttr(node,"value")&&value}function setTextValue(node,value){node.textContent=value}function getSelection(node){return isContentEditable(node)?getContentEditableSelection(node):{start:node.selectionStart,end:node.selectionEnd}}function getContentEditableSelection(node){var selection=window.getSelection(),focusNode=selection.focusNode,focusOffset=selection.focusOffset,anchorOffset=selection.anchorOffset;if(!focusNode)throw new Error("not selected");if(!node.contains(focusNode))throw new Error("not selected");return{start:Math.min(focusOffset,anchorOffset),end:Math.max(focusOffset,anchorOffset)}}function setSelection(node,selection){isContentEditable(node)?setContentEditableSelection(node,selection):(node.selectionStart=selection.start,node.selectionEnd=selection.end)}function setContentEditableSelection(node,selection){var focusNode,domRange,domSelection;focusNode=node.firstChild||node,domRange=document.createRange(),domRange.setStart(focusNode,selection.start),domRange.setEnd(focusNode,selection.end),domSelection=window.getSelection(),domSelection.removeAllRanges(),domSelection.addRange(domRange)}var domify=require("min-dom/lib/domify"),domQuery=require("min-dom/lib/query"),domRemove=require("min-dom/lib/remove"),domClasses=require("min-dom/lib/classes"),domClosest=require("min-dom/lib/closest"),domAttr=require("min-dom/lib/attr"),domDelegate=require("min-dom/lib/delegate"),domMatches=require("min-dom/lib/matches"),forEach=require("lodash/collection/forEach"),filter=require("lodash/collection/filter"),get=require("lodash/object/get"),keys=require("lodash/object/keys"),isEmpty=require("lodash/lang/isEmpty"),isArray=require("lodash/lang/isArray"),xor=require("lodash/array/xor"),debounce=require("lodash/function/debounce"),updateSelection=require("selection-update"),scrollTabs=require("scroll-tabs"),getBusinessObject=require("bpmn-js/lib/util/ModelUtil").getBusinessObject,HIDE_CLASS="bpp-hidden";PropertiesPanel.$inject=["config.propertiesPanel","eventBus","modeling","propertiesProvider","commandStack","canvas"],module.exports=PropertiesPanel,PropertiesPanel.prototype._init=function(config){var eventBus=this._eventBus,self=this;eventBus.on("root.added",function(e){self.update(e.element)}),eventBus.on("selection.changed",function(e){var newElement=e.newSelection[0];self.update(newElement)}),eventBus.on(["propertiesPanel.changed","propertiesPanel.resized"],function(event){var tabBarNode=domQuery(".bpp-properties-tab-bar",self._container);if(tabBarNode){var scroller=scrollTabs.get(tabBarNode);scroller||(scroller=scrollTabs(tabBarNode,{selectors:{tabsContainer:".bpp-properties-tabs-links",tab:".bpp-properties-tabs-links li",ignore:".bpp-hidden",active:".bpp-active"}}),scroller.on("scroll",function(newActiveNode,oldActiveNode,direction){var linkNode=domQuery("[data-tab-target]",newActiveNode),tabId=domAttr(linkNode,"data-tab-target");self.activateTab(tabId)})),scroller.update()}}),eventBus.on("elements.changed",function(e){var current=self._current,element=current&&current.element;element&&-1!==e.elements.indexOf(element)&&self.update(element)}),eventBus.on("elementTemplates.changed",function(){var current=self._current,element=current&&current.element;element&&self.update(element)}),eventBus.on("diagram.destroy",function(){self.detach()}),this._container=domify('<div class="bpp-properties-panel"></div>'),this._bindListeners(this._container),config&&config.parent&&this.attachTo(config.parent)},PropertiesPanel.prototype.attachTo=function(parentNode){if(!parentNode)throw new Error("parentNode required");this.detach(),parentNode.get&&(parentNode=parentNode.get(0)),"string"==typeof parentNode&&(parentNode=domQuery(parentNode));var container=this._container;parentNode.appendChild(container),this._emit("attach")},PropertiesPanel.prototype.detach=function(){var container=this._container,parentNode=container.parentNode;parentNode&&(this._emit("detach"),parentNode.removeChild(container))},PropertiesPanel.prototype.activateTab=function(tab){var tabId="string"==typeof tab?tab:tab.id,current=this._current,panelNode=current.panel,allTabNodes=domQuery.all(".bpp-properties-tab",panelNode),allTabLinkNodes=domQuery.all(".bpp-properties-tab-link",panelNode);forEach(allTabNodes,function(tabNode){var currentTabId=domAttr(tabNode,"data-tab");domClasses(tabNode).toggle("bpp-active",tabId===currentTabId)}),forEach(allTabLinkNodes,function(tabLinkNode){var tabLink=domQuery("[data-tab-target]",tabLinkNode),currentTabId=domAttr(tabLink,"data-tab-target");domClasses(tabLinkNode).toggle("bpp-active",tabId===currentTabId)})},PropertiesPanel.prototype.update=function(element){var current=this._current,needsCreate=!0;void 0===element&&(element=this._canvas.getRootElement());var newTabs=this._propertiesProvider.getTabs(element);if(current&&current.element===element&&(needsCreate=this._entriesChanged(current,newTabs)),needsCreate){if(current){var activeTabId,activeTabNode=domQuery(".bpp-properties-tab.bpp-active",current.panel);activeTabNode&&(activeTabId=domAttr(activeTabNode,"data-tab")),domRemove(current.panel)}this._current=this._create(element,newTabs),activeTabId?this.activateTab(activeTabId):this.activateTab(this._current.tabs[0])}this._current&&this._updateActivation(this._current),this._emit("changed")},PropertiesPanel.prototype._entriesChanged=function(current,newTabs){var oldEntryIds=keys(current.entries),newEntryIds=keys(extractEntries(newTabs));return!isEmpty(xor(oldEntryIds,newEntryIds))},PropertiesPanel.prototype._emit=function(event){this._eventBus.fire("propertiesPanel."+event,{panel:this,current:this._current})},PropertiesPanel.prototype._bindListeners=function(container){function handleInput(event,element){var inputNode=event.delegateTarget,entryNode=domClosest(inputNode,"[data-entry]");if(entryNode){var eventHandlerId=domAttr(inputNode,"data-blur"),entryId=domAttr(entryNode,"data-entry"),entry=self.getEntry(entryId);if(self.executeAction(entry,entryNode,eventHandlerId,event)){var values=getFormControlValues(entryNode);self.applyChanges(entry,values,entryNode)}self.updateState(entry,entryNode)}}var self=this,handleChange=function(event){var entryId,entry,node=domClosest(event.delegateTarget,"[data-entry]");if(node){entryId=domAttr(node,"data-entry"),entry=self.getEntry(entryId);var values=getFormControlValues(node);if("change"===event.type){var onChangeAction=event.delegateTarget.getAttribute("data-on-change");if(onChangeAction){if(!self.executeAction(entry,node,onChangeAction,event))return self.update(self._current.element)}}self.applyChanges(entry,values,node),self.updateState(entry,node)}};domDelegate.bind(container,"input, textarea, [contenteditable]","input",debounce(handleChange,300)),domDelegate.bind(container,"input, textarea, select, [contenteditable]","change",handleChange),domDelegate.bind(container,"[data-action]","click",function(event){var inputNode=event.delegateTarget,entryNode=domClosest(inputNode,"[data-entry]"),actionId=domAttr(inputNode,"data-action"),entryId=domAttr(entryNode,"data-entry"),entry=self.getEntry(entryId);if(self.executeAction(entry,entryNode,actionId,event)){var values=getFormControlValues(entryNode);self.applyChanges(entry,values,entryNode)}self.updateState(entry,entryNode)}),domDelegate.bind(container,"[data-blur]","blur",handleInput,!0),domDelegate.bind(container,".bpp-properties-tabs-links [data-tab-target]","click",function(event){event.preventDefault();var delegateTarget=event.delegateTarget,tabId=domAttr(delegateTarget,"data-tab-target");self.activateTab(tabId)})},PropertiesPanel.prototype.updateState=function(entry,entryNode){this.updateShow(entry,entryNode),this.updateDisable(entry,entryNode)},PropertiesPanel.prototype.updateShow=function(entry,node){var current=this._current;if(current){var showNodes=domQuery.all("[data-show]",node)||[];forEach(showNodes,function(showNode){var expr=domAttr(showNode,"data-show"),fn=get(entry,expr);if(fn){var scope=domClosest(showNode,"[data-scope]")||node,shouldShow=fn(current.element,node,showNode,scope)||!1,hasClass=domClasses(showNode).has(HIDE_CLASS);shouldShow?hasClass&&domClasses(showNode).remove(HIDE_CLASS):domClasses(showNode).add(HIDE_CLASS)}})}},PropertiesPanel.prototype.updateDisable=function(entry,node){var current=this._current;if(current){var nodes=domQuery.all("[data-disable]",node)||[];forEach(nodes,function(currentNode){var expr=domAttr(currentNode,"data-disable"),fn=get(entry,expr);if(fn){var scope=domClosest(currentNode,"[data-scope]")||node,shouldDisable=fn(current.element,node,currentNode,scope)||!1;domAttr(currentNode,"disabled",shouldDisable?"":null)}})}},PropertiesPanel.prototype.executeAction=function(entry,entryNode,actionId,event){var current=this._current;if(current){var fn=get(entry,actionId);if(fn){var scopeNode=domClosest(event.target,"[data-scope]")||entryNode;return fn.apply(entry,[current.element,entryNode,event,scopeNode])}}},PropertiesPanel.prototype.applyChanges=function(entry,values,containerElement){var element=this._current.element;if(!valuesEqual(values,entry.oldValues)){var commandToExecute,command=entry.set(element,values,containerElement);isArray(command)?command.length&&(commandToExecute={cmd:"properties-panel.multi-command-executor",context:flattenDeep(command)}):commandToExecute=command,commandToExecute?this._commandStack.execute(commandToExecute.cmd,commandToExecute.context||{element:element}):this.update(element)}},PropertiesPanel.prototype.applyValidationErrors=function(validationErrors,entryNode){var valid=!0,controlNodes=getFormControls(entryNode,!0);return forEach(controlNodes,function(controlNode){var name=domAttr(controlNode,"name")||domAttr(controlNode,"data-name"),error=validationErrors&&validationErrors[name],errorMessageNode=domQuery(".bpp-error-message",controlNode.parentNode);error?(valid=!1,errorMessageNode||(errorMessageNode=domify("<div></div>"),domClasses(errorMessageNode).add("bpp-error-message"),controlNode.parentNode.insertBefore(errorMessageNode,controlNode.nextSibling)),errorMessageNode.innerHTML=error,domClasses(controlNode).add("invalid")):(domClasses(controlNode).remove("invalid"),errorMessageNode&&controlNode.parentNode.removeChild(errorMessageNode))}),valid},PropertiesPanel.prototype.validate=function(entry,values,entryNode){var self=this,current=this._current,valid=!0;if(entryNode=entryNode||domQuery('[data-entry="'+entry.id+'"]',current.panel),values instanceof Array)for(var listContainer=domQuery("[data-list-entry-container]",entryNode),listEntryNodes=listContainer.children||[],i=0;i<values.length;i++){var listValue=values[i];if(entry.validateListItem){var validationErrors=entry.validateListItem(current.element,listValue,entryNode,i),listEntryNode=listEntryNodes[i];valid=self.applyValidationErrors(validationErrors,listEntryNode)&&valid}}else entry.validate&&(this.validationErrors=entry.validate(current.element,values,entryNode),valid=self.applyValidationErrors(this.validationErrors,entryNode)&&valid);return valid},PropertiesPanel.prototype.getEntry=function(id){return this._current&&this._current.entries[id]};var flattenDeep=require("lodash/array/flattenDeep"),indexBy=require("lodash/collection/indexBy"),map=require("lodash/collection/map");PropertiesPanel.prototype._create=function(element,tabs){if(!element)return null;var containerNode=this._container,panelNode=this._createPanel(element,tabs);containerNode.appendChild(panelNode);var entries=extractEntries(tabs);return{tabs:tabs,groups:extractGroups(tabs),entries:entries,element:element,panel:panelNode}},PropertiesPanel.prototype._bindTemplate=function(element,entry,values,entryNode,idx){function isPropertyEditable(entry,propertyName){return eventBus.fire("propertiesPanel.isPropertyEditable",{entry:entry,propertyName:propertyName,element:element})}var eventBus=this._eventBus,inputNodes=getPropertyPlaceholders(entryNode);forEach(inputNodes,function(node){var name,newValue,editable;"value"in node||"true"===isContentEditable(node)?(name=domAttr(node,"name")||domAttr(node,"data-name"),newValue=values[name],editable=isPropertyEditable(entry,name),editable&&entry.editable&&(editable=entry.editable(element,entryNode,node,name,newValue,idx)),domAttr(node,"readonly",editable?null:""),domAttr(node,"disabled",editable?null:""),entry.setControlValue?entry.setControlValue(element,entryNode,node,name,newValue,idx):isToggle(node)?setToggleValue(node,newValue):isSelect(node)?setSelectValue(node,newValue):setInputValue(node,newValue)):(name=domAttr(node,"data-value"),newValue=values[name],entry.setControlValue?entry.setControlValue(element,entryNode,node,name,newValue,idx):setTextValue(node,newValue))})},PropertiesPanel.prototype._updateActivation=function(current){function isEntryVisible(entry){return eventBus.fire("propertiesPanel.isEntryVisible",{entry:entry,element:element})}function isGroupVisible(group,element,groupNode){return"function"!=typeof group.enabled||group.enabled(element,groupNode)}function isTabVisible(tab,element){return"function"!=typeof tab.enabled||tab.enabled(element)}function toggleVisible(node,visible){domClasses(node).toggle(HIDE_CLASS,!visible)}function checkActiveTabVisibility(node,visible){var isActive=domClasses(node).has("bpp-active");!visible&&isActive&&self.activateTab(current.tabs[0])}function updateLabel(element,selector,text){var labelNode=domQuery(selector,element);labelNode&&(labelNode.textContent=text)}var self=this,eventBus=this._eventBus,element=current.element,panelNode=current.panel;forEach(current.tabs,function(tab){var tabNode=domQuery("[data-tab="+tab.id+"]",panelNode),tabLinkNode=domQuery("[data-tab-target="+tab.id+"]",panelNode).parentNode,tabVisible=!1;forEach(tab.groups,function(group){var groupVisible=!1,groupNode=domQuery("[data-group="+group.id+"]",tabNode);forEach(group.entries,function(entry){var entryNode=domQuery('[data-entry="'+entry.id+'"]',groupNode),entryVisible=isEntryVisible(entry);groupVisible=groupVisible||entryVisible,toggleVisible(entryNode,entryVisible);var values="get"in entry?entry.get(element,entryNode):{};if(values instanceof Array){for(var listEntryContainer=domQuery("[data-list-entry-container]",entryNode),existingElements=listEntryContainer.children||[],i=0;i<values.length;i++){var listValue=values[i],listItemNode=existingElements[i];listItemNode||(listItemNode=domify(entry.createListEntryTemplate(listValue,i,listEntryContainer)),listEntryContainer.appendChild(listItemNode)),domAttr(listItemNode,"data-index",i),self._bindTemplate(element,entry,listValue,listItemNode,i)}for(var entriesToRemove=existingElements.length-values.length,j=0;j<entriesToRemove;j++)listEntryContainer.removeChild(listEntryContainer.lastChild)}else self._bindTemplate(element,entry,values,entryNode);self.updateState(entry,entryNode),self.validate(entry,values,entryNode),entry.oldValues=getFormControlValues(entryNode)}),"function"==typeof group.label&&updateLabel(groupNode,".group-label",group.label(element,groupNode)),groupVisible=groupVisible&&isGroupVisible(group,element,groupNode),tabVisible=tabVisible||groupVisible,toggleVisible(groupNode,groupVisible)}),tabVisible=tabVisible&&isTabVisible(tab,element),toggleVisible(tabNode,tabVisible),toggleVisible(tabLinkNode,tabVisible),checkActiveTabVisibility(tabNode,tabVisible)}),updateLabel(panelNode,"[data-label-id]",getBusinessObject(element).id||"")},PropertiesPanel.prototype._createPanel=function(element,tabs){var self=this,panelNode=domify('<div class="bpp-properties"></div>'),headerNode=domify('<div class="bpp-properties-header"><div class="label" data-label-id></div><div class="search"><input type="search" placeholder="Search for property" /><button><span>Search</span></button></div></div>'),tabBarNode=domify('<div class="bpp-properties-tab-bar"></div>'),tabLinksNode=domify('<ul class="bpp-properties-tabs-links"></ul>'),tabContainerNode=domify('<div class="bpp-properties-tabs-container"></div>');return panelNode.appendChild(headerNode),forEach(tabs,function(tab,tabIndex){if(!tab.id)throw new Error("tab must have an id");var tabNode=domify('<div class="bpp-properties-tab" data-tab="'+tab.id+'"></div>'),tabLinkNode=domify('<li class="bpp-properties-tab-link"><a href data-tab-target="'+tab.id+'">'+tab.label+"</a></li>"),groups=tab.groups;forEach(groups,function(group){if(!group.id)throw new Error("group must have an id");var groupNode=domify('<div class="bpp-properties-group" data-group="'+group.id+'"><span class="group-toggle"></span><span class="group-label">'+group.label+"</span></div>");groupNode.querySelector(".group-toggle").addEventListener("click",function(evt){domClasses(groupNode).toggle("group-closed"),evt.preventDefault(),evt.stopPropagation()}),groupNode.addEventListener("click",function(evt){!evt.defaultPrevented&&domClasses(groupNode).has("group-closed")&&domClasses(groupNode).remove("group-closed")}),forEach(group.entries,function(entry){if(!entry.id)throw new Error("entry must have an id");var html=entry.html;"string"==typeof html&&(html=domify(html)),html.get&&(html=html.get(0));var entryNode=domify('<div class="bpp-properties-entry" data-entry="'+entry.id+'"></div>');forEach(entry.cssClasses||[],function(cssClass){domClasses(entryNode).add(cssClass)}),entryNode.appendChild(html),groupNode.appendChild(entryNode),self.updateState(entry,entryNode)}),tabNode.appendChild(groupNode)}),tabLinksNode.appendChild(tabLinkNode),tabContainerNode.appendChild(tabNode)}),tabBarNode.appendChild(tabLinksNode),panelNode.appendChild(tabBarNode),panelNode.appendChild(tabContainerNode),panelNode}},{"bpmn-js/lib/util/ModelUtil":160,"lodash/array/flattenDeep":357,"lodash/array/xor":363,"lodash/collection/filter":367,"lodash/collection/forEach":369,"lodash/collection/indexBy":372,"lodash/collection/map":373,"lodash/function/debounce":381,"lodash/lang/isArray":492,"lodash/lang/isEmpty":493,"lodash/object/get":504,"lodash/object/keys":506,"min-dom/lib/attr":517,"min-dom/lib/classes":518,"min-dom/lib/closest":520,"min-dom/lib/delegate":521,"min-dom/lib/domify":522,"min-dom/lib/matches":524,"min-dom/lib/query":525,"min-dom/lib/remove":526,"scroll-tabs":543,"selection-update":544}],31:[function(require,module,exports){"use strict";function selectedOption(selectBox){if(selectBox.selectedIndex>=0)return selectBox.options[selectBox.selectedIndex].value}function selectedType(elementSyntax,inputNode){return selectedOption(domQuery(elementSyntax,inputNode))}function getRoot(businessObject){for(var parent=businessObject;parent.$parent;)parent=parent.$parent;return parent}function filterElementsByType(objectList,type){var list=objectList||[],result=[];return forEach(list,function(obj){is(obj,type)&&result.push(obj)}),result}function findRootElementsByType(businessObject,referencedType){return filterElementsByType(getRoot(businessObject).rootElements,referencedType)}function removeAllChildren(domElement){for(;domElement.firstChild;)domElement.removeChild(domElement.firstChild)}function addEmptyParameter(list){return list.push({label:"",value:"",name:""})}function refreshOptionsModel(businessObject,referencedType){var model=[],referableObjects=findRootElementsByType(businessObject,referencedType);return forEach(referableObjects,function(obj){model.push({label:(obj.name||"")+" (id="+obj.id+")",value:obj.id,name:obj.name})}),model}function updateOptionsDropDown(domSelector,businessObject,referencedType,entryNode){var options=refreshOptionsModel(businessObject,referencedType);addEmptyParameter(options);var selectBox=domQuery(domSelector,entryNode);return domClear(selectBox),forEach(options,function(option){var optionEntry=domify('<option value="'+option.value+'">'+option.label+"</option>");selectBox.appendChild(optionEntry)}),options}function isIdValid(bo,idValue){var assigned=bo.$model.ids.assigned(idValue),idExists=assigned&&assigned!==bo;return!idValue||idExists?"Element must have an unique id.":validateId(idValue)}function validateId(idValue){return idValue=stripPlaceholders(idValue),containsSpace(idValue)?"Id must not contain spaces.":ID_REGEX.test(idValue)?void 0:QNAME_REGEX.test(idValue)?"Id must not contain prefix.":"Id must be a valid QName."}function containsSpace(value){return SPACE_REGEX.test(value)}function stripPlaceholders(idValue){return idValue.replace(PLACEHOLDER_REGEX,"$1")}function nextId(prefix){return new Ids([32,32,1]).nextPrefixed(prefix)}function triggerClickEvent(element){var evt;if(document.createEvent){try{evt=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})}catch(e){evt=document.createEvent("MouseEvent"),evt.initEvent("click",!0,!0)}return element.dispatchEvent(evt)}return evt=document.createEventObject(),element.fireEvent("onclick",evt)}var domQuery=require("min-dom/lib/query"),domClear=require("min-dom/lib/clear"),is=require("bpmn-js/lib/util/ModelUtil").is,forEach=require("lodash/collection/forEach"),domify=require("min-dom/lib/domify"),Ids=require("ids"),SPACE_REGEX=/\s/,QNAME_REGEX=/^([a-z][\w-.]*:)?[a-z_][\w-.]*$/i,ID_REGEX=/^[a-z_][\w-.]*$/i,PLACEHOLDER_REGEX=/\$\{([^\}]*)\}/g;module.exports.selectedOption=selectedOption,module.exports.selectedType=selectedType,module.exports.getRoot=getRoot,module.exports.filterElementsByType=filterElementsByType,module.exports.findRootElementsByType=findRootElementsByType,module.exports.removeAllChildren=removeAllChildren,module.exports.addEmptyParameter=addEmptyParameter,module.exports.refreshOptionsModel=refreshOptionsModel,module.exports.updateOptionsDropDown=updateOptionsDropDown,module.exports.isIdValid=isIdValid,module.exports.validateId=validateId,module.exports.containsSpace=containsSpace,module.exports.nextId=nextId,module.exports.triggerClickEvent=triggerClickEvent},{"bpmn-js/lib/util/ModelUtil":160,ids:353,"lodash/collection/forEach":369,"min-dom/lib/clear":519,"min-dom/lib/domify":522,"min-dom/lib/query":525}],32:[function(require,module,exports){"use strict";function CreateAndReferenceElementHandler(elementRegistry,bpmnFactory){this._elementRegistry=elementRegistry,this._bpmnFactory=bpmnFactory}function ensureNotNull(prop,name){if(!prop)throw new Error(name+" required");return prop}var elementHelper=require("../helper/ElementHelper");CreateAndReferenceElementHandler.$inject=["elementRegistry","bpmnFactory"],module.exports=CreateAndReferenceElementHandler,CreateAndReferenceElementHandler.prototype.execute=function(context){var referencingObject=ensureNotNull(context.referencingObject,"referencingObject"),referenceProperty=ensureNotNull(context.referenceProperty,"referenceProperty"),newObject=ensureNotNull(context.newObject,"newObject"),newObjectContainer=ensureNotNull(context.newObjectContainer,"newObjectContainer"),newObjectParent=ensureNotNull(context.newObjectParent,"newObjectParent"),changed=[context.element],referencedObject=elementHelper.createElement(newObject.type,newObject.properties,newObjectParent,this._bpmnFactory);return context.referencedObject=referencedObject,newObjectContainer.push(referencedObject),context.previousReference=referencingObject[referenceProperty],referencingObject[referenceProperty]=referencedObject,context.changed=changed,changed},CreateAndReferenceElementHandler.prototype.revert=function(context){var referencingObject=context.referencingObject,referenceProperty=context.referenceProperty,previousReference=context.previousReference,referencedObject=context.referencedObject,newObjectContainer=context.newObjectContainer;return referencingObject.set(referenceProperty,previousReference),newObjectContainer.splice(newObjectContainer.indexOf(referencedObject),1),context.changed}},{"../helper/ElementHelper":50}],33:[function(require,module,exports){"use strict";function CreateBusinessObjectListHandler(elementRegistry,bpmnFactory){this._elementRegistry=elementRegistry,this._bpmnFactory=bpmnFactory}function ensureNotNull(prop,name){if(!prop)throw new Error(name+" required");return prop}function ensureList(prop,name){if(!prop||"[object Array]"!==Object.prototype.toString.call(prop))throw new Error(name+" needs to be a list");return prop}var forEach=require("lodash/collection/forEach"),elementHelper=require("../helper/ElementHelper");CreateBusinessObjectListHandler.$inject=["elementRegistry","bpmnFactory"],module.exports=CreateBusinessObjectListHandler,CreateBusinessObjectListHandler.prototype.execute=function(context){var currentObject=ensureNotNull(context.currentObject,"currentObject"),propertyName=ensureNotNull(context.propertyName,"propertyName"),newObjects=ensureList(context.newObjects,"newObjects"),changed=[context.element],childObjects=[],self=this;return forEach(newObjects,function(obj){var element=elementHelper.createElement(obj.type,obj.properties,currentObject,self._bpmnFactory);childObjects.push(element)}),context.childObject=childObjects,context.previousChilds=currentObject[propertyName],currentObject[propertyName]=childObjects,context.changed=changed,changed},CreateBusinessObjectListHandler.prototype.revert=function(context){var currentObject=context.currentObject,propertyName=context.propertyName,previousChilds=context.previousChilds;return currentObject.set(propertyName,previousChilds),context.changed}},{"../helper/ElementHelper":50,"lodash/collection/forEach":369}],34:[function(require,module,exports){"use strict";function MultiCommandHandler(commandStack){this._commandStack=commandStack}var forEach=require("lodash/collection/forEach");MultiCommandHandler.$inject=["commandStack"],module.exports=MultiCommandHandler,MultiCommandHandler.prototype.preExecute=function(context){var commandStack=this._commandStack;forEach(context,function(command){commandStack.execute(command.cmd,command.context)})}},{"lodash/collection/forEach":369}],35:[function(require,module,exports){"use strict";function UpdateBusinessObjectHandler(elementRegistry){this._elementRegistry=elementRegistry}function getRoot(businessObject){for(var parent=businessObject;parent.$parent;)parent=parent.$parent;return parent}function getProperties(businessObject,propertyNames){return reduce(propertyNames,function(result,key){return result[key]=businessObject.get(key),result},{})}function setProperties(businessObject,properties){forEach(properties,function(value,key){businessObject.set(key,value)})}var reduce=require("lodash/object/transform"),is=require("bpmn-js/lib/util/ModelUtil").is,keys=require("lodash/object/keys"),forEach=require("lodash/collection/forEach");UpdateBusinessObjectHandler.$inject=["elementRegistry"],module.exports=UpdateBusinessObjectHandler,UpdateBusinessObjectHandler.prototype.execute=function(context){var element=context.element,businessObject=context.businessObject,rootElements=getRoot(businessObject).rootElements,referenceType=context.referenceType,referenceProperty=context.referenceProperty,changed=[element];if(!element)throw new Error("element required");if(!businessObject)throw new Error("businessObject required");var properties=context.properties,oldProperties=context.oldProperties||getProperties(businessObject,keys(properties));return void 0!==referenceType&&void 0!==referenceProperty&&forEach(rootElements,function(rootElement){is(rootElement,referenceType)&&rootElement.id===properties[referenceProperty]&&(properties[referenceProperty]=rootElement)}),setProperties(businessObject,properties),context.oldProperties=oldProperties,context.changed=changed,changed},UpdateBusinessObjectHandler.prototype.revert=function(context){var oldProperties=context.oldProperties;return setProperties(context.businessObject,oldProperties),context.changed}},{"bpmn-js/lib/util/ModelUtil":160,"lodash/collection/forEach":369,"lodash/object/keys":506,"lodash/object/transform":512}],36:[function(require,module,exports){"use strict";function UpdateBusinessObjectListHandler(elementRegistry,bpmnFactory){this._elementRegistry=elementRegistry,this._bpmnFactory=bpmnFactory}function ensureNotNull(prop,name){if(!prop)throw new Error(name+"required");return prop}var forEach=require("lodash/collection/forEach");UpdateBusinessObjectListHandler.$inject=["elementRegistry","bpmnFactory"],module.exports=UpdateBusinessObjectListHandler,UpdateBusinessObjectListHandler.prototype.execute=function(context){var referencePropertyName,currentObject=ensureNotNull(context.currentObject,"currentObject"),propertyName=ensureNotNull(context.propertyName,"propertyName"),updatedObjectList=context.updatedObjectList,objectsToRemove=context.objectsToRemove||[],objectsToAdd=context.objectsToAdd||[],changed=[context.element];context.referencePropertyName&&(referencePropertyName=context.referencePropertyName);var objectList=currentObject[propertyName];if(context.previousList=currentObject[propertyName],updatedObjectList)currentObject[propertyName]=updatedObjectList;else{var listCopy=[];if(forEach(objectList,function(object){-1==objectsToRemove.indexOf(object)&&listCopy.push(object)}),listCopy=listCopy.concat(objectsToAdd),listCopy.length>0||!referencePropertyName)currentObject[propertyName]=listCopy;else if(referencePropertyName){var parentObject=currentObject.$parent;parentObject.set(referencePropertyName,void 0)}}return context.changed=changed,changed},UpdateBusinessObjectListHandler.prototype.revert=function(context){var currentObject=context.currentObject,propertyName=context.propertyName,previousList=context.previousList,parentObject=currentObject.$parent;return context.referencePropertyName&&parentObject.set(context.referencePropertyName,currentObject),currentObject.set(propertyName,previousList),context.changed}},{"lodash/collection/forEach":369}],37:[function(require,module,exports){"use strict";function CommandInitializer(eventBus,commandStack){eventBus.on("diagram.init",function(){forEach(HANDLERS,function(handler,id){commandStack.registerHandler(id,handler)})})}var forEach=require("lodash/collection/forEach"),HANDLERS={"properties-panel.update-businessobject":require("./UpdateBusinessObjectHandler"),"properties-panel.create-and-reference":require("./CreateAndReferenceHandler"),"properties-panel.create-businessobject-list":require("./CreateBusinessObjectListHandler"),"properties-panel.update-businessobject-list":require("./UpdateBusinessObjectListHandler"),"properties-panel.multi-command-executor":require("./MultiCommandHandler")};CommandInitializer.$inject=["eventBus","commandStack"],module.exports={__init__:[CommandInitializer]}},{"./CreateAndReferenceHandler":32,"./CreateBusinessObjectListHandler":33,"./MultiCommandHandler":34,"./UpdateBusinessObjectHandler":35,"./UpdateBusinessObjectListHandler":36,"lodash/collection/forEach":369}],38:[function(require,module,exports){"use strict";var getBusinessObject=require("bpmn-js/lib/util/ModelUtil").getBusinessObject,cmdHelper=require("../helper/CmdHelper"),entryFieldDescription=require("./EntryFieldDescription"),checkbox=function(options,defaultParameters){var resource=defaultParameters,label=options.label||resource.id,canBeDisabled=!!options.disabled&&"function"==typeof options.disabled,description=options.description;return resource.html='<input id="camunda-'+resource.id+'" type="checkbox" name="'+options.modelProperty+'" '+(canBeDisabled?'data-show="isDisabled"':"")+' /><label for="camunda-'+resource.id+'" '+(canBeDisabled?'data-show="isDisabled"':"")+">"+label+"</label>",description&&(resource.html+=entryFieldDescription(description)),resource.get=function(element){var bo=getBusinessObject(element),res={};return res[options.modelProperty]=bo.get(options.modelProperty),res},resource.set=function(element,values){var res={};return res[options.modelProperty]=!!values[options.modelProperty],cmdHelper.updateProperties(element,res)},"function"==typeof options.set&&(resource.set=options.set),"function"==typeof options.get&&(resource.get=options.get),canBeDisabled&&(resource.isDisabled=function(){return!options.disabled.apply(resource,arguments)}),resource.cssClasses=["bpp-checkbox"],resource};module.exports=checkbox},{
"../helper/CmdHelper":49,"./EntryFieldDescription":41,"bpmn-js/lib/util/ModelUtil":160}],39:[function(require,module,exports){"use strict";var assign=require("lodash/object/assign"),find=require("lodash/collection/find"),domQuery=require("min-dom/lib/query"),selectEntryFactory=require("./SelectEntryFactory"),entryFieldDescription=require("./EntryFieldDescription"),comboBox=function(options){var selectOptions=options.selectOptions,modelProperty=options.modelProperty,customValue=options.customValue||"custom",customName=options.customName||"custom "+modelProperty,description=options.description,isCustomValue=function(value){return void 0!==value[modelProperty]&&!find(selectOptions,function(option){return value[modelProperty]===option.value})},comboOptions=assign({},options);comboOptions.showCustomInput=function(element,node){var selectBox=domQuery('[data-entry="'+options.id+'"] select',node.parentNode);return!!selectBox&&selectBox.value===customValue},comboOptions.get=function(element,node){var value=options.get(element,node),modifiedValues={};return isCustomValue(value)?(modifiedValues[modelProperty]=customValue,modifiedValues["custom-"+modelProperty]=value[modelProperty],modifiedValues):(modifiedValues[modelProperty]=value[modelProperty]||"",modifiedValues)},comboOptions.set=function(element,values,node){var modifiedValues={};return values[modelProperty]===customValue?modifiedValues[modelProperty]=values["custom-"+modelProperty]||"":options.emptyParameter&&""===values[modelProperty]?modifiedValues[modelProperty]=void 0:modifiedValues[modelProperty]=values[modelProperty],options.set(element,modifiedValues,node)},comboOptions.selectOptions.push({name:customName,value:customValue});var comboBoxEntry=assign({},selectEntryFactory(comboOptions,comboOptions));return comboBoxEntry.html+='<div class="bpp-field-wrapper bpp-combo-input" data-show="showCustomInput"><input id="camunda-'+options.id+'-input" type="text" name="custom-'+modelProperty+'"  /></div>',description&&(comboBoxEntry.html+=entryFieldDescription(description)),comboBoxEntry};module.exports=comboBox},{"./EntryFieldDescription":41,"./SelectEntryFactory":44,"lodash/collection/find":368,"lodash/object/assign":502,"min-dom/lib/query":525}],40:[function(require,module,exports){"use strict";function ensureNotNull(prop){if(!prop)throw new Error(prop+" must be set.");return prop}function EntryFactory(){}var getBusinessObject=require("bpmn-js/lib/util/ModelUtil").getBusinessObject,textInputField=require("./TextInputEntryFactory"),checkboxField=require("./CheckboxEntryFactory"),selectBoxField=require("./SelectEntryFactory"),comboBoxField=require("./ComboEntryFactory"),textBoxField=require("./TextBoxEntryFactory"),validationAwareTextInputField=require("./ValidationAwareTextInput"),tableField=require("./TableEntryFactory"),labelEntry=require("./LabelFactory"),link=require("./LinkEntryFactory"),cmdHelper=require("../helper/CmdHelper"),setDefaultParameters=function(options){var defaultGet=function(element){var bo=getBusinessObject(element),res={},prop=ensureNotNull(options.modelProperty);return res[prop]=bo.get(prop),res},defaultSet=function(element,values){var res={},prop=ensureNotNull(options.modelProperty);return""!==values[prop]?res[prop]=values[prop]:res[prop]=void 0,cmdHelper.updateProperties(element,res)},defaultValidate=function(){return{}};return{id:options.id,description:options.description||"",get:options.get||defaultGet,set:options.set||defaultSet,validate:options.validate||defaultValidate,html:""}};EntryFactory.textField=function(options){return textInputField(options,setDefaultParameters(options))},EntryFactory.validationAwareTextField=function(options){return validationAwareTextInputField(options,setDefaultParameters(options))},EntryFactory.checkbox=function(options){return checkboxField(options,setDefaultParameters(options))},EntryFactory.textBox=function(options){return textBoxField(options,setDefaultParameters(options))},EntryFactory.selectBox=function(options){return selectBoxField(options,setDefaultParameters(options))},EntryFactory.comboBox=function(options){return comboBoxField(options)},EntryFactory.table=function(options){return tableField(options)},EntryFactory.label=function(options){return labelEntry(options)},EntryFactory.link=function(options){return link(options)},module.exports=EntryFactory},{"../helper/CmdHelper":49,"./CheckboxEntryFactory":38,"./ComboEntryFactory":39,"./LabelFactory":42,"./LinkEntryFactory":43,"./SelectEntryFactory":44,"./TableEntryFactory":45,"./TextBoxEntryFactory":46,"./TextInputEntryFactory":47,"./ValidationAwareTextInput":48,"bpmn-js/lib/util/ModelUtil":160}],41:[function(require,module,exports){"use strict";function linkify(text){return text.replace(MARKDOWN_LINK_REGEX,'<a href="$2" target="_blank">$1</a>')}var MARKDOWN_LINK_REGEX=/\[([^\)]+)\]\(([^\]]+)\)/g;module.exports=function(description){return'<div class="bpp-field-description">'+(description=linkify(description))+"</div>"}},{}],42:[function(require,module,exports){"use strict";var label=function(options){return{id:options.id,html:'<label data-value="label" data-show="showLabel" class="entry-label'+(options.divider?" divider":"")+'"></label>',get:function(element,node){return"function"==typeof options.get?options.get(element,node):{label:options.labelText}},showLabel:function(element,node){return"function"!=typeof options.showLabel||options.showLabel(element,node)}}};module.exports=label},{}],43:[function(require,module,exports){"use strict";var utils=require("../Utils"),entryFieldDescription=require("./EntryFieldDescription"),link=function(options,defaultParameters){var id=options.id,label=options.label||id,hideLink=options.hideLink,canBeHidden="function"==typeof hideLink,getClickableElement=options.getClickableElement,description=options.description,resource={id:id};return resource.html='<a data-action="linkSelected" '+(canBeHidden?'data-show="hideLink" ':"")+'class="bpp-entry-link'+(options.cssClasses?" "+options.cssClasses:"")+'">'+label+"</a>",description&&(resource.html+=entryFieldDescription(description)),resource.linkSelected=function(element,node,event,scopeNode){if("function"==typeof getClickableElement){var link=getClickableElement.apply(resource,[element,node,event,scopeNode]);link&&utils.triggerClickEvent(link)}return!1},canBeHidden&&(resource.hideLink=function(){return!hideLink.apply(resource,arguments)}),resource};module.exports=link},{"../Utils":31,"./EntryFieldDescription":41}],44:[function(require,module,exports){"use strict";var domify=require("min-dom/lib/domify"),forEach=require("lodash/collection/forEach"),entryFieldDescription=require("./EntryFieldDescription"),isList=function(list){return!(!list||"[object Array]"!==Object.prototype.toString.call(list))},addEmptyParameter=function(list){return list.concat([{name:"",value:""}])},createOption=function(option){return'<option value="'+option.value+'">'+option.name+"</option>"},selectbox=function(options,defaultParameters){var resource=defaultParameters,label=options.label||resource.id,selectOptions=options.selectOptions||[{name:"",value:""}],modelProperty=options.modelProperty,emptyParameter=options.emptyParameter,canBeDisabled=!!options.disabled&&"function"==typeof options.disabled,description=options.description;return emptyParameter&&(selectOptions=addEmptyParameter(selectOptions)),resource.html='<label for="camunda-'+resource.id+'"'+(canBeDisabled?'data-show="isDisabled" ':"")+">"+label+'</label><select id="camunda-'+resource.id+'-select" name="'+modelProperty+'"'+(canBeDisabled?'data-show="isDisabled" ':"")+" data-value>",isList(selectOptions)&&forEach(selectOptions,function(option){resource.html+='<option value="'+option.value+'">'+(option.name||"")+"</option>"}),resource.html+="</select>",description&&"function"===(options.showCustomInput,!1)&&(resource.html+=entryFieldDescription(description)),resource.setControlValue=function(element,entryNode,inputNode,inputName,newValue){if("function"==typeof selectOptions){var options=selectOptions(element,inputNode);if(options){for(;inputNode.firstChild;)inputNode.removeChild(inputNode.firstChild);forEach(options,function(option){var template=domify(createOption(option));inputNode.appendChild(template)})}}void 0!==newValue&&(inputNode.value=newValue)},canBeDisabled&&(resource.isDisabled=function(){return!options.disabled.apply(resource,arguments)}),resource.cssClasses=["dropdown"],resource};module.exports=selectbox},{"./EntryFieldDescription":41,"lodash/collection/forEach":369,"min-dom/lib/domify":522}],45:[function(require,module,exports){"use strict";function createInputRowTemplate(properties,canRemove){var template=TABLE_ROW_DIV_SNIPPET;return template+=createInputTemplate(properties,canRemove),template+=canRemove?DELETE_ROW_BUTTON_SNIPPET:"",template+="</div>"}function createInputTemplate(properties,canRemove){var columns=properties.length,template="";return forEach(properties,function(prop){template+='<input class="bpp-table-row-columns-'+columns+" "+(canRemove?"bpp-table-row-removable":"")+'" id="camunda-table-row-cell-input-value" type="text" name="'+prop+'" />'}),template}function createLabelRowTemplate(labels){var template=TABLE_ROW_DIV_SNIPPET;return template+=createLabelTemplate(labels),template+="</div>"}function createLabelTemplate(labels){var columns=labels.length,template="";return forEach(labels,function(label){template+='<label class="bpp-table-row-columns-'+columns+'">'+label+"</label>"}),template}function pick(elements,properties){return(elements||[]).map(function(elem){var newElement={};return forEach(properties,function(prop){newElement[prop]=elem[prop]||""}),newElement})}function diff(element,node,values,oldValues,editable){return filter(values,function(value,idx){return!valueEqual(element,node,value,oldValues[idx],editable,idx)})}function valueEqual(element,node,value,oldValue,editable,idx){return!(value&&!oldValue)&&keys(value).concat(keys(oldValue)).every(function(key){var n=value[key]||void 0,o=oldValue[key]||void 0;return!editable(element,node,key,idx)||n===o})}function getEntryNode(node){return domClosest(node,"[data-entry]",!0)}function getContainer(node){return domQuery("div[data-list-entry-container]",node)}function getSelection(node){return{start:node.selectionStart,end:node.selectionEnd}}function setSelection(node,selection){node.selectionStart=selection.start,node.selectionEnd=selection.end}var cmdHelper=require("../helper/CmdHelper"),domQuery=require("min-dom/lib/query"),domAttr=require("min-dom/lib/attr"),domClosest=require("min-dom/lib/closest"),filter=require("lodash/collection/filter"),forEach=require("lodash/collection/forEach"),keys=require("lodash/object/keys"),domify=require("min-dom/lib/domify"),entryFieldDescription=require("./EntryFieldDescription"),updateSelection=require("selection-update"),TABLE_ROW_DIV_SNIPPET='<div class="bpp-field-wrapper bpp-table-row">',DELETE_ROW_BUTTON_SNIPPET='<button class="clear" data-action="deleteElement"><span>X</span></button>';module.exports=function(options){var id=options.id,modelProperties=options.modelProperties,labels=options.labels,description=options.description,labelRow=createLabelRowTemplate(labels),getElements=options.getElements,removeElement=options.removeElement,canRemove="function"==typeof removeElement,addElement=options.addElement,canAdd="function"==typeof addElement,addLabel=options.addLabel||"Add Value",updateElement=options.updateElement,canUpdate="function"==typeof updateElement,editable=options.editable||function(){return!0},setControlValue=options.setControlValue,show=options.show,canBeShown="function"==typeof show,elements=function(element,node){return pick(getElements(element,node),modelProperties)},factory={id:id,html:(canAdd?'<div class="bpp-table-add-row" '+(canBeShown?'data-show="show"':"")+"><label>"+addLabel+'</label><button class="add" data-action="addElement"><span>+</span></button></div>':"")+'<div class="bpp-table" data-show="showTable"><div class="bpp-field-wrapper bpp-table-row">'+labelRow+"</div><div data-list-entry-container></div></div>"+(description?entryFieldDescription(description):""),get:function(element,node){var boElements=elements(element,node,this.__invalidValues),invalidValues=this.__invalidValues;return delete this.__invalidValues,forEach(invalidValues,function(value,idx){var element=boElements[idx];forEach(modelProperties,function(prop){element[prop]=value[prop]})}),boElements},set:function(element,values,node){var action=this.__action||{};if(delete this.__action,"delete-element"===action.id)return removeElement(element,node,action.idx);if("add-element"===action.id)return addElement(element,node);if(canUpdate){var commands=[],valuesToValidate=values;"function"!=typeof options.validate&&(valuesToValidate=diff(element,node,values,elements(element,node),editable));var self=this;return forEach(valuesToValidate,function(value){var validationError,idx=values.indexOf(value);if("function"==typeof options.validate&&(validationError=options.validate(element,value,node,idx)),validationError)self.__invalidValues=self.__invalidValues||{},self.__invalidValues[idx]=value,commands.push(cmdHelper.updateProperties(element,{}));else{var cmd=updateElement(element,value,node,idx);cmd&&commands.push(cmd)}}),commands}},createListEntryTemplate:function(value,index,selectBox){return createInputRowTemplate(modelProperties,canRemove)},addElement:function(element,node,event,scopeNode){var template=domify(createInputRowTemplate(modelProperties,canRemove));return getContainer(node).appendChild(template),this.__action={id:"add-element"},!0},deleteElement:function(element,node,event,scopeNode){var container=getContainer(node),rowToDelete=event.delegateTarget.parentNode,idx=parseInt(domAttr(rowToDelete,"data-index"),10);return container.removeChild(rowToDelete),this.__action={id:"delete-element",idx:idx},!0},editable:function(element,rowNode,input,prop,value,idx){var entryNode=domClosest(rowNode,"[data-entry]");return editable(element,entryNode,prop,idx)},show:function(element,entryNode,node,scopeNode){return entryNode=getEntryNode(entryNode),show(element,entryNode,node,scopeNode)},showTable:function(element,entryNode,node,scopeNode){entryNode=getEntryNode(entryNode);var elems=elements(element,entryNode);return elems&&elems.length&&(!canBeShown||show(element,entryNode,node,scopeNode))},validateListItem:function(element,value,node,idx){if("function"==typeof options.validate)return options.validate(element,value,node,idx)}};return setControlValue&&(factory.setControlValue=function(element,rowNode,input,prop,value,idx){var selection,entryNode=getEntryNode(rowNode),isReadOnly=domAttr(input,"readonly"),oldValue=input.value;void 0===value&&(value=""),isReadOnly&&oldValue===value||(document.activeElement===input&&(selection=updateSelection(getSelection(input),oldValue,value)),setControlValue(element,entryNode,input,prop,value,idx),selection&&setSelection(input,selection))}),factory}},{"../helper/CmdHelper":49,"./EntryFieldDescription":41,"lodash/collection/filter":367,"lodash/collection/forEach":369,"lodash/object/keys":506,"min-dom/lib/attr":517,"min-dom/lib/closest":520,"min-dom/lib/domify":522,"min-dom/lib/query":525,"selection-update":544}],46:[function(require,module,exports){"use strict";var entryFieldDescription=require("./EntryFieldDescription"),textBox=function(options,defaultParameters){var resource=defaultParameters,label=options.label||resource.id,canBeShown=!!options.show&&"function"==typeof options.show,description=options.description;return resource.html='<label for="camunda-'+resource.id+'" '+(canBeShown?'data-show="isShown"':"")+">"+label+'</label><div class="bpp-field-wrapper" '+(canBeShown?'data-show="isShown"':"")+'><div contenteditable="true" id="camunda-'+resource.id+'" name="'+options.modelProperty+'" /></div>',description&&(resource.html+=entryFieldDescription(description)),canBeShown&&(resource.isShown=function(){return options.show.apply(resource,arguments)}),resource.cssClasses=["bpp-textbox"],resource};module.exports=textBox},{"./EntryFieldDescription":41}],47:[function(require,module,exports){"use strict";var domQuery=require("min-dom/lib/query"),entryFieldDescription=require("./EntryFieldDescription"),textField=function(options,defaultParameters){var defaultButtonAction=function(element,inputNode){return domQuery('input[name="'+options.modelProperty+'"]',inputNode).value="",!0},defaultButtonShow=function(element,inputNode){return""!==domQuery('input[name="'+options.modelProperty+'"]',inputNode).value},resource=defaultParameters,label=options.label||resource.id,dataValueLabel=options.dataValueLabel,buttonLabel=options.buttonLabel||"X",actionName=void 0!==options.buttonAction?options.buttonAction.name:"clear",actionMethod=void 0!==options.buttonAction?options.buttonAction.method:defaultButtonAction,showName=void 0!==options.buttonShow?options.buttonShow.name:"canClear",showMethod=void 0!==options.buttonShow?options.buttonShow.method:defaultButtonShow,canBeDisabled=!!options.disabled&&"function"==typeof options.disabled,description=options.description;return resource.html='<label for="camunda-'+resource.id+'" '+(canBeDisabled?'data-show="isDisabled" ':"")+(dataValueLabel?'data-value="'+dataValueLabel+'"':"")+">"+label+'</label><div class="bpp-field-wrapper" '+(canBeDisabled?'data-show="isDisabled"':"")+'><input id="camunda-'+resource.id+'" type="text" name="'+options.modelProperty+'"  /><button class="'+actionName+'" data-action="'+actionName+'" data-show="'+showName+'" '+(canBeDisabled?'data-disabled="isDisabled"':"")+"><span>"+buttonLabel+"</span></button></div>",description&&(resource.html+=entryFieldDescription(description)),resource[actionName]=actionMethod,resource[showName]=showMethod,canBeDisabled&&(resource.isDisabled=function(){return!options.disabled.apply(resource,arguments)}),resource.cssClasses=["bpp-textfield"],resource};module.exports=textField},{"./EntryFieldDescription":41,"min-dom/lib/query":525}],48:[function(require,module,exports){"use strict";var textField=require("./TextInputEntryFactory"),validationAwareTextField=function(options,defaultParameters){var modelProperty=options.modelProperty;defaultParameters.get=function(element,node){var value=this.__lastInvalidValue;delete this.__lastInvalidValue;var properties={};return properties[modelProperty]=void 0!==value?value:options.getProperty(element,node),properties},defaultParameters.set=function(element,values,node){var validationErrors=validate.apply(this,[element,values,node]),propertyValue=values[modelProperty];if(validationErrors&&validationErrors[modelProperty])return this.__lastInvalidValue=propertyValue,options.setProperty(element,{},node);var properties={};return properties[modelProperty]=propertyValue,options.setProperty(element,properties,node)};var validate=defaultParameters.validate=function(element,values,node){var value=values[modelProperty]||this.__lastInvalidValue,property={};return property[modelProperty]=value,options.validate(element,property,node)};return textField(options,defaultParameters)};module.exports=validationAwareTextField},{"./TextInputEntryFactory":47}],49:[function(require,module,exports){"use strict";var CmdHelper={};module.exports=CmdHelper,CmdHelper.updateProperties=function(element,properties){return{cmd:"element.updateProperties",context:{element:element,properties:properties}}},CmdHelper.updateBusinessObject=function(element,businessObject,newProperties){return{cmd:"properties-panel.update-businessobject",context:{element:element,businessObject:businessObject,properties:newProperties}}},CmdHelper.addElementsTolist=function(element,businessObject,listPropertyName,objectsToAdd){return{cmd:"properties-panel.update-businessobject-list",context:{element:element,currentObject:businessObject,propertyName:listPropertyName,objectsToAdd:objectsToAdd}}},CmdHelper.removeElementsFromList=function(element,businessObject,listPropertyName,referencePropertyName,objectsToRemove){return{cmd:"properties-panel.update-businessobject-list",context:{element:element,currentObject:businessObject,propertyName:listPropertyName,referencePropertyName:referencePropertyName,objectsToRemove:objectsToRemove}}},CmdHelper.addAndRemoveElementsFromList=function(element,businessObject,listPropertyName,referencePropertyName,objectsToAdd,objectsToRemove){return{cmd:"properties-panel.update-businessobject-list",context:{element:element,currentObject:businessObject,propertyName:listPropertyName,referencePropertyName:referencePropertyName,objectsToAdd:objectsToAdd,objectsToRemove:objectsToRemove}}},CmdHelper.setList=function(element,businessObject,listPropertyName,updatedObjectList){return{cmd:"properties-panel.update-businessobject-list",context:{element:element,currentObject:businessObject,propertyName:listPropertyName,updatedObjectList:updatedObjectList}}}},{}],50:[function(require,module,exports){"use strict";var ElementHelper={};module.exports=ElementHelper,ElementHelper.createElement=function(elementType,properties,parent,factory){var element=factory.create(elementType,properties);return element.$parent=parent,element}},{}],51:[function(require,module,exports){"use strict";var getBusinessObject=require("bpmn-js/lib/util/ModelUtil").getBusinessObject,is=require("bpmn-js/lib/util/ModelUtil").is,forEach=require("lodash/collection/forEach"),EventDefinitionHelper={};module.exports=EventDefinitionHelper,EventDefinitionHelper.getEventDefinition=function(element,eventType){var bo=getBusinessObject(element),eventDefinition=null;return bo.eventDefinitions&&forEach(bo.eventDefinitions,function(event){is(event,eventType)&&(eventDefinition=event)}),eventDefinition},EventDefinitionHelper.getTimerEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:TimerEventDefinition")},EventDefinitionHelper.getMessageEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:MessageEventDefinition")},EventDefinitionHelper.getSignalEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:SignalEventDefinition")},EventDefinitionHelper.getErrorEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:ErrorEventDefinition")},EventDefinitionHelper.getEscalationEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:EscalationEventDefinition")},EventDefinitionHelper.getCompensateEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:CompensateEventDefinition")},EventDefinitionHelper.getLinkEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:LinkEventDefinition")},EventDefinitionHelper.getConditionalEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:ConditionalEventDefinition")}},{"bpmn-js/lib/util/ModelUtil":160,"lodash/collection/forEach":369}],52:[function(require,module,exports){"use strict";var cmdHelper=require("./CmdHelper"),elementHelper=require("./ElementHelper"),is=require("bpmn-js/lib/util/ModelUtil").is,ExtensionElementsHelper={},getExtensionElements=function(bo){return bo.get("extensionElements")};ExtensionElementsHelper.getExtensionElements=function(bo,type){var extensionElements=getExtensionElements(bo);if(void 0!==extensionElements){var extensionValues=extensionElements.get("values");if(void 0!==extensionValues){var elements=extensionValues.filter(function(value){return is(value,type)});if(elements.length)return elements}}},ExtensionElementsHelper.addEntry=function(bo,element,entry,bpmnFactory){var extensionElements=bo.get("extensionElements");return extensionElements?cmdHelper.addElementsTolist(element,extensionElements,"values",[entry]):(extensionElements=elementHelper.createElement("bpmn:ExtensionElements",{values:[entry]},bo,bpmnFactory),{extensionElements:extensionElements})},ExtensionElementsHelper.removeEntry=function(bo,element,entry){var extensionElements=bo.get("extensionElements");return extensionElements?cmdHelper.removeElementsFromList(element,extensionElements,"values","extensionElements",[entry]):{}},module.exports=ExtensionElementsHelper},{"./CmdHelper":49,"./ElementHelper":50,"bpmn-js/lib/util/ModelUtil":160}],53:[function(require,module,exports){module.exports={__depends__:[require("./cmd")],__init__:["propertiesPanel"],propertiesPanel:["type",require("./PropertiesPanel")]}},{"./PropertiesPanel":30,"./cmd":37}],54:[function(require,module,exports){"use strict";var entryFactory=require("../../../factory/EntryFactory"),cmdHelper=require("../../../helper/CmdHelper"),ModelUtil=require("bpmn-js/lib/util/ModelUtil"),is=ModelUtil.is,getBusinessObject=ModelUtil.getBusinessObject;module.exports=function(group,element,bpmnFactory){var getValue=function(businessObject){return function(element){var documentations=businessObject&&businessObject.get("documentation");return{documentation:documentations&&documentations.length>0?documentations[0].text:""}}},setValue=function(businessObject){return function(element,values){var newObjectList=[];return void 0!==values.documentation&&""!==values.documentation&&newObjectList.push(bpmnFactory.create("bpmn:Documentation",{text:values.documentation})),cmdHelper.setList(element,businessObject,"documentation",newObjectList)}},elementDocuEntry=entryFactory.textBox({id:"documentation",label:"Element Documentation",modelProperty:"documentation"});elementDocuEntry.set=setValue(getBusinessObject(element)),elementDocuEntry.get=getValue(getBusinessObject(element)),group.entries.push(elementDocuEntry);var processRef;if(is(element,"bpmn:Participant")&&(processRef=getBusinessObject(element).processRef)){var processDocuEntry=entryFactory.textBox({id:"process-documentation",label:"Process Documentation",modelProperty:"documentation"});processDocuEntry.set=setValue(processRef),processDocuEntry.get=getValue(processRef),group.entries.push(processDocuEntry)}}},{"../../../factory/EntryFactory":40,"../../../helper/CmdHelper":49,"bpmn-js/lib/util/ModelUtil":160}],55:[function(require,module,exports){"use strict";var is=require("bpmn-js/lib/util/ModelUtil").is,isAny=require("bpmn-js/lib/features/modeling/util/ModelingUtil").isAny,isEventSubProcess=require("bpmn-js/lib/util/DiUtil").isEventSubProcess,getBusinessObject=require("bpmn-js/lib/util/ModelUtil").getBusinessObject,eventDefinitionHelper=require("../../../helper/EventDefinitionHelper"),forEach=require("lodash/collection/forEach"),message=require("./implementation/MessageEventDefinition"),signal=require("./implementation/SignalEventDefinition"),error=require("./implementation/ErrorEventDefinition"),escalation=require("./implementation/EscalationEventDefinition"),timer=require("./implementation/TimerEventDefinition"),compensation=require("./implementation/CompensateEventDefinition"),condition=require("./implementation/ConditionalEventDefinition");module.exports=function(group,element,bpmnFactory,elementRegistry){if(forEach(["bpmn:StartEvent","bpmn:EndEvent","bpmn:IntermediateThrowEvent","bpmn:BoundaryEvent","bpmn:IntermediateCatchEvent"],function(event){if(is(element,event)){var messageEventDefinition=eventDefinitionHelper.getMessageEventDefinition(element),signalEventDefinition=eventDefinitionHelper.getSignalEventDefinition(element);messageEventDefinition&&message(group,element,bpmnFactory,messageEventDefinition),signalEventDefinition&&signal(group,element,bpmnFactory,signalEventDefinition)}}),is(element,"bpmn:ReceiveTask")&&message(group,element,bpmnFactory,getBusinessObject(element)),forEach(["bpmn:StartEvent","bpmn:BoundaryEvent","bpmn:EndEvent"],function(event){if(is(element,event)){var errorEventDefinition=eventDefinitionHelper.getErrorEventDefinition(element);if(errorEventDefinition){var isCatchingErrorEvent=is(element,"bpmn:StartEvent")||is(element,"bpmn:BoundaryEvent");error(group,element,bpmnFactory,errorEventDefinition,isCatchingErrorEvent,isCatchingErrorEvent)}}}),forEach(["bpmn:StartEvent","bpmn:BoundaryEvent","bpmn:IntermediateThrowEvent","bpmn:EndEvent"],function(event){if(is(element,event)){var showEscalationCodeVariable=is(element,"bpmn:StartEvent")||is(element,"bpmn:BoundaryEvent"),escalationEventDefinition=eventDefinitionHelper.getEscalationEventDefinition(element);escalationEventDefinition&&escalation(group,element,bpmnFactory,escalationEventDefinition,showEscalationCodeVariable)}}),forEach(["bpmn:StartEvent","bpmn:BoundaryEvent","bpmn:IntermediateCatchEvent"],function(event){if(is(element,event)){var timerEventDefinition=eventDefinitionHelper.getTimerEventDefinition(element);timerEventDefinition&&timer(group,element,bpmnFactory,timerEventDefinition)}}),forEach(["bpmn:EndEvent","bpmn:IntermediateThrowEvent"],function(event){if(is(element,event)){var compensateEventDefinition=eventDefinitionHelper.getCompensateEventDefinition(element);compensateEventDefinition&&compensation(group,element,bpmnFactory,compensateEventDefinition,elementRegistry)}}),isAny(element,["bpmn:BoundaryEvent","bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])||is(element,"bpmn:StartEvent")&&isEventSubProcess(element.parent)){var conditionalEventDefinition=eventDefinitionHelper.getConditionalEventDefinition(element);conditionalEventDefinition&&condition(group,element,bpmnFactory,conditionalEventDefinition,elementRegistry)}}},{"../../../helper/EventDefinitionHelper":51,"./implementation/CompensateEventDefinition":57,"./implementation/ConditionalEventDefinition":58,"./implementation/ErrorEventDefinition":60,"./implementation/EscalationEventDefinition":61,"./implementation/MessageEventDefinition":63,"./implementation/SignalEventDefinition":64,"./implementation/TimerEventDefinition":65,"bpmn-js/lib/features/modeling/util/ModelingUtil":133,"bpmn-js/lib/util/DiUtil":158,"bpmn-js/lib/util/ModelUtil":160,"lodash/collection/forEach":369}],56:[function(require,module,exports){"use strict";function getLinkEventDefinition(element){var bo=getBusinessObject(element),linkEventDefinition=null;return bo.eventDefinitions&&forEach(bo.eventDefinitions,function(eventDefinition){is(eventDefinition,"bpmn:LinkEventDefinition")&&(linkEventDefinition=eventDefinition)}),linkEventDefinition}var is=require("bpmn-js/lib/util/ModelUtil").is,getBusinessObject=require("bpmn-js/lib/util/ModelUtil").getBusinessObject,entryFactory=require("../../../factory/EntryFactory"),cmdHelper=require("../../../helper/CmdHelper"),forEach=require("lodash/collection/forEach");module.exports=function(group,element){forEach(["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"],function(event){if(is(element,event)){var linkEventDefinition=getLinkEventDefinition(element);if(linkEventDefinition){var entry=entryFactory.textField({id:"link-event",label:"Link Name",modelProperty:"link-name"});entry.get=function(){return{"link-name":linkEventDefinition.get("name")}},entry.set=function(element,values){var newProperties={name:values["link-name"]};return cmdHelper.updateBusinessObject(element,linkEventDefinition,newProperties)},group.entries.push(entry)}}})}},{"../../../factory/EntryFactory":40,"../../../helper/CmdHelper":49,"bpmn-js/lib/util/ModelUtil":160,"lodash/collection/forEach":369}],57:[function(require,module,exports){"use strict";function getContainedActivities(element){return getFlowElements(element,"bpmn:Activity")}function getContainedBoundaryEvents(element){return getFlowElements(element,"bpmn:BoundaryEvent")}function getFlowElements(element,type){return utils.filterElementsByType(element.flowElements,type)}function isCompensationEventAttachedToActivity(activity,boundaryEvents){var activityId=activity.id;return!!find(boundaryEvents,function(boundaryEvent){var compensateEventDefinition=eventDefinitionHelper.getCompensateEventDefinition(boundaryEvent),attachedToRef=boundaryEvent.attachedToRef;return compensateEventDefinition&&attachedToRef&&attachedToRef.id===activityId})}function canActivityBeCompensated(activity,boundaryEvents){return is(activity,"bpmn:SubProcess")&&!activity.triggeredByEvent||is(activity,"bpmn:CallActivity")||isCompensationEventAttachedToActivity(activity,boundaryEvents)}
function getActivitiesForCompensation(element){var boundaryEvents=getContainedBoundaryEvents(element);return filter(getContainedActivities(element),function(activity){return canActivityBeCompensated(activity,boundaryEvents)})}function getActivitiesForActivityRef(element){var bo=getBusinessObject(element),parent=bo.$parent,activitiesForActivityRef=getActivitiesForCompensation(parent);return is(parent,"bpmn:SubProcess")&&parent.triggeredByEvent&&(parent=parent.$parent)&&(activitiesForActivityRef=activitiesForActivityRef.concat(getActivitiesForCompensation(parent))),activitiesForActivityRef}function createActivityRefOptions(element){var options=[{value:""}],activities=getActivitiesForActivityRef(element);return forEach(activities,function(activity){var activityId=activity.id,name=(activity.name?activity.name+" ":"")+"(id="+activityId+")";options.push({value:activityId,name:name})}),options}var entryFactory=require("../../../../factory/EntryFactory"),cmdHelper=require("../../../../helper/CmdHelper"),eventDefinitionHelper=require("../../../../helper/EventDefinitionHelper"),utils=require("../../../../Utils"),getBusinessObject=require("bpmn-js/lib/util/ModelUtil").getBusinessObject,is=require("bpmn-js/lib/util/ModelUtil").is,forEach=require("lodash/collection/forEach"),find=require("lodash/collection/find"),filter=require("lodash/collection/filter");module.exports=function(group,element,bpmnFactory,compensateEventDefinition,elementRegistry){group.entries.push(entryFactory.checkbox({id:"wait-for-completion",label:"Wait for Completion",modelProperty:"waitForCompletion",get:function(element,node){return{waitForCompletion:compensateEventDefinition.waitForCompletion}},set:function(element,values){return values.waitForCompletion=values.waitForCompletion||void 0,cmdHelper.updateBusinessObject(element,compensateEventDefinition,values)}})),group.entries.push(entryFactory.selectBox({id:"activity-ref",label:"Activity Ref",selectOptions:createActivityRefOptions(element),modelProperty:"activityRef",get:function(element,node){var activityRef=compensateEventDefinition.activityRef;return activityRef=activityRef&&activityRef.id,{activityRef:activityRef||""}},set:function(element,values){var activityRef=values.activityRef||void 0;return activityRef=activityRef&&getBusinessObject(elementRegistry.get(activityRef)),cmdHelper.updateBusinessObject(element,compensateEventDefinition,{activityRef:activityRef})}}))}},{"../../../../Utils":31,"../../../../factory/EntryFactory":40,"../../../../helper/CmdHelper":49,"../../../../helper/EventDefinitionHelper":51,"bpmn-js/lib/util/ModelUtil":160,"lodash/collection/filter":367,"lodash/collection/find":368,"lodash/collection/forEach":369}],58:[function(require,module,exports){"use strict";function createFormalExpression(parent,body,bpmnFactory){return body=body||void 0,elementHelper.createElement("bpmn:FormalExpression",{body:body},parent,bpmnFactory)}var entryFactory=require("../../../../factory/EntryFactory"),elementHelper=require("../../../../helper/ElementHelper"),cmdHelper=require("../../../../helper/CmdHelper");module.exports=function(group,element,bpmnFactory,conditionalEventDefinition){var getValue=function(modelProperty){return function(element){var modelPropertyValue=conditionalEventDefinition.get("camunda:"+modelProperty),value={};return value[modelProperty]=modelPropertyValue,value}},setValue=function(modelProperty){return function(element,values){var props={};return props["camunda:"+modelProperty]=values[modelProperty]||void 0,cmdHelper.updateBusinessObject(element,conditionalEventDefinition,props)}};group.entries.push(entryFactory.textField({id:"condition",label:"Condition",modelProperty:"condition",get:function(element){var condition=conditionalEventDefinition.get("condition");return{condition:condition&&condition.get("body")||""}},set:function(element,values){var condition=conditionalEventDefinition.get("condition");return""===values.condition?cmdHelper.updateBusinessObject(element,conditionalEventDefinition,{condition:void 0}):condition?cmdHelper.updateBusinessObject(element,condition,{body:values.condition||void 0}):(condition=createFormalExpression(conditionalEventDefinition,values.condition,bpmnFactory),cmdHelper.updateBusinessObject(element,conditionalEventDefinition,{condition:condition}))},validate:function(element,values){if(""===values.condition)return{condition:"Must provide a value"}}})),group.entries.push(entryFactory.textField({id:"variableName",label:"Variable Name",modelProperty:"variableName",get:getValue("variableName"),set:setValue("variableName")})),group.entries.push(entryFactory.textField({id:"variableEvent",label:"Variable Event",description:"Specify more than one variable change event as a comma separated list.",modelProperty:"variableEvent",get:getValue("variableEvent"),set:setValue("variableEvent")}))}},{"../../../../factory/EntryFactory":40,"../../../../helper/CmdHelper":49,"../../../../helper/ElementHelper":50}],59:[function(require,module,exports){"use strict";var entryFactory=require("../../../../factory/EntryFactory"),cmdHelper=require("../../../../helper/CmdHelper");module.exports=function(element,definition,bpmnFactory,options){var id=options.id||"element-property",label=options.label,referenceProperty=options.referenceProperty,modelProperty=options.modelProperty||"name",shouldValidate=options.shouldValidate||!1,entry=entryFactory.textField({id:id,label:label,modelProperty:modelProperty,get:function(element,node){var reference=definition.get(referenceProperty),props={};return props[modelProperty]=reference&&reference.get(modelProperty),props},set:function(element,values,node){var reference=definition.get(referenceProperty),props={};return props[modelProperty]=values[modelProperty]||void 0,cmdHelper.updateBusinessObject(element,reference,props)},disabled:function(element,node){return!definition.get(referenceProperty)}});return shouldValidate&&(entry.validate=function(element,values,node){if(definition.get(referenceProperty)&&!values[modelProperty]){var validationErrors={};return validationErrors[modelProperty]="Must provide a value",validationErrors}}),[entry]}},{"../../../../factory/EntryFactory":40,"../../../../helper/CmdHelper":49}],60:[function(require,module,exports){"use strict";var entryFactory=require("../../../../factory/EntryFactory"),cmdHelper=require("../../../../helper/CmdHelper"),eventDefinitionReference=require("./EventDefinitionReference"),elementReferenceProperty=require("./ElementReferenceProperty");module.exports=function(group,element,bpmnFactory,errorEventDefinition,showErrorCodeVariable,showErrorMessageVariable){var getValue=function(modelProperty){return function(element){var modelPropertyValue=errorEventDefinition.get("camunda:"+modelProperty),value={};return value[modelProperty]=modelPropertyValue,value}},setValue=function(modelProperty){return function(element,values){var props={};return props["camunda:"+modelProperty]=values[modelProperty]||void 0,cmdHelper.updateBusinessObject(element,errorEventDefinition,props)}};group.entries=group.entries.concat(eventDefinitionReference(element,errorEventDefinition,bpmnFactory,{label:"Error",elementName:"error",elementType:"bpmn:Error",referenceProperty:"errorRef",newElementIdPrefix:"Error_"})),group.entries=group.entries.concat(elementReferenceProperty(element,errorEventDefinition,bpmnFactory,{id:"error-element-name",label:"Error Name",referenceProperty:"errorRef",modelProperty:"name",shouldValidate:!0})),group.entries=group.entries.concat(elementReferenceProperty(element,errorEventDefinition,bpmnFactory,{id:"error-element-code",label:"Error Code",referenceProperty:"errorRef",modelProperty:"errorCode"})),showErrorCodeVariable&&group.entries.push(entryFactory.textField({id:"errorCodeVariable",label:"Error Code Variable",modelProperty:"errorCodeVariable",get:getValue("errorCodeVariable"),set:setValue("errorCodeVariable")})),showErrorMessageVariable&&group.entries.push(entryFactory.textField({id:"errorMessageVariable",label:"Error Message Variable",modelProperty:"errorMessageVariable",get:getValue("errorMessageVariable"),set:setValue("errorMessageVariable")}))}},{"../../../../factory/EntryFactory":40,"../../../../helper/CmdHelper":49,"./ElementReferenceProperty":59,"./EventDefinitionReference":62}],61:[function(require,module,exports){"use strict";var entryFactory=require("../../../../factory/EntryFactory"),cmdHelper=require("../../../../helper/CmdHelper"),eventDefinitionReference=require("./EventDefinitionReference"),elementReferenceProperty=require("./ElementReferenceProperty");module.exports=function(group,element,bpmnFactory,escalationEventDefinition,showEscalationCodeVariable){group.entries=group.entries.concat(eventDefinitionReference(element,escalationEventDefinition,bpmnFactory,{label:"Escalation",elementName:"escalation",elementType:"bpmn:Escalation",referenceProperty:"escalationRef",newElementIdPrefix:"Escalation_"})),group.entries=group.entries.concat(elementReferenceProperty(element,escalationEventDefinition,bpmnFactory,{id:"escalation-element-name",label:"Escalation Name",referenceProperty:"escalationRef",modelProperty:"name",shouldValidate:!0})),group.entries=group.entries.concat(elementReferenceProperty(element,escalationEventDefinition,bpmnFactory,{id:"escalation-element-code",label:"Escalation Code",referenceProperty:"escalationRef",modelProperty:"escalationCode"})),showEscalationCodeVariable&&group.entries.push(entryFactory.textField({id:"escalationCodeVariable",label:"Escalation Code Variable",modelProperty:"escalationCodeVariable",get:function(element){return{escalationCodeVariable:escalationEventDefinition.get("camunda:escalationCodeVariable")}},set:function(element,values){return cmdHelper.updateBusinessObject(element,escalationEventDefinition,{"camunda:escalationCodeVariable":values.escalationCodeVariable||void 0})}}))}},{"../../../../factory/EntryFactory":40,"../../../../helper/CmdHelper":49,"./ElementReferenceProperty":59,"./EventDefinitionReference":62}],62:[function(require,module,exports){"use strict";function getSelectBox(node){return domQuery(selector,node.parentElement)}function findElementById(eventDefinition,type,id){var elements=utils.findRootElementsByType(eventDefinition,type);return find(elements,function(element){return element.id===id})}var cmdHelper=require("../../../../helper/CmdHelper"),domQuery=require("min-dom/lib/query"),domify=require("min-dom/lib/domify"),domAttr=require("min-dom/lib/attr"),forEach=require("lodash/collection/forEach"),find=require("lodash/collection/find"),elementHelper=require("../../../../helper/ElementHelper"),utils=require("../../../../Utils"),selector="select[name=selectedElement]";module.exports=function(element,definition,bpmnFactory,options){var elementName=options.elementName||"",elementType=options.elementType,referenceProperty=options.referenceProperty,newElementIdPrefix=options.newElementIdPrefix||"elem_",label=options.label||"",description=options.description||"",entries=[];return entries.push({id:"event-definitions-"+elementName,description:description,html:'<div class="bpp-row bpp-select"><label for="camunda-'+elementName+'">'+label+'</label><div class="bpp-field-wrapper"><select id="camunda-'+elementName+'" name="selectedElement" data-value></select><button class="add" id="addElement" data-action="addElement"><span>+</span></button></div></div>',get:function(element,entryNode){utils.updateOptionsDropDown(selector,definition,elementType,entryNode);var reference=definition.get(referenceProperty);return{selectedElement:reference&&reference.id||""}},set:function(element,values){var selection=values.selectedElement,props={};if(!selection||void 0===selection)return props[referenceProperty]=void 0,cmdHelper.updateBusinessObject(element,definition,props);var commands=[],selectedElement=findElementById(definition,elementType,selection);if(!selectedElement){var root=utils.getRoot(definition);selectedElement=elementHelper.createElement(elementType,{name:selection},root,bpmnFactory),commands.push(cmdHelper.addAndRemoveElementsFromList(element,root,"rootElements",null,[selectedElement]))}return props[referenceProperty]=selectedElement,commands.push(cmdHelper.updateBusinessObject(element,definition,props)),commands},addElement:function(element,inputNode){var id=utils.nextId(newElementIdPrefix),optionTemplate=domify('<option value="'+id+'"> (id='+id+")</option>"),selectBox=getSelectBox(inputNode);return selectBox.insertBefore(optionTemplate,selectBox.firstChild),forEach(selectBox,function(option){option.value===id?domAttr(option,"selected","selected"):domAttr(option,"selected",null)}),!0}}),entries}},{"../../../../Utils":31,"../../../../helper/CmdHelper":49,"../../../../helper/ElementHelper":50,"lodash/collection/find":368,"lodash/collection/forEach":369,"min-dom/lib/attr":517,"min-dom/lib/domify":522,"min-dom/lib/query":525}],63:[function(require,module,exports){"use strict";var eventDefinitionReference=require("./EventDefinitionReference"),elementReferenceProperty=require("./ElementReferenceProperty");module.exports=function(group,element,bpmnFactory,messageEventDefinition){group.entries=group.entries.concat(eventDefinitionReference(element,messageEventDefinition,bpmnFactory,{label:"Message",elementName:"message",elementType:"bpmn:Message",referenceProperty:"messageRef",newElementIdPrefix:"Message_"})),group.entries=group.entries.concat(elementReferenceProperty(element,messageEventDefinition,bpmnFactory,{id:"message-element-name",label:"Message Name",referenceProperty:"messageRef",modelProperty:"name",shouldValidate:!0}))}},{"./ElementReferenceProperty":59,"./EventDefinitionReference":62}],64:[function(require,module,exports){"use strict";var eventDefinitionReference=require("./EventDefinitionReference"),elementReferenceProperty=require("./ElementReferenceProperty");module.exports=function(group,element,bpmnFactory,signalEventDefinition){group.entries=group.entries.concat(eventDefinitionReference(element,signalEventDefinition,bpmnFactory,{label:"Signal",elementName:"signal",elementType:"bpmn:Signal",referenceProperty:"signalRef",newElementIdPrefix:"Signal_"})),group.entries=group.entries.concat(elementReferenceProperty(element,signalEventDefinition,bpmnFactory,{id:"signal-element-name",label:"Signal Name",referenceProperty:"signalRef",modelProperty:"name",shouldValidate:!0}))}},{"./ElementReferenceProperty":59,"./EventDefinitionReference":62}],65:[function(require,module,exports){"use strict";function getTimerDefinitionType(timer){return void 0!==timer.get("timeDate")?"timeDate":void 0!==timer.get("timeCycle")?"timeCycle":void 0!==timer.get("timeDuration")?"timeDuration":void 0}function createFormalExpression(parent,body,bpmnFactory){return body=body||void 0,elementHelper.createElement("bpmn:FormalExpression",{body:body},parent,bpmnFactory)}function TimerEventDefinition(group,element,bpmnFactory,timerEventDefinition){var selectOptions=[{value:"timeDate",name:"Date"},{value:"timeDuration",name:"Duration"},{value:"timeCycle",name:"Cycle"}];group.entries.push(entryFactory.selectBox({id:"timer-event-definition-type",label:"Timer Definition Type",selectOptions:selectOptions,emptyParameter:!0,modelProperty:"timerDefinitionType",get:function(element,node){return{timerDefinitionType:getTimerDefinitionType(timerEventDefinition)||""}},set:function(element,values){var props={timeDuration:void 0,timeDate:void 0,timeCycle:void 0},newType=values.timerDefinitionType;if(values.timerDefinitionType){var value,oldType=getTimerDefinitionType(timerEventDefinition);if(oldType){value=timerEventDefinition.get(oldType).get("body")}props[newType]=createFormalExpression(timerEventDefinition,value,bpmnFactory)}return cmdHelper.updateBusinessObject(element,timerEventDefinition,props)}})),group.entries.push(entryFactory.textField({id:"timer-event-definition",label:"Timer Definition",modelProperty:"timerDefinition",get:function(element,node){var type=getTimerDefinitionType(timerEventDefinition),definition=type&&timerEventDefinition.get(type);return{timerDefinition:definition&&definition.get("body")}},set:function(element,values){var type=getTimerDefinitionType(timerEventDefinition),definition=type&&timerEventDefinition.get(type);if(definition)return cmdHelper.updateBusinessObject(element,definition,{body:values.timerDefinition||void 0})},validate:function(element){var type=getTimerDefinitionType(timerEventDefinition),definition=type&&timerEventDefinition.get(type);if(definition){if(!definition.get("body"))return{timerDefinition:"Must provide a value"}}},disabled:function(element){return!getTimerDefinitionType(timerEventDefinition)}}))}var elementHelper=require("../../../../helper/ElementHelper"),cmdHelper=require("../../../../helper/CmdHelper"),entryFactory=require("../../../../factory/EntryFactory");module.exports=TimerEventDefinition},{"../../../../factory/EntryFactory":40,"../../../../helper/CmdHelper":49,"../../../../helper/ElementHelper":50}],66:[function(require,module,exports){"use strict";var properties=require("./implementation/Properties"),elementHelper=require("../../../helper/ElementHelper"),cmdHelper=require("../../../helper/CmdHelper");module.exports=function(group,element,bpmnFactory){var propertiesEntry=properties(element,bpmnFactory,{id:"properties",modelProperties:["name","value"],labels:["Name","Value"],getParent:function(element,node,bo){return bo.extensionElements},createParent:function(element,bo){var parent=elementHelper.createElement("bpmn:ExtensionElements",{values:[]},bo,bpmnFactory);return{cmd:cmdHelper.updateBusinessObject(element,bo,{extensionElements:parent}),parent:parent}}});propertiesEntry&&group.entries.push(propertiesEntry)}},{"../../../helper/CmdHelper":49,"../../../helper/ElementHelper":50,"./implementation/Properties":67}],67:[function(require,module,exports){"use strict";function generatePropertyId(){return utils.nextId("Property_")}function getPropertyValues(parent){var properties=parent&&getPropertiesElement(parent);return properties&&properties.values?properties.values:[]}function getPropertiesElement(element){return isExtensionElements(element)?getPropertiesElementInsideExtensionElements(element):element.properties}function getPropertiesElementInsideExtensionElements(extensionElements){return find(extensionElements.values,function(elem){return is(elem,"camunda:Properties")})}function isExtensionElements(element){return is(element,"bpmn:ExtensionElements")}var getBusinessObject=require("bpmn-js/lib/util/ModelUtil").getBusinessObject,is=require("bpmn-js/lib/util/ModelUtil").is,factory=require("../../../../factory/EntryFactory"),elementHelper=require("../../../../helper/ElementHelper"),extensionElementsHelper=require("../../../../helper/ExtensionElementsHelper"),cmdHelper=require("../../../../helper/CmdHelper"),utils=require("../../../../Utils"),assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),find=require("lodash/collection/find");module.exports=function(element,bpmnFactory,options){var getParent=options.getParent,modelProperties=options.modelProperties,createParent=options.createParent,bo=getBusinessObject(element);if(is(element,"bpmn:Participant")&&(bo=bo.get("processRef")),bo)return assign(options,{addLabel:"Add Property",getElements:function(element,node){return getPropertyValues(getParent(element,node,bo))},addElement:function(element,node){var commands=[],parent=getParent(element,node,bo);if(!parent&&"function"==typeof createParent){var result=createParent(element,bo);parent=result.parent,commands.push(result.cmd)}var properties=getPropertiesElement(parent);properties||(properties=elementHelper.createElement("camunda:Properties",{},parent,bpmnFactory),isExtensionElements(parent)?commands.push(cmdHelper.addAndRemoveElementsFromList(element,parent,"values","extensionElements",[properties],[])):commands.push(cmdHelper.updateBusinessObject(element,parent,{properties:properties})));var propertyProps={};forEach(modelProperties,function(prop){propertyProps[prop]=void 0}),modelProperties.indexOf("id")>=0&&(propertyProps.id=generatePropertyId());var property=elementHelper.createElement("camunda:Property",propertyProps,properties,bpmnFactory);return commands.push(cmdHelper.addElementsTolist(element,properties,"values",[property])),commands},updateElement:function(element,value,node,idx){var parent=getParent(element,node,bo),property=getPropertyValues(parent)[idx];return forEach(modelProperties,function(prop){value[prop]=value[prop]||void 0}),cmdHelper.updateBusinessObject(element,property,value)},validate:function(element,value,node,idx){if(modelProperties.indexOf("id")>=0){var parent=getParent(element,node,bo),properties=getPropertyValues(parent),property=properties[idx];if(property){var validationError=utils.isIdValid(property,value.id);if(validationError)return{id:validationError}}}},removeElement:function(element,node,idx){var commands=[],parent=getParent(element,node,bo),properties=getPropertiesElement(parent),propertyValues=getPropertyValues(parent),currentProperty=propertyValues[idx];return commands.push(cmdHelper.removeElementsFromList(element,properties,"values",null,[currentProperty])),1===propertyValues.length&&(isExtensionElements(parent)?forEach(parent.values,function(value){is(value,"camunda:Properties")&&commands.push(extensionElementsHelper.removeEntry(bo,element,value))}):commands.push(cmdHelper.updateBusinessObject(element,parent,{properties:void 0}))),commands}}),factory.table(options)}},{"../../../../Utils":31,"../../../../factory/EntryFactory":40,"../../../../helper/CmdHelper":49,"../../../../helper/ElementHelper":50,"../../../../helper/ExtensionElementsHelper":52,"bpmn-js/lib/util/ModelUtil":160,"lodash/collection/find":368,"lodash/collection/forEach":369,"lodash/object/assign":502}],68:[function(require,module,exports){"use strict";function Modeler(options){Viewer.call(this,options),this.on("import.parse.complete",function(event){event.error||this._collectIds(event.definitions,event.context)},this),this.on("diagram.destroy",function(){this.moddle.ids.clear()},this)}var inherits=require("inherits"),Ids=require("ids"),Viewer=require("./Viewer"),NavigatedViewer=require("./NavigatedViewer");inherits(Modeler,Viewer),module.exports=Modeler,module.exports.Viewer=Viewer,module.exports.NavigatedViewer=NavigatedViewer,Modeler.prototype.createDiagram=function(done){return this.importXML('<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>',done)},Modeler.prototype._createModdle=function(options){var moddle=Viewer.prototype._createModdle.call(this,options);return moddle.ids=new Ids([32,36,1]),moddle},Modeler.prototype._collectIds=function(definitions,context){var id,moddle=definitions.$model,ids=moddle.ids;ids.clear();for(id in context.elementsById)ids.claim(id,context.elementsById[id])},Modeler.prototype._interactionModules=[require("diagram-js/lib/navigation/movecanvas"),require("diagram-js/lib/navigation/touch"),require("diagram-js/lib/navigation/zoomscroll")],Modeler.prototype._modelingModules=[require("diagram-js/lib/features/auto-scroll"),require("diagram-js/lib/features/bendpoints"),require("diagram-js/lib/features/move"),require("diagram-js/lib/features/resize"),require("./features/auto-resize"),require("./features/editor-actions"),require("./features/context-pad"),require("./features/keyboard"),require("./features/label-editing"),require("./features/modeling"),require("./features/palette"),require("./features/replace-preview"),require("./features/snapping")],Modeler.prototype._modules=[].concat(Modeler.prototype._modules,Modeler.prototype._interactionModules,Modeler.prototype._modelingModules)},{"./NavigatedViewer":69,"./Viewer":70,"./features/auto-resize":77,"./features/context-pad":79,"./features/editor-actions":85,"./features/keyboard":89,"./features/label-editing":93,"./features/modeling":131,"./features/palette":137,"./features/replace-preview":142,"./features/snapping":152,"diagram-js/lib/features/auto-scroll":202,"diagram-js/lib/features/bendpoints":208,"diagram-js/lib/features/move":269,"diagram-js/lib/features/resize":287,"diagram-js/lib/navigation/movecanvas":319,"diagram-js/lib/navigation/touch":320,"diagram-js/lib/navigation/zoomscroll":323,ids:353,inherits:354}],69:[function(require,module,exports){"use strict";function NavigatedViewer(options){Viewer.call(this,options)}var inherits=require("inherits"),Viewer=require("./Viewer");inherits(NavigatedViewer,Viewer),module.exports=NavigatedViewer,NavigatedViewer.prototype._navigationModules=[require("diagram-js/lib/navigation/zoomscroll"),require("diagram-js/lib/navigation/movecanvas")],NavigatedViewer.prototype._modules=[].concat(NavigatedViewer.prototype._modules,NavigatedViewer.prototype._navigationModules)},{"./Viewer":70,"diagram-js/lib/navigation/movecanvas":319,"diagram-js/lib/navigation/zoomscroll":323,inherits:354}],70:[function(require,module,exports){"use strict";function checkValidationError(err){var pattern=/unparsable content <([^>]+)> detected([\s\S]*)$/,match=pattern.exec(err.message);return match&&(err.message="unparsable content <"+match[1]+"> detected; this may indicate an invalid BPMN 2.0 diagram file"+match[2]),err}function ensureUnit(val){return val+(isNumber(val)?"px":"")}function Viewer(options){options=assign({},DEFAULT_OPTIONS,options),this.moddle=this._createModdle(options),this.container=this._createContainer(options),addProjectLogo(this.container),this._init(this.container,this.moddle,options)}function addProjectLogo(container){var logoData=PoweredBy.BPMNIO_LOGO,linkMarkup='<a href="http://bpmn.io" target="_blank" class="bjs-powered-by" title="Powered by bpmn.io" style="position: absolute; bottom: 15px; right: 15px; z-index: 100"><img src="data:image/png;base64,'+logoData+'"></a>',linkElement=domify(linkMarkup);container.appendChild(linkElement),domEvent.bind(linkElement,"click",function(event){PoweredBy.open(),event.preventDefault()})}var assign=require("lodash/object/assign"),omit=require("lodash/object/omit"),isString=require("lodash/lang/isString"),isNumber=require("lodash/lang/isNumber"),domify=require("min-dom/lib/domify"),domQuery=require("min-dom/lib/query"),domRemove=require("min-dom/lib/remove"),innerSVG=require("tiny-svg/lib/innerSVG"),Diagram=require("diagram-js"),BpmnModdle=require("bpmn-moddle"),inherits=require("inherits"),Importer=require("./import/Importer"),DEFAULT_OPTIONS={width:"100%",height:"100%",position:"relative",container:"body"};inherits(Viewer,Diagram),module.exports=Viewer,Viewer.prototype.importXML=function(xml,done){done=done||function(){};var self=this;xml=this._emit("import.parse.start",{xml:xml})||xml,this.moddle.fromXML(xml,"bpmn:Definitions",function(err,definitions,context){if(definitions=self._emit("import.parse.complete",{error:err,definitions:definitions,context:context})||definitions,err)return err=checkValidationError(err),self._emit("import.done",{error:err}),done(err);var parseWarnings=context.warnings;self.importDefinitions(definitions,function(err,importWarnings){var allWarnings=[].concat(parseWarnings,importWarnings||[]);self._emit("import.done",{error:err,warnings:allWarnings}),done(err,allWarnings)})})},Viewer.prototype.saveXML=function(options,done){done||(done=options,options={});var definitions=this.definitions;if(!definitions)return done(new Error("no definitions loaded"));this.moddle.toXML(definitions,options,done)},Viewer.prototype.saveSVG=function(options,done){done||(done=options,options={});var canvas=this.get("canvas"),contentNode=canvas.getDefaultLayer(),defsNode=domQuery("defs",canvas._svg),contents=innerSVG(contentNode),defs=defsNode&&defsNode.outerHTML||"",bbox=contentNode.getBBox();done(null,'<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- created with bpmn-js / http://bpmn.io --\x3e\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+bbox.width+'" height="'+bbox.height+'" viewBox="'+bbox.x+" "+bbox.y+" "+bbox.width+" "+bbox.height+'" version="1.1">'+defs+contents+"</svg>")},Viewer.prototype.importDefinitions=function(definitions,done){try{this.definitions&&this.clear(),this.definitions=definitions,Importer.importBpmnDiagram(this,definitions,done)}catch(e){done(e)}},Viewer.prototype.getModules=function(){return this._modules},Viewer.prototype.destroy=function(){Diagram.prototype.destroy.call(this),domRemove(this.container)},Viewer.prototype.on=function(event,priority,callback,target){return this.get("eventBus").on(event,priority,callback,target)},Viewer.prototype.off=function(event,callback){this.get("eventBus").off(event,callback)},Viewer.prototype._init=function(container,moddle,options){var baseModules=options.modules||this.getModules(),additionalModules=options.additionalModules||[],staticModules=[{bpmnjs:["value",this],moddle:["value",moddle]}],diagramModules=[].concat(staticModules,baseModules,additionalModules),diagramOptions=assign(omit(options,"additionalModules"),{canvas:assign({},options.canvas,{container:container}),modules:diagramModules});Diagram.call(this,diagramOptions)},Viewer.prototype._emit=function(type,event){return this.get("eventBus").fire(type,event)},Viewer.prototype._createContainer=function(options){var container,parent=options.container;return parent.get&&(parent=parent.get(0)),isString(parent)&&(parent=domQuery(parent)),container=domify('<div class="bjs-container"></div>'),assign(container.style,{width:ensureUnit(options.width),height:ensureUnit(options.height),position:options.position}),parent.appendChild(container),container},Viewer.prototype._createModdle=function(options){var moddleOptions=assign({},this._moddleExtensions,options.moddleExtensions);return new BpmnModdle(moddleOptions)},Viewer.prototype._modules=[require("./core"),require("diagram-js/lib/i18n/translate"),require("diagram-js/lib/features/selection"),require("diagram-js/lib/features/overlays")],Viewer.prototype._moddleExtensions={};var PoweredBy=require("./util/PoweredByUtil"),domEvent=require("min-dom/lib/event")},{"./core":71,"./import/Importer":155,"./util/PoweredByUtil":161,"bpmn-moddle":162,"diagram-js":180,"diagram-js/lib/features/overlays":274,"diagram-js/lib/features/selection":296,"diagram-js/lib/i18n/translate":311,inherits:354,"lodash/lang/isNumber":496,"lodash/lang/isString":499,"lodash/object/assign":502,"lodash/object/omit":509,"min-dom/lib/domify":522,"min-dom/lib/event":523,"min-dom/lib/query":525,"min-dom/lib/remove":526,"tiny-svg/lib/innerSVG":554}],71:[function(require,module,exports){module.exports={__depends__:[require("../draw"),require("../import")]}},{"../draw":74,"../import":157}],72:[function(require,module,exports){"use strict";function BpmnRenderer(eventBus,styles,pathMap,priority){function addMarker(id,element){markers[id]=element}function marker(id){return"url(#"+markers[id].id+")"}function initMarkers(svg){function createMarker(id,options){var attrs=assign({fill:"black",strokeWidth:1,strokeLinecap:"round",strokeDasharray:"none"},options.attrs),ref=options.ref||{x:0,y:0},scale=options.scale||1;"none"===attrs.strokeDasharray&&(attrs.strokeDasharray=[1e4,1]);var marker=svgCreate("marker");svgAttr(options.element,attrs),svgAppend(marker,options.element),svgAttr(marker,{id:id,viewBox:"0 0 20 20",refX:ref.x,refY:ref.y,markerWidth:20*scale,
markerHeight:20*scale,orient:"auto"});var defs=domQuery("defs",svg);return defs||(defs=svgCreate("defs"),svgAppend(svg,defs)),svgAppend(defs,marker),addMarker(id,marker)}var sequenceflowEnd=svgCreate("path");svgAttr(sequenceflowEnd,{d:"M 1 5 L 11 10 L 1 15 Z"}),createMarker("sequenceflow-end",{element:sequenceflowEnd,ref:{x:11,y:10},scale:.5});var messageflowStart=svgCreate("circle");svgAttr(messageflowStart,{cx:6,cy:6,r:3.5}),createMarker("messageflow-start",{element:messageflowStart,attrs:{fill:"white",stroke:"black"},ref:{x:6,y:6}});var messageflowEnd=svgCreate("path");svgAttr(messageflowEnd,{d:"m 1 5 l 0 -3 l 7 3 l -7 3 z"}),createMarker("messageflow-end",{element:messageflowEnd,attrs:{fill:"white",stroke:"black",strokeLinecap:"butt"},ref:{x:8.5,y:5}});var associationStart=svgCreate("path");svgAttr(associationStart,{d:"M 11 5 L 1 10 L 11 15"}),createMarker("association-start",{element:associationStart,attrs:{fill:"none",stroke:"black",strokeWidth:1.5},ref:{x:1,y:10},scale:.5});var associationEnd=svgCreate("path");svgAttr(associationEnd,{d:"M 1 5 L 11 10 L 1 15"}),createMarker("association-end",{element:associationEnd,attrs:{fill:"none",stroke:"black",strokeWidth:1.5},ref:{x:12,y:10},scale:.5});var conditionalflowMarker=svgCreate("path");svgAttr(conditionalflowMarker,{d:"M 0 10 L 8 6 L 16 10 L 8 14 Z"}),createMarker("conditional-flow-marker",{element:conditionalflowMarker,attrs:{fill:"white",stroke:"black"},ref:{x:-1,y:10},scale:.5});var conditionaldefaultflowMarker=svgCreate("path");svgAttr(conditionaldefaultflowMarker,{d:"M 1 4 L 5 16"}),createMarker("conditional-default-flow-marker",{element:conditionaldefaultflowMarker,attrs:{stroke:"black"},ref:{x:-5,y:10},scale:.5})}function drawCircle(parentGfx,width,height,offset,attrs){isObject(offset)&&(attrs=offset,offset=0),offset=offset||0,attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"});var cx=width/2,cy=height/2,circle=svgCreate("circle");return svgAttr(circle,{cx:cx,cy:cy,r:Math.round((width+height)/4-offset)}),svgAttr(circle,attrs),svgAppend(parentGfx,circle),circle}function drawRect(parentGfx,width,height,r,offset,attrs){isObject(offset)&&(attrs=offset,offset=0),offset=offset||0,attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"});var rect=svgCreate("rect");return svgAttr(rect,{x:offset,y:offset,width:width-2*offset,height:height-2*offset,rx:r,ry:r}),svgAttr(rect,attrs),svgAppend(parentGfx,rect),rect}function drawDiamond(parentGfx,width,height,attrs){var x_2=width/2,y_2=height/2,points=[{x:x_2,y:0},{x:width,y:y_2},{x:x_2,y:height},{x:0,y:y_2}],pointsString=points.map(function(point){return point.x+","+point.y}).join(" ");attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"});var polygon=svgCreate("polygon");return svgAttr(polygon,{points:pointsString}),svgAttr(polygon,attrs),svgAppend(parentGfx,polygon),polygon}function drawLine(parentGfx,waypoints,attrs){attrs=computeStyle(attrs,["no-fill"],{stroke:"black",strokeWidth:2,fill:"none"});var line=createLine(waypoints,attrs);return svgAppend(parentGfx,line),line}function drawPath(parentGfx,d,attrs){attrs=computeStyle(attrs,["no-fill"],{strokeWidth:2,stroke:"black"});var path=svgCreate("path");return svgAttr(path,{d:d}),svgAttr(path,attrs),svgAppend(parentGfx,path),path}function drawMarker(type,parentGfx,path,attrs){return drawPath(parentGfx,path,assign({"data-marker":type},attrs))}function as(type){return function(parentGfx,element){return handlers[type](parentGfx,element)}}function renderer(type){return handlers[type]}function renderEventContent(element,parentGfx){var event=getSemantic(element),isThrowing=isThrowEvent(event);return isTypedEvent(event,"bpmn:MessageEventDefinition")?renderer("bpmn:MessageEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:TimerEventDefinition")?renderer("bpmn:TimerEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:ConditionalEventDefinition")?renderer("bpmn:ConditionalEventDefinition")(parentGfx,element):isTypedEvent(event,"bpmn:SignalEventDefinition")?renderer("bpmn:SignalEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:CancelEventDefinition")&&isTypedEvent(event,"bpmn:TerminateEventDefinition",{parallelMultiple:!1})?renderer("bpmn:MultipleEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:CancelEventDefinition")&&isTypedEvent(event,"bpmn:TerminateEventDefinition",{parallelMultiple:!0})?renderer("bpmn:ParallelMultipleEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:EscalationEventDefinition")?renderer("bpmn:EscalationEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:LinkEventDefinition")?renderer("bpmn:LinkEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:ErrorEventDefinition")?renderer("bpmn:ErrorEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:CancelEventDefinition")?renderer("bpmn:CancelEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:CompensateEventDefinition")?renderer("bpmn:CompensateEventDefinition")(parentGfx,element,isThrowing):isTypedEvent(event,"bpmn:TerminateEventDefinition")?renderer("bpmn:TerminateEventDefinition")(parentGfx,element,isThrowing):null}function renderLabel(parentGfx,label,options){var text=textUtil.createText(parentGfx,label||"",options);return svgClasses(text).add("djs-label"),text}function renderEmbeddedLabel(parentGfx,element,align){return renderLabel(parentGfx,getSemantic(element).name,{box:element,align:align,padding:5})}function renderExternalLabel(parentGfx,element){var semantic=getSemantic(element),box={width:90,height:30,x:element.width/2+element.x,y:element.height/2+element.y};return renderLabel(parentGfx,semantic.name,{box:box,style:{fontSize:"11px"}})}function renderLaneLabel(parentGfx,text,element){var textBox=renderLabel(parentGfx,text,{box:{height:30,width:element.height},align:"center-middle"}),top=-1*element.height;transform(textBox,0,-top,270)}function createPathFromConnection(connection){for(var waypoints=connection.waypoints,pathData="m  "+waypoints[0].x+","+waypoints[0].y,i=1;i<waypoints.length;i++)pathData+="L"+waypoints[i].x+","+waypoints[i].y+" ";return pathData}function attachTaskMarkers(parentGfx,element,taskMarkers){var position,obj=getSemantic(element),subprocess=includes(taskMarkers,"SubProcessMarker");position=subprocess?{seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10}:{seq:-3,parallel:-6,compensation:-27,loop:0,adhoc:10},forEach(taskMarkers,function(marker){renderer(marker)(parentGfx,element,position)}),obj.isForCompensation&&renderer("CompensationMarker")(parentGfx,element,position),"bpmn:AdHocSubProcess"===obj.$type&&renderer("AdhocMarker")(parentGfx,element,position);var loopCharacteristics=obj.loopCharacteristics,isSequential=loopCharacteristics&&loopCharacteristics.isSequential;loopCharacteristics&&(void 0===isSequential&&renderer("LoopMarker")(parentGfx,element,position),!1===isSequential&&renderer("ParallelMarker")(parentGfx,element,position),!0===isSequential&&renderer("SequentialMarker")(parentGfx,element,position))}function renderDataItemCollection(parentGfx,element){var yPosition=(element.height-16)/element.height;drawPath(parentGfx,pathMap.getScaledPath("DATA_OBJECT_COLLECTION_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:.451,my:yPosition}}),{strokeWidth:2})}BaseRenderer.call(this,eventBus,priority);var textUtil=new TextUtil({style:LABEL_STYLE,size:{width:100}}),markers={},computeStyle=styles.computeStyle,handlers=this.handlers={"bpmn:Event":function(parentGfx,element,attrs){return drawCircle(parentGfx,element.width,element.height,attrs)},"bpmn:StartEvent":function(parentGfx,element){var attrs={};getSemantic(element).isInterrupting||(attrs={strokeDasharray:"6",strokeLinecap:"round"});var circle=renderer("bpmn:Event")(parentGfx,element,attrs);return renderEventContent(element,parentGfx),circle},"bpmn:MessageEventDefinition":function(parentGfx,element,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_MESSAGE",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:element.width,containerHeight:element.height,position:{mx:.235,my:.315}}),{strokeWidth:1,fill:isThrowing?"black":"white",stroke:isThrowing?"white":"black"})},"bpmn:TimerEventDefinition":function(parentGfx,element){var circle=drawCircle(parentGfx,element.width,element.height,.2*element.height,{strokeWidth:2});drawPath(parentGfx,pathMap.getScaledPath("EVENT_TIMER_WH",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:element.width,containerHeight:element.height,position:{mx:.5,my:.5}}),{strokeWidth:2,strokeLinecap:"square"});for(var i=0;i<12;i++){var linePathData=pathMap.getScaledPath("EVENT_TIMER_LINE",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:element.width,containerHeight:element.height,position:{mx:.5,my:.5}}),width=element.width/2;drawPath(parentGfx,linePathData,{strokeWidth:1,strokeLinecap:"square",transform:"rotate("+30*i+","+element.height/2+","+width+")"})}return circle},"bpmn:EscalationEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_ESCALATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:ConditionalEventDefinition":function(parentGfx,event){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_CONDITIONAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.222}}),{strokeWidth:1})},"bpmn:LinkEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_LINK",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.57,my:.263}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:ErrorEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_ERROR",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:.2,my:.722}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:CancelEventDefinition":function(parentGfx,event,isThrowing){var pathData=pathMap.getScaledPath("EVENT_CANCEL_45",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.638,my:-.055}}),fill=isThrowing?"black":"none",path=drawPath(parentGfx,pathData,{strokeWidth:1,fill:fill});return rotate(path,45),path},"bpmn:CompensateEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.22,my:.5}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:SignalEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_SIGNAL",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:MultipleEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_MULTIPLE",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:.222,my:.36}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:ParallelMultipleEventDefinition":function(parentGfx,event){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_PARALLEL_MULTIPLE",{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:event.width,containerHeight:event.height,position:{mx:.458,my:.194}}),{strokeWidth:1})},"bpmn:EndEvent":function(parentGfx,element){var circle=renderer("bpmn:Event")(parentGfx,element,{strokeWidth:4});return renderEventContent(element,parentGfx),circle},"bpmn:TerminateEventDefinition":function(parentGfx,element){return drawCircle(parentGfx,element.width,element.height,8,{strokeWidth:4,fill:"black"})},"bpmn:IntermediateEvent":function(parentGfx,element){var outer=renderer("bpmn:Event")(parentGfx,element,{strokeWidth:1});return drawCircle(parentGfx,element.width,element.height,INNER_OUTER_DIST,{strokeWidth:1,fill:"none"}),renderEventContent(element,parentGfx),outer},"bpmn:IntermediateCatchEvent":as("bpmn:IntermediateEvent"),"bpmn:IntermediateThrowEvent":as("bpmn:IntermediateEvent"),"bpmn:Activity":function(parentGfx,element,attrs){return drawRect(parentGfx,element.width,element.height,TASK_BORDER_RADIUS,attrs)},"bpmn:Task":function(parentGfx,element,attrs){var rect=renderer("bpmn:Activity")(parentGfx,element,attrs);return renderEmbeddedLabel(parentGfx,element,"center-middle"),attachTaskMarkers(parentGfx,element),rect},"bpmn:ServiceTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:12,y:18}}),{strokeWidth:1,fill:"none"}),drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SERVICE_FILL",{abspos:{x:17.2,y:18}}),{strokeWidth:0,stroke:"none",fill:"white"}),drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:17,y:22}}),{strokeWidth:1,fill:"white"}),task},"bpmn:UserTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_USER_1",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:"none"}),drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_USER_2",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:"none"}),drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_USER_3",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:"black"}),task},"bpmn:ManualTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_MANUAL",{abspos:{x:17,y:15}}),{strokeWidth:.25,fill:"white",stroke:"black"}),task},"bpmn:SendTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:.285,my:.357}}),{strokeWidth:1,fill:"black",stroke:"white"}),task},"bpmn:ReceiveTask":function(parentGfx,element){var pathData,semantic=getSemantic(element),task=renderer("bpmn:Task")(parentGfx,element);return semantic.instantiate?(drawCircle(parentGfx,28,28,4.4,{strokeWidth:1}),pathData=pathMap.getScaledPath("TASK_TYPE_INSTANTIATING_SEND",{abspos:{x:7.77,y:9.52}})):pathData=pathMap.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:21,containerHeight:14,position:{mx:.3,my:.4}}),drawPath(parentGfx,pathData,{strokeWidth:1}),task},"bpmn:ScriptTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SCRIPT",{abspos:{x:15,y:20}}),{strokeWidth:1}),task},"bpmn:BusinessRuleTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element),headerPathData=pathMap.getScaledPath("TASK_TYPE_BUSINESS_RULE_HEADER",{abspos:{x:8,y:8}}),businessHeaderPath=drawPath(parentGfx,headerPathData);svgAttr(businessHeaderPath,{strokeWidth:1,fill:"AAA"});var headerData=pathMap.getScaledPath("TASK_TYPE_BUSINESS_RULE_MAIN",{abspos:{x:8,y:8}}),businessPath=drawPath(parentGfx,headerData);return svgAttr(businessPath,{strokeWidth:1}),task},"bpmn:SubProcess":function(parentGfx,element,attrs){attrs=assign({fillOpacity:.95},attrs);var rect=renderer("bpmn:Activity")(parentGfx,element,attrs),expanded=DiUtil.isExpanded(element);return DiUtil.isEventSubProcess(element)&&svgAttr(rect,{strokeDasharray:"1,2"}),renderEmbeddedLabel(parentGfx,element,expanded?"center-top":"center-middle"),expanded?attachTaskMarkers(parentGfx,element):attachTaskMarkers(parentGfx,element,["SubProcessMarker"]),rect},"bpmn:AdHocSubProcess":function(parentGfx,element){return renderer("bpmn:SubProcess")(parentGfx,element)},"bpmn:Transaction":function(parentGfx,element){var outer=renderer("bpmn:SubProcess")(parentGfx,element),innerAttrs=styles.style(["no-fill","no-events"]);return drawRect(parentGfx,element.width,element.height,TASK_BORDER_RADIUS-2,INNER_OUTER_DIST,innerAttrs),outer},"bpmn:CallActivity":function(parentGfx,element){return renderer("bpmn:SubProcess")(parentGfx,element,{strokeWidth:5})},"bpmn:Participant":function(parentGfx,element){var lane=renderer("bpmn:Lane")(parentGfx,element,{fillOpacity:.95,fill:"White"});DiUtil.isExpanded(element)?(drawLine(parentGfx,[{x:30,y:0},{x:30,y:element.height}]),renderLaneLabel(parentGfx,getSemantic(element).name,element)):renderLabel(parentGfx,getSemantic(element).name,{box:element,align:"center-middle"});return!!getSemantic(element).participantMultiplicity&&renderer("ParticipantMultiplicityMarker")(parentGfx,element),lane},"bpmn:Lane":function(parentGfx,element,attrs){var rect=drawRect(parentGfx,element.width,element.height,0,attrs||{fill:"none"}),semantic=getSemantic(element);if("bpmn:Lane"===semantic.$type){renderLaneLabel(parentGfx,semantic.name,element)}return rect},"bpmn:InclusiveGateway":function(parentGfx,element){var diamond=drawDiamond(parentGfx,element.width,element.height);return drawCircle(parentGfx,element.width,element.height,.24*element.height,{strokeWidth:2.5,fill:"none"}),diamond},"bpmn:ExclusiveGateway":function(parentGfx,element){var diamond=drawDiamond(parentGfx,element.width,element.height),pathData=pathMap.getScaledPath("GATEWAY_EXCLUSIVE",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:element.width,containerHeight:element.height,position:{mx:.32,my:.3}});return getDi(element).isMarkerVisible&&drawPath(parentGfx,pathData,{strokeWidth:1,fill:"black"}),diamond},"bpmn:ComplexGateway":function(parentGfx,element){var diamond=drawDiamond(parentGfx,element.width,element.height);return drawPath(parentGfx,pathMap.getScaledPath("GATEWAY_COMPLEX",{xScaleFactor:.5,yScaleFactor:.5,containerWidth:element.width,containerHeight:element.height,position:{mx:.46,my:.26}}),{strokeWidth:1,fill:"black"}),diamond},"bpmn:ParallelGateway":function(parentGfx,element){var diamond=drawDiamond(parentGfx,element.width,element.height);return drawPath(parentGfx,pathMap.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.6,yScaleFactor:.6,containerWidth:element.width,containerHeight:element.height,position:{mx:.46,my:.2}}),{strokeWidth:1,fill:"black"}),diamond},"bpmn:EventBasedGateway":function(parentGfx,element){var semantic=getSemantic(element),diamond=drawDiamond(parentGfx,element.width,element.height);drawCircle(parentGfx,element.width,element.height,.2*element.height,{strokeWidth:1,fill:"none"});var type=semantic.eventGatewayType,instantiate=!!semantic.instantiate;if("Parallel"===type){var pathData=pathMap.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:element.width,containerHeight:element.height,position:{mx:.474,my:.296}}),parallelPath=drawPath(parentGfx,pathData);svgAttr(parallelPath,{strokeWidth:1,fill:"none"})}else if("Exclusive"===type){if(!instantiate){var innerCircle=drawCircle(parentGfx,element.width,element.height,.26*element.height);svgAttr(innerCircle,{strokeWidth:1,fill:"none"})}!function(){var pathData=pathMap.getScaledPath("GATEWAY_EVENT_BASED",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:element.width,containerHeight:element.height,position:{mx:.36,my:.44}});drawPath(parentGfx,pathData,{strokeWidth:2,fill:"none"})}()}return diamond},"bpmn:Gateway":function(parentGfx,element){return drawDiamond(parentGfx,element.width,element.height)},"bpmn:SequenceFlow":function(parentGfx,element){var pathData=createPathFromConnection(element),path=drawPath(parentGfx,pathData,{strokeLinejoin:"round",markerEnd:marker("sequenceflow-end")}),sequenceFlow=getSemantic(element),source=element.source.businessObject;return sequenceFlow.conditionExpression&&source.$instanceOf("bpmn:Activity")&&svgAttr(path,{markerStart:marker("conditional-flow-marker")}),source.default&&(source.$instanceOf("bpmn:Gateway")||source.$instanceOf("bpmn:Activity"))&&source.default===sequenceFlow&&svgAttr(path,{markerStart:marker("conditional-default-flow-marker")}),path},"bpmn:Association":function(parentGfx,element,attrs){var semantic=getSemantic(element);return attrs=assign({strokeDasharray:"0.5, 5",strokeLinecap:"round",strokeLinejoin:"round"},attrs||{}),"One"!==semantic.associationDirection&&"Both"!==semantic.associationDirection||(attrs.markerEnd=marker("association-end")),"Both"===semantic.associationDirection&&(attrs.markerStart=marker("association-start")),drawLine(parentGfx,element.waypoints,attrs)},"bpmn:DataInputAssociation":function(parentGfx,element){return renderer("bpmn:Association")(parentGfx,element,{markerEnd:marker("association-end")})},"bpmn:DataOutputAssociation":function(parentGfx,element){return renderer("bpmn:Association")(parentGfx,element,{markerEnd:marker("association-end")})},"bpmn:MessageFlow":function(parentGfx,element){var semantic=getSemantic(element),di=getDi(element),pathData=createPathFromConnection(element),path=drawPath(parentGfx,pathData,{markerEnd:marker("messageflow-end"),markerStart:marker("messageflow-start"),strokeDasharray:"10, 12",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5px"});if(semantic.messageRef){var midPoint=path.getPointAtLength(path.getTotalLength()/2),markerPathData=pathMap.getScaledPath("MESSAGE_FLOW_MARKER",{abspos:{x:midPoint.x,y:midPoint.y}}),messageAttrs={strokeWidth:1};"initiating"===di.messageVisibleKind?(messageAttrs.fill="white",messageAttrs.stroke="black"):(messageAttrs.fill="#888",messageAttrs.stroke="white"),drawPath(parentGfx,markerPathData,messageAttrs)}return path},"bpmn:DataObject":function(parentGfx,element){var pathData=pathMap.getScaledPath("DATA_OBJECT_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:.474,my:.296}}),elementObject=drawPath(parentGfx,pathData,{fill:"white"});return isCollection(getSemantic(element))&&renderDataItemCollection(parentGfx,element),elementObject},"bpmn:DataObjectReference":as("bpmn:DataObject"),"bpmn:DataInput":function(parentGfx,element){var arrowPathData=pathMap.getRawPath("DATA_ARROW"),elementObject=renderer("bpmn:DataObject")(parentGfx,element);return drawPath(parentGfx,arrowPathData,{strokeWidth:1}),elementObject},"bpmn:DataOutput":function(parentGfx,element){var arrowPathData=pathMap.getRawPath("DATA_ARROW"),elementObject=renderer("bpmn:DataObject")(parentGfx,element);return drawPath(parentGfx,arrowPathData,{strokeWidth:1,fill:"black"}),elementObject},"bpmn:DataStoreReference":function(parentGfx,element){return drawPath(parentGfx,pathMap.getScaledPath("DATA_STORE",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0,my:.133}}),{strokeWidth:2,fill:"white"})},"bpmn:BoundaryEvent":function(parentGfx,element){var semantic=getSemantic(element),cancel=semantic.cancelActivity,attrs={strokeWidth:1};cancel||(attrs.strokeDasharray="6",attrs.strokeLinecap="round");var outer=renderer("bpmn:Event")(parentGfx,element,attrs);return drawCircle(parentGfx,element.width,element.height,INNER_OUTER_DIST,assign(attrs,{fill:"none"})),renderEventContent(element,parentGfx),outer},"bpmn:Group":function(parentGfx,element){return drawRect(parentGfx,element.width,element.height,TASK_BORDER_RADIUS,{strokeWidth:1,strokeDasharray:"8,3,1,3",fill:"none",pointerEvents:"none"})},label:function(parentGfx,element){var textBBox,textElement=renderExternalLabel(parentGfx,element);try{textBBox=textElement.getBBox()}catch(e){textBBox={width:0,height:0,x:0}}return element.x=Math.ceil(element.x+element.width/2)-Math.ceil(textBBox.width/2),element.width=Math.ceil(textBBox.width),element.height=Math.ceil(textBBox.height),svgAttr(textElement,{transform:"translate("+-1*textBBox.x+",0)"}),textElement},"bpmn:TextAnnotation":function(parentGfx,element){var style={fill:"none",stroke:"none"},textElement=drawRect(parentGfx,element.width,element.height,0,0,style);return drawPath(parentGfx,pathMap.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0,my:0}})),renderLabel(parentGfx,getSemantic(element).text||"",{box:element,align:"left-middle",padding:5}),textElement},ParticipantMultiplicityMarker:function(parentGfx,element){drawMarker("participant-multiplicity",parentGfx,pathMap.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:element.width/2/element.width,my:(element.height-15)/element.height}}))},SubProcessMarker:function(parentGfx,element){var markerRect=drawRect(parentGfx,14,14,0,{strokeWidth:1});translate(markerRect,element.width/2-7.5,element.height-20),drawMarker("sub-process",parentGfx,pathMap.getScaledPath("MARKER_SUB_PROCESS",{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2-7.5)/element.width,my:(element.height-20)/element.height}}))},ParallelMarker:function(parentGfx,element,position){drawMarker("parallel",parentGfx,pathMap.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.parallel)/element.width,my:(element.height-20)/element.height}}))},SequentialMarker:function(parentGfx,element,position){drawMarker("sequential",parentGfx,pathMap.getScaledPath("MARKER_SEQUENTIAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.seq)/element.width,my:(element.height-19)/element.height}}))},CompensationMarker:function(parentGfx,element,position){drawMarker("compensation",parentGfx,pathMap.getScaledPath("MARKER_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.compensation)/element.width,my:(element.height-13)/element.height}}),{strokeWidth:1})},LoopMarker:function(parentGfx,element,position){drawMarker("loop",parentGfx,pathMap.getScaledPath("MARKER_LOOP",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.loop)/element.width,my:(element.height-7)/element.height}}),{strokeWidth:1,fill:"none",strokeLinecap:"round",strokeMiterlimit:.5})},AdhocMarker:function(parentGfx,element,position){drawMarker("adhoc",parentGfx,pathMap.getScaledPath("MARKER_ADHOC",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.adhoc)/element.width,my:(element.height-15)/element.height}}),{strokeWidth:1,fill:"black"})}};eventBus.on("canvas.init",function(event){initMarkers(event.svg)})}function isTypedEvent(event,eventDefinitionType,filter){function matches(definition,filter){return every(filter,function(val,key){return definition[key]==val})}return some(event.eventDefinitions,function(definition){return definition.$type===eventDefinitionType&&matches(event,filter)})}function isThrowEvent(event){return"bpmn:IntermediateThrowEvent"===event.$type||"bpmn:EndEvent"===event.$type}function isCollection(element){return element.isCollection||element.elementObjectRef&&element.elementObjectRef.isCollection}function getDi(element){return element.businessObject.di}function getSemantic(element){return element.businessObject}function getCirclePath(shape){var cx=shape.x+shape.width/2,cy=shape.y+shape.height/2,radius=shape.width/2;return componentsToPath([["M",cx,cy],["m",0,-radius],["a",radius,radius,0,1,1,0,2*radius],["a",radius,radius,0,1,1,0,-2*radius],["z"]])}function getRoundRectPath(shape,borderRadius){var x=shape.x,y=shape.y,width=shape.width,height=shape.height;return componentsToPath([["M",x+borderRadius,y],["l",width-2*borderRadius,0],["a",borderRadius,borderRadius,0,0,1,borderRadius,borderRadius],["l",0,height-2*borderRadius],["a",borderRadius,borderRadius,0,0,1,-borderRadius,borderRadius],["l",2*borderRadius-width,0],["a",borderRadius,borderRadius,0,0,1,-borderRadius,-borderRadius],["l",0,2*borderRadius-height],["a",borderRadius,borderRadius,0,0,1,borderRadius,-borderRadius],["z"]])}function getDiamondPath(shape){var width=shape.width,height=shape.height,x=shape.x,y=shape.y,halfWidth=width/2,halfHeight=height/2;return componentsToPath([["M",x+halfWidth,y],["l",halfWidth,halfHeight],["l",-halfWidth,halfHeight],["l",-halfWidth,-halfHeight],["z"]])}function getRectPath(shape){var x=shape.x,y=shape.y,width=shape.width,height=shape.height;return componentsToPath([["M",x,y],["l",width,0],["l",0,height],["l",-width,0],["z"]])}var inherits=require("inherits"),isObject=require("lodash/lang/isObject"),assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),every=require("lodash/collection/every"),includes=require("lodash/collection/includes"),some=require("lodash/collection/some"),BaseRenderer=require("diagram-js/lib/draw/BaseRenderer"),TextUtil=require("diagram-js/lib/util/Text"),DiUtil=require("../util/DiUtil"),is=require("../util/ModelUtil").is,RenderUtil=require("diagram-js/lib/util/RenderUtil"),componentsToPath=RenderUtil.componentsToPath,createLine=RenderUtil.createLine,domQuery=require("min-dom/lib/query"),svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create"),svgClasses=require("tiny-svg/lib/classes"),rotate=require("diagram-js/lib/util/SvgTransformUtil").rotate,transform=require("diagram-js/lib/util/SvgTransformUtil").transform,translate=require("diagram-js/lib/util/SvgTransformUtil").translate,TASK_BORDER_RADIUS=10,INNER_OUTER_DIST=3,LABEL_STYLE={fontFamily:"Arial, sans-serif",fontSize:12};inherits(BpmnRenderer,BaseRenderer),BpmnRenderer.$inject=["eventBus","styles","pathMap"],module.exports=BpmnRenderer,BpmnRenderer.prototype.canRender=function(element){return is(element,"bpmn:BaseElement")},BpmnRenderer.prototype.drawShape=function(parentGfx,element){var type=element.type;return(0,this.handlers[type])(parentGfx,element)},BpmnRenderer.prototype.drawConnection=function(parentGfx,element){var type=element.type;return(0,this.handlers[type])(parentGfx,element)},BpmnRenderer.prototype.getShapePath=function(element){return is(element,"bpmn:Event")?getCirclePath(element):is(element,"bpmn:Activity")?getRoundRectPath(element,TASK_BORDER_RADIUS):is(element,"bpmn:Gateway")?getDiamondPath(element):getRectPath(element)}},{"../util/DiUtil":158,"../util/ModelUtil":160,"diagram-js/lib/draw/BaseRenderer":191,"diagram-js/lib/util/RenderUtil":341,"diagram-js/lib/util/SvgTransformUtil":342,"diagram-js/lib/util/Text":343,inherits:354,"lodash/collection/every":366,"lodash/collection/forEach":369,"lodash/collection/includes":371,"lodash/collection/some":377,"lodash/lang/isObject":497,"lodash/object/assign":502,"min-dom/lib/query":525,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/create":552}],73:[function(require,module,exports){"use strict";function PathMap(){this.pathMap={EVENT_MESSAGE:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:36,width:36,heightElements:[6,14],widthElements:[10.5,21]},EVENT_SIGNAL:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z",height:36,width:36,heightElements:[18],widthElements:[10,20]},EVENT_ESCALATION:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z",height:36,width:36,heightElements:[20,7],widthElements:[8]},EVENT_CONDITIONAL:{d:"M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z M {e.x2},{e.y3} l {e.x0},0 M {e.x2},{e.y4} l {e.x0},0 M {e.x2},{e.y5} l {e.x0},0 M {e.x2},{e.y6} l {e.x0},0 M {e.x2},{e.y7} l {e.x0},0 M {e.x2},{e.y8} l {e.x0},0 ",height:36,width:36,heightElements:[8.5,14.5,18,11.5,14.5,17.5,20.5,23.5,26.5],widthElements:[10.5,14.5,12.5]},EVENT_LINK:{d:"m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z",height:36,
width:36,heightElements:[4.4375,6.75,7.8125],widthElements:[9.84375,13.5]},EVENT_ERROR:{d:"m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z",height:36,width:36,heightElements:[.023,8.737,8.151,16.564,10.591,8.714],widthElements:[.085,6.672,6.97,4.273,5.337,6.636]},EVENT_CANCEL_45:{d:"m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:36,width:36,heightElements:[4.75,8.5],widthElements:[4.75,8.5]},EVENT_COMPENSATION:{d:"m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z",height:36,width:36,heightElements:[6.5,13,.4,6.1],widthElements:[9,9.3,8.7]},EVENT_TIMER_WH:{d:"M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ",height:36,width:36,heightElements:[10,2],widthElements:[3,7]},EVENT_TIMER_LINE:{d:"M {mx},{my} m {e.x0},{e.y0} l -{e.x1},{e.y1} ",height:36,width:36,heightElements:[10,3],widthElements:[0,0]},EVENT_MULTIPLE:{d:"m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z",height:36,width:36,heightElements:[6.28099,12.56199],widthElements:[3.1405,9.42149,12.56198]},EVENT_PARALLEL_MULTIPLE:{d:"m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} -{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z",height:36,width:36,heightElements:[2.56228,7.68683],widthElements:[2.56228,7.68683]},GATEWAY_EXCLUSIVE:{d:"m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} {e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} {e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z",height:17.5,width:17.5,heightElements:[8.5,6.5312,-6.5312,-8.5],widthElements:[6.5,-6.5,3,-3,5,-5]},GATEWAY_PARALLEL:{d:"m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:30,width:30,heightElements:[5,12.5],widthElements:[5,12.5]},GATEWAY_EVENT_BASED:{d:"m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z",height:11,width:11,heightElements:[-6,6,12,-12],widthElements:[9,-3,-12]},GATEWAY_COMPLEX:{d:"m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} {e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} {e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} -{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z",height:17.125,width:17.125,heightElements:[4.875,3.4375,2.125,3],widthElements:[3.4375,2.125,4.875,3]},DATA_OBJECT_PATH:{d:"m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0",height:61,width:51,heightElements:[10,50,60],widthElements:[10,40,50,60]},DATA_OBJECT_COLLECTION_PATH:{d:"m {mx}, {my} m  0 15  l 0 -15 m  4 15  l 0 -15 m  4 15  l 0 -15 ",height:61,width:51,heightElements:[12],widthElements:[1,6,12,15]},DATA_ARROW:{d:"m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z",height:61,width:51,heightElements:[],widthElements:[]},DATA_STORE:{d:"m  {mx},{my} l  0,{e.y2} c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 l  0,-{e.y2} c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0",height:61,width:61,heightElements:[7,10,45],widthElements:[2,58,60]},TEXT_ANNOTATION:{d:"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0",height:30,width:10,heightElements:[30],widthElements:[10]},MARKER_SUB_PROCESS:{d:"m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_PARALLEL:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},MARKER_SEQUENTIAL:{d:"m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_COMPENSATION:{d:"m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z",height:10,width:21,heightElements:[],widthElements:[]},MARKER_LOOP:{d:"m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 -6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902",height:13.9,width:13.7,heightElements:[],widthElements:[]},MARKER_ADHOC:{d:"m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 -3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 -2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z",height:4,width:15,heightElements:[],widthElements:[]},TASK_TYPE_SEND:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:14,width:21,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_SCRIPT:{d:"m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z m -7,-12 l 5,0 m -4.5,3 l 4.5,0 m -3,3 l 5,0m -4,3 l 5,0",height:15,width:12.6,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_USER_1:{d:"m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 -4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 zm -8,6 l 0,5.5 m 11,0 l 0,-5"},TASK_TYPE_USER_2:{d:"m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 -2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 "},TASK_TYPE_USER_3:{d:"m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 -4.20799998,3.36699999 -4.20699998,4.34799999 z"},TASK_TYPE_MANUAL:{d:"m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 -0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 -1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 -10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 -0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 -1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 -0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 -5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z"},TASK_TYPE_INSTANTIATING_SEND:{d:"m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6"},TASK_TYPE_SERVICE:{d:"m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 -1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 -0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 -1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 -0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_SERVICE_FILL:{d:"m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_BUSINESS_RULE_HEADER:{d:"m {mx},{my} 0,4 20,0 0,-4 z"},TASK_TYPE_BUSINESS_RULE_MAIN:{d:"m {mx},{my} 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8"},MESSAGE_FLOW_MARKER:{d:"m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6"}},this.getRawPath=function(pathId){return this.pathMap[pathId].d},this.getScaledPath=function(pathId,param){var mx,my,rawPath=this.pathMap[pathId];param.abspos?(mx=param.abspos.x,my=param.abspos.y):(mx=param.containerWidth*param.position.mx,my=param.containerHeight*param.position.my);var coordinates={};if(param.position){for(var heightRatio=param.containerHeight/rawPath.height*param.yScaleFactor,widthRatio=param.containerWidth/rawPath.width*param.xScaleFactor,heightIndex=0;heightIndex<rawPath.heightElements.length;heightIndex++)coordinates["y"+heightIndex]=rawPath.heightElements[heightIndex]*heightRatio;for(var widthIndex=0;widthIndex<rawPath.widthElements.length;widthIndex++)coordinates["x"+widthIndex]=rawPath.widthElements[widthIndex]*widthRatio}return format(rawPath.d,{mx:mx,my:my,e:coordinates})}}function replacer(all,key,obj){var res=obj;return key.replace(objNotationRegex,function(all,name,quote,quotedName,isFunc){name=name||quotedName,res&&(name in res&&(res=res[name]),"function"==typeof res&&isFunc&&(res=res()))}),res=(null==res||res==obj?all:res)+""}function format(str,obj){return String(str).replace(tokenRegex,function(all,key){return replacer(all,key,obj)})}module.exports=PathMap;var tokenRegex=/\{([^\}]+)\}/g,objNotationRegex=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g},{}],74:[function(require,module,exports){module.exports={__init__:["bpmnRenderer"],bpmnRenderer:["type",require("./BpmnRenderer")],pathMap:["type",require("./PathMap")]}},{"./BpmnRenderer":72,"./PathMap":73}],75:[function(require,module,exports){function BpmnAutoResize(eventBus,elementRegistry,modeling,rules){AutoResize.call(this,eventBus,elementRegistry,modeling,rules)}var AutoResize=require("diagram-js/lib/features/auto-resize/AutoResize"),inherits=require("inherits"),is=require("../../util/ModelUtil").is;BpmnAutoResize.$inject=["eventBus","elementRegistry","modeling","rules"],inherits(BpmnAutoResize,AutoResize),module.exports=BpmnAutoResize,BpmnAutoResize.prototype.resize=function(target,newBounds){is(target,"bpmn:Participant")?this._modeling.resizeLane(target,newBounds):this._modeling.resizeShape(target,newBounds)}},{"../../util/ModelUtil":160,"diagram-js/lib/features/auto-resize/AutoResize":199,inherits:354}],76:[function(require,module,exports){"use strict";function BpmnAutoResizeProvider(eventBus,modeling){AutoResizeProvider.call(this,eventBus),this._modeling=modeling}var is=require("../../util/ModelUtil").is,inherits=require("inherits"),forEach=require("lodash/collection/forEach"),AutoResizeProvider=require("diagram-js/lib/features/auto-resize/AutoResizeProvider");inherits(BpmnAutoResizeProvider,AutoResizeProvider),BpmnAutoResizeProvider.$inject=["eventBus","modeling"],module.exports=BpmnAutoResizeProvider,BpmnAutoResizeProvider.prototype.canResize=function(elements,target){if(!is(target,"bpmn:Participant")&&!is(target,"bpmn:Lane")&&!is(target,"bpmn:SubProcess"))return!1;var canResize=!0;return forEach(elements,function(element){if(is(element,"bpmn:Lane")||element.labelTarget)return void(canResize=!1)}),canResize}},{"../../util/ModelUtil":160,"diagram-js/lib/features/auto-resize/AutoResizeProvider":200,inherits:354,"lodash/collection/forEach":369}],77:[function(require,module,exports){module.exports={__init__:["bpmnAutoResize","bpmnAutoResizeProvider"],bpmnAutoResize:["type",require("./BpmnAutoResize")],bpmnAutoResizeProvider:["type",require("./BpmnAutoResizeProvider")]}},{"./BpmnAutoResize":75,"./BpmnAutoResizeProvider":76}],78:[function(require,module,exports){"use strict";function ContextPadProvider(eventBus,contextPad,modeling,elementFactory,connect,create,popupMenu,canvas,rules,translate){contextPad.registerProvider(this),this._contextPad=contextPad,this._modeling=modeling,this._elementFactory=elementFactory,this._connect=connect,this._create=create,this._popupMenu=popupMenu,this._canvas=canvas,this._rules=rules,this._translate=translate,eventBus.on("create.end",250,function(event){var shape=event.context.shape;if(hasPrimaryModifier(event)){var entries=contextPad.getEntries(shape);entries.replace&&entries.replace.action.click(event,shape)}})}function isEventType(eventBo,type,definition){var isType=eventBo.$instanceOf(type),isDefinition=!1,definitions=eventBo.eventDefinitions||[];return forEach(definitions,function(def){def.$type===definition&&(isDefinition=!0)}),isType&&isDefinition}var assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),isArray=require("lodash/lang/isArray"),is=require("../../util/ModelUtil").is,isExpanded=require("../../util/DiUtil").isExpanded,isAny=require("../modeling/util/ModelingUtil").isAny,getChildLanes=require("../modeling/util/LaneUtil").getChildLanes,isEventSubProcess=require("../../util/DiUtil").isEventSubProcess,hasPrimaryModifier=require("diagram-js/lib/util/Mouse").hasPrimaryModifier;ContextPadProvider.$inject=["eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate"],module.exports=ContextPadProvider,ContextPadProvider.prototype.getContextPadEntries=function(element){function startConnect(event,element,autoActivate){connect.start(event,element,autoActivate)}function removeElement(e){modeling.removeElements([element])}function getReplaceMenuPosition(element){var diagramContainer=canvas.getContainer(),pad=contextPad.getPad(element).html,diagramRect=diagramContainer.getBoundingClientRect(),padRect=pad.getBoundingClientRect(),top=padRect.top-diagramRect.top;return{x:padRect.left-diagramRect.left,y:top+padRect.height+5}}function appendAction(type,className,title,options){function appendListener(event,element){var shape=elementFactory.createShape(assign({type:type},options));create.start(event,shape,element)}return"string"!=typeof title&&(options=title,title=translate("Append {type}",{type:type.replace(/^bpmn\:/,"")})),{group:"model",className:className,title:title,action:{dragstart:appendListener,click:appendListener}}}function splitLaneHandler(count){return function(event,element){modeling.splitLane(element,count),contextPad.open(element,!0)}}var contextPad=this._contextPad,modeling=this._modeling,elementFactory=this._elementFactory,connect=this._connect,create=this._create,popupMenu=this._popupMenu,canvas=this._canvas,rules=this._rules,translate=this._translate,actions={};if("label"===element.type)return actions;var businessObject=element.businessObject;if(isAny(businessObject,["bpmn:Lane","bpmn:Participant"])&&isExpanded(businessObject)){var childLanes=getChildLanes(element);assign(actions,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:translate("Add Lane above"),action:{click:function(event,element){modeling.addLane(element,"top")}}}}),childLanes.length<2&&(element.height>=120&&assign(actions,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:translate("Divide into two Lanes"),action:{click:splitLaneHandler(2)}}}),element.height>=180&&assign(actions,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:translate("Divide into three Lanes"),action:{click:splitLaneHandler(3)}}})),assign(actions,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:translate("Add Lane below"),action:{click:function(event,element){modeling.addLane(element,"bottom")}}}})}is(businessObject,"bpmn:FlowNode")&&(is(businessObject,"bpmn:EventBasedGateway")?assign(actions,{"append.receive-task":appendAction("bpmn:ReceiveTask","bpmn-icon-receive-task"),"append.message-intermediate-event":appendAction("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":appendAction("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condtion-intermediate-event":appendAction("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":appendAction("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",{eventDefinitionType:"bpmn:SignalEventDefinition"})}):isEventType(businessObject,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?assign(actions,{"append.compensation-activity":appendAction("bpmn:Task","bpmn-icon-task",translate("Append compensation activity"),{isForCompensation:!0})}):is(businessObject,"bpmn:EndEvent")||businessObject.isForCompensation||isEventType(businessObject,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||isEventSubProcess(businessObject)||assign(actions,{"append.end-event":appendAction("bpmn:EndEvent","bpmn-icon-end-event-none"),"append.gateway":appendAction("bpmn:ExclusiveGateway","bpmn-icon-gateway-xor"),"append.append-task":appendAction("bpmn:Task","bpmn-icon-task"),"append.intermediate-event":appendAction("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none")}));var replaceMenu;popupMenu._providers["bpmn-replace"]&&(replaceMenu=popupMenu.create("bpmn-replace",element)),replaceMenu&&!replaceMenu.isEmpty()&&assign(actions,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:translate("Change type"),action:{click:function(event,element){replaceMenu.open(assign(getReplaceMenuPosition(element),{cursor:{x:event.x,y:event.y}}),element)}}}}),isAny(businessObject,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&assign(actions,{"append.text-annotation":appendAction("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:translate("Connect using "+(businessObject.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:startConnect,dragstart:startConnect}}}),isAny(businessObject,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&assign(actions,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:translate("Connect using DataInputAssociation"),action:{click:startConnect,dragstart:startConnect}}});var deleteAllowed=rules.allowed("elements.delete",{elements:[element]});return isArray(deleteAllowed)&&(deleteAllowed=deleteAllowed[0]===element),deleteAllowed&&assign(actions,{delete:{group:"edit",className:"bpmn-icon-trash",title:translate("Remove"),action:{click:removeElement,dragstart:removeElement}}}),actions}},{"../../util/DiUtil":158,"../../util/ModelUtil":160,"../modeling/util/LaneUtil":132,"../modeling/util/ModelingUtil":133,"diagram-js/lib/util/Mouse":337,"lodash/collection/forEach":369,"lodash/lang/isArray":492,"lodash/object/assign":502}],79:[function(require,module,exports){module.exports={__depends__:[require("diagram-js-direct-editing"),require("diagram-js/lib/features/context-pad"),require("diagram-js/lib/features/selection"),require("diagram-js/lib/features/connect"),require("diagram-js/lib/features/create"),require("../popup-menu")],__init__:["contextPadProvider"],contextPadProvider:["type",require("./ContextPadProvider")]}},{"../popup-menu":139,"./ContextPadProvider":78,"diagram-js-direct-editing":177,"diagram-js/lib/features/connect":214,"diagram-js/lib/features/context-pad":216,"diagram-js/lib/features/create":220,"diagram-js/lib/features/selection":296}],80:[function(require,module,exports){"use strict";function setProperties(descriptor,data,properties){forEach(properties,function(property){void 0!==data[property]&&(descriptor[property]=data[property])})}function removeProperties(element,properties){forEach(properties,function(prop){element[prop]&&delete element[prop]})}function BpmnCopyPaste(bpmnFactory,eventBus,copyPaste,clipboard,moddle,canvas,bpmnRules){copyPaste.registerDescriptor(function(element,descriptor){var conditionExpression,eventDefinitions,businessObject=getBusinessObject(element);return descriptor.type=element.type,"label"===element.type?descriptor:(setProperties(descriptor,businessObject,["name","text","processRef","isInterrupting","isForCompensation","associationDirection","triggeredByEvent","cancelActivity"]),businessObject.default&&(descriptor.default=businessObject.default.id),businessObject.loopCharacteristics&&(descriptor.loopCharacteristics={type:businessObject.loopCharacteristics.$type,isSequential:businessObject.loopCharacteristics.isSequential}),setProperties(descriptor,businessObject.di,["isExpanded"]),is(businessObject,"bpmn:SequenceFlow")&&(conditionExpression=businessObject.get("conditionExpression"))&&(descriptor.conditionExpression={type:conditionExpression.$type,body:conditionExpression.body}),eventDefinitions=businessObject.get("eventDefinitions")||[],eventDefinitions.length&&(descriptor.eventDefinitions=map(eventDefinitions,function(defs){return defs.$type})),descriptor)}),eventBus.on("element.paste",function(context){var businessObject,newEventDefinition,conditionExpression,loopCharacteristics,source,target,canConnect,descriptor=context.descriptor,createdElements=context.createdElements,parent=descriptor.parent,rootElement=canvas.getRootElement();"label"!==descriptor.type&&(is(parent,"bpmn:Process")&&(descriptor.parent=is(rootElement,"bpmn:Collaboration")?rootElement:parent),"bpmn:DataOutputAssociation"!==descriptor.type&&"bpmn:DataInputAssociation"!==descriptor.type&&"bpmn:MessageFlow"!==descriptor.type||(descriptor.parent=rootElement),is(parent,"bpmn:Lane")&&(descriptor.parent=parent.parent),descriptor.waypoints&&(source=createdElements[descriptor.source],target=createdElements[descriptor.target],source&&target&&(source=source.element,target=target.element),(canConnect=bpmnRules.canConnect(source,target))&&(descriptor.type=canConnect.type)),descriptor.businessObject=businessObject=bpmnFactory.create(descriptor.type),"bpmn:Participant"===descriptor.type&&descriptor.processRef&&(descriptor.processRef=businessObject.processRef=bpmnFactory.create("bpmn:Process")),setProperties(businessObject,descriptor,["name","text","isExpanded","isInterrupting","cancelActivity","triggeredByEvent"]),descriptor.loopCharacteristics&&(loopCharacteristics=descriptor.loopCharacteristics,businessObject.loopCharacteristics=moddle.create(loopCharacteristics.type),loopCharacteristics.isSequential&&(businessObject.loopCharacteristics.isSequential=!0),businessObject.loopCharacteristics.$parent=businessObject),descriptor.conditionExpression&&(conditionExpression=descriptor.conditionExpression,businessObject.conditionExpression=moddle.create(conditionExpression.type,{body:conditionExpression.body}),businessObject.conditionExpression.$parent=businessObject),descriptor.eventDefinitions&&(businessObject.eventDefinitions=map(descriptor.eventDefinitions,function(type){return newEventDefinition=moddle.create(type),newEventDefinition.$parent=businessObject,newEventDefinition})),removeProperties(descriptor,["name","text","eventDefinitions","conditionExpression","loopCharacteristics","isInterrupting","cancelActivity","triggeredByEvent"]))})}var ModelUtil=require("../../util/ModelUtil"),getBusinessObject=ModelUtil.getBusinessObject,is=ModelUtil.is,map=require("lodash/collection/map"),forEach=require("lodash/collection/forEach");BpmnCopyPaste.$inject=["bpmnFactory","eventBus","copyPaste","clipboard","moddle","canvas","bpmnRules"],module.exports=BpmnCopyPaste},{"../../util/ModelUtil":160,"lodash/collection/forEach":369,"lodash/collection/map":373}],81:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/copy-paste")],__init__:["bpmnCopyPaste"],bpmnCopyPaste:["type",require("./BpmnCopyPaste")]}},{"./BpmnCopyPaste":80,"diagram-js/lib/features/copy-paste":218}],82:[function(require,module,exports){"use strict";function BpmnDistributeElements(distributeElements){distributeElements.registerFilter(function(elements){return filter(elements,function(element){var cannotDistribute=isAny(element,["bpmn:Association","bpmn:BoundaryEvent","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:Lane","bpmn:MessageFlow","bpmn:Participant","bpmn:SequenceFlow","bpmn:TextAnnotation"]);return!(element.labelTarget||cannotDistribute)})})}var filter=require("lodash/collection/filter"),isAny=require("../modeling/util/ModelingUtil").isAny;BpmnDistributeElements.$inject=["distributeElements"],module.exports=BpmnDistributeElements},{"../modeling/util/ModelingUtil":133,"lodash/collection/filter":367}],83:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/distribute-elements")],__init__:["bpmnDistributeElements"],bpmnDistributeElements:["type",require("./BpmnDistributeElements")]}},{"./BpmnDistributeElements":82,"diagram-js/lib/features/distribute-elements":222}],84:[function(require,module,exports){"use strict";function BpmnEditorActions(injector,canvas,elementRegistry,selection,spaceTool,lassoTool,handTool,globalConnect,distributeElements,alignElements,directEditing,searchPad,modeling){injector.invoke(EditorActions,this),this.register({selectElements:function(){var rootElement=canvas.getRootElement(),elements=elementRegistry.filter(function(element){return element!==rootElement});return selection.select(elements),elements},spaceTool:function(){spaceTool.toggle()},lassoTool:function(){lassoTool.toggle()},handTool:function(){handTool.toggle()},globalConnectTool:function(){globalConnect.toggle()},distributeElements:function(opts){var currentSelection=selection.get(),type=opts.type;currentSelection.length&&distributeElements.trigger(currentSelection,type)},alignElements:function(opts){var currentSelection=selection.get(),aligneableElements=[],type=opts.type;currentSelection.length&&(aligneableElements=filter(currentSelection,function(element){return!is(element,"bpmn:Lane")}),alignElements.trigger(aligneableElements,type))},directEditing:function(){var currentSelection=selection.get();currentSelection.length&&directEditing.activate(currentSelection[0])},find:function(){searchPad.toggle()},moveToOrigin:function(){var boundingBox,elements,rootElement=canvas.getRootElement();elements=is(rootElement,"bpmn:Collaboration")?elementRegistry.filter(function(element){return is(element.parent,"bpmn:Collaboration")}):elementRegistry.filter(function(element){return element!==rootElement}),boundingBox=getBBox(elements),modeling.moveElements(elements,{x:-boundingBox.x,y:-boundingBox.y},rootElement)}})}var inherits=require("inherits"),EditorActions=require("diagram-js/lib/features/editor-actions/EditorActions"),filter=require("lodash/collection/filter"),is=require("../../util/ModelUtil").is,getBBox=require("diagram-js/lib/util/Elements").getBBox;inherits(BpmnEditorActions,EditorActions),BpmnEditorActions.$inject=["injector","canvas","elementRegistry","selection","spaceTool","lassoTool","handTool","globalConnect","distributeElements","alignElements","directEditing","searchPad","modeling"],module.exports=BpmnEditorActions},{"../../util/ModelUtil":160,"diagram-js/lib/features/editor-actions/EditorActions":226,"diagram-js/lib/util/Elements":329,inherits:354,"lodash/collection/filter":367}],85:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/align-elements"),require("diagram-js/lib/features/editor-actions"),require("diagram-js/lib/features/hand-tool"),require("diagram-js/lib/features/lasso-tool"),require("diagram-js/lib/features/space-tool"),require("../global-connect"),require("../copy-paste"),require("../distribute-elements"),require("../search"),require("../modeling")],editorActions:["type",require("./BpmnEditorActions")]}},{"../copy-paste":81,"../distribute-elements":83,"../global-connect":87,"../modeling":131,"../search":149,"./BpmnEditorActions":84,"diagram-js/lib/features/align-elements":196,"diagram-js/lib/features/editor-actions":227,"diagram-js/lib/features/hand-tool":231,"diagram-js/lib/features/lasso-tool":239,"diagram-js/lib/features/space-tool":303}],86:[function(require,module,exports){"use strict";function BpmnGlobalConnect(globalConnect){globalConnect.registerProvider(this)}function nonExistantOrLabel(element){return!element||isLabel(element)}function isLabel(element){return element.labelTarget}var isAny=require("../modeling/util/ModelingUtil").isAny;BpmnGlobalConnect.$inject=["globalConnect"],module.exports=BpmnGlobalConnect,BpmnGlobalConnect.prototype.canStartConnect=function(source){if(nonExistantOrLabel(source))return null;var businessObject=source.businessObject;return isAny(businessObject,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])}},{"../modeling/util/ModelingUtil":133}],87:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/global-connect")],__init__:["bpmnGlobalConnect"],bpmnGlobalConnect:["type",require("./BpmnGlobalConnect")]}},{"./BpmnGlobalConnect":86,"diagram-js/lib/features/global-connect":229}],88:[function(require,module,exports){"use strict";function BpmnKeyBindings(keyboard,editorActions){keyboard.addListener(function(key,modifiers){if(65===key&&keyboard.isCmd(modifiers))return editorActions.trigger("selectElements"),!0;if(70===key&&keyboard.isCmd(modifiers))return editorActions.trigger("find"),!0;if(!keyboard.hasModifier(modifiers))return 83===key?(editorActions.trigger("spaceTool"),!0):76===key?(editorActions.trigger("lassoTool"),!0):72===key?(editorActions.trigger("handTool"),!0):67===key?(editorActions.trigger("globalConnectTool"),!0):69===key?(editorActions.trigger("directEditing"),!0):void 0})}BpmnKeyBindings.$inject=["keyboard","editorActions"],module.exports=BpmnKeyBindings},{}],89:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/keyboard")],__init__:["bpmnKeyBindings"],bpmnKeyBindings:["type",require("./BpmnKeyBindings")]}},{"./BpmnKeyBindings":88,"diagram-js/lib/features/keyboard":235}],90:[function(require,module,exports){"use strict";function LabelEditingProvider(eventBus,canvas,directEditing,commandStack){this._canvas=canvas,this._commandStack=commandStack,directEditing.registerProvider(this),commandStack.registerHandler("element.updateLabel",UpdateLabelHandler),eventBus.on("element.dblclick",function(event){directEditing.activate(event.element)}),eventBus.on(["element.mousedown","drag.init","canvas.viewbox.changed"],function(event){directEditing.complete()}),eventBus.on(["commandStack.changed"],function(){directEditing.cancel()}),"ontouchstart"in document.documentElement||eventBus.on("create.end",500,function(e){var element=e.shape;e.context.canExecute&&(is(element,"bpmn:Task")||is(element,"bpmn:TextAnnotation")||is(element,"bpmn:SubProcess")&&!isExpanded(element))&&directEditing.activate(element)})}
var UpdateLabelHandler=require("./cmd/UpdateLabelHandler"),LabelUtil=require("./LabelUtil"),is=require("../../util/ModelUtil").is,isExpanded=require("../../util/DiUtil").isExpanded;LabelEditingProvider.$inject=["eventBus","canvas","directEditing","commandStack"],module.exports=LabelEditingProvider,LabelEditingProvider.prototype.activate=function(element){var text=LabelUtil.getLabel(element);if(void 0!==text){var properties=this.getEditingBBox(element);return properties.text=text,properties}},LabelEditingProvider.prototype.getEditingBBox=function(element){var zoom,canvas=this._canvas,target=element.label||element,bbox=canvas.getAbsoluteBBox(target),mid={x:bbox.x+bbox.width/2,y:bbox.y+bbox.height/2},bounds={x:bbox.x,y:bbox.y},style={};return(is(element,"bpmn:Participant")&&isExpanded(element)||is(element,"bpmn:Lane"))&&(bounds.width=150,bounds.minHeight=20,bounds.maxHeight=34,bounds.x=bbox.x-bounds.width/2,bounds.y=mid.y-bounds.minHeight/2),(is(element,"bpmn:Task")||is(element,"bpmn:CallActivity")&&!isExpanded(element)||is(element,"bpmn:SubProcess")&&!isExpanded(element)||is(element,"bpmn:Participant")&&!isExpanded(element))&&(zoom=canvas.zoom(),zoom>1?(bounds.width=bbox.width,bounds.height=bbox.height):(bounds.width=bbox.width/zoom,bounds.height=bbox.height/zoom),zoom<1&&(bounds.x=bbox.x-(bounds.width/2-bbox.width/2),bounds.y=bbox.y-(bounds.height/2-bbox.height/2))),is(element,"bpmn:SubProcess")&&isExpanded(element)&&(bounds.width=element.width,bounds.maxHeight=48,bounds.x=mid.x-element.width/2),target.labelTarget&&(bounds.width=150,bounds.minHeight=20,bounds.x=mid.x-bounds.width/2),is(element,"bpmn:TextAnnotation")&&(bounds.minWidth=100,bounds.height=element.height,style.textAlign="left"),{bounds:bounds,style:style}},LabelEditingProvider.prototype.update=function(element,newLabel){this._commandStack.execute("element.updateLabel",{element:element,newLabel:newLabel})}},{"../../util/DiUtil":158,"../../util/ModelUtil":160,"./LabelUtil":91,"./cmd/UpdateLabelHandler":92}],91:[function(require,module,exports){"use strict";function getLabelAttr(semantic){return is(semantic,"bpmn:FlowElement")||is(semantic,"bpmn:Participant")||is(semantic,"bpmn:Lane")||is(semantic,"bpmn:SequenceFlow")||is(semantic,"bpmn:MessageFlow")?"name":is(semantic,"bpmn:TextAnnotation")?"text":void 0}var is=require("../../util/ModelUtil").is;module.exports.getLabel=function(element){var semantic=element.businessObject,attr=getLabelAttr(semantic);if(attr)return semantic[attr]||""},module.exports.setLabel=function(element,text,isExternal){var semantic=element.businessObject,attr=getLabelAttr(semantic);return attr&&(semantic[attr]=text),isExternal&&(element.hidden=!text),element}},{"../../util/ModelUtil":160}],92:[function(require,module,exports){"use strict";function UpdateLabelHandler(){function setText(element,text){var label=element.label||element,labelTarget=element.labelTarget||element;return LabelUtil.setLabel(label,text,labelTarget!==label),[label,labelTarget]}function execute(ctx){return ctx.oldLabel=LabelUtil.getLabel(ctx.element),setText(ctx.element,ctx.newLabel)}function revert(ctx){return setText(ctx.element,ctx.oldLabel)}this.execute=execute,this.revert=revert}var LabelUtil=require("../LabelUtil");module.exports=UpdateLabelHandler},{"../LabelUtil":91}],93:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/command"),require("diagram-js/lib/features/change-support"),require("diagram-js-direct-editing")],__init__:["labelEditingProvider"],labelEditingProvider:["type",require("./LabelEditingProvider")]}},{"./LabelEditingProvider":90,"diagram-js-direct-editing":177,"diagram-js/lib/command":184,"diagram-js/lib/features/change-support":210}],94:[function(require,module,exports){"use strict";function BpmnFactory(moddle){this._model=moddle}var map=require("lodash/collection/map"),assign=require("lodash/object/assign"),pick=require("lodash/object/pick");BpmnFactory.$inject=["moddle"],BpmnFactory.prototype._needsId=function(element){return element.$instanceOf("bpmn:RootElement")||element.$instanceOf("bpmn:FlowElement")||element.$instanceOf("bpmn:MessageFlow")||element.$instanceOf("bpmn:DataAssociation")||element.$instanceOf("bpmn:Artifact")||element.$instanceOf("bpmn:Participant")||element.$instanceOf("bpmn:Lane")||element.$instanceOf("bpmn:Process")||element.$instanceOf("bpmn:Collaboration")||element.$instanceOf("bpmndi:BPMNShape")||element.$instanceOf("bpmndi:BPMNEdge")||element.$instanceOf("bpmndi:BPMNDiagram")||element.$instanceOf("bpmndi:BPMNPlane")||element.$instanceOf("bpmn:Property")},BpmnFactory.prototype._ensureId=function(element){var prefix=(element.$type||"").replace(/^[^:]*:/g,"")+"_";!element.id&&this._needsId(element)&&(element.id=this._model.ids.nextPrefixed(prefix,element))},BpmnFactory.prototype.create=function(type,attrs){var element=this._model.create(type,attrs||{});return this._ensureId(element),element},BpmnFactory.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})},BpmnFactory.prototype.createDiShape=function(semantic,bounds,attrs){return this.create("bpmndi:BPMNShape",assign({bpmnElement:semantic,bounds:this.createDiBounds(bounds)},attrs))},BpmnFactory.prototype.createDiBounds=function(bounds){return this.create("dc:Bounds",bounds)},BpmnFactory.prototype.createDiWaypoints=function(waypoints){return map(waypoints,function(pos){return this.createDiWaypoint(pos)},this)},BpmnFactory.prototype.createDiWaypoint=function(point){return this.create("dc:Point",pick(point,["x","y"]))},BpmnFactory.prototype.createDiEdge=function(semantic,waypoints,attrs){return this.create("bpmndi:BPMNEdge",assign({bpmnElement:semantic},attrs))},BpmnFactory.prototype.createDiPlane=function(semantic){return this.create("bpmndi:BPMNPlane",{bpmnElement:semantic})},module.exports=BpmnFactory},{"lodash/collection/map":373,"lodash/object/assign":502,"lodash/object/pick":511}],95:[function(require,module,exports){"use strict";function BpmnLayouter(){}function getAttachOrientation(attachedElement){var hostElement=attachedElement.host;return getOrientation(getMid(attachedElement),hostElement,-10)}function getConnectionDocking(point,shape){return point?point.original||point:getMid(shape)}function isCompensationAssociation(connection){var source=connection.source,target=connection.target;return is(target,"bpmn:Activity")&&is(source,"bpmn:BoundaryEvent")&&target.businessObject.isForCompensation}function isExpandedSubProcess(element){return is(element,"bpmn:SubProcess")&&isExpanded(element)}var inherits=require("inherits"),assign=require("lodash/object/assign"),BaseLayouter=require("diagram-js/lib/layout/BaseLayouter"),ManhattanLayout=require("diagram-js/lib/layout/ManhattanLayout"),LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),isExpanded=require("../../util/DiUtil").isExpanded,getMid=LayoutUtil.getMid,getOrientation=LayoutUtil.getOrientation,is=require("../../util/ModelUtil").is;inherits(BpmnLayouter,BaseLayouter),module.exports=BpmnLayouter,BpmnLayouter.prototype.layoutConnection=function(connection,hints){hints=hints||{};var manhattanOptions,updatedWaypoints,source=connection.source,target=connection.target,waypoints=connection.waypoints,start=hints.connectionStart,end=hints.connectionEnd;if(start||(start=getConnectionDocking(waypoints&&waypoints[0],source)),end||(end=getConnectionDocking(waypoints&&waypoints[waypoints.length-1],target)),(is(connection,"bpmn:Association")||is(connection,"bpmn:DataAssociation"))&&waypoints&&!isCompensationAssociation(connection))return[].concat([start],waypoints.slice(1,-1),[end]);if(is(connection,"bpmn:MessageFlow"))manhattanOptions={preferredLayouts:["v:v"]},is(target,"bpmn:Participant")&&(manhattanOptions={preferredLayouts:["straight","v:v"]}),isExpandedSubProcess(target)&&(manhattanOptions={preferredLayouts:["straight","v:v"]}),isExpandedSubProcess(source)&&is(target,"bpmn:FlowNode")&&(manhattanOptions={preferredLayouts:["straight","v:v"],preserveDocking:isExpandedSubProcess(target)?"source":"target"}),is(source,"bpmn:Participant")&&is(target,"bpmn:FlowNode")&&(manhattanOptions={preferredLayouts:["straight","v:v"],preserveDocking:"target"}),is(target,"bpmn:Event")&&(manhattanOptions={preferredLayouts:["v:v"]});else if(is(connection,"bpmn:SequenceFlow")||isCompensationAssociation(connection))if(is(source,"bpmn:BoundaryEvent")){var orientation=getAttachOrientation(source);/left|right/.test(orientation)?manhattanOptions={preferredLayouts:["h:v"]}:/top|bottom/.test(orientation)&&(manhattanOptions={preferredLayouts:["v:h"]})}else manhattanOptions=is(source,"bpmn:Gateway")?{preferredLayouts:["v:h"]}:is(target,"bpmn:Gateway")?{preferredLayouts:["h:v"]}:{preferredLayouts:["h:h"]};return manhattanOptions&&(manhattanOptions=assign(manhattanOptions,hints),updatedWaypoints=ManhattanLayout.repairConnection(source,target,start,end,waypoints,manhattanOptions)),updatedWaypoints||[start,end]}},{"../../util/DiUtil":158,"../../util/ModelUtil":160,"diagram-js/lib/layout/BaseLayouter":313,"diagram-js/lib/layout/LayoutUtil":315,"diagram-js/lib/layout/ManhattanLayout":316,inherits:354,"lodash/object/assign":502}],96:[function(require,module,exports){"use strict";function BpmnUpdater(eventBus,bpmnFactory,connectionDocking,translate){function cropConnection(e){var connection,context=e.context;context.cropped||(connection=context.connection,connection.waypoints=connectionDocking.getCroppedWaypoints(connection),context.cropped=!0)}function updateParent(e){var context=e.context;self.updateParent(context.shape||context.connection,context.oldParent)}function reverseUpdateParent(e){var context=e.context,element=context.shape||context.connection,oldParent=context.parent||context.newParent;self.updateParent(element,oldParent)}function updateRoot(event){var context=event.context,oldRoot=context.oldRoot,children=oldRoot.children;forEach(children,function(child){is(child,"bpmn:BaseElement")&&self.updateParent(child)})}function updateBounds(e){var shape=e.context.shape;is(shape,"bpmn:BaseElement")&&self.updateBounds(shape)}function updateConnection(e){self.updateConnection(e.context)}function updateConnectionWaypoints(e){self.updateConnectionWaypoints(e.context.connection)}function updateAttachment(e){self.updateAttachment(e.context)}CommandInterceptor.call(this,eventBus),this._bpmnFactory=bpmnFactory,this._translate=translate;var self=this;this.executed(["connection.layout","connection.create","connection.reconnectEnd","connection.reconnectStart"],cropConnection),this.reverted(["connection.layout"],function(e){delete e.context.cropped}),this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ifBpmn(updateParent)),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ifBpmn(reverseUpdateParent)),this.executed(["canvas.updateRoot"],updateRoot),this.reverted(["canvas.updateRoot"],updateRoot),this.executed(["shape.move","shape.create","shape.resize"],ifBpmn(function(event){"label"!==event.context.shape.type&&updateBounds(event)})),this.reverted(["shape.move","shape.create","shape.resize"],ifBpmn(function(event){"label"!==event.context.shape.type&&updateBounds(event)})),eventBus.on("shape.changed",function(event){"label"===event.element.type&&updateBounds({context:{shape:event.element}})}),this.executed(["connection.create","connection.move","connection.delete","connection.reconnectEnd","connection.reconnectStart"],ifBpmn(updateConnection)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnectEnd","connection.reconnectStart"],ifBpmn(updateConnection)),this.executed(["connection.layout","connection.move","connection.updateWaypoints","connection.reconnectEnd","connection.reconnectStart"],ifBpmn(updateConnectionWaypoints)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints","connection.reconnectEnd","connection.reconnectStart"],ifBpmn(updateConnectionWaypoints)),this.executed(["connection.reconnectEnd","connection.reconnectStart"],ifBpmn(function(e){var context=e.context,connection=context.connection,businessObject=getBusinessObject(connection),oldSource=getBusinessObject(context.oldSource),oldTarget=getBusinessObject(context.oldTarget),newSource=getBusinessObject(connection.source),newTarget=getBusinessObject(connection.target);oldSource!==newSource&&oldTarget!==newTarget&&(oldSource&&oldSource.default===businessObject&&(context.default=oldSource.default,oldSource.default=void 0),businessObject.sourceRef&&businessObject.sourceRef.default&&!(is(newTarget,"bpmn:Activity")||is(newTarget,"bpmn:EndEvent")||is(newTarget,"bpmn:Gateway")||is(newTarget,"bpmn:IntermediateThrowEvent"))&&(context.default=businessObject.sourceRef.default,businessObject.sourceRef.default=void 0),oldSource&&businessObject.conditionExpression&&!is(newSource,"bpmn:Activity")&&!is(newSource,"bpmn:Gateway")&&(context.conditionExpression=businessObject.conditionExpression,businessObject.conditionExpression=void 0),oldTarget&&businessObject.conditionExpression&&!(is(newTarget,"bpmn:Activity")||is(newTarget,"bpmn:EndEvent")||is(newTarget,"bpmn:Gateway")||is(newTarget,"bpmn:IntermediateThrowEvent"))&&(context.conditionExpression=businessObject.conditionExpression,businessObject.conditionExpression=void 0))})),this.reverted(["connection.reconnectEnd","connection.reconnectStart"],ifBpmn(function(e){var context=e.context,connection=context.connection,businessObject=getBusinessObject(connection),newSource=getBusinessObject(connection.source);context.default&&(is(newSource,"bpmn:ExclusiveGateway")||is(newSource,"bpmn:InclusiveGateway")||is(newSource,"bpmn:Activity"))&&(newSource.default=context.default),context.conditionExpression&&is(newSource,"bpmn:Activity")&&(businessObject.conditionExpression=context.conditionExpression)})),this.executed(["element.updateAttachment"],ifBpmn(updateAttachment)),this.reverted(["element.updateAttachment"],ifBpmn(updateAttachment))}function getDefinitions(element){for(;element&&!is(element,"bpmn:Definitions");)element=element.$parent;return element}function ifBpmn(fn){return function(event){var context=event.context,element=context.shape||context.connection;is(element,"bpmn:BaseElement")&&fn(event)}}var assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),inherits=require("inherits"),Collections=require("diagram-js/lib/util/Collections"),Model=require("diagram-js/lib/model"),getBusinessObject=require("../../util/ModelUtil").getBusinessObject,is=require("../../util/ModelUtil").is,CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor");inherits(BpmnUpdater,CommandInterceptor),module.exports=BpmnUpdater,BpmnUpdater.$inject=["eventBus","bpmnFactory","connectionDocking","translate"],BpmnUpdater.prototype.updateAttachment=function(context){var shape=context.shape,businessObject=shape.businessObject,host=shape.host;businessObject.attachedToRef=host&&host.businessObject},BpmnUpdater.prototype.updateParent=function(element,oldParent){if(!(element instanceof Model.Label)){var parentShape=element.parent,businessObject=element.businessObject,parentBusinessObject=parentShape&&parentShape.businessObject,parentDi=parentBusinessObject&&parentBusinessObject.di;is(element,"bpmn:FlowNode")&&this.updateFlowNodeRefs(businessObject,parentBusinessObject,oldParent&&oldParent.businessObject),is(element,"bpmn:DataOutputAssociation")&&(parentBusinessObject=element.source?element.source.businessObject:null),is(element,"bpmn:DataInputAssociation")&&(parentBusinessObject=element.target?element.target.businessObject:null),this.updateSemanticParent(businessObject,parentBusinessObject),is(element,"bpmn:DataObjectReference")&&businessObject.dataObjectRef&&this.updateSemanticParent(businessObject.dataObjectRef,parentBusinessObject),this.updateDiParent(businessObject.di,parentDi)}},BpmnUpdater.prototype.updateBounds=function(shape){var di=shape.businessObject.di,bounds=shape instanceof Model.Label?this._getLabel(di).bounds:di.bounds;assign(bounds,{x:shape.x,y:shape.y,width:shape.width,height:shape.height})},BpmnUpdater.prototype.updateFlowNodeRefs=function(businessObject,newContainment,oldContainment){if(oldContainment!==newContainment){var oldRefs,newRefs;is(oldContainment,"bpmn:Lane")&&(oldRefs=oldContainment.get("flowNodeRef"),Collections.remove(oldRefs,businessObject)),is(newContainment,"bpmn:Lane")&&(newRefs=newContainment.get("flowNodeRef"),Collections.add(newRefs,businessObject))}},BpmnUpdater.prototype.updateDiConnection=function(di,newSource,newTarget){di.sourceElement&&di.sourceElement.bpmnElement!==newSource&&(di.sourceElement=newSource&&newSource.di),di.targetElement&&di.targetElement.bpmnElement!==newTarget&&(di.targetElement=newTarget&&newTarget.di)},BpmnUpdater.prototype.updateDiParent=function(di,parentDi){if(parentDi&&!is(parentDi,"bpmndi:BPMNPlane")&&(parentDi=parentDi.$parent),di.$parent!==parentDi){var planeElements=(parentDi||di.$parent).get("planeElement");parentDi?(planeElements.push(di),di.$parent=parentDi):(Collections.remove(planeElements,di),di.$parent=null)}},BpmnUpdater.prototype.getLaneSet=function(container){var laneSet,laneSets;return is(container,"bpmn:Lane")?(laneSet=container.childLaneSet,laneSet||(laneSet=this._bpmnFactory.create("bpmn:LaneSet"),container.childLaneSet=laneSet,laneSet.$parent=container),laneSet):(is(container,"bpmn:Participant")&&(container=container.processRef),laneSets=container.get("laneSets"),laneSet=laneSets[0],laneSet||(laneSet=this._bpmnFactory.create("bpmn:LaneSet"),laneSet.$parent=container,laneSets.push(laneSet)),laneSet)},BpmnUpdater.prototype.updateSemanticParent=function(businessObject,newParent,visualParent){var containment,translate=this._translate;if(businessObject.$parent!==newParent){if(is(businessObject,"bpmn:Lane"))newParent&&(newParent=this.getLaneSet(newParent)),containment="lanes";else if(is(businessObject,"bpmn:FlowElement")){if(newParent)if(is(newParent,"bpmn:Participant"))newParent=newParent.processRef;else if(is(newParent,"bpmn:Lane"))do{newParent=newParent.$parent.$parent}while(is(newParent,"bpmn:Lane"));containment="flowElements"}else if(is(businessObject,"bpmn:Artifact")){for(;newParent&&!is(newParent,"bpmn:Process")&&!is(newParent,"bpmn:SubProcess")&&!is(newParent,"bpmn:Collaboration");){if(is(newParent,"bpmn:Participant")){newParent=newParent.processRef;break}newParent=newParent.$parent}containment="artifacts"}else if(is(businessObject,"bpmn:MessageFlow"))containment="messageFlows";else if(is(businessObject,"bpmn:Participant")){containment="participants";var definitions,process=businessObject.processRef;process&&(definitions=getDefinitions(businessObject.$parent||newParent),businessObject.$parent&&(Collections.remove(definitions.get("rootElements"),process),process.$parent=null),newParent&&(Collections.add(definitions.get("rootElements"),process),process.$parent=definitions))}else is(businessObject,"bpmn:DataOutputAssociation")?containment="dataOutputAssociations":is(businessObject,"bpmn:DataInputAssociation")&&(containment="dataInputAssociations");if(!containment)throw new Error(translate("no parent for {element} in {parent}",{element:businessObject.id,parent:newParent.id}));var children;if(businessObject.$parent&&(children=businessObject.$parent.get(containment),Collections.remove(children,businessObject)),newParent?(children=newParent.get(containment),children.push(businessObject),businessObject.$parent=newParent):businessObject.$parent=null,visualParent){var diChildren=visualParent.get(containment);Collections.remove(children,businessObject),newParent&&(diChildren||(diChildren=[],newParent.set(containment,diChildren)),diChildren.push(businessObject))}}},BpmnUpdater.prototype.updateConnectionWaypoints=function(connection){connection.businessObject.di.set("waypoint",this._bpmnFactory.createDiWaypoints(connection.waypoints))},BpmnUpdater.prototype.updateConnection=function(context){var visualParent,connection=context.connection,businessObject=getBusinessObject(connection),newSource=getBusinessObject(connection.source),newTarget=getBusinessObject(connection.target);if(is(businessObject,"bpmn:DataAssociation"))is(businessObject,"bpmn:DataInputAssociation")?(businessObject.get("sourceRef")[0]=newSource,visualParent=context.parent||context.newParent||newTarget,this.updateSemanticParent(businessObject,newTarget,parent.businessObject)):is(businessObject,"bpmn:DataOutputAssociation")&&(visualParent=context.parent||context.newParent||newSource,this.updateSemanticParent(businessObject,newSource,visualParent),businessObject.targetRef=newTarget);else{var inverseSet=is(businessObject,"bpmn:SequenceFlow");businessObject.sourceRef!==newSource&&(inverseSet&&(Collections.remove(businessObject.sourceRef&&businessObject.sourceRef.get("outgoing"),businessObject),newSource&&newSource.get("outgoing")&&newSource.get("outgoing").push(businessObject)),businessObject.sourceRef=newSource),businessObject.targetRef!==newTarget&&(inverseSet&&(Collections.remove(businessObject.targetRef&&businessObject.targetRef.get("incoming"),businessObject),newTarget&&newTarget.get("incoming")&&newTarget.get("incoming").push(businessObject)),businessObject.targetRef=newTarget)}this.updateConnectionWaypoints(connection),this.updateDiConnection(businessObject.di,newSource,newTarget)},BpmnUpdater.prototype._getLabel=function(di){return di.label||(di.label=this._bpmnFactory.createDiLabel()),di.label}},{"../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,"diagram-js/lib/model":317,"diagram-js/lib/util/Collections":326,inherits:354,"lodash/collection/forEach":369,"lodash/object/assign":502}],97:[function(require,module,exports){"use strict";function ElementFactory(bpmnFactory,moddle,translate){BaseElementFactory.call(this),this._bpmnFactory=bpmnFactory,this._moddle=moddle,this._translate=translate}var assign=require("lodash/object/assign"),inherits=require("inherits"),is=require("../../util/ModelUtil").is,isExpanded=require("../../util/DiUtil").isExpanded,BaseElementFactory=require("diagram-js/lib/core/ElementFactory"),LabelUtil=require("../../util/LabelUtil");inherits(ElementFactory,BaseElementFactory),ElementFactory.$inject=["bpmnFactory","moddle","translate"],module.exports=ElementFactory,ElementFactory.prototype.baseCreate=BaseElementFactory.prototype.create,ElementFactory.prototype.create=function(elementType,attrs){return"label"===elementType?this.baseCreate(elementType,assign({type:"label"},LabelUtil.DEFAULT_LABEL_SIZE,attrs)):this.createBpmnElement(elementType,attrs)},ElementFactory.prototype.createBpmnElement=function(elementType,attrs){var size,translate=this._translate;attrs=attrs||{};var businessObject=attrs.businessObject;if(!businessObject){if(!attrs.type)throw new Error(translate("no shape type specified"));businessObject=this._bpmnFactory.create(attrs.type)}businessObject.di||(businessObject.di="root"===elementType?this._bpmnFactory.createDiPlane(businessObject,[],{id:businessObject.id+"_di"}):"connection"===elementType?this._bpmnFactory.createDiEdge(businessObject,[],{id:businessObject.id+"_di"}):this._bpmnFactory.createDiShape(businessObject,{},{id:businessObject.id+"_di"})),attrs.processRef&&(businessObject.processRef=attrs.processRef),attrs.isExpanded&&(businessObject.di.isExpanded=attrs.isExpanded),is(businessObject,"bpmn:ExclusiveGateway")&&(businessObject.di.isMarkerVisible=!0),!1===attrs.isInterrupting&&(businessObject.isInterrupting=!1),attrs.associationDirection&&(businessObject.associationDirection=attrs.associationDirection);var eventDefinitions,newEventDefinition;return attrs.eventDefinitionType&&(eventDefinitions=businessObject.get("eventDefinitions")||[],newEventDefinition=this._moddle.create(attrs.eventDefinitionType),eventDefinitions.push(newEventDefinition),newEventDefinition.$parent=businessObject,businessObject.eventDefinitions=eventDefinitions),attrs.isForCompensation&&(businessObject.isForCompensation=!0),size=this._getDefaultSize(businessObject),attrs=assign({businessObject:businessObject,id:businessObject.id},size,attrs),this.baseCreate(elementType,attrs)},ElementFactory.prototype._getDefaultSize=function(semantic){return is(semantic,"bpmn:SubProcess")?isExpanded(semantic)?{width:350,height:200}:{width:100,height:80}:is(semantic,"bpmn:Task")?{width:100,height:80}:is(semantic,"bpmn:Gateway")?{width:50,height:50}:is(semantic,"bpmn:Event")?{width:36,height:36}:is(semantic,"bpmn:Participant")?isExpanded(semantic)?{width:600,height:250}:{width:400,height:100}:is(semantic,"bpmn:Lane")?{width:400,height:100}:is(semantic,"bpmn:DataObjectReference")?{width:36,height:50}:is(semantic,"bpmn:DataStoreReference")?{width:50,height:50}:is(semantic,"bpmn:TextAnnotation")?{width:100,height:30}:{width:100,height:80}},ElementFactory.prototype.createParticipantShape=function(collapsed){var attrs={type:"bpmn:Participant"};return collapsed||(attrs.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(attrs)}},{"../../util/DiUtil":158,"../../util/LabelUtil":159,"../../util/ModelUtil":160,"diagram-js/lib/core/ElementFactory":186,inherits:354,"lodash/object/assign":502}],98:[function(require,module,exports){"use strict";function Modeling(eventBus,elementFactory,commandStack,bpmnRules){BaseModeling.call(this,eventBus,elementFactory,commandStack),this._bpmnRules=bpmnRules}var inherits=require("inherits"),BaseModeling=require("diagram-js/lib/features/modeling/Modeling"),UpdatePropertiesHandler=require("./cmd/UpdatePropertiesHandler"),UpdateCanvasRootHandler=require("./cmd/UpdateCanvasRootHandler"),AddLaneHandler=require("./cmd/AddLaneHandler"),SplitLaneHandler=require("./cmd/SplitLaneHandler"),ResizeLaneHandler=require("./cmd/ResizeLaneHandler"),UpdateFlowNodeRefsHandler=require("./cmd/UpdateFlowNodeRefsHandler"),IdClaimHandler=require("./cmd/IdClaimHandler");inherits(Modeling,BaseModeling),Modeling.$inject=["eventBus","elementFactory","commandStack","bpmnRules"],module.exports=Modeling,Modeling.prototype.getHandlers=function(){var handlers=BaseModeling.prototype.getHandlers.call(this);return handlers["element.updateProperties"]=UpdatePropertiesHandler,handlers["canvas.updateRoot"]=UpdateCanvasRootHandler,handlers["lane.add"]=AddLaneHandler,handlers["lane.resize"]=ResizeLaneHandler,handlers["lane.split"]=SplitLaneHandler,handlers["lane.updateRefs"]=UpdateFlowNodeRefsHandler,handlers["id.updateClaim"]=IdClaimHandler,handlers},Modeling.prototype.updateLabel=function(element,newLabel){this._commandStack.execute("element.updateLabel",{element:element,newLabel:newLabel})},Modeling.prototype.connect=function(source,target,attrs,hints){var bpmnRules=this._bpmnRules;return attrs||(attrs=bpmnRules.canConnect(source,target)||{type:"bpmn:Association"}),this.createConnection(source,target,attrs,source.parent,hints)},Modeling.prototype.updateProperties=function(element,properties){this._commandStack.execute("element.updateProperties",{element:element,properties:properties})},Modeling.prototype.resizeLane=function(laneShape,newBounds,balanced){this._commandStack.execute("lane.resize",{shape:laneShape,newBounds:newBounds,balanced:balanced})},Modeling.prototype.addLane=function(targetLaneShape,location){var context={shape:targetLaneShape,location:location};return this._commandStack.execute("lane.add",context),context.newLane},Modeling.prototype.splitLane=function(targetLane,count){this._commandStack.execute("lane.split",{shape:targetLane,count:count})},Modeling.prototype.makeCollaboration=function(){var collaborationElement=this._create("root",{type:"bpmn:Collaboration"}),context={newRoot:collaborationElement};return this._commandStack.execute("canvas.updateRoot",context),collaborationElement},Modeling.prototype.updateLaneRefs=function(flowNodeShapes,laneShapes){this._commandStack.execute("lane.updateRefs",{flowNodeShapes:flowNodeShapes,laneShapes:laneShapes})},Modeling.prototype.makeProcess=function(){var processElement=this._create("root",{type:"bpmn:Process"}),context={newRoot:processElement};this._commandStack.execute("canvas.updateRoot",context)},Modeling.prototype.claimId=function(id,moddleElement){this._commandStack.execute("id.updateClaim",{id:id,element:moddleElement,claiming:!0})},Modeling.prototype.unclaimId=function(id,moddleElement){this._commandStack.execute("id.updateClaim",{id:id,element:moddleElement})}},{"./cmd/AddLaneHandler":124,"./cmd/IdClaimHandler":125,"./cmd/ResizeLaneHandler":126,"./cmd/SplitLaneHandler":127,"./cmd/UpdateCanvasRootHandler":128,"./cmd/UpdateFlowNodeRefsHandler":129,"./cmd/UpdatePropertiesHandler":130,"diagram-js/lib/features/modeling/Modeling":240,inherits:354}],99:[function(require,module,exports){"use strict";function AppendBehavior(eventBus,elementFactory,bpmnRules){CommandInterceptor.call(this,eventBus),this.preExecute("shape.append",function(context){var source=context.source,shape=context.shape;context.position||(is(shape,"bpmn:TextAnnotation")?context.position={x:source.x+source.width/2+75,y:source.y-50-shape.height/2}:context.position={x:source.x+source.width+80+shape.width/2,y:source.y+source.height/2})},!0)}var inherits=require("inherits"),is=require("../../../util/ModelUtil").is,CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor");AppendBehavior.$inject=["eventBus","elementFactory","bpmnRules"],inherits(AppendBehavior,CommandInterceptor),module.exports=AppendBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,inherits:354}],100:[function(require,module,exports){"use strict";function CopyPasteBehavior(eventBus,modeling,canvas){CommandInterceptor.call(this,eventBus),this.preExecute("elements.paste",1500,function(context){var topParent=context.topParent;if(topParent.parent||(context.topParent=canvas.getRootElement()),is(topParent,"bpmn:Lane"))do{topParent=context.topParent=topParent.parent}while(is(topParent,"bpmn:Lane")||!is(topParent,"bpmn:Participant"))},!0),this.postExecute("elements.paste",function(context){var tree=context.tree,createdElements=tree.createdElements;forEach(createdElements,function(data){var defaultFlow,element=data.element,businessObject=element.businessObject,descriptor=data.descriptor;(is(businessObject,"bpmn:ExclusiveGateway")||is(businessObject,"bpmn:InclusiveGateway")||is(businessObject,"bpmn:Activity"))&&descriptor.default&&(defaultFlow=createdElements[descriptor.default],defaultFlow=defaultFlow?defaultFlow.element:void 0,delete element.default,modeling.updateProperties(element,{default:defaultFlow}))})},!0)}var inherits=require("inherits"),forEach=require("lodash/collection/forEach"),is=require("../../../util/ModelUtil").is,CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor");CopyPasteBehavior.$inject=["eventBus","modeling","canvas"],inherits(CopyPasteBehavior,CommandInterceptor),module.exports=CopyPasteBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,inherits:354,"lodash/collection/forEach":369}],101:[function(require,module,exports){"use strict";function CreateBoundaryEventBehavior(eventBus,modeling,elementFactory,bpmnFactory){CommandInterceptor.call(this,eventBus),this.preExecute("shape.create",function(context){var businessObject,boundaryEvent,shape=context.shape,host=context.host,attrs={cancelActivity:!0};host&&is(shape,"bpmn:IntermediateThrowEvent")&&(attrs.attachedToRef=host.businessObject,businessObject=bpmnFactory.create("bpmn:BoundaryEvent",attrs),boundaryEvent={type:"bpmn:BoundaryEvent",businessObject:businessObject},context.shape=elementFactory.createShape(boundaryEvent))},!0)}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),is=require("../../../util/ModelUtil").is;CreateBoundaryEventBehavior.$inject=["eventBus","modeling","elementFactory","bpmnFactory"],inherits(CreateBoundaryEventBehavior,CommandInterceptor),module.exports=CreateBoundaryEventBehavior},{"../../../util/ModelUtil":160,
"diagram-js/lib/command/CommandInterceptor":182,inherits:354}],102:[function(require,module,exports){"use strict";function CreateDataObjectBehavior(eventBus,bpmnFactory,moddle){CommandInterceptor.call(this,eventBus),this.preExecute("shape.create",function(event){var context=event.context,shape=context.shape;if(is(shape,"bpmn:DataObjectReference")&&"label"!==shape.type){var dataObject=bpmnFactory.create("bpmn:DataObject");shape.businessObject.dataObjectRef=dataObject}})}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),is=require("../../../util/ModelUtil").is;CreateDataObjectBehavior.$inject=["eventBus","bpmnFactory","moddle"],inherits(CreateDataObjectBehavior,CommandInterceptor),module.exports=CreateDataObjectBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,inherits:354}],103:[function(require,module,exports){"use strict";function copy(obj){return assign({},obj)}function CreateOnFlowBehavior(eventBus,bpmnRules,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("shape.create",function(context){var parent=context.parent,shape=context.shape;bpmnRules.canInsert(shape,parent)&&(context.targetFlow=parent,context.parent=parent.parent)},!0),this.postExecute("shape.create",function(context){var source,target,reconnected,intersection,waypoints,waypointsBefore,waypointsAfter,dockingPoint,shape=context.shape,targetFlow=context.targetFlow,position=context.position;targetFlow&&(waypoints=targetFlow.waypoints,intersection=getApproxIntersection(waypoints,position),intersection&&(waypointsBefore=waypoints.slice(0,intersection.index),waypointsAfter=waypoints.slice(intersection.index+(intersection.bendpoint?1:0)),dockingPoint=intersection.bendpoint?waypoints[intersection.index]:position,waypointsBefore.push(copy(dockingPoint)),waypointsAfter.unshift(copy(dockingPoint))),source=targetFlow.source,target=targetFlow.target,bpmnRules.canConnect(source,shape,targetFlow)&&(modeling.reconnectEnd(targetFlow,shape,waypointsBefore||copy(position)),reconnected=!0),bpmnRules.canConnect(shape,target,targetFlow)&&(reconnected?modeling.connect(shape,target,{type:targetFlow.type,waypoints:waypointsAfter}):modeling.reconnectStart(targetFlow,shape,waypointsAfter||copy(position))))},!0)}var inherits=require("inherits"),assign=require("lodash/object/assign"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),getApproxIntersection=require("diagram-js/lib/util/LineIntersection").getApproxIntersection;inherits(CreateOnFlowBehavior,CommandInterceptor),CreateOnFlowBehavior.$inject=["eventBus","bpmnRules","modeling"],module.exports=CreateOnFlowBehavior},{"diagram-js/lib/command/CommandInterceptor":182,"diagram-js/lib/util/LineIntersection":335,inherits:354,"lodash/object/assign":502}],104:[function(require,module,exports){"use strict";function CreateParticipantBehavior(eventBus,modeling,elementFactory,bpmnFactory,canvas){CommandInterceptor.call(this,eventBus),this.preExecute("shape.create",function(context){var parent=context.parent,shape=context.shape,position=context.position,rootElement=canvas.getRootElement();if(is(parent,"bpmn:Process")&&is(shape,"bpmn:Participant")&&!is(rootElement,"bpmn:Collaboration")){var collaborationElement=modeling.makeCollaboration();context.position=position,context.parent=collaborationElement,context.processRoot=parent}},!0),this.execute("shape.create",function(context){var processRoot=context.processRoot,shape=context.shape;processRoot&&(context.oldProcessRef=shape.businessObject.processRef,shape.businessObject.processRef=processRoot.businessObject)},!0),this.revert("shape.create",function(context){var processRoot=context.processRoot,shape=context.shape;processRoot&&(shape.businessObject.processRef=context.oldProcessRef)},!0),this.postExecute("shape.create",function(context){var processRoot=context.processRoot,shape=context.shape;if(processRoot){var processChildren=processRoot.children.slice();modeling.moveElements(processChildren,{x:0,y:0},shape)}},!0)}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),is=require("../../../util/ModelUtil").is;CreateParticipantBehavior.$inject=["eventBus","modeling","elementFactory","bpmnFactory","canvas"],inherits(CreateParticipantBehavior,CommandInterceptor),module.exports=CreateParticipantBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,inherits:354}],105:[function(require,module,exports){"use strict";function DataInputAssociationBehavior(eventBus,bpmnFactory){function usesTargetRef(element,targetRef,removedConnection){var inputAssociations=element.get("dataInputAssociations");return find(inputAssociations,function(association){return association!==removedConnection&&association.targetRef===targetRef})}function getTargetRef(element,create){var properties=element.get("properties"),targetRefProp=find(properties,function(p){return p.name===TARGET_REF_PLACEHOLDER_NAME});return!targetRefProp&&create&&(targetRefProp=bpmnFactory.create("bpmn:Property",{name:TARGET_REF_PLACEHOLDER_NAME}),Collections.add(properties,targetRefProp)),targetRefProp}function cleanupTargetRef(element,connection){var targetRefProp=getTargetRef(element);targetRefProp&&(usesTargetRef(element,targetRefProp,connection)||Collections.remove(element.get("properties"),targetRefProp))}function fixTargetRef(event){var targetRefProp,context=event.context,connection=context.connection,connectionBo=connection.businessObject,target=connection.target,targetBo=target&&target.businessObject,newTarget=context.newTarget,newTargetBo=newTarget&&newTarget.businessObject,oldTarget=context.oldTarget||context.target,oldTargetBo=oldTarget&&oldTarget.businessObject,dataAssociation=connection.businessObject;oldTargetBo&&oldTargetBo!==targetBo&&cleanupTargetRef(oldTargetBo,connectionBo),newTargetBo&&newTargetBo!==targetBo&&cleanupTargetRef(newTargetBo,connectionBo),targetBo?(targetRefProp=getTargetRef(targetBo,!0),dataAssociation.targetRef=targetRefProp):dataAssociation.targetRef=null}CommandInterceptor.call(this,eventBus),this.executed(["connection.create","connection.delete","connection.move","connection.reconnectEnd"],ifDataInputAssociation(fixTargetRef)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnectEnd"],ifDataInputAssociation(fixTargetRef))}function ifDataInputAssociation(fn){return function(event){var context=event.context,connection=context.connection;if(is(connection,"bpmn:DataInputAssociation"))return fn(event)}}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),Collections=require("diagram-js/lib/util/Collections"),find=require("lodash/collection/find"),is=require("../../../util/ModelUtil").is,TARGET_REF_PLACEHOLDER_NAME="__targetRef_placeholder";DataInputAssociationBehavior.$inject=["eventBus","bpmnFactory"],inherits(DataInputAssociationBehavior,CommandInterceptor),module.exports=DataInputAssociationBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,"diagram-js/lib/util/Collections":326,inherits:354,"lodash/collection/find":368}],106:[function(require,module,exports){"use strict";function DeleteLaneBehavior(eventBus,modeling,spaceTool){function compensateLaneDelete(shape,oldParent){var siblings=getChildLanes(oldParent),topAffected=[],bottomAffected=[];if(eachElement(siblings,function(element){return element.y>shape.y?bottomAffected.push(element):topAffected.push(element),element.children}),siblings.length){var offset;offset=bottomAffected.length&&topAffected.length?shape.height/2:shape.height;var topAdjustments,bottomAdjustments;topAffected.length&&(topAdjustments=spaceTool.calculateAdjustments(topAffected,"y",offset,shape.y-10),spaceTool.makeSpace(topAdjustments.movingShapes,topAdjustments.resizingShapes,{x:0,y:offset},"s")),bottomAffected.length&&(bottomAdjustments=spaceTool.calculateAdjustments(bottomAffected,"y",-offset,shape.y+shape.height+10),spaceTool.makeSpace(bottomAdjustments.movingShapes,bottomAdjustments.resizingShapes,{x:0,y:-offset},"n"))}}CommandInterceptor.call(this,eventBus),this.postExecuted("shape.delete",LOW_PRIORITY,function(event){var context=event.context,hints=context.hints,shape=context.shape,oldParent=context.oldParent;is(shape,"bpmn:Lane")&&(hints&&hints.nested||compensateLaneDelete(shape,oldParent))})}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),is=require("../../../util/ModelUtil").is,getChildLanes=require("../util/LaneUtil").getChildLanes,eachElement=require("diagram-js/lib/util/Elements").eachElement,LOW_PRIORITY=500;DeleteLaneBehavior.$inject=["eventBus","modeling","spaceTool"],inherits(DeleteLaneBehavior,CommandInterceptor),module.exports=DeleteLaneBehavior},{"../../../util/ModelUtil":160,"../util/LaneUtil":132,"diagram-js/lib/command/CommandInterceptor":182,"diagram-js/lib/util/Elements":329,inherits:354}],107:[function(require,module,exports){"use strict";function ImportDockingFix(eventBus){function adjustDocking(startPoint,nextPoint,elementMid){var centerIntersect,elementTop={x:elementMid.x,y:elementMid.y-50},elementLeft={x:elementMid.x-50,y:elementMid.y},verticalIntersect=lineIntersect(startPoint,nextPoint,elementMid,elementTop),horizontalIntersect=lineIntersect(startPoint,nextPoint,elementMid,elementLeft);centerIntersect=verticalIntersect&&horizontalIntersect?getDistance(verticalIntersect,elementMid)>getDistance(horizontalIntersect,elementMid)?horizontalIntersect:verticalIntersect:verticalIntersect||horizontalIntersect,startPoint.original=centerIntersect}function fixDockings(connection){var waypoints=connection.waypoints;adjustDocking(waypoints[0],waypoints[1],getMid(connection.source)),adjustDocking(waypoints[waypoints.length-1],waypoints[waypoints.length-2],getMid(connection.target))}eventBus.on("bpmnElement.added",function(e){var element=e.element;element.waypoints&&fixDockings(element)})}function getDistance(p1,p2){return Math.sqrt(Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2))}var getMid=require("diagram-js/lib/layout/LayoutUtil").getMid,lineIntersect=require("./util/LineIntersect");ImportDockingFix.$inject=["eventBus"],module.exports=ImportDockingFix},{"./util/LineIntersect":123,"diagram-js/lib/layout/LayoutUtil":315}],108:[function(require,module,exports){"use strict";function LabelSupport(eventBus,modeling,bpmnFactory){function getHiddenLabelAdjustment(event){var context=event.context,connection=context.connection,label=connection.label,labelPosition=getExternalLabelMid(connection);return{x:labelPosition.x-label.x-label.width/2,y:labelPosition.y-label.y-label.height/2}}function getVisibleLabelAdjustment(event){var command=event.command,context=event.context,connection=context.connection,label=connection.label,hints=assign({},context.hints),newWaypoints=context.newWaypoints||connection.waypoints,oldWaypoints=context.oldWaypoints;return void 0===hints.startChanged&&(hints.startChanged="connection.reconnectStart"===command),void 0===hints.endChanged&&(hints.endChanged="connection.reconnectEnd"===command),getLabelAdjustment(label,newWaypoints,oldWaypoints,hints)}CommandInterceptor.call(this,eventBus),this.postExecute(["shape.create","connection.create"],function(e){var position,context=e.context,element=context.shape||context.connection,businessObject=element.businessObject;hasExternalLabel(businessObject)&&(position=getExternalLabelMid(element),modeling.createLabel(element,position,{id:businessObject.id+"_label",hidden:!businessObject.name,businessObject:businessObject}))}),this.executed(["label.create"],function(event){var businessObject,di,element=event.context.shape;element.labelTarget&&is(element.labelTarget||element,"bpmn:BaseElement")&&(businessObject=element.businessObject,di=businessObject.di,di.label||(di.label=bpmnFactory.create("bpmndi:BPMNLabel",{bounds:bpmnFactory.create("dc:Bounds")})),assign(di.label.bounds,{x:element.x,y:element.y,width:element.width,height:element.height}))}),this.postExecute(["connection.layout","connection.reconnectEnd","connection.reconnectStart","connection.updateWaypoints"],function(event){var labelAdjustment,label=event.context.connection.label;label&&(labelAdjustment=label.hidden?getHiddenLabelAdjustment(event):getVisibleLabelAdjustment(event),modeling.moveShape(label,labelAdjustment))}),this.postExecute(["shape.replace"],function(event){var context=event.context,newShape=context.newShape,oldShape=context.oldShape,businessObject=getBusinessObject(newShape);businessObject&&hasExternalLabel(businessObject)&&(newShape.label.x=oldShape.label.x,newShape.label.y=oldShape.label.y)})}var assign=require("lodash/object/assign"),inherits=require("inherits"),LabelUtil=require("../../../util/LabelUtil"),LabelLayoutUtil=require("./util/LabelLayoutUtil"),ModelUtil=require("../../../util/ModelUtil"),is=ModelUtil.is,getBusinessObject=ModelUtil.getBusinessObject,hasExternalLabel=LabelUtil.hasExternalLabel,getExternalLabelMid=LabelUtil.getExternalLabelMid,getLabelAdjustment=LabelLayoutUtil.getLabelAdjustment,CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor");inherits(LabelSupport,CommandInterceptor),LabelSupport.$inject=["eventBus","modeling","bpmnFactory"],module.exports=LabelSupport},{"../../../util/LabelUtil":159,"../../../util/ModelUtil":160,"./util/LabelLayoutUtil":121,"diagram-js/lib/command/CommandInterceptor":182,inherits:354,"lodash/object/assign":502}],109:[function(require,module,exports){"use strict";function ModelingFeedback(eventBus,tooltips,translate){function showError(position,message,timeout){tooltips.add({position:{x:position.x+5,y:position.y+5},type:"error",timeout:timeout||2e3,html:"<div>"+message+"</div>"})}eventBus.on(["shape.move.rejected","create.rejected"],function(event){var context=event.context,shape=context.shape,target=context.target;is(target,"bpmn:Collaboration")&&is(shape,"bpmn:FlowNode")&&showError(event,translate(COLLAB_ERR_MSG))}),eventBus.on(["elements.paste.rejected"],function(event){var context=event.context,position=context.position,target=context.target;is(target,"bpmn:Collaboration")&&showError(position,translate(COLLAB_ERR_MSG)),is(target,"bpmn:Process")&&showError(position,translate(PROCESS_ERR_MSG),3e3)})}var is=require("../../../util/ModelUtil").is,COLLAB_ERR_MSG="flow elements must be children of pools/participants",PROCESS_ERR_MSG="participants cannot be pasted onto a non-empty process diagram";ModelingFeedback.$inject=["eventBus","tooltips","translate"],module.exports=ModelingFeedback},{"../../../util/ModelUtil":160}],110:[function(require,module,exports){"use strict";function RemoveElementBehavior(eventBus,bpmnRules,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("shape.delete",function(e){var shape=e.context.shape;if(1==shape.incoming.length&&1==shape.outgoing.length){var inConnection=shape.incoming[0],outConnection=shape.outgoing[0];if(bpmnRules.canConnect(inConnection.source,outConnection.target,inConnection)){var newWaypoints=getNewWaypoints(inConnection.waypoints,outConnection.waypoints);modeling.reconnectEnd(inConnection,outConnection.target,newWaypoints)}}})}function getDocking(point){return point.original||point}function getNewWaypoints(inWaypoints,outWaypoints){var intersection=lineIntersect(getDocking(inWaypoints[inWaypoints.length-2]),getDocking(inWaypoints[inWaypoints.length-1]),getDocking(outWaypoints[1]),getDocking(outWaypoints[0]));return intersection?[].concat(inWaypoints.slice(0,inWaypoints.length-1),[intersection],outWaypoints.slice(1)):[getDocking(inWaypoints[0]),getDocking(outWaypoints[outWaypoints.length-1])]}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),lineIntersect=require("./util/LineIntersect");inherits(RemoveElementBehavior,CommandInterceptor),RemoveElementBehavior.$inject=["eventBus","bpmnRules","modeling"],module.exports=RemoveElementBehavior},{"./util/LineIntersect":123,"diagram-js/lib/command/CommandInterceptor":182,inherits:354}],111:[function(require,module,exports){"use strict";function RemoveParticipantBehavior(eventBus,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("shape.delete",function(context){var shape=context.shape,parent=shape.parent;is(shape,"bpmn:Participant")&&(context.collaborationRoot=parent)},!0),this.postExecute("shape.delete",function(context){var collaborationRoot=context.collaborationRoot;collaborationRoot&&!collaborationRoot.businessObject.participants.length&&modeling.makeProcess()},!0)}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),is=require("../../../util/ModelUtil").is;RemoveParticipantBehavior.$inject=["eventBus","modeling"],inherits(RemoveParticipantBehavior,CommandInterceptor),module.exports=RemoveParticipantBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,inherits:354}],112:[function(require,module,exports){"use strict";function ReplaceConnectionBehavior(eventBus,modeling,bpmnRules){function fixConnection(connection){var source=connection.source,target=connection.target;if(connection.parent){var replacementType,remove;is(connection,"bpmn:SequenceFlow")&&(bpmnRules.canConnectSequenceFlow(source,target)||(remove=!0),bpmnRules.canConnectMessageFlow(source,target)&&(replacementType="bpmn:MessageFlow")),is(connection,"bpmn:MessageFlow")&&(bpmnRules.canConnectMessageFlow(source,target)||(remove=!0),bpmnRules.canConnectSequenceFlow(source,target)&&(replacementType="bpmn:SequenceFlow")),is(connection,"bpmn:Association")&&!bpmnRules.canConnectAssociation(source,target)&&(remove=!0),remove&&modeling.removeConnection(connection),replacementType&&modeling.connect(source,target,{type:replacementType,waypoints:connection.waypoints.slice()})}}CommandInterceptor.call(this,eventBus),this.postExecuted("elements.move",function(context){var closure=context.closure,allConnections=closure.allConnections;forEach(allConnections,fixConnection)},!0),this.postExecuted(["connection.reconnectStart","connection.reconnectEnd"],function(event){fixConnection(event.context.connection)}),this.postExecuted("element.updateProperties",function(event){var connection,context=event.context,properties=context.properties,element=context.element,businessObject=element.businessObject;properties.default&&(connection=find(element.outgoing,{id:element.businessObject.default.id}))&&modeling.updateProperties(connection,{conditionExpression:void 0}),properties.conditionExpression&&businessObject.sourceRef.default===businessObject&&modeling.updateProperties(element.source,{default:void 0})})}var forEach=require("lodash/collection/forEach"),find=require("lodash/collection/find"),inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),is=require("../../../util/ModelUtil").is;inherits(ReplaceConnectionBehavior,CommandInterceptor),ReplaceConnectionBehavior.$inject=["eventBus","modeling","bpmnRules"],module.exports=ReplaceConnectionBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,inherits:354,"lodash/collection/find":368,"lodash/collection/forEach":369}],113:[function(require,module,exports){"use strict";function ReplaceElementBehaviour(eventBus,bpmnReplace,bpmnRules,elementRegistry,selection,modeling){CommandInterceptor.call(this,eventBus),this._bpmnReplace=bpmnReplace,this._elementRegistry=elementRegistry,this._selection=selection,this._modeling=modeling,this.postExecuted(["elements.move"],500,function(event){var context=event.context,target=context.newParent,newHost=context.newHost,elements=[];forEach(context.closure.topLevel,function(topLevelElements){elements=isEventSubProcess(topLevelElements)?elements.concat(topLevelElements.children):elements.concat(topLevelElements)}),1===elements.length&&newHost&&(target=newHost);var canReplace=bpmnRules.canReplace(elements,target);canReplace&&this.replaceElements(elements,canReplace.replacements,newHost)},this),this.postExecute(["shape.replace"],1500,function(e){var canReplace,context=e.context,oldShape=context.oldShape,newShape=context.newShape,attachers=oldShape.attachers;attachers&&attachers.length&&(canReplace=bpmnRules.canReplace(attachers,newShape),this.replaceElements(attachers,canReplace.replacements))},this),this.postExecuted(["shape.replace"],1500,function(e){var context=e.context,oldShape=context.oldShape,newShape=context.newShape;modeling.unclaimId(oldShape.businessObject.id,oldShape.businessObject),modeling.updateProperties(newShape,{id:oldShape.id})})}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),forEach=require("lodash/collection/forEach"),isEventSubProcess=require("../../../util/DiUtil").isEventSubProcess,is=require("../../../util/ModelUtil").is;inherits(ReplaceElementBehaviour,CommandInterceptor),ReplaceElementBehaviour.prototype.replaceElements=function(elements,newElements,newHost){var elementRegistry=this._elementRegistry,bpmnReplace=this._bpmnReplace,selection=this._selection,modeling=this._modeling;forEach(newElements,function(replacement){var newElement={type:replacement.newElementType},oldElement=elementRegistry.get(replacement.oldElementId);newHost&&is(oldElement,"bpmn:BoundaryEvent")&&modeling.updateAttachment(oldElement,null);var idx=elements.indexOf(oldElement);elements[idx]=bpmnReplace.replaceElement(oldElement,newElement,{select:!1}),newHost&&is(elements[idx],"bpmn:BoundaryEvent")&&modeling.updateAttachment(elements[idx],newHost)}),newElements&&selection.select(elements)},ReplaceElementBehaviour.$inject=["eventBus","bpmnReplace","bpmnRules","elementRegistry","selection","modeling"],module.exports=ReplaceElementBehaviour},{"../../../util/DiUtil":158,"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,inherits:354,"lodash/collection/forEach":369}],114:[function(require,module,exports){"use strict";function ResizeLaneBehavior(eventBus,modeling){eventBus.on("resize.start",SLIGHTLY_HIGHER_PRIORITY+500,function(event){var context=event.context,shape=context.shape;(is(shape,"bpmn:Lane")||is(shape,"bpmn:Participant"))&&(context.balanced=!hasPrimaryModifier(event))}),eventBus.on("resize.end",SLIGHTLY_HIGHER_PRIORITY,function(event){var context=event.context,shape=context.shape,canExecute=context.canExecute,newBounds=context.newBounds;if(is(shape,"bpmn:Lane")||is(shape,"bpmn:Participant"))return canExecute&&(newBounds=roundBounds(newBounds),modeling.resizeLane(shape,newBounds,context.balanced)),!1})}var is=require("../../../util/ModelUtil").is,roundBounds=require("diagram-js/lib/layout/LayoutUtil").roundBounds,hasPrimaryModifier=require("diagram-js/lib/util/Mouse").hasPrimaryModifier,SLIGHTLY_HIGHER_PRIORITY=1001;ResizeLaneBehavior.$inject=["eventBus","modeling"],module.exports=ResizeLaneBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/layout/LayoutUtil":315,"diagram-js/lib/util/Mouse":337}],115:[function(require,module,exports){"use strict";function ToggleElementCollapseBehaviour(eventBus,elementFactory,modeling,resize){function hideEmptyLables(children){children.length&&children.forEach(function(child){"label"!==child.type||child.businessObject.name||(child.hidden=!0)})}function expandedBounds(shape,defaultSize){var visibleElements,visibleBBox,children=shape.children,newBounds=defaultSize;return visibleElements=filterVisible(children).concat([shape]),visibleBBox=computeChildrenBBox(visibleElements),visibleBBox?(newBounds.width=Math.max(visibleBBox.width,newBounds.width),newBounds.height=Math.max(visibleBBox.height,newBounds.height),newBounds.x=visibleBBox.x+(visibleBBox.width-newBounds.width)/2,newBounds.y=visibleBBox.y+(visibleBBox.height-newBounds.height)/2):(newBounds.x=shape.x+(shape.width-newBounds.width)/2,newBounds.y=shape.y+(shape.height-newBounds.height)/2),newBounds}function collapsedBounds(shape,defaultSize){return{x:shape.x+(shape.width-defaultSize.width)/2,y:shape.y+(shape.height-defaultSize.height)/2,width:defaultSize.width,height:defaultSize.height}}CommandInterceptor.call(this,eventBus),this.executed(["shape.toggleCollapse"],LOW_PRIORITY,function(e){var context=e.context,shape=context.shape;is(shape,"bpmn:SubProcess")&&(shape.collapsed?getBusinessObject(shape).di.isExpanded=!1:(hideEmptyLables(shape.children),getBusinessObject(shape).di.isExpanded=!0))}),this.reverted(["shape.toggleCollapse"],LOW_PRIORITY,function(e){var context=e.context,shape=context.shape;shape.collapsed?getBusinessObject(shape).di.isExpanded=!1:getBusinessObject(shape).di.isExpanded=!0}),this.postExecuted(["shape.toggleCollapse"],LOW_PRIORITY,function(e){var newBounds,shape=e.context.shape,defaultSize=elementFactory._getDefaultSize(shape);newBounds=shape.collapsed?collapsedBounds(shape,defaultSize):expandedBounds(shape,defaultSize),modeling.resizeShape(shape,newBounds)})}function filterVisible(elements){return elements.filter(function(e){return!e.hidden})}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),getBusinessObject=require("../../../util/ModelUtil").getBusinessObject,is=require("../../../util/ModelUtil").is,computeChildrenBBox=require("diagram-js/lib/features/resize/ResizeUtil").computeChildrenBBox,LOW_PRIORITY=500;inherits(ToggleElementCollapseBehaviour,CommandInterceptor),ToggleElementCollapseBehaviour.$inject=["eventBus","elementFactory","modeling"],module.exports=ToggleElementCollapseBehaviour},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,"diagram-js/lib/features/resize/ResizeUtil":286,inherits:354}],116:[function(require,module,exports){"use strict";function UnclaimIdBehavior(eventBus,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("elements.delete",function(event){var context=event.context,elements=context.elements;forEach(elements,function(element){modeling.unclaimId(element.businessObject.id,element.businessObject)})})}var forEach=require("lodash/collection/forEach"),inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor");inherits(UnclaimIdBehavior,CommandInterceptor),UnclaimIdBehavior.$inject=["eventBus","modeling"],module.exports=UnclaimIdBehavior},{"diagram-js/lib/command/CommandInterceptor":182,inherits:354,"lodash/collection/forEach":369}],117:[function(require,module,exports){"use strict";function DeleteSequenceFlowBehavior(eventBus,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("connection.delete",function(event){var context=event.context,connection=context.connection,source=connection.source;isDefaultFlow(connection,source)&&modeling.updateProperties(source,{default:null})})}function isDefaultFlow(connection,source){if(!is(connection,"bpmn:SequenceFlow"))return!1;var sourceBo=getBusinessObject(source),sequenceFlow=getBusinessObject(connection);return sourceBo.get("default")===sequenceFlow}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),is=require("../../../util/ModelUtil").is,getBusinessObject=require("../../../util/ModelUtil").getBusinessObject;inherits(DeleteSequenceFlowBehavior,CommandInterceptor),DeleteSequenceFlowBehavior.$inject=["eventBus","modeling"],module.exports=DeleteSequenceFlowBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,inherits:354}],118:[function(require,module,exports){"use strict";function UpdateFlowNodeRefsBehavior(eventBus,modeling,translate){function initContext(){return context=context||new UpdateContext,context.enter(),context}function getContext(){if(!context)throw new Error(translate("out of bounds release"));return context}function releaseContext(){if(!context)throw new Error(translate("out of bounds release"));var triggerUpdate=context.leave();return triggerUpdate&&(modeling.updateLaneRefs(context.flowNodes,context.lanes),context=null),triggerUpdate}CommandInterceptor.call(this,eventBus);var context,laneRefUpdateEvents=["spaceTool","lane.add","lane.resize","lane.split","elements.move","elements.delete","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(laneRefUpdateEvents,HIGH_PRIORITY,function(event){initContext()}),this.postExecuted(laneRefUpdateEvents,LOW_PRIORITY,function(event){releaseContext()}),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],function(event){var context=event.context,shape=context.shape,updateContext=getContext();shape.labelTarget||(is(shape,"bpmn:Lane")&&updateContext.addLane(shape),is(shape,"bpmn:FlowNode")&&updateContext.addFlowNode(shape))})}function UpdateContext(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(lane){this.lanes.push(lane)},this.addFlowNode=function(flowNode){this.flowNodes.push(flowNode)},this.enter=function(){this.counter++},this.leave=function(){return!--this.counter}}var inherits=require("inherits"),CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),is=require("../../../util/ModelUtil").is,LOW_PRIORITY=500,HIGH_PRIORITY=5e3;UpdateFlowNodeRefsBehavior.$inject=["eventBus","modeling","translate"],inherits(UpdateFlowNodeRefsBehavior,CommandInterceptor),module.exports=UpdateFlowNodeRefsBehavior},{"../../../util/ModelUtil":160,"diagram-js/lib/command/CommandInterceptor":182,inherits:354}],119:[function(require,module,exports){module.exports={__init__:["appendBehavior","copyPasteBehavior","createBoundaryEventBehavior","createDataObjectBehavior","createOnFlowBehavior","createParticipantBehavior","dataInputAssociationBehavior","deleteLaneBehavior","importDockingFix","labelBehavior","modelingFeedback","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeLaneBehavior","unsetDefaultFlowBehavior","updateFlowNodeRefsBehavior","removeElementBehavior","unclaimIdBehavior","toggleElementCollapseBehaviour"],appendBehavior:["type",require("./AppendBehavior")],copyPasteBehavior:["type",require("./CopyPasteBehavior")],createBoundaryEventBehavior:["type",require("./CreateBoundaryEventBehavior")],createDataObjectBehavior:["type",require("./CreateDataObjectBehavior")],createOnFlowBehavior:["type",require("./CreateOnFlowBehavior")],createParticipantBehavior:["type",require("./CreateParticipantBehavior")],dataInputAssociationBehavior:["type",require("./DataInputAssociationBehavior")],deleteLaneBehavior:["type",require("./DeleteLaneBehavior")],importDockingFix:["type",require("./ImportDockingFix")],labelBehavior:["type",require("./LabelBehavior")],modelingFeedback:["type",require("./ModelingFeedback")],removeParticipantBehavior:["type",require("./RemoveParticipantBehavior")],replaceConnectionBehavior:["type",require("./ReplaceConnectionBehavior")],replaceElementBehaviour:["type",require("./ReplaceElementBehaviour")],resizeLaneBehavior:["type",require("./ResizeLaneBehavior")],unsetDefaultFlowBehavior:["type",require("./UnsetDefaultFlowBehavior")],updateFlowNodeRefsBehavior:["type",require("./UpdateFlowNodeRefsBehavior")],removeElementBehavior:["type",require("./RemoveElementBehavior")],unclaimIdBehavior:["type",require("./UnclaimIdBehavior")],toggleElementCollapseBehaviour:["type",require("./ToggleElementCollapseBehaviour")]}},{"./AppendBehavior":99,"./CopyPasteBehavior":100,"./CreateBoundaryEventBehavior":101,"./CreateDataObjectBehavior":102,"./CreateOnFlowBehavior":103,"./CreateParticipantBehavior":104,"./DataInputAssociationBehavior":105,"./DeleteLaneBehavior":106,"./ImportDockingFix":107,"./LabelBehavior":108,"./ModelingFeedback":109,"./RemoveElementBehavior":110,"./RemoveParticipantBehavior":111,"./ReplaceConnectionBehavior":112,"./ReplaceElementBehaviour":113,"./ResizeLaneBehavior":114,"./ToggleElementCollapseBehaviour":115,"./UnclaimIdBehavior":116,"./UnsetDefaultFlowBehavior":117,"./UpdateFlowNodeRefsBehavior":118}],120:[function(require,module,exports){"use strict";function vectorLength(v){return Math.sqrt(Math.pow(v.x,2)+Math.pow(v.y,2))}function getAngle(line){
return Math.atan((line[1].y-line[0].y)/(line[1].x-line[0].x))}function rotateVector(vector,angle){return angle?{x:Math.cos(angle)*vector.x-Math.sin(angle)*vector.y,y:Math.sin(angle)*vector.x+Math.cos(angle)*vector.y}:vector}function solveLambaSystem(a,b,c){var system=[{n:a[0]-c[0],lambda:b[0]},{n:a[1]-c[1],lambda:b[1]}];return-(system[0].n*b[0]+system[1].n*b[1])/(system[0].lambda*b[0]+system[1].lambda*b[1])}function perpendicularFoot(point,line){var a=line[0],b=line[1],bd={x:b.x-a.x,y:b.y-a.y},r=solveLambaSystem([a.x,a.y],[bd.x,bd.y],[point.x,point.y]);return{x:a.x+r*bd.x,y:a.y+r*bd.y}}function getDistancePointLine(point,line){var pfPoint=perpendicularFoot(point,line);return vectorLength({x:pfPoint.x-point.x,y:pfPoint.y-point.y})}function getDistancePointPoint(point1,point2){return vectorLength({x:point1.x-point2.x,y:point1.y-point2.y})}module.exports.vectorLength=vectorLength,module.exports.getAngle=getAngle,module.exports.rotateVector=rotateVector,module.exports.perpendicularFoot=perpendicularFoot,module.exports.getDistancePointLine=getDistancePointLine,module.exports.getDistancePointPoint=getDistancePointPoint},{}],121:[function(require,module,exports){"use strict";function findNewLabelLineStartIndex(oldWaypoints,newWaypoints,attachment,hints){var index=attachment.segmentIndex,offset=newWaypoints.length-oldWaypoints.length;if(hints.segmentMove){var oldSegmentStartIndex=hints.segmentMove.segmentStartIndex,newSegmentStartIndex=hints.segmentMove.newSegmentStartIndex;return index===oldSegmentStartIndex?newSegmentStartIndex:index>=newSegmentStartIndex?index+offset<newSegmentStartIndex?newSegmentStartIndex:index+offset:index}if(hints.bendpointMove){var newIndex,insert=hints.bendpointMove.insert,bendpointIndex=hints.bendpointMove.bendpointIndex;if(0===offset)return index;if(index>=bendpointIndex&&(newIndex=insert?index+1:index-1),index<bendpointIndex&&(newIndex=index,insert&&"bendpoint"!==attachment.type&&bendpointIndex-1===index)){relativePositionMidWaypoint(newWaypoints,bendpointIndex)<attachment.relativeLocation&&newIndex++}return newIndex}return 0===offset?index:hints.connectionStart?0===index?0:null:hints.connectionEnd&&index===oldWaypoints.length-2?newWaypoints.length-2:null}function getLabelAdjustment(label,newWaypoints,oldWaypoints,hints){var x=0,y=0,labelPosition=getLabelMid(label),attachment=getAttachment(labelPosition,oldWaypoints),oldLabelLineIndex=attachment.segmentIndex,newLabelLineIndex=findNewLabelLineStartIndex(oldWaypoints,newWaypoints,attachment,hints);if(null===newLabelLineIndex)return{x:x,y:y};if(newLabelLineIndex<0||newLabelLineIndex>newWaypoints.length-2)return{x:x,y:y};var oldLabelLine=getLine(oldWaypoints,oldLabelLineIndex),newLabelLine=getLine(newWaypoints,newLabelLineIndex),oldFoot=attachment.position,relativeFootPosition=getRelativeFootPosition(oldLabelLine,oldFoot),angleDelta=getAngleDelta(oldLabelLine,newLabelLine);if("bendpoint"===attachment.type){var offset=newWaypoints.length-oldWaypoints.length,oldBendpointIndex=attachment.bendpointIndex,oldBendpoint=oldWaypoints[oldBendpointIndex];if(-1!==newWaypoints.indexOf(oldBendpoint))return{x:x,y:y};if(0===offset){var newBendpoint=newWaypoints[oldBendpointIndex];return{x:newBendpoint.x-attachment.position.x,y:newBendpoint.y-attachment.position.y}}offset<0&&0!==oldBendpointIndex&&oldBendpointIndex<oldWaypoints.length-1&&(relativeFootPosition=relativePositionMidWaypoint(oldWaypoints,oldBendpointIndex))}var newFoot={x:(newLabelLine[1].x-newLabelLine[0].x)*relativeFootPosition+newLabelLine[0].x,y:(newLabelLine[1].y-newLabelLine[0].y)*relativeFootPosition+newLabelLine[0].y},newLabelVector=GeometricUtil.rotateVector({x:labelPosition.x-oldFoot.x,y:labelPosition.y-oldFoot.y},angleDelta);return x=newFoot.x+newLabelVector.x-labelPosition.x,y=newFoot.y+newLabelVector.y-labelPosition.y,{x:x,y:y}}function relativePositionMidWaypoint(waypoints,idx){var distanceSegment1=getDistancePointPoint(waypoints[idx-1],waypoints[idx]);return distanceSegment1/(distanceSegment1+getDistancePointPoint(waypoints[idx],waypoints[idx+1]))}function getLabelMid(label){return{x:label.x+label.width/2,y:label.y+label.height/2}}function getAngleDelta(l1,l2){var a1=GeometricUtil.getAngle(l1);return GeometricUtil.getAngle(l2)-a1}function getLine(waypoints,idx){return[waypoints[idx],waypoints[idx+1]]}function getRelativeFootPosition(line,foot){var length=getDistancePointPoint(line[0],line[1]);return getDistancePointPoint(line[0],foot)/length}var GeometricUtil=require("./GeometricUtil"),getDistancePointPoint=require("./GeometricUtil").getDistancePointPoint,getAttachment=require("./LineAttachmentUtil").getAttachment;module.exports.findNewLabelLineStartIndex=findNewLabelLineStartIndex,module.exports.getLabelAdjustment=getLabelAdjustment},{"./GeometricUtil":120,"./LineAttachmentUtil":122}],122:[function(require,module,exports){"use strict";function sq(n){return Math.pow(n,2)}function getDistance(p1,p2){return sqrt(sq(p1.x-p2.x)+sq(p1.y-p2.y))}function getAttachment(point,line){var segmentStart,segmentEnd,segmentStartDistance,segmentEndDistance,attachmentPosition,minDistance,intersections,attachment,attachmentDistance,closestAttachmentDistance,closestAttachment,idx=0;for(idx=0;idx<line.length-1;idx++)if(segmentStart=line[idx],segmentEnd=line[idx+1],!pointsEqual(segmentStart,segmentEnd)){if(segmentStartDistance=getDistance(point,segmentStart),segmentEndDistance=getDistance(point,segmentEnd),minDistance=min(segmentStartDistance,segmentEndDistance),intersections=getCircleSegmentIntersections(segmentStart,segmentEnd,point,minDistance),intersections.length<1)throw new Error("expected between [1, 2] circle -> line intersections");1===intersections.length&&(attachment={type:"bendpoint",position:intersections[0],segmentIndex:idx,bendpointIndex:pointsEqual(segmentStart,intersections[0])?idx:idx+1}),2===intersections.length&&(attachmentPosition=mid(intersections[0],intersections[1]),attachment={type:"segment",position:attachmentPosition,segmentIndex:idx,relativeLocation:getDistance(segmentStart,attachmentPosition)/getDistance(segmentStart,segmentEnd)}),attachmentDistance=getDistance(attachment.position,point),(!closestAttachment||closestAttachmentDistance>attachmentDistance)&&(closestAttachment=attachment,closestAttachmentDistance=attachmentDistance)}return closestAttachment}function getCircleSegmentIntersections(s1,s2,cc,cr){s1=roundPoint(s1),s2=roundPoint(s2),cc=roundPoint(cc),cr=min(getDistance(s1,cc),getDistance(s2,cc));var baX=s2.x-s1.x,baY=s2.y-s1.y,caX=cc.x-s1.x,caY=cc.y-s1.y,a=baX*baX+baY*baY,bBy2=baX*caX+baY*caY,c=caX*caX+caY*caY-cr*cr,pBy2=bBy2/a,q=c/a,disc=pBy2*pBy2-q;if(disc<0)return[];var tmpSqrt=sqrt(disc),abScalingFactor1=-pBy2+tmpSqrt,abScalingFactor2=-pBy2-tmpSqrt,i1={x:round(s1.x-baX*abScalingFactor1),y:round(s1.y-baY*abScalingFactor1)};return 0===disc?[i1]:[i1,{x:round(s1.x-baX*abScalingFactor2),y:round(s1.y-baY*abScalingFactor2)}].filter(function(p){return isPointInSegment(p,s1,s2)})}function isPointInSegment(p,segmentStart,segmentEnd){return fenced(p.x,segmentStart.x,segmentEnd.x)&&fenced(p.y,segmentStart.y,segmentEnd.y)}function fenced(n,rangeStart,rangeEnd){return min(rangeStart,rangeEnd)<=n&&n<=max(rangeStart,rangeEnd)}function mid(p1,p2){return{x:(p1.x+p2.x)/2,y:(p1.y+p2.y)/2}}function round(n){return Math.round(1e3*n)/1e3}function roundPoint(p){return{x:round(p.x),y:round(p.y)}}function pointsEqual(p1,p2){return p1.x===p2.x&&p1.y===p2.y}var sqrt=Math.sqrt,min=Math.min,max=Math.max;module.exports.getAttachment=getAttachment},{}],123:[function(require,module,exports){"use strict";module.exports=function(l1s,l1e,l2s,l2e){var denominator,a,b,c,numerator;return 0==(denominator=(l2e.y-l2s.y)*(l1e.x-l1s.x)-(l2e.x-l2s.x)*(l1e.y-l1s.y))?null:(a=l1s.y-l2s.y,b=l1s.x-l2s.x,numerator=(l2e.x-l2s.x)*a-(l2e.y-l2s.y)*b,c=numerator/denominator,{x:Math.round(l1s.x+c*(l1e.x-l1s.x)),y:Math.round(l1s.y+c*(l1e.y-l1s.y))})}},{}],124:[function(require,module,exports){"use strict";function AddLaneHandler(modeling,spaceTool){this._modeling=modeling,this._spaceTool=spaceTool}var filter=require("lodash/collection/filter"),Elements=require("diagram-js/lib/util/Elements"),getLanesRoot=require("../util/LaneUtil").getLanesRoot,getChildLanes=require("../util/LaneUtil").getChildLanes,LANE_INDENTATION=require("../util/LaneUtil").LANE_INDENTATION;AddLaneHandler.$inject=["modeling","spaceTool"],module.exports=AddLaneHandler,AddLaneHandler.prototype.preExecute=function(context){var spaceTool=this._spaceTool,modeling=this._modeling,shape=context.shape,location=context.location,lanesRoot=getLanesRoot(shape),isRoot=lanesRoot===shape,laneParent=isRoot?shape:shape.parent;getChildLanes(laneParent).length||modeling.createShape({type:"bpmn:Lane"},{x:shape.x+LANE_INDENTATION,y:shape.y,width:shape.width-LANE_INDENTATION,height:shape.height},laneParent);var allAffected=[];Elements.eachElement(lanesRoot,function(element){return allAffected.push(element),element===shape?[]:filter(element.children,function(c){return c!==shape})});var offset="top"===location?-120:120,lanePosition="top"===location?shape.y:shape.y+shape.height,spacePos=lanePosition+("top"===location?10:-10),direction="top"===location?"n":"s",adjustments=spaceTool.calculateAdjustments(allAffected,"y",offset,spacePos);spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:0,y:offset},direction),context.newLane=modeling.createShape({type:"bpmn:Lane"},{x:shape.x+(isRoot?LANE_INDENTATION:0),y:lanePosition-("top"===location?120:0),width:shape.width-(isRoot?LANE_INDENTATION:0),height:120},laneParent)}},{"../util/LaneUtil":132,"diagram-js/lib/util/Elements":329,"lodash/collection/filter":367}],125:[function(require,module,exports){"use strict";function IdClaimHandler(moddle){this._moddle=moddle}IdClaimHandler.$inject=["moddle"],module.exports=IdClaimHandler,IdClaimHandler.prototype.execute=function(context){var ids=this._moddle.ids,id=context.id,element=context.element;context.claiming?ids.claim(id,element):ids.unclaim(id)},IdClaimHandler.prototype.revert=function(context){var ids=this._moddle.ids,id=context.id,element=context.element;context.claiming?ids.unclaim(id):ids.claim(id,element)}},{}],126:[function(require,module,exports){"use strict";function ResizeLaneHandler(modeling,spaceTool){this._modeling=modeling,this._spaceTool=spaceTool}var is=require("../../../util/ModelUtil").is,getLanesRoot=require("../util/LaneUtil").getLanesRoot,computeLanesResize=require("../util/LaneUtil").computeLanesResize,eachElement=require("diagram-js/lib/util/Elements").eachElement,asTRBL=require("diagram-js/lib/layout/LayoutUtil").asTRBL,substractTRBL=require("diagram-js/lib/features/resize/ResizeUtil").substractTRBL;ResizeLaneHandler.$inject=["modeling","spaceTool"],module.exports=ResizeLaneHandler,ResizeLaneHandler.prototype.preExecute=function(context){var shape=context.shape,newBounds=context.newBounds;!1!==context.balanced?this.resizeBalanced(shape,newBounds):this.resizeSpace(shape,newBounds)},ResizeLaneHandler.prototype.resizeBalanced=function(shape,newBounds){var modeling=this._modeling,resizeNeeded=computeLanesResize(shape,newBounds);modeling.resizeShape(shape,newBounds),resizeNeeded.forEach(function(r){modeling.resizeShape(r.shape,r.newBounds)})},ResizeLaneHandler.prototype.resizeSpace=function(shape,newBounds){var spaceTool=this._spaceTool,shapeTrbl=asTRBL(shape),newTrbl=asTRBL(newBounds),trblDiff=substractTRBL(newTrbl,shapeTrbl),lanesRoot=getLanesRoot(shape),allAffected=[],allLanes=[];eachElement(lanesRoot,function(element){return allAffected.push(element),(is(element,"bpmn:Lane")||is(element,"bpmn:Participant"))&&allLanes.push(element),element.children});var change,spacePos,direction,offset,adjustments;(trblDiff.bottom||trblDiff.top)&&(change=trblDiff.bottom||trblDiff.top,spacePos=shape.y+(trblDiff.bottom?shape.height:0)+(trblDiff.bottom?-10:10),direction=trblDiff.bottom?"s":"n",offset=trblDiff.top>0||trblDiff.bottom<0?-change:change,adjustments=spaceTool.calculateAdjustments(allAffected,"y",offset,spacePos),spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:0,y:change},direction)),(trblDiff.left||trblDiff.right)&&(change=trblDiff.right||trblDiff.left,spacePos=shape.x+(trblDiff.right?shape.width:0)+(trblDiff.right?-10:100),direction=trblDiff.right?"e":"w",offset=trblDiff.left>0||trblDiff.right<0?-change:change,adjustments=spaceTool.calculateAdjustments(allLanes,"x",offset,spacePos),spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:change,y:0},direction))}},{"../../../util/ModelUtil":160,"../util/LaneUtil":132,"diagram-js/lib/features/resize/ResizeUtil":286,"diagram-js/lib/layout/LayoutUtil":315,"diagram-js/lib/util/Elements":329}],127:[function(require,module,exports){"use strict";function SplitLaneHandler(modeling,translate){this._modeling=modeling,this._translate=translate}var getChildLanes=require("../util/LaneUtil").getChildLanes,LANE_INDENTATION=require("../util/LaneUtil").LANE_INDENTATION;SplitLaneHandler.$inject=["modeling","translate"],module.exports=SplitLaneHandler,SplitLaneHandler.prototype.preExecute=function(context){var modeling=this._modeling,translate=this._translate,shape=context.shape,newLanesCount=context.count,childLanes=getChildLanes(shape),existingLanesCount=childLanes.length;if(existingLanesCount>newLanesCount)throw new Error(translate("more than {count} child lanes",{count:newLanesCount}));var laneY,laneHeight,laneBounds,newLaneAttrs,idx,newLanesHeight=Math.round(shape.height/newLanesCount);for(idx=0;idx<newLanesCount;idx++)laneY=shape.y+idx*newLanesHeight,laneHeight=idx===newLanesCount-1?shape.height-newLanesHeight*idx:newLanesHeight,laneBounds={x:shape.x+LANE_INDENTATION,y:laneY,width:shape.width-LANE_INDENTATION,height:laneHeight},idx<existingLanesCount?modeling.resizeShape(childLanes[idx],laneBounds):(newLaneAttrs={type:"bpmn:Lane"},modeling.createShape(newLaneAttrs,laneBounds,shape))}},{"../util/LaneUtil":132}],128:[function(require,module,exports){"use strict";function UpdateCanvasRootHandler(canvas,modeling){this._canvas=canvas,this._modeling=modeling}var Collections=require("diagram-js/lib/util/Collections");UpdateCanvasRootHandler.$inject=["canvas","modeling"],module.exports=UpdateCanvasRootHandler,UpdateCanvasRootHandler.prototype.execute=function(context){var canvas=this._canvas,newRoot=context.newRoot,newRootBusinessObject=newRoot.businessObject,oldRoot=canvas.getRootElement(),oldRootBusinessObject=oldRoot.businessObject,bpmnDefinitions=oldRootBusinessObject.$parent,diPlane=oldRootBusinessObject.di;canvas.setRootElement(newRoot,!0),Collections.add(bpmnDefinitions.rootElements,newRootBusinessObject),newRootBusinessObject.$parent=bpmnDefinitions,Collections.remove(bpmnDefinitions.rootElements,oldRootBusinessObject),oldRootBusinessObject.$parent=null,oldRootBusinessObject.di=null,diPlane.bpmnElement=newRootBusinessObject,newRootBusinessObject.di=diPlane,context.oldRoot=oldRoot},UpdateCanvasRootHandler.prototype.revert=function(context){var canvas=this._canvas,newRoot=context.newRoot,newRootBusinessObject=newRoot.businessObject,oldRoot=context.oldRoot,oldRootBusinessObject=oldRoot.businessObject,bpmnDefinitions=newRootBusinessObject.$parent,diPlane=newRootBusinessObject.di;canvas.setRootElement(oldRoot,!0),Collections.remove(bpmnDefinitions.rootElements,newRootBusinessObject),newRootBusinessObject.$parent=null,Collections.add(bpmnDefinitions.rootElements,oldRootBusinessObject),oldRootBusinessObject.$parent=bpmnDefinitions,newRootBusinessObject.di=null,diPlane.bpmnElement=oldRootBusinessObject,oldRootBusinessObject.di=diPlane}},{"diagram-js/lib/util/Collections":326}],129:[function(require,module,exports){"use strict";function UpdateFlowNodeRefsHandler(elementRegistry){this._elementRegistry=elementRegistry}var collectLanes=require("../util/LaneUtil").collectLanes,getLanesRoot=require("../util/LaneUtil").getLanesRoot,is=require("../../../util/ModelUtil").is,Collections=require("diagram-js/lib/util/Collections"),asTRBL=require("diagram-js/lib/layout/LayoutUtil").asTRBL;UpdateFlowNodeRefsHandler.$inject=["elementRegistry"],module.exports=UpdateFlowNodeRefsHandler,UpdateFlowNodeRefsHandler.prototype.computeUpdates=function(flowNodeShapes,laneShapes){function isInLaneShape(element,laneShape){var laneTrbl=asTRBL(laneShape),elementMid={x:element.x+element.width/2,y:element.y+element.height/2};return elementMid.x>laneTrbl.left&&elementMid.x<laneTrbl.right&&elementMid.y>laneTrbl.top&&elementMid.y<laneTrbl.bottom}function addFlowNodeShape(flowNodeShape){handledNodes[flowNodeShape.id]||(allFlowNodeShapes.push(flowNodeShape),handledNodes[flowNodeShape.id]=flowNodeShape)}function getAllLaneShapes(flowNodeShape){var root=getLanesRoot(flowNodeShape);return participantCache[root.id]||(participantCache[root.id]=collectLanes(root)),participantCache[root.id]}function getNewLanes(flowNodeShape){return flowNodeShape.parent?getAllLaneShapes(flowNodeShape).filter(function(l){return isInLaneShape(flowNodeShape,l)}).map(function(shape){return shape.businessObject}):[]}var handledNodes={},updates=[],participantCache={},allFlowNodeShapes=[];return laneShapes.forEach(function(laneShape){var root=getLanesRoot(laneShape);if(root&&!handledNodes[root.id]){root.children.filter(function(c){return is(c,"bpmn:FlowNode")}).forEach(addFlowNodeShape),handledNodes[root.id]=root}}),flowNodeShapes.forEach(addFlowNodeShape),allFlowNodeShapes.forEach(function(flowNodeShape){var flowNode=flowNodeShape.businessObject,lanes=flowNode.get("lanes"),remove=lanes.slice(),add=getNewLanes(flowNodeShape);updates.push({flowNode:flowNode,remove:remove,add:add})}),laneShapes.forEach(function(laneShape){var lane=laneShape.businessObject;laneShape.parent||lane.get("flowNodeRef").forEach(function(flowNode){updates.push({flowNode:flowNode,remove:[lane],add:[]})})}),updates},UpdateFlowNodeRefsHandler.prototype.execute=function(context){var updates=context.updates;updates||(updates=context.updates=this.computeUpdates(context.flowNodeShapes,context.laneShapes)),updates.forEach(function(update){var flowNode=update.flowNode,lanes=flowNode.get("lanes");update.remove.forEach(function(oldLane){Collections.remove(lanes,oldLane),Collections.remove(oldLane.get("flowNodeRef"),flowNode)}),update.add.forEach(function(newLane){Collections.add(lanes,newLane),Collections.add(newLane.get("flowNodeRef"),flowNode)})})},UpdateFlowNodeRefsHandler.prototype.revert=function(context){context.updates.forEach(function(update){var flowNode=update.flowNode,lanes=flowNode.get("lanes");update.add.forEach(function(newLane){Collections.remove(lanes,newLane),Collections.remove(newLane.get("flowNodeRef"),flowNode)}),update.remove.forEach(function(oldLane){Collections.add(lanes,oldLane),Collections.add(oldLane.get("flowNodeRef"),flowNode)})})}},{"../../../util/ModelUtil":160,"../util/LaneUtil":132,"diagram-js/lib/layout/LayoutUtil":315,"diagram-js/lib/util/Collections":326}],130:[function(require,module,exports){"use strict";function UpdatePropertiesHandler(elementRegistry,moddle,translate){this._elementRegistry=elementRegistry,this._moddle=moddle,this._translate=translate}function isIdChange(properties,businessObject){return ID in properties&&properties[ID]!==businessObject[ID]}function getProperties(businessObject,propertyNames){return reduce(propertyNames,function(result,key){return result[key]=businessObject.get(key),result},{})}function setProperties(businessObject,properties){forEach(properties,function(value,key){businessObject.set(key,value)})}function unwrapBusinessObjects(properties){var unwrappedProps=assign({},properties);return referencePropertyNames.forEach(function(name){name in properties&&(unwrappedProps[name]=getBusinessObject(unwrappedProps[name]))}),unwrappedProps}var reduce=require("lodash/object/transform"),keys=require("lodash/object/keys"),forEach=require("lodash/collection/forEach"),assign=require("lodash/object/assign"),getBusinessObject=require("../../../util/ModelUtil").getBusinessObject,ID="id";UpdatePropertiesHandler.$inject=["elementRegistry","moddle","translate"],module.exports=UpdatePropertiesHandler,UpdatePropertiesHandler.prototype.execute=function(context){var element=context.element,changed=[element],translate=this._translate;if(!element)throw new Error(translate("element required"));var elementRegistry=this._elementRegistry,ids=this._moddle.ids,businessObject=element.businessObject,properties=unwrapBusinessObjects(context.properties),oldProperties=context.oldProperties||getProperties(businessObject,keys(properties));return isIdChange(properties,businessObject)&&(ids.unclaim(businessObject[ID]),elementRegistry.updateId(element,properties[ID]),ids.claim(properties[ID],businessObject)),"default"in properties&&(properties.default&&changed.push(elementRegistry.get(properties.default.id)),businessObject.default&&changed.push(elementRegistry.get(businessObject.default.id))),"name"in properties&&element.label&&(changed.push(element.label),element.label.hidden=!properties.name),setProperties(businessObject,properties),context.oldProperties=oldProperties,context.changed=changed,changed},UpdatePropertiesHandler.prototype.revert=function(context){var element=context.element,properties=context.properties,oldProperties=context.oldProperties,businessObject=element.businessObject,elementRegistry=this._elementRegistry,ids=this._moddle.ids;return setProperties(businessObject,oldProperties),isIdChange(properties,businessObject)&&(ids.unclaim(properties[ID]),elementRegistry.updateId(element,oldProperties[ID]),ids.claim(oldProperties[ID],businessObject)),context.changed};var referencePropertyNames=["default"]},{"../../../util/ModelUtil":160,"lodash/collection/forEach":369,"lodash/object/assign":502,"lodash/object/keys":506,"lodash/object/transform":512}],131:[function(require,module,exports){module.exports={__init__:["modeling","bpmnUpdater"],__depends__:[require("./behavior"),require("../label-editing"),require("../rules"),require("../ordering"),require("../replace"),require("diagram-js/lib/command"),require("diagram-js/lib/features/tooltips"),require("diagram-js/lib/features/label-support"),require("diagram-js/lib/features/attach-support"),require("diagram-js/lib/features/selection"),require("diagram-js/lib/features/change-support"),require("diagram-js/lib/features/space-tool")],bpmnFactory:["type",require("./BpmnFactory")],bpmnUpdater:["type",require("./BpmnUpdater")],elementFactory:["type",require("./ElementFactory")],modeling:["type",require("./Modeling")],layouter:["type",require("./BpmnLayouter")],connectionDocking:["type",require("diagram-js/lib/layout/CroppingConnectionDocking")]}},{"../label-editing":93,"../ordering":135,"../replace":145,"../rules":147,"./BpmnFactory":94,"./BpmnLayouter":95,"./BpmnUpdater":96,"./ElementFactory":97,"./Modeling":98,"./behavior":119,"diagram-js/lib/command":184,"diagram-js/lib/features/attach-support":198,"diagram-js/lib/features/change-support":210,"diagram-js/lib/features/label-support":237,"diagram-js/lib/features/selection":296,"diagram-js/lib/features/space-tool":303,"diagram-js/lib/features/tooltips":307,"diagram-js/lib/layout/CroppingConnectionDocking":314}],132:[function(require,module,exports){"use strict";function getTRBLResize(oldBounds,newBounds){return substractTRBL(asTRBL(newBounds),asTRBL(oldBounds))}function collectLanes(shape,collectedShapes){return collectedShapes=collectedShapes||[],shape.children.filter(function(s){is(s,"bpmn:Lane")&&(collectLanes(s,collectedShapes),collectedShapes.push(s))}),collectedShapes}function getChildLanes(shape){return shape.children.filter(function(c){return is(c,"bpmn:Lane")})}function getLanesRoot(shape){return getParent(shape,LANE_PARENTS)||shape}function computeLanesResize(shape,newBounds){var rootElement=getLanesRoot(shape),initialShapes=is(rootElement,"bpmn:Process")?[]:[rootElement],allLanes=collectLanes(rootElement,initialShapes),shapeTrbl=asTRBL(shape),shapeNewTrbl=asTRBL(newBounds),trblResize=getTRBLResize(shape,newBounds),resizeNeeded=[];return allLanes.forEach(function(other){if(other!==shape){var topResize=0,rightResize=trblResize.right,bottomResize=0,leftResize=trblResize.left,otherTrbl=asTRBL(other);trblResize.top&&(abs(otherTrbl.bottom-shapeTrbl.top)<10&&(bottomResize=shapeNewTrbl.top-otherTrbl.bottom),abs(otherTrbl.top-shapeTrbl.top)<5&&(topResize=shapeNewTrbl.top-otherTrbl.top)),trblResize.bottom&&(abs(otherTrbl.top-shapeTrbl.bottom)<10&&(topResize=shapeNewTrbl.bottom-otherTrbl.top),abs(otherTrbl.bottom-shapeTrbl.bottom)<5&&(bottomResize=shapeNewTrbl.bottom-otherTrbl.bottom)),(topResize||rightResize||bottomResize||leftResize)&&resizeNeeded.push({shape:other,newBounds:resizeTRBL(other,{top:topResize,right:rightResize,bottom:bottomResize,left:leftResize})})}}),resizeNeeded}var is=require("../../../util/ModelUtil").is,getParent=require("./ModelingUtil").getParent,asTRBL=require("diagram-js/lib/layout/LayoutUtil").asTRBL,substractTRBL=require("diagram-js/lib/features/resize/ResizeUtil").substractTRBL,resizeTRBL=require("diagram-js/lib/features/resize/ResizeUtil").resizeTRBL,abs=Math.abs,LANE_PARENTS=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"];module.exports.LANE_INDENTATION=30,module.exports.collectLanes=collectLanes,module.exports.getChildLanes=getChildLanes,module.exports.getLanesRoot=getLanesRoot,module.exports.computeLanesResize=computeLanesResize},{"../../../util/ModelUtil":160,"./ModelingUtil":133,"diagram-js/lib/features/resize/ResizeUtil":286,"diagram-js/lib/layout/LayoutUtil":315}],133:[function(require,module,exports){"use strict";function getParents(element){for(var parents=[];element;)(element=element.parent)&&parents.push(element);return parents}function isAny(element,types){return any(types,function(t){return is(element,t)})}function getParent(element,anyType){for("string"==typeof anyType&&(anyType=[anyType]);element=element.parent;)if(isAny(element,anyType))return element;return null}var any=require("lodash/collection/any"),is=require("../../../util/ModelUtil").is;module.exports.getParents=getParents,module.exports.isAny=isAny,module.exports.getParent=getParent},{"../../../util/ModelUtil":160,"lodash/collection/any":365}],134:[function(require,module,exports){"use strict";function BpmnOrderingProvider(eventBus,translate){function computeOrder(element){if(element.labelTarget)return{level:10};var entry=find(orders,function(o){return isAny(element,[o.type])});return entry&&entry.order||{level:1}}function getOrder(element){var order=element.order;return order||(element.order=order=computeOrder(element)),order}function findActualParent(element,newParent,containers){for(var actualParent=newParent;actualParent&&!isAny(actualParent,containers);)actualParent=actualParent.parent;if(!actualParent)throw new Error(translate("no parent for {element} in {parent}",{element:element.id,parent:newParent.id}));return actualParent}OrderingProvider.call(this,eventBus);var orders=[{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:5,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataInputAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:Process"]}},{type:"bpmn:DataOutputAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:Process"]}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];this.getOrdering=function(element,newParent){var elementOrder=getOrder(element);elementOrder.containers&&(newParent=findActualParent(element,newParent,elementOrder.containers));var currentIndex=newParent.children.indexOf(element),insertIndex=findIndex(newParent.children,function(child){return!(!element.labelTarget&&child.labelTarget)&&elementOrder.level<getOrder(child).level});return-1!==insertIndex&&-1!==currentIndex&&currentIndex<insertIndex&&(insertIndex-=1),{index:insertIndex,parent:newParent}}}var inherits=require("inherits"),OrderingProvider=require("diagram-js/lib/features/ordering/OrderingProvider"),isAny=require("../modeling/util/ModelingUtil").isAny,findIndex=require("lodash/array/findIndex"),find=require("lodash/collection/find");BpmnOrderingProvider.$inject=["eventBus","translate"],inherits(BpmnOrderingProvider,OrderingProvider),module.exports=BpmnOrderingProvider},{"../modeling/util/ModelingUtil":133,"diagram-js/lib/features/ordering/OrderingProvider":270,inherits:354,"lodash/array/findIndex":355,"lodash/collection/find":368}],135:[function(require,module,exports){module.exports={__init__:["bpmnOrderingProvider"],__depends__:[require("diagram-js/lib/i18n/translate")],bpmnOrderingProvider:["type",require("./BpmnOrderingProvider")]}},{"./BpmnOrderingProvider":134,"diagram-js/lib/i18n/translate":311}],136:[function(require,module,exports){"use strict";function PaletteProvider(palette,create,elementFactory,spaceTool,lassoTool,handTool,globalConnect,translate){this._palette=palette,this._create=create,this._elementFactory=elementFactory,this._spaceTool=spaceTool,this._lassoTool=lassoTool,this._handTool=handTool,this._globalConnect=globalConnect,this._translate=translate,palette.registerProvider(this)}var assign=require("lodash/object/assign");module.exports=PaletteProvider,PaletteProvider.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],PaletteProvider.prototype.getPaletteEntries=function(element){function createAction(type,group,className,title,options){function createListener(event){var shape=elementFactory.createShape(assign({type:type},options));options&&(shape.businessObject.di.isExpanded=options.isExpanded),create.start(event,shape)}var shortType=type.replace(/^bpmn\:/,"");return{group:group,className:className,title:title||translate("Create {type}",{type:shortType}),action:{dragstart:createListener,click:createListener}}}function createParticipant(event,collapsed){create.start(event,elementFactory.createParticipantShape(collapsed))}var actions={},create=this._create,elementFactory=this._elementFactory,spaceTool=this._spaceTool,lassoTool=this._lassoTool,handTool=this._handTool,globalConnect=this._globalConnect,translate=this._translate;return assign(actions,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:translate("Activate the hand tool"),action:{click:function(event){handTool.activateHand(event)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:translate("Activate the lasso tool"),action:{click:function(event){lassoTool.activateSelection(event)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:translate("Activate the create/remove space tool"),action:{click:function(event){spaceTool.activateSelection(event)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:translate("Activate the global connect tool"),action:{click:function(event){globalConnect.toggle(event)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":createAction("bpmn:StartEvent","event","bpmn-icon-start-event-none"),"create.intermediate-event":createAction("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",translate("Create IntermediateThrowEvent/BoundaryEvent")),"create.end-event":createAction("bpmn:EndEvent","event","bpmn-icon-end-event-none"),"create.exclusive-gateway":createAction("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-xor"),"create.task":createAction("bpmn:Task","activity","bpmn-icon-task"),"create.data-object":createAction("bpmn:DataObjectReference","data-object","bpmn-icon-data-object"),"create.data-store":createAction("bpmn:DataStoreReference","data-store","bpmn-icon-data-store"),"create.subprocess-expanded":createAction("bpmn:SubProcess","activity","bpmn-icon-subprocess-expanded",translate("Create expanded SubProcess"),{isExpanded:!0}),"create.participant-expanded":{group:"collaboration",
className:"bpmn-icon-participant",title:translate("Create Pool/Participant"),action:{dragstart:createParticipant,click:createParticipant}}}),actions}},{"lodash/object/assign":502}],137:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/palette"),require("diagram-js/lib/features/create"),require("diagram-js/lib/features/space-tool"),require("diagram-js/lib/features/lasso-tool"),require("diagram-js/lib/features/hand-tool"),require("diagram-js/lib/i18n/translate"),require("../global-connect")],__init__:["paletteProvider"],paletteProvider:["type",require("./PaletteProvider")]}},{"../global-connect":87,"./PaletteProvider":136,"diagram-js/lib/features/create":220,"diagram-js/lib/features/hand-tool":231,"diagram-js/lib/features/lasso-tool":239,"diagram-js/lib/features/palette":276,"diagram-js/lib/features/space-tool":303,"diagram-js/lib/i18n/translate":311}],138:[function(require,module,exports){"use strict";function ReplaceMenuProvider(popupMenu,modeling,moddle,bpmnReplace,rules,translate){this._popupMenu=popupMenu,this._modeling=modeling,this._moddle=moddle,this._bpmnReplace=bpmnReplace,this._rules=rules,this._translate=translate,this.register()}var is=require("../../util/ModelUtil").is,isEventSubProcess=require("../../util/DiUtil").isEventSubProcess,getBusinessObject=require("../../util/ModelUtil").getBusinessObject,isExpanded=require("../../util/DiUtil").isExpanded,isDifferentType=require("./util/TypeUtil").isDifferentType,forEach=require("lodash/collection/forEach"),filter=require("lodash/collection/filter"),reject=require("lodash/collection/reject"),replaceOptions=require("../replace/ReplaceOptions");ReplaceMenuProvider.$inject=["popupMenu","modeling","moddle","bpmnReplace","rules","translate"],ReplaceMenuProvider.prototype.register=function(){this._popupMenu.registerProvider("bpmn-replace",this)},ReplaceMenuProvider.prototype.getEntries=function(element){var entries,businessObject=element.businessObject,rules=this._rules;if(!rules.allowed("shape.replace",{element:element}))return[];var differentType=isDifferentType(element);return is(businessObject,"bpmn:StartEvent")&&!isEventSubProcess(businessObject.$parent)?(entries=filter(replaceOptions.START_EVENT,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:Participant")?(entries=filter(replaceOptions.PARTICIPANT,function(entry){return isExpanded(businessObject)!==entry.target.isExpanded}),this._createEntries(element,entries)):is(businessObject,"bpmn:StartEvent")&&isEventSubProcess(businessObject.$parent)?(entries=filter(replaceOptions.EVENT_SUB_PROCESS_START_EVENT,function(entry){var target=entry.target,isInterrupting=!1!==target.isInterrupting,isInterruptingEqual=getBusinessObject(element).isInterrupting===isInterrupting;return differentType(entry)||!differentType(entry)&&!isInterruptingEqual}),this._createEntries(element,entries)):is(businessObject,"bpmn:EndEvent")?(entries=filter(replaceOptions.END_EVENT,function(entry){return!("bpmn:CancelEventDefinition"==entry.target.eventDefinitionType&&!is(businessObject.$parent,"bpmn:Transaction"))&&differentType(entry)}),this._createEntries(element,entries)):is(businessObject,"bpmn:BoundaryEvent")?(entries=filter(replaceOptions.BOUNDARY_EVENT,function(entry){var target=entry.target;if("bpmn:CancelEventDefinition"==target.eventDefinition&&!is(businessObject.attachedToRef,"bpmn:Transaction"))return!1;var cancelActivity=!1!==target.cancelActivity,isCancelActivityEqual=businessObject.cancelActivity==cancelActivity;return differentType(entry)||!differentType(entry)&&!isCancelActivityEqual}),this._createEntries(element,entries)):is(businessObject,"bpmn:IntermediateCatchEvent")||is(businessObject,"bpmn:IntermediateThrowEvent")?(entries=filter(replaceOptions.INTERMEDIATE_EVENT,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:Gateway")?(entries=filter(replaceOptions.GATEWAY,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:Transaction")?(entries=filter(replaceOptions.TRANSACTION,differentType),this._createEntries(element,entries)):isEventSubProcess(businessObject)&&isExpanded(businessObject)?(entries=filter(replaceOptions.EVENT_SUB_PROCESS,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:SubProcess")&&isExpanded(businessObject)?(entries=filter(replaceOptions.SUBPROCESS_EXPANDED,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:AdHocSubProcess")&&!isExpanded(businessObject)?(entries=filter(replaceOptions.TASK,function(entry){var target=entry.target,isTargetSubProcess="bpmn:SubProcess"===target.type,isTargetExpanded=!0===target.isExpanded;return isDifferentType(element,target)&&(!isTargetSubProcess||isTargetExpanded)}),this._createEntries(element,entries)):is(businessObject,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(element,replaceOptions.SEQUENCE_FLOW):is(businessObject,"bpmn:FlowNode")?(entries=filter(replaceOptions.TASK,differentType),is(businessObject,"bpmn:SubProcess")&&!isExpanded(businessObject)&&(entries=reject(entries,function(entry){return"Sub Process (collapsed)"===entry.label})),this._createEntries(element,entries)):[]},ReplaceMenuProvider.prototype.getHeaderEntries=function(element){var headerEntries=[];return is(element,"bpmn:Activity")&&!isEventSubProcess(element)&&(headerEntries=headerEntries.concat(this._getLoopEntries(element))),!is(element,"bpmn:SubProcess")||is(element,"bpmn:Transaction")||isEventSubProcess(element)||headerEntries.push(this._getAdHocEntry(element)),headerEntries},ReplaceMenuProvider.prototype._createEntries=function(element,replaceOptions){var menuEntries=[],self=this;return forEach(replaceOptions,function(definition){var entry=self._createMenuEntry(definition,element);menuEntries.push(entry)}),menuEntries},ReplaceMenuProvider.prototype._createSequenceFlowEntries=function(element,replaceOptions){var businessObject=getBusinessObject(element),menuEntries=[],modeling=this._modeling,moddle=this._moddle,self=this;return forEach(replaceOptions,function(entry){switch(entry.actionName){case"replace-with-default-flow":businessObject.sourceRef.default!==businessObject&&(is(businessObject.sourceRef,"bpmn:ExclusiveGateway")||is(businessObject.sourceRef,"bpmn:InclusiveGateway")||is(businessObject.sourceRef,"bpmn:ComplexGateway")||is(businessObject.sourceRef,"bpmn:Activity"))&&menuEntries.push(self._createMenuEntry(entry,element,function(){modeling.updateProperties(element.source,{default:businessObject})}));break;case"replace-with-conditional-flow":!businessObject.conditionExpression&&is(businessObject.sourceRef,"bpmn:Activity")&&menuEntries.push(self._createMenuEntry(entry,element,function(){var conditionExpression=moddle.create("bpmn:FormalExpression",{body:""});modeling.updateProperties(element,{conditionExpression:conditionExpression})}));break;default:if(is(businessObject.sourceRef,"bpmn:Activity")&&businessObject.conditionExpression)return menuEntries.push(self._createMenuEntry(entry,element,function(){modeling.updateProperties(element,{conditionExpression:void 0})}));if((is(businessObject.sourceRef,"bpmn:ExclusiveGateway")||is(businessObject.sourceRef,"bpmn:InclusiveGateway")||is(businessObject.sourceRef,"bpmn:ComplexGateway")||is(businessObject.sourceRef,"bpmn:Activity"))&&businessObject.sourceRef.default===businessObject)return menuEntries.push(self._createMenuEntry(entry,element,function(){modeling.updateProperties(element.source,{default:void 0})}))}}),menuEntries},ReplaceMenuProvider.prototype._createMenuEntry=function(definition,element,action){var translate=this._translate,replaceElement=this._bpmnReplace.replaceElement,replaceAction=function(){return replaceElement(element,definition.target)};return action=action||replaceAction,{label:translate(definition.label),className:definition.className,id:definition.actionName,action:action}},ReplaceMenuProvider.prototype._getLoopEntries=function(element){function toggleLoopEntry(event,entry){var loopCharacteristics;entry.active?loopCharacteristics=void 0:(loopCharacteristics=self._moddle.create(entry.options.loopCharacteristics),entry.options.isSequential&&(loopCharacteristics.isSequential=entry.options.isSequential)),self._modeling.updateProperties(element,{loopCharacteristics:loopCharacteristics})}var isSequential,isLoop,isParallel,self=this,translate=this._translate,businessObject=getBusinessObject(element),loopCharacteristics=businessObject.loopCharacteristics;return loopCharacteristics&&(isSequential=loopCharacteristics.isSequential,isLoop=void 0===loopCharacteristics.isSequential,isParallel=void 0!==loopCharacteristics.isSequential&&!loopCharacteristics.isSequential),[{id:"toggle-parallel-mi",className:"bpmn-icon-parallel-mi-marker",title:translate("Parallel Multi Instance"),active:isParallel,action:toggleLoopEntry,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},{id:"toggle-sequential-mi",className:"bpmn-icon-sequential-mi-marker",title:translate("Sequential Multi Instance"),active:isSequential,action:toggleLoopEntry,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},{id:"toggle-loop",className:"bpmn-icon-loop-marker",title:translate("Loop"),active:isLoop,action:toggleLoopEntry,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}]},ReplaceMenuProvider.prototype._getAdHocEntry=function(element){var translate=this._translate,businessObject=getBusinessObject(element),isAdHoc=is(businessObject,"bpmn:AdHocSubProcess"),replaceElement=this._bpmnReplace.replaceElement;return{id:"toggle-adhoc",className:"bpmn-icon-ad-hoc-marker",title:translate("Ad-hoc"),active:isAdHoc,action:function(event,entry){return isAdHoc?replaceElement(element,{type:"bpmn:SubProcess"}):replaceElement(element,{type:"bpmn:AdHocSubProcess"})}}},module.exports=ReplaceMenuProvider},{"../../util/DiUtil":158,"../../util/ModelUtil":160,"../replace/ReplaceOptions":144,"./util/TypeUtil":140,"lodash/collection/filter":367,"lodash/collection/forEach":369,"lodash/collection/reject":375}],139:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/popup-menu"),require("../replace")],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",require("./ReplaceMenuProvider")]}},{"../replace":145,"./ReplaceMenuProvider":138,"diagram-js/lib/features/popup-menu":278}],140:[function(require,module,exports){"use strict";function isDifferentType(element){return function(entry){var target=entry.target,businessObject=getBusinessObject(element),eventDefinition=businessObject.eventDefinitions&&businessObject.eventDefinitions[0],isTypeEqual=businessObject.$type===target.type,isEventDefinitionEqual=(eventDefinition&&eventDefinition.$type)===target.eventDefinitionType,isTriggeredByEventEqual=businessObject.triggeredByEvent===target.triggeredByEvent,isExpandedEqual=void 0===target.isExpanded||target.isExpanded===isExpanded(businessObject);return!(isTypeEqual&&isEventDefinitionEqual&&isTriggeredByEventEqual&&isExpandedEqual)}}var getBusinessObject=require("../../../util/ModelUtil").getBusinessObject,isExpanded=require("../../../util/DiUtil").isExpanded;module.exports.isDifferentType=isDifferentType},{"../../../util/DiUtil":158,"../../../util/ModelUtil":160}],141:[function(require,module,exports){"use strict";function BpmnReplacePreview(eventBus,elementRegistry,elementFactory,canvas,previewSupport){function replaceVisual(context){var replacements=context.canExecute.replacements;forEach(replacements,function(replacement){var id=replacement.oldElementId,newElement={type:replacement.newElementType};if(!context.visualReplacements[id]){var element=elementRegistry.get(id);assign(newElement,{x:element.x,y:element.y});var tempShape=elementFactory.createShape(newElement);canvas.addShape(tempShape,element.parent);var gfx=domQuery("[data-element-id="+element.id+"]",context.dragGroup);gfx&&svgAttr(gfx,{display:"none"});var dragger=previewSupport.addDragger(tempShape,context.dragGroup);context.visualReplacements[id]=dragger,canvas.removeShape(tempShape)}})}function restoreVisual(context){var visualReplacements=context.visualReplacements;forEach(visualReplacements,function(dragger,id){var originalGfx=domQuery("[data-element-id="+id+"]",context.dragGroup);originalGfx&&svgAttr(originalGfx,{display:"inline"}),dragger.remove(),visualReplacements[id]&&delete visualReplacements[id]})}CommandInterceptor.call(this,eventBus),eventBus.on("shape.move.move",LOW_PRIORITY,function(event){var context=event.context,canExecute=context.canExecute;context.visualReplacements||(context.visualReplacements={}),canExecute.replacements?replaceVisual(context):restoreVisual(context)})}var CommandInterceptor=require("diagram-js/lib/command/CommandInterceptor"),inherits=require("inherits"),assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),domQuery=require("min-dom/lib/query"),svgAttr=require("tiny-svg/lib/attr"),LOW_PRIORITY=250;BpmnReplacePreview.$inject=["eventBus","elementRegistry","elementFactory","canvas","previewSupport"],inherits(BpmnReplacePreview,CommandInterceptor),module.exports=BpmnReplacePreview},{"diagram-js/lib/command/CommandInterceptor":182,inherits:354,"lodash/collection/forEach":369,"lodash/object/assign":502,"min-dom/lib/query":525,"tiny-svg/lib/attr":548}],142:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/preview-support")],__init__:["bpmnReplacePreview"],bpmnReplacePreview:["type",require("./BpmnReplacePreview")]}},{"./BpmnReplacePreview":141,"diagram-js/lib/features/preview-support":280}],143:[function(require,module,exports){"use strict";function toggeling(element,target){var targetCollapsed,oldCollapsed=has(element,"collapsed")?element.collapsed:!isExpanded(element);return targetCollapsed=has(target,"collapsed")||has(target,"isExpanded")?has(target,"collapsed")?target.collapsed:!target.isExpanded:oldCollapsed,oldCollapsed!==targetCollapsed&&(element.collapsed=oldCollapsed,!0)}function BpmnReplace(bpmnFactory,replace,selection,modeling){function replaceElement(element,target,hints){hints=hints||{};var type=target.type,oldBusinessObject=element.businessObject;if(is(oldBusinessObject,"bpmn:SubProcess")&&"bpmn:SubProcess"===type&&toggeling(element,target))return modeling.toggleCollapse(element),element;var newBusinessObject=bpmnFactory.create(type),newElement={type:type,businessObject:newBusinessObject};return target.eventDefinitionType&&(newElement.eventDefinitionType=target.eventDefinitionType),assign(newBusinessObject,pick(target,CUSTOM_PROPERTIES)),is(oldBusinessObject,"bpmn:Activity")&&(is(oldBusinessObject,"bpmn:SubProcess")?newElement.isExpanded=isExpanded(oldBusinessObject):has(target,"isExpanded")&&(newElement.isExpanded=target.isExpanded),isExpanded(oldBusinessObject)&&!is(oldBusinessObject,"bpmn:Task")&&target.isExpanded&&(newElement.width=element.width,newElement.height=element.height)),is(oldBusinessObject,"bpmn:Participant")&&(!0===target.isExpanded?newBusinessObject.processRef=bpmnFactory.create("bpmn:Process"):hints.moveChildren=!1,newElement.width=element.width,newElement.height=element.height),newBusinessObject.name=oldBusinessObject.name,isEventSubProcess(newBusinessObject)||(newBusinessObject.loopCharacteristics=oldBusinessObject.loopCharacteristics),(is(oldBusinessObject,"bpmn:ExclusiveGateway")||is(oldBusinessObject,"bpmn:InclusiveGateway")||is(oldBusinessObject,"bpmn:Activity"))&&(is(newBusinessObject,"bpmn:ExclusiveGateway")||is(newBusinessObject,"bpmn:InclusiveGateway")||is(newBusinessObject,"bpmn:Activity"))&&(newBusinessObject.default=oldBusinessObject.default),oldBusinessObject.isForCompensation&&(newBusinessObject.isForCompensation=!0),newElement=replace.replaceElement(element,newElement,hints),!1!==hints.select&&selection.select(newElement),newElement}this.replaceElement=replaceElement}var pick=require("lodash/object/pick"),assign=require("lodash/object/assign"),has=require("lodash/object/has"),is=require("../../util/ModelUtil").is,isExpanded=require("../../util/DiUtil").isExpanded,isEventSubProcess=require("../../util/DiUtil").isEventSubProcess,CUSTOM_PROPERTIES=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];BpmnReplace.$inject=["bpmnFactory","replace","selection","modeling"],module.exports=BpmnReplace},{"../../util/DiUtil":158,"../../util/ModelUtil":160,"lodash/object/assign":502,"lodash/object/has":505,"lodash/object/pick":511}],144:[function(require,module,exports){"use strict";module.exports.START_EVENT=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],module.exports.INTERMEDIATE_EVENT=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Intermediate Catch Event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message Intermediate Throw Event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Intermediate Catch Event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Intermediate Throw Event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Intermediate Catch Event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link Intermediate Catch Event",actionName:"replace-with-link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition"}},{label:"Link Intermediate Throw Event",actionName:"replace-with-link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition"}},{label:"Compensation Intermediate Throw Event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal Intermediate Catch Event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal Intermediate Throw Event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],module.exports.END_EVENT=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message End Event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation End Event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error End Event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel End Event",actionName:"replace-with-cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation End Event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal End Event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate End Event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}],module.exports.GATEWAY=[{label:"Exclusive Gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel Gateway",actionName:"replace-with-parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive Gateway",actionName:"replace-with-inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"}},{label:"Complex Gateway",actionName:"replace-with-complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"}},{label:"Event based Gateway",actionName:"replace-with-event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}],module.exports.SUBPROCESS_EXPANDED=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Sub Process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}}],module.exports.TRANSACTION=[{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],module.exports.EVENT_SUB_PROCESS=[{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}}],module.exports.TASK=[{label:"Task",actionName:"replace-with-task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"Send Task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}},{label:"Receive Task",actionName:"replace-with-receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"}},{label:"User Task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Manual Task",actionName:"replace-with-manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"}},{label:"Business Rule Task",actionName:"replace-with-rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Service Task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Script Task",actionName:"replace-with-script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call Activity",actionName:"replace-with-call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}},{label:"Sub Process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub Process (expanded)",actionName:"replace-with-expanded-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}],module.exports.BOUNDARY_EVENT=[{label:"Message Boundary Event",actionName:"replace-with-message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Boundary Event",actionName:"replace-with-timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Boundary Event",actionName:"replace-with-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Boundary Event",actionName:"replace-with-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Error Boundary Event",actionName:"replace-with-error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel Boundary Event",actionName:"replace-with-cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Signal Boundary Event",actionName:"replace-with-signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Compensation Boundary Event",actionName:"replace-with-compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}],module.exports.EVENT_SUB_PROCESS_START_EVENT=[{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Error Start Event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Escalation Start Event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Compensation Start Event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-start",className:"bpmn-icon-start-event-non-interrupting-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!1}},{label:"Timer Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-start",className:"bpmn-icon-start-event-non-interrupting-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!1}},{label:"Conditional Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-start",className:"bpmn-icon-start-event-non-interrupting-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!1}},{label:"Signal Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-start",className:"bpmn-icon-start-event-non-interrupting-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!1}},{label:"Escalation Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-start",className:"bpmn-icon-start-event-non-interrupting-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!1}}],module.exports.SEQUENCE_FLOW=[{label:"Sequence Flow",
actionName:"replace-with-sequence-flow",className:"bpmn-icon-connection"},{label:"Default Flow",actionName:"replace-with-default-flow",className:"bpmn-icon-default-flow"},{label:"Conditional Flow",actionName:"replace-with-conditional-flow",className:"bpmn-icon-conditional-flow"}],module.exports.PARTICIPANT=[{label:"Expanded Pool",actionName:"replace-with-expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:"Collapsed Pool",actionName:"replace-with-collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}]},{}],145:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/replace"),require("diagram-js/lib/features/selection")],bpmnReplace:["type",require("./BpmnReplace")]}},{"./BpmnReplace":143,"diagram-js/lib/features/replace":282,"diagram-js/lib/features/selection":296}],146:[function(require,module,exports){"use strict";function BpmnRules(eventBus){RuleProvider.call(this,eventBus)}function nonExistantOrLabel(element){return!element||isLabel(element)}function isSame(a,b){return a===b}function getOrganizationalParent(element){for(var bo=getBusinessObject(element);bo&&!is(bo,"bpmn:Process");){if(is(bo,"bpmn:Participant"))return bo.processRef||bo;bo=bo.$parent}return bo}function isTextAnnotation(element){return is(element,"bpmn:TextAnnotation")}function isCompensationBoundary(element){return is(element,"bpmn:BoundaryEvent")&&hasEventDefinition(element,"bpmn:CompensateEventDefinition")}function isForCompensation(e){return getBusinessObject(e).isForCompensation}function isSameOrganization(a,b){return getOrganizationalParent(a)===getOrganizationalParent(b)}function isMessageFlowSource(element){return is(element,"bpmn:InteractionNode")&&!isForCompensation(element)&&(!is(element,"bpmn:Event")||is(element,"bpmn:ThrowEvent")&&hasEventDefinitionOrNone(element,"bpmn:MessageEventDefinition"))}function isMessageFlowTarget(element){return is(element,"bpmn:InteractionNode")&&!isForCompensation(element)&&(!is(element,"bpmn:Event")||is(element,"bpmn:CatchEvent")&&hasEventDefinitionOrNone(element,"bpmn:MessageEventDefinition"))}function getScopeParent(element){var bo=getBusinessObject(element);if(is(bo,"bpmn:Participant"))return null;for(;bo;)if(bo=bo.$parent,is(bo,"bpmn:FlowElementsContainer"))return bo;return bo}function isSameScope(a,b){var scopeParentA=getScopeParent(a),scopeParentB=getScopeParent(b);return scopeParentA&&scopeParentA===scopeParentB}function hasEventDefinition(element,eventDefinition){var bo=getBusinessObject(element);return!!find(bo.eventDefinitions||[],function(definition){return is(definition,eventDefinition)})}function hasEventDefinitionOrNone(element,eventDefinition){return(getBusinessObject(element).eventDefinitions||[]).every(function(definition){return is(definition,eventDefinition)})}function isSequenceFlowSource(element){return is(element,"bpmn:FlowNode")&&!is(element,"bpmn:EndEvent")&&!isEventSubProcess(element)&&!(is(element,"bpmn:IntermediateThrowEvent")&&hasEventDefinition(element,"bpmn:LinkEventDefinition"))&&!isCompensationBoundary(element)&&!isForCompensation(element)}function isSequenceFlowTarget(element){return is(element,"bpmn:FlowNode")&&!is(element,"bpmn:StartEvent")&&!is(element,"bpmn:BoundaryEvent")&&!isEventSubProcess(element)&&!(is(element,"bpmn:IntermediateCatchEvent")&&hasEventDefinition(element,"bpmn:LinkEventDefinition"))&&!isForCompensation(element)}function isEventBasedTarget(element){return is(element,"bpmn:ReceiveTask")||is(element,"bpmn:IntermediateCatchEvent")&&(hasEventDefinition(element,"bpmn:MessageEventDefinition")||hasEventDefinition(element,"bpmn:TimerEventDefinition")||hasEventDefinition(element,"bpmn:ConditionalEventDefinition")||hasEventDefinition(element,"bpmn:SignalEventDefinition"))}function isLabel(element){return element.labelTarget}function isConnection(element){return element.waypoints}function isParent(possibleParent,element){return-1!==getParents(element).indexOf(possibleParent)}function canConnect(source,target,connection){if(nonExistantOrLabel(source)||nonExistantOrLabel(target))return null;if(isSame(source,target))return!1;if(!is(connection,"bpmn:DataAssociation")){if(canConnectMessageFlow(source,target))return{type:"bpmn:MessageFlow"};if(canConnectSequenceFlow(source,target))return{type:"bpmn:SequenceFlow"}}var connectDataAssociation=canConnectDataAssociation(source,target);return connectDataAssociation||(isCompensationBoundary(source)&&isForCompensation(target)?{type:"bpmn:Association",associationDirection:"One"}:is(connection,"bpmn:Association")&&canConnectAssociation(source,target)?{type:"bpmn:Association"}:!(!isTextAnnotation(source)&&!isTextAnnotation(target))&&{type:"bpmn:Association"})}function canDrop(element,target,position){return!(!isLabel(element)||isConnection(target))||!(is(target,"bpmn:Participant")&&!isExpanded(target))&&(is(element,"bpmn:Participant")?is(target,"bpmn:Process")||is(target,"bpmn:Collaboration"):is(element,"bpmn:Lane")?is(target,"bpmn:Participant")||is(target,"bpmn:Lane"):!is(element,"bpmn:BoundaryEvent")&&(is(element,"bpmn:FlowElement")||is(element,"bpmn:DataAssociation")?is(target,"bpmn:FlowElementsContainer")?isExpanded(target):isAny(target,["bpmn:Participant","bpmn:Lane"]):is(element,"bpmn:Artifact")?isAny(target,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):!!is(element,"bpmn:MessageFlow")&&(is(target,"bpmn:Collaboration")||element.source.parent==target||element.target.parent==target)))}function canPaste(tree,target){var topLevel=tree[0];return is(target,"bpmn:Collaboration")?every(topLevel,function(e){return"bpmn:Participant"===e.type}):is(target,"bpmn:Process")?!(any(topLevel,function(e){return"bpmn:Participant"===e.type})&&target.children.length>0):!(is(target,"bpmn:Participant")&&!isExpanded(target))&&(is(target,"bpmn:FlowElementsContainer")?isExpanded(target):isAny(target,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]))}function isBoundaryEvent(element){return!isLabel(element)&&is(element,"bpmn:BoundaryEvent")}function isLane(element){return is(element,"bpmn:Lane")}function isBoundaryCandidate(element){return isBoundaryEvent(element)||is(element,"bpmn:IntermediateThrowEvent")&&!element.parent}function canAttach(elements,target,source,position){if(Array.isArray(elements)||(elements=[elements]),source)return!1;if(1!==elements.length)return!1;var element=elements[0];return!isLabel(element)&&(!!isBoundaryCandidate(element)&&(!target||!isEventSubProcess(target)&&(!(!is(target,"bpmn:Activity")||isForCompensation(target))&&(!(position&&!isBoundaryAttachment(position,target))&&"attach"))))}function canReplace(elements,target,position){if(!target)return!1;var canExecute={replacements:[]};return forEach(elements,function(element){isEventSubProcess(target)||is(element,"bpmn:StartEvent")&&"label"!==element.type&&canDrop(element,target)&&(isInterrupting(element)||canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:StartEvent"}),(hasErrorEventDefinition(element)||hasEscalationEventDefinition(element)||hasCompensateEventDefinition(element))&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:StartEvent"})),is(target,"bpmn:Transaction")||hasEventDefinition(element,"bpmn:CancelEventDefinition")&&"label"!==element.type&&(is(element,"bpmn:EndEvent")&&canDrop(element,target)&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:EndEvent"}),is(element,"bpmn:BoundaryEvent")&&canAttach(element,target,null,position)&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:BoundaryEvent"}))}),!!canExecute.replacements.length&&canExecute}function canMove(elements,target){return!any(elements,isBoundaryEvent)&&(!any(elements,isLane)&&(!target||elements.every(function(element){return canDrop(element,target)})))}function canCreate(shape,target,source,position){return!!target&&(isLabel(target)?null:!isSame(source,target)&&((!source||!isParent(source,target))&&(canDrop(shape,target,position)||canInsert(shape,target,position))))}function canResize(shape,newBounds){return is(shape,"bpmn:SubProcess")?!!isExpanded(shape)&&(!newBounds||newBounds.width>=100&&newBounds.height>=80):is(shape,"bpmn:Lane")?!newBounds||newBounds.width>=130&&newBounds.height>=60:is(shape,"bpmn:Participant")?!newBounds||newBounds.width>=250&&newBounds.height>=50:!!isTextAnnotation(shape)}function canConnectAssociation(source,target){return!isConnection(source)&&!isConnection(target)&&(!isParent(target,source)&&!isParent(source,target))}function canConnectMessageFlow(source,target){return isMessageFlowSource(source)&&isMessageFlowTarget(target)&&!isSameOrganization(source,target)}function canConnectSequenceFlow(source,target){return isSequenceFlowSource(source)&&isSequenceFlowTarget(target)&&isSameScope(source,target)&&!(is(source,"bpmn:EventBasedGateway")&&!isEventBasedTarget(target))}function canConnectDataAssociation(source,target){return isAny(source,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&isAny(target,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:!(!isAny(target,["bpmn:DataObjectReference","bpmn:DataStoreReference"])||!isAny(source,["bpmn:Activity","bpmn:CatchEvent"]))&&{type:"bpmn:DataOutputAssociation"}}function canInsert(shape,flow,position){return isAny(flow,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&is(shape,"bpmn:FlowNode")&&!is(shape,"bpmn:BoundaryEvent")&&canDrop(shape,flow.parent,position)}function contains(collection,element){return collection&&element&&-1!==collection.indexOf(element)}function canCopy(collection,element){return!(is(element,"bpmn:Lane")&&!contains(collection,element.parent))&&!(is(element,"bpmn:BoundaryEvent")&&!contains(collection,element.host))}var find=require("lodash/collection/find"),any=require("lodash/collection/any"),every=require("lodash/collection/every"),filter=require("lodash/collection/filter"),forEach=require("lodash/collection/forEach"),inherits=require("inherits"),getParents=require("../modeling/util/ModelingUtil").getParents,is=require("../../util/ModelUtil").is,isAny=require("../modeling/util/ModelingUtil").isAny,getBusinessObject=require("../../util/ModelUtil").getBusinessObject,isExpanded=require("../../util/DiUtil").isExpanded,isEventSubProcess=require("../../util/DiUtil").isEventSubProcess,isInterrupting=require("../../util/DiUtil").isInterrupting,hasErrorEventDefinition=require("../../util/DiUtil").hasErrorEventDefinition,hasEscalationEventDefinition=require("../../util/DiUtil").hasEscalationEventDefinition,hasCompensateEventDefinition=require("../../util/DiUtil").hasCompensateEventDefinition,RuleProvider=require("diagram-js/lib/features/rules/RuleProvider"),isBoundaryAttachment=require("../snapping/BpmnSnappingUtil").getBoundaryAttachment;inherits(BpmnRules,RuleProvider),BpmnRules.$inject=["eventBus"],module.exports=BpmnRules,BpmnRules.prototype.init=function(){this.addRule("connection.create",function(context){return canConnect(context.source,context.target)}),this.addRule("connection.reconnectStart",function(context){var connection=context.connection;return canConnect(context.hover||context.source,connection.target,connection)}),this.addRule("connection.reconnectEnd",function(context){var connection=context.connection;return canConnect(connection.source,context.hover||context.target,connection)}),this.addRule("connection.updateWaypoints",function(context){return null}),this.addRule("shape.resize",function(context){return canResize(context.shape,context.newBounds)}),this.addRule("elements.move",function(context){var target=context.target,shapes=context.shapes,position=context.position;return canAttach(shapes,target,null,position)||canReplace(shapes,target,position)||canMove(shapes,target)}),this.addRule(["shape.create","shape.append"],function(context){var target=context.target,shape=context.shape,source=context.source,position=context.position;return canAttach([shape],target,source,position)||canCreate(shape,target,source,position)}),this.addRule("element.copy",function(context){return canCopy(context.collection,context.element)}),this.addRule("element.paste",function(context){var parent=context.parent,element=context.element,position=context.position,source=context.source,target=context.target;return source||target?canConnect(source,target):canAttach([element],parent,null,position)||canCreate(element,parent,null,position)}),this.addRule("elements.paste",function(context){return canPaste(context.tree,context.target)}),this.addRule(["elements.delete"],function(context){return filter(context.elements,function(e){return!isLabel(e)})})},BpmnRules.prototype.canConnectMessageFlow=canConnectMessageFlow,BpmnRules.prototype.canConnectSequenceFlow=canConnectSequenceFlow,BpmnRules.prototype.canConnectDataAssociation=canConnectDataAssociation,BpmnRules.prototype.canConnectAssociation=canConnectAssociation,BpmnRules.prototype.canMove=canMove,BpmnRules.prototype.canAttach=canAttach,BpmnRules.prototype.canReplace=canReplace,BpmnRules.prototype.canDrop=canDrop,BpmnRules.prototype.canInsert=canInsert,BpmnRules.prototype.canCreate=canCreate,BpmnRules.prototype.canConnect=canConnect,BpmnRules.prototype.canResize=canResize,BpmnRules.prototype.canCopy=canCopy},{"../../util/DiUtil":158,"../../util/ModelUtil":160,"../modeling/util/ModelingUtil":133,"../snapping/BpmnSnappingUtil":151,"diagram-js/lib/features/rules/RuleProvider":288,inherits:354,"lodash/collection/any":365,"lodash/collection/every":366,"lodash/collection/filter":367,"lodash/collection/find":368,"lodash/collection/forEach":369}],147:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/rules")],__init__:["bpmnRules"],bpmnRules:["type",require("./BpmnRules")]}},{"./BpmnRules":146,"diagram-js/lib/features/rules":290}],148:[function(require,module,exports){"use strict";function BpmnSearchProvider(elementRegistry,searchPad,canvas){this._elementRegistry=elementRegistry,this._canvas=canvas,searchPad.registerProvider(this)}function hasMatched(tokens){return filter(tokens,function(t){return!!t.matched}).length>0}function matchAndSplit(text,pattern){var tokens=[],originalText=text;if(!text)return tokens;text=text.toLowerCase(),pattern=pattern.toLowerCase();var i=text.indexOf(pattern);return i>-1?(0!==i&&tokens.push({normal:originalText.substr(0,i)}),tokens.push({matched:originalText.substr(i,pattern.length)}),pattern.length+i<text.length&&tokens.push({normal:originalText.substr(pattern.length+i,text.length)})):tokens.push({normal:originalText}),tokens}var map=require("lodash/collection/map"),filter=require("lodash/collection/filter"),sortBy=require("lodash/collection/sortBy"),labelUtil=require("../label-editing/LabelUtil");module.exports=BpmnSearchProvider,BpmnSearchProvider.$inject=["elementRegistry","searchPad","canvas"],BpmnSearchProvider.prototype.find=function(pattern){var rootElement=this._canvas.getRootElement(),elements=this._elementRegistry.filter(function(element){return!element.labelTarget});return elements=filter(elements,function(element){return element!==rootElement}),elements=map(elements,function(element){return{primaryTokens:matchAndSplit(labelUtil.getLabel(element),pattern),secondaryTokens:matchAndSplit(element.id,pattern),element:element}}),elements=filter(elements,function(element){return hasMatched(element.primaryTokens)||hasMatched(element.secondaryTokens)}),elements=sortBy(elements,function(element){return labelUtil.getLabel(element.element)+element.element.id})}},{"../label-editing/LabelUtil":91,"lodash/collection/filter":367,"lodash/collection/map":373,"lodash/collection/sortBy":378}],149:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/search-pad")],__init__:["bpmnSearch"],bpmnSearch:["type",require("./BpmnSearchProvider")]}},{"./BpmnSearchProvider":148,"diagram-js/lib/features/search-pad":292}],150:[function(require,module,exports){"use strict";function BpmnSnapping(eventBus,canvas,bpmnRules,elementRegistry){function canAttach(shape,target,position){return"attach"===bpmnRules.canAttach([shape],target,null,position)}function canConnect(source,target){return bpmnRules.canConnect(source,target)}Snapping.call(this,eventBus,canvas),eventBus.on("create.start",function(event){var context=event.context,shape=context.shape,rootElement=canvas.getRootElement();is(shape,"bpmn:Participant")&&is(rootElement,"bpmn:Process")&&initParticipantSnapping(context,shape,rootElement.children)}),eventBus.on(["create.move","create.end"],HIGH_PRIORITY,function(event){var context=event.context,shape=context.shape,participantSnapBox=context.participantSnapBox;!isSnapped(event)&&participantSnapBox&&snapParticipant(participantSnapBox,shape,event)}),eventBus.on("shape.move.start",function(event){var context=event.context,shape=context.shape,rootElement=canvas.getRootElement();is(shape,"bpmn:Participant")&&is(rootElement,"bpmn:Process")&&initParticipantSnapping(context,shape,rootElement.children)}),eventBus.on(["create.move","create.end","shape.move.move","shape.move.end"],HIGH_PRIORITY,function(event){var context=event.context,target=context.target,shape=context.shape;target&&!isSnapped(event)&&canAttach(shape,target,event)&&snapBoundaryEvent(event,shape,target)}),eventBus.on(["shape.move.hover","shape.move.move","shape.move.end","create.hover","create.move","create.end"],HIGH_PRIORITY,function(event){var context=event.context,shape=context.shape,hover=event.hover;is(hover,"bpmn:Lane")&&!isAny(shape,["bpmn:Lane","bpmn:Participant"])&&(event.hover=getLanesRoot(hover),event.hoverGfx=elementRegistry.getGraphics(event.hover))}),eventBus.on(["connect.move","connect.hover","connect.end"],HIGH_PRIORITY,function(event){var context=event.context,source=context.source,target=context.target,connection=canConnect(source,target)||{};context.initialSourcePosition||(context.initialSourcePosition=context.sourcePosition),target&&"bpmn:SequenceFlow"===connection.type?(context.sourcePosition=mid(source),assign(event,mid(target))):context.sourcePosition=context.initialSourcePosition}),eventBus.on(["create.move","shape.move.move"],function(event){var context=event.context,shape=context.shape,target=context.target;if(is(shape,"bpmn:Lane")&&isAny(target,["bpmn:Lane","bpmn:Participant"])){var targetTrbl,childLanes=filter(target.children,function(c){return is(c,"bpmn:Lane")}),y=event.y,insert=childLanes.reduce(function(insert,l){var laneTrbl=asTRBL(l);return abs(laneTrbl.top-y)<30?insert=assign(insert||{},{before:{element:l,y:laneTrbl.top}}):abs(laneTrbl.bottom-y)<30?insert=assign(insert||{},{after:{element:l,y:laneTrbl.bottom}}):laneTrbl.top<y&&laneTrbl.bottom>y&&(insert=abs(laneTrbl.top-y)>abs(laneTrbl.bottom-y)?assign(insert||{},{after:{element:l,y:laneTrbl.bottom}}):assign(insert||{},{before:{element:l,y:laneTrbl.top}})),insert},!1);insert||(targetTrbl=asTRBL(target),insert=abs(targetTrbl.top-y)<30?{before:{element:target,y:targetTrbl.top}}:abs(targetTrbl.bottom-y)<30?{after:{element:target,y:targetTrbl.bottom}}:{into:{element:target,y:(targetTrbl.top+targetTrbl.bottom)/2}}),insert.before&&insert.after?(console.log("insert between",insert.before.element.id,"and",insert.after.element.id),setSnapped(event,"x",insert.before.element.x+insert.before.element.width/2),setSnapped(event,"y",insert.before.y)):insert.after?(console.log("insert after",insert.after.element.id),setSnapped(event,"x",insert.after.element.x+insert.after.element.width/2),setSnapped(event,"y",insert.after.y)):insert.before?(console.log("insert before",insert.before.element.id),setSnapped(event,"x",insert.before.element.x+insert.before.element.width/2),setSnapped(event,"y",insert.before.y)):insert.into&&(console.log("insert into",insert.into.element.id),setSnapped(event,"x",insert.into.element.x+insert.into.element.width/2),setSnapped(event,"y",insert.into.y))}}),eventBus.on("resize.start",HIGH_PRIORITY,function(event){var context=event.context,shape=context.shape;is(shape,"bpmn:SubProcess")&&isExpanded(shape)&&(context.minDimensions={width:140,height:120}),is(shape,"bpmn:Participant")&&(context.minDimensions={width:300,height:150}),(is(shape,"bpmn:Lane")||is(shape,"bpmn:Participant"))&&(context.resizeConstraints=getParticipantSizeConstraints(shape,context.direction,context.balanced)),is(shape,"bpmn:TextAnnotation")&&(context.minDimensions={width:50,height:30})})}function initParticipantSnapping(context,shape,elements){if(elements.length){var snapBox=getBoundingBox(elements.filter(function(e){return!e.labelTarget&&!e.waypoints}));snapBox.x-=50,snapBox.y-=20,snapBox.width+=70,snapBox.height+=40,shape.width=Math.max(shape.width,snapBox.width),shape.height=Math.max(shape.height,snapBox.height),context.participantSnapBox=snapBox}}function snapParticipant(snapBox,shape,event,offset){offset=offset||0;var shapeHalfWidth=shape.width/2-offset,shapeHalfHeight=shape.height/2,currentTopLeft={x:event.x-shapeHalfWidth-offset,y:event.y-shapeHalfHeight},currentBottomRight={x:event.x+shapeHalfWidth+offset,y:event.y+shapeHalfHeight},snapTopLeft=snapBox,snapBottomRight=bottomRight(snapBox);currentTopLeft.x>=snapTopLeft.x?setSnapped(event,"x",snapTopLeft.x+offset+shapeHalfWidth):currentBottomRight.x<=snapBottomRight.x&&setSnapped(event,"x",snapBottomRight.x-offset-shapeHalfWidth),currentTopLeft.y>=snapTopLeft.y?setSnapped(event,"y",snapTopLeft.y+shapeHalfHeight):currentBottomRight.y<=snapBottomRight.y&&setSnapped(event,"y",snapBottomRight.y-shapeHalfHeight)}function snapBoundaryEvent(event,shape,target){var targetTRBL=asTRBL(target),direction=getBoundaryAttachment(event,target);/top/.test(direction)?setSnapped(event,"y",targetTRBL.top):/bottom/.test(direction)&&setSnapped(event,"y",targetTRBL.bottom),/left/.test(direction)?setSnapped(event,"x",targetTRBL.left):/right/.test(direction)&&setSnapped(event,"x",targetTRBL.right)}var inherits=require("inherits"),abs=Math.abs,forEach=require("lodash/collection/forEach"),filter=require("lodash/collection/filter"),assign=require("lodash/object/assign"),getBoundingBox=require("diagram-js/lib/util/Elements").getBBox,is=require("../../util/ModelUtil").is,isAny=require("../modeling/util/ModelingUtil").isAny,isExpanded=require("../../util/DiUtil").isExpanded,Snapping=require("diagram-js/lib/features/snapping/Snapping"),SnapUtil=require("diagram-js/lib/features/snapping/SnapUtil"),asTRBL=require("diagram-js/lib/layout/LayoutUtil").asTRBL,round=Math.round,mid=SnapUtil.mid,topLeft=SnapUtil.topLeft,bottomRight=SnapUtil.bottomRight,isSnapped=SnapUtil.isSnapped,setSnapped=SnapUtil.setSnapped,getBoundaryAttachment=require("./BpmnSnappingUtil").getBoundaryAttachment,getParticipantSizeConstraints=require("./BpmnSnappingUtil").getParticipantSizeConstraints,getLanesRoot=require("../modeling/util/LaneUtil").getLanesRoot,HIGH_PRIORITY=1500;inherits(BpmnSnapping,Snapping),BpmnSnapping.$inject=["eventBus","canvas","bpmnRules","elementRegistry"],module.exports=BpmnSnapping,BpmnSnapping.prototype.initSnap=function(event){var shapeMid,shapeBounds,shapeTopLeft,shapeBottomRight,snapContext,context=event.context,shape=event.shape;snapContext=Snapping.prototype.initSnap.call(this,event),is(shape,"bpmn:Participant")&&snapContext.setSnapLocations(["top-left","bottom-right","mid"]),shape&&(shapeMid=mid(shape,event),shapeBounds={width:shape.width,height:shape.height,x:isNaN(shape.x)?round(shapeMid.x-shape.width/2):shape.x,y:isNaN(shape.y)?round(shapeMid.y-shape.height/2):shape.y},shapeTopLeft=topLeft(shapeBounds),shapeBottomRight=bottomRight(shapeBounds),snapContext.setSnapOrigin("top-left",{x:shapeTopLeft.x-event.x,y:shapeTopLeft.y-event.y}),snapContext.setSnapOrigin("bottom-right",{x:shapeBottomRight.x-event.x,y:shapeBottomRight.y-event.y}),forEach(shape.outgoing,function(c){var docking=c.waypoints[0];docking=docking.original||docking,snapContext.setSnapOrigin(c.id+"-docking",{x:docking.x-event.x,y:docking.y-event.y})}),forEach(shape.incoming,function(c){var docking=c.waypoints[c.waypoints.length-1];docking=docking.original||docking,snapContext.setSnapOrigin(c.id+"-docking",{x:docking.x-event.x,y:docking.y-event.y})}));var source=context.source;source&&snapContext.addDefaultSnap("mid",mid(source))},BpmnSnapping.prototype.addTargetSnaps=function(snapPoints,shape,target){is(shape,"bpmn:BoundaryEvent")&&"label"!==shape.type&&(target=target.parent),is(target,"bpmn:SequenceFlow")&&this.addTargetSnaps(snapPoints,shape,target.parent);var siblings=this.getSiblings(shape,target)||[];forEach(siblings,function(s){is(s,"bpmn:Lane")||(snapPoints.add("mid",mid(s)),is(s,"bpmn:Participant")&&(snapPoints.add("top-left",topLeft(s)),snapPoints.add("bottom-right",bottomRight(s))))}),forEach(shape.incoming,function(c){-1===siblings.indexOf(c.source)&&snapPoints.add("mid",mid(c.source));var docking=c.waypoints[0];snapPoints.add(c.id+"-docking",docking.original||docking)}),forEach(shape.outgoing,function(c){-1===siblings.indexOf(c.target)&&snapPoints.add("mid",mid(c.target));var docking=c.waypoints[c.waypoints.length-1];snapPoints.add(c.id+"-docking",docking.original||docking)})}},{"../../util/DiUtil":158,"../../util/ModelUtil":160,"../modeling/util/LaneUtil":132,"../modeling/util/ModelingUtil":133,"./BpmnSnappingUtil":151,"diagram-js/lib/features/snapping/SnapUtil":298,"diagram-js/lib/features/snapping/Snapping":299,"diagram-js/lib/layout/LayoutUtil":315,"diagram-js/lib/util/Elements":329,inherits:354,"lodash/collection/filter":367,"lodash/collection/forEach":369,"lodash/object/assign":502}],151:[function(require,module,exports){"use strict";function getBoundaryAttachment(position,targetBounds){var orientation=getOrientation(position,targetBounds,-15);return"intersect"!==orientation?orientation:null}function addToTrbl(trbl,attr,value,choice){var current=trbl[attr];trbl[attr]=void 0===current?value:choice(value,current)}function addMin(trbl,attr,value){return addToTrbl(trbl,attr,value,min)}function addMax(trbl,attr,value){return addToTrbl(trbl,attr,value,max)}function getParticipantSizeConstraints(laneShape,resizeDirection,balanced){var lanesRoot=getLanesRoot(laneShape),isFirst=!0,isLast=!0,allLanes=collectLanes(lanesRoot,[lanesRoot]),laneTrbl=asTRBL(laneShape),maxTrbl={},minTrbl={};return/e/.test(resizeDirection)?minTrbl.right=laneTrbl.left+LANE_MIN_WIDTH:/w/.test(resizeDirection)&&(minTrbl.left=laneTrbl.right-LANE_MIN_WIDTH),allLanes.forEach(function(other){var otherTrbl=asTRBL(other);/n/.test(resizeDirection)&&(otherTrbl.top<laneTrbl.top-10&&(isFirst=!1),balanced&&abs(laneTrbl.top-otherTrbl.bottom)<10&&addMax(maxTrbl,"top",otherTrbl.top+LANE_MIN_HEIGHT),abs(laneTrbl.top-otherTrbl.top)<5&&addMin(minTrbl,"top",otherTrbl.bottom-LANE_MIN_HEIGHT)),/s/.test(resizeDirection)&&(otherTrbl.bottom>laneTrbl.bottom+10&&(isLast=!1),balanced&&abs(laneTrbl.bottom-otherTrbl.top)<10&&addMin(maxTrbl,"bottom",otherTrbl.bottom-LANE_MIN_HEIGHT),abs(laneTrbl.bottom-otherTrbl.bottom)<5&&addMax(minTrbl,"bottom",otherTrbl.top+LANE_MIN_HEIGHT))}),lanesRoot.children.filter(function(s){return!s.hidden&&!s.waypoints&&(is(s,"bpmn:FlowElement")||is(s,"bpmn:Artifact"))}).forEach(function(flowElement){var flowElementTrbl=asTRBL(flowElement);isFirst&&/n/.test(resizeDirection)&&addMin(minTrbl,"top",flowElementTrbl.top-LANE_TOP_PADDING),/e/.test(resizeDirection)&&addMax(minTrbl,"right",flowElementTrbl.right+LANE_RIGHT_PADDING),isLast&&/s/.test(resizeDirection)&&addMax(minTrbl,"bottom",flowElementTrbl.bottom+LANE_BOTTOM_PADDING),/w/.test(resizeDirection)&&addMin(minTrbl,"left",flowElementTrbl.left-LANE_LEFT_PADDING)}),{min:minTrbl,max:maxTrbl}}var getOrientation=require("diagram-js/lib/layout/LayoutUtil").getOrientation;module.exports.getBoundaryAttachment=getBoundaryAttachment;var is=require("../../util/ModelUtil").is,asTRBL=require("diagram-js/lib/layout/LayoutUtil").asTRBL,collectLanes=require("../modeling/util/LaneUtil").collectLanes,getLanesRoot=require("../modeling/util/LaneUtil").getLanesRoot,abs=Math.abs,min=Math.min,max=Math.max,LANE_MIN_HEIGHT=60,LANE_MIN_WIDTH=300,LANE_RIGHT_PADDING=20,LANE_LEFT_PADDING=50,LANE_TOP_PADDING=20,LANE_BOTTOM_PADDING=20;module.exports.getParticipantSizeConstraints=getParticipantSizeConstraints},{"../../util/ModelUtil":160,"../modeling/util/LaneUtil":132,"diagram-js/lib/layout/LayoutUtil":315}],152:[function(require,module,exports){module.exports={__init__:["snapping"],snapping:["type",require("./BpmnSnapping")]}},{"./BpmnSnapping":150}],153:[function(require,module,exports){"use strict";function elementData(semantic,attrs){return assign({id:semantic.id,type:semantic.$type,businessObject:semantic},attrs)}function collectWaypoints(waypoints){return map(waypoints,function(p){return{x:p.x,y:p.y}})}function notYetDrawn(translate,semantic,refSemantic,property){return new Error(translate("element {element} referenced by {referenced}#{property} not yet drawn",{element:elementToString(refSemantic),referenced:elementToString(semantic),property:property}))}function BpmnImporter(eventBus,canvas,elementFactory,elementRegistry,translate){this._eventBus=eventBus,this._canvas=canvas,this._elementFactory=elementFactory,this._elementRegistry=elementRegistry,this._translate=translate}var assign=require("lodash/object/assign"),map=require("lodash/collection/map"),LabelUtil=require("../util/LabelUtil"),is=require("../util/ModelUtil").is,hasExternalLabel=LabelUtil.hasExternalLabel,getExternalLabelBounds=LabelUtil.getExternalLabelBounds,isExpanded=require("../util/DiUtil").isExpanded,elementToString=require("./Util").elementToString;BpmnImporter.$inject=["eventBus","canvas","elementFactory","elementRegistry","translate"],module.exports=BpmnImporter,BpmnImporter.prototype.add=function(semantic,parentElement){var element,hidden,di=semantic.di,translate=this._translate;if(is(di,"bpmndi:BPMNPlane"))element=this._elementFactory.createRoot(elementData(semantic)),this._canvas.setRootElement(element);else if(is(di,"bpmndi:BPMNShape")){var collapsed=!isExpanded(semantic);hidden=parentElement&&(parentElement.hidden||parentElement.collapsed);var bounds=semantic.di.bounds;element=this._elementFactory.createShape(elementData(semantic,{collapsed:collapsed,hidden:hidden,x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)})),is(semantic,"bpmn:BoundaryEvent")&&this._attachBoundary(semantic,element),this._canvas.addShape(element,parentElement)}else{if(!is(di,"bpmndi:BPMNEdge"))throw new Error(translate("unknown di {di} for element {semantic}",{di:elementToString(di),semantic:elementToString(semantic)}));var source=this._getSource(semantic),target=this._getTarget(semantic);hidden=parentElement&&(parentElement.hidden||parentElement.collapsed),element=this._elementFactory.createConnection(elementData(semantic,{hidden:hidden,source:source,target:target,waypoints:collectWaypoints(semantic.di.waypoint)})),(is(semantic,"bpmn:DataInputAssociation")||is(semantic,"bpmn:DataOutputAssociation"))&&(parentElement=null),this._canvas.addConnection(element,parentElement)}return hasExternalLabel(semantic)&&this.addLabel(semantic,element),this._eventBus.fire("bpmnElement.added",{element:element}),element},BpmnImporter.prototype._attachBoundary=function(boundarySemantic,boundaryElement){var translate=this._translate,hostSemantic=boundarySemantic.attachedToRef;if(!hostSemantic)throw new Error(translate("missing {semantic}#attachedToRef",{semantic:elementToString(boundarySemantic)}));var host=this._elementRegistry.get(hostSemantic.id),attachers=host&&host.attachers;if(!host)throw notYetDrawn(translate,boundarySemantic,hostSemantic,"attachedToRef");boundaryElement.host=host,attachers||(host.attachers=attachers=[]),-1===attachers.indexOf(boundaryElement)&&attachers.push(boundaryElement)},BpmnImporter.prototype.addLabel=function(semantic,element){var bounds=getExternalLabelBounds(semantic,element),label=this._elementFactory.createLabel(elementData(semantic,{id:semantic.id+"_label",labelTarget:element,type:"label",
hidden:element.hidden||!semantic.name,x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)}));return this._canvas.addShape(label,element.parent)},BpmnImporter.prototype._getEnd=function(semantic,side){var element,refSemantic,type=semantic.$type,translate=this._translate;if(refSemantic=semantic[side+"Ref"],"source"===side&&"bpmn:DataInputAssociation"===type&&(refSemantic=refSemantic&&refSemantic[0]),("source"===side&&"bpmn:DataOutputAssociation"===type||"target"===side&&"bpmn:DataInputAssociation"===type)&&(refSemantic=semantic.$parent),element=refSemantic&&this._getElement(refSemantic))return element;throw refSemantic?notYetDrawn(translate,semantic,refSemantic,side+"Ref"):new Error(translate("{semantic}#{side} Ref not specified",{semantic:elementToString(semantic),side:side}))},BpmnImporter.prototype._getSource=function(semantic){return this._getEnd(semantic,"source")},BpmnImporter.prototype._getTarget=function(semantic){return this._getEnd(semantic,"target")},BpmnImporter.prototype._getElement=function(semantic){return this._elementRegistry.get(semantic.id)}},{"../util/DiUtil":158,"../util/LabelUtil":159,"../util/ModelUtil":160,"./Util":156,"lodash/collection/map":373,"lodash/object/assign":502}],154:[function(require,module,exports){"use strict";function is(element,type){return element.$instanceOf(type)}function findDisplayCandidate(definitions){return find(definitions.rootElements,function(e){return is(e,"bpmn:Process")||is(e,"bpmn:Collaboration")})}function BpmnTreeWalker(handler,translate){function contextual(fn,ctx){return function(e){fn(e,ctx)}}function handled(element){handledElements[element.id]=element}function isHandled(element){return handledElements[element.id]}function visit(element,ctx){if(element.gfx)throw new Error(translate("already rendered {element}",{element:elementToString(element)}));return handler.element(element,ctx)}function visitRoot(element,diagram){return handler.root(element,diagram)}function visitIfDi(element,ctx){try{var gfx=element.di&&visit(element,ctx);return handled(element),gfx}catch(e){logError(e.message,{element:element,error:e}),console.error(translate("failed to import {element}",{element:elementToString(element)})),console.error(e)}}function logError(message,context){handler.error(message,context)}function registerDi(di){var bpmnElement=di.bpmnElement;bpmnElement?bpmnElement.di?logError(translate("multiple DI elements defined for {element}",{element:elementToString(bpmnElement)}),{element:bpmnElement}):(diRefs.bind(bpmnElement,"di"),bpmnElement.di=di):logError(translate("no bpmnElement referenced in {element}",{element:elementToString(di)}),{element:di})}function handleDiagram(diagram){handlePlane(diagram.plane)}function handlePlane(plane){registerDi(plane),forEach(plane.planeElement,handlePlaneElement)}function handlePlaneElement(planeElement){registerDi(planeElement)}function handleDefinitions(definitions,diagram){var diagrams=definitions.diagrams;if(diagram&&-1===diagrams.indexOf(diagram))throw new Error(translate("diagram not part of bpmn:Definitions"));if(!diagram&&diagrams&&diagrams.length&&(diagram=diagrams[0]),!diagram)throw new Error(translate("no diagram to display"));handleDiagram(diagram);var plane=diagram.plane;if(!plane)throw new Error(translate("no plane for {element}",{element:elementToString(diagram)}));var rootElement=plane.bpmnElement;if(!rootElement){if(!(rootElement=findDisplayCandidate(definitions)))throw new Error(translate("no process or collaboration to display"));logError(translate("correcting missing bpmnElement on {plane} to {rootElement}",{plane:elementToString(plane),rootElement:elementToString(rootElement)})),plane.bpmnElement=rootElement,registerDi(plane)}var ctx=visitRoot(rootElement,plane);if(is(rootElement,"bpmn:Process"))handleProcess(rootElement,ctx);else{if(!is(rootElement,"bpmn:Collaboration"))throw new Error(translate("unsupported bpmnElement for {plane}: {rootElement}",{plane:elementToString(plane),rootElement:elementToString(rootElement)}));handleCollaboration(rootElement),handleUnhandledProcesses(definitions.rootElements)}handleDeferred(deferred)}function handleDeferred(deferred){forEach(deferred,function(d){d()})}function handleProcess(process,context){handleFlowElementsContainer(process,context),handleIoSpecification(process.ioSpecification,context),handleArtifacts(process.artifacts,context),handled(process)}function handleUnhandledProcesses(rootElements){filter(rootElements,function(e){return!isHandled(e)&&is(e,"bpmn:Process")&&e.laneSets}).forEach(contextual(handleProcess))}function handleMessageFlow(messageFlow,context){visitIfDi(messageFlow,context)}function handleMessageFlows(messageFlows,context){forEach(messageFlows,contextual(handleMessageFlow,context))}function handleDataAssociation(association,context){visitIfDi(association,context)}function handleDataInput(dataInput,context){visitIfDi(dataInput,context)}function handleDataOutput(dataOutput,context){visitIfDi(dataOutput,context)}function handleArtifact(artifact,context){visitIfDi(artifact,context)}function handleArtifacts(artifacts,context){forEach(artifacts,function(e){is(e,"bpmn:Association")?deferred.push(function(){handleArtifact(e,context)}):handleArtifact(e,context)})}function handleIoSpecification(ioSpecification,context){ioSpecification&&(forEach(ioSpecification.dataInputs,contextual(handleDataInput,context)),forEach(ioSpecification.dataOutputs,contextual(handleDataOutput,context)))}function handleSubProcess(subProcess,context){handleFlowElementsContainer(subProcess,context),handleArtifacts(subProcess.artifacts,context)}function handleFlowNode(flowNode,context){var childCtx=visitIfDi(flowNode,context);is(flowNode,"bpmn:SubProcess")&&handleSubProcess(flowNode,childCtx||context),is(flowNode,"bpmn:Activity")&&handleIoSpecification(flowNode.ioSpecification,context),deferred.push(function(){forEach(flowNode.dataInputAssociations,contextual(handleDataAssociation,context)),forEach(flowNode.dataOutputAssociations,contextual(handleDataAssociation,context))})}function handleSequenceFlow(sequenceFlow,context){visitIfDi(sequenceFlow,context)}function handleDataElement(dataObject,context){visitIfDi(dataObject,context)}function handleBoundaryEvent(dataObject,context){visitIfDi(dataObject,context)}function handleLane(lane,context){var newContext=visitIfDi(lane,context);lane.childLaneSet&&handleLaneSet(lane.childLaneSet,newContext||context),wireFlowNodeRefs(lane)}function handleLaneSet(laneSet,context){forEach(laneSet.lanes,contextual(handleLane,context))}function handleLaneSets(laneSets,context){forEach(laneSets,contextual(handleLaneSet,context))}function handleFlowElementsContainer(container,context){container.laneSets&&handleLaneSets(container.laneSets,context),handleFlowElements(container.flowElements,context)}function handleFlowElements(flowElements,context){forEach(flowElements,function(e){is(e,"bpmn:SequenceFlow")?deferred.push(function(){handleSequenceFlow(e,context)}):is(e,"bpmn:BoundaryEvent")?deferred.unshift(function(){handleBoundaryEvent(e,context)}):is(e,"bpmn:FlowNode")?handleFlowNode(e,context):is(e,"bpmn:DataObject")||(is(e,"bpmn:DataStoreReference")?handleDataElement(e,context):is(e,"bpmn:DataObjectReference")?handleDataElement(e,context):logError(translate("unrecognized flowElement {element} in context {context}",{element:elementToString(e),context:context?elementToString(context.businessObject):"null"}),{element:e,context:context}))})}function handleParticipant(participant,context){var newCtx=visitIfDi(participant,context),process=participant.processRef;process&&handleProcess(process,newCtx||context)}function handleCollaboration(collaboration){forEach(collaboration.participants,contextual(handleParticipant)),handleArtifacts(collaboration.artifacts),deferred.push(function(){handleMessageFlows(collaboration.messageFlows)})}function wireFlowNodeRefs(lane){forEach(lane.flowNodeRef,function(flowNode){var lanes=flowNode.get("lanes");lanes&&lanes.push(lane)})}var handledElements={},deferred=[];return{handleDefinitions:handleDefinitions}}var filter=require("lodash/collection/filter"),find=require("lodash/collection/find"),forEach=require("lodash/collection/forEach"),Refs=require("object-refs"),elementToString=require("./Util").elementToString,diRefs=new Refs({name:"bpmnElement",enumerable:!0},{name:"di"});module.exports=BpmnTreeWalker},{"./Util":156,"lodash/collection/filter":367,"lodash/collection/find":368,"lodash/collection/forEach":369,"object-refs":539}],155:[function(require,module,exports){"use strict";function importBpmnDiagram(diagram,definitions,done){var error,importer=diagram.get("bpmnImporter"),eventBus=diagram.get("eventBus"),translate=diagram.get("translate"),warnings=[];eventBus.fire("import.render.start",{definitions:definitions});try{!function(definitions){new BpmnTreeWalker({root:function(element){return importer.add(element)},element:function(element,parentShape){return importer.add(element,parentShape)},error:function(message,context){warnings.push({message:message,context:context})}},translate).handleDefinitions(definitions)}(definitions)}catch(e){error=e}eventBus.fire("import.render.complete",{error:error,warnings:warnings}),done(error,warnings)}var BpmnTreeWalker=require("./BpmnTreeWalker");module.exports.importBpmnDiagram=importBpmnDiagram},{"./BpmnTreeWalker":154}],156:[function(require,module,exports){"use strict";module.exports.elementToString=function(e){return e?"<"+e.$type+(e.id?' id="'+e.id:"")+'" />':"<null>"}},{}],157:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/i18n/translate")],bpmnImporter:["type",require("./BpmnImporter")]}},{"./BpmnImporter":153,"diagram-js/lib/i18n/translate":311}],158:[function(require,module,exports){"use strict";function hasEventDefinition(element,eventType){var bo=getBusinessObject(element),hasEventDefinition=!1;return bo.eventDefinitions&&forEach(bo.eventDefinitions,function(event){is(event,eventType)&&(hasEventDefinition=!0)}),hasEventDefinition}var is=require("./ModelUtil").is,getBusinessObject=require("./ModelUtil").getBusinessObject,forEach=require("lodash/collection/forEach");module.exports.isExpanded=function(element){return!is(element,"bpmn:CallActivity")&&(is(element,"bpmn:SubProcess")?!!getBusinessObject(element).di.isExpanded:!is(element,"bpmn:Participant")||!!getBusinessObject(element).processRef)},module.exports.isInterrupting=function(element){return element&&!1!==getBusinessObject(element).isInterrupting},module.exports.isEventSubProcess=function(element){return element&&!!getBusinessObject(element).triggeredByEvent},module.exports.hasEventDefinition=hasEventDefinition,module.exports.hasErrorEventDefinition=function(element){return hasEventDefinition(element,"bpmn:ErrorEventDefinition")},module.exports.hasEscalationEventDefinition=function(element){return hasEventDefinition(element,"bpmn:EscalationEventDefinition")},module.exports.hasCompensateEventDefinition=function(element){return hasEventDefinition(element,"bpmn:CompensateEventDefinition")}},{"./ModelUtil":160,"lodash/collection/forEach":369}],159:[function(require,module,exports){"use strict";function getFlowLabelPosition(waypoints){var mid=waypoints.length/2-1,first=waypoints[Math.floor(mid)],second=waypoints[Math.ceil(mid+.01)],position=getWaypointsMid(waypoints),angle=Math.atan((second.y-first.y)/(second.x-first.x)),x=position.x,y=position.y;return Math.abs(angle)<Math.PI/2?y-=FLOW_LABEL_INDENT:x+=FLOW_LABEL_INDENT,{x:x,y:y}}function getWaypointsMid(waypoints){var mid=waypoints.length/2-1,first=waypoints[Math.floor(mid)],second=waypoints[Math.ceil(mid+.01)];return{x:first.x+(second.x-first.x)/2,y:first.y+(second.y-first.y)/2}}function getExternalLabelMid(element){return element.waypoints?getFlowLabelPosition(element.waypoints):{x:element.x+element.width/2,y:element.y+element.height+DEFAULT_LABEL_SIZE.height/2}}var assign=require("lodash/object/assign"),is=require("./ModelUtil").is,DEFAULT_LABEL_SIZE=module.exports.DEFAULT_LABEL_SIZE={width:90,height:20},FLOW_LABEL_INDENT=module.exports.FLOW_LABEL_INDENT=15;module.exports.hasExternalLabel=function(semantic){return is(semantic,"bpmn:Event")||is(semantic,"bpmn:Gateway")||is(semantic,"bpmn:DataStoreReference")||is(semantic,"bpmn:DataObjectReference")||is(semantic,"bpmn:SequenceFlow")||is(semantic,"bpmn:MessageFlow")},module.exports.getFlowLabelPosition=getFlowLabelPosition,module.exports.getWaypointsMid=getWaypointsMid,module.exports.getExternalLabelMid=getExternalLabelMid,module.exports.getExternalLabelBounds=function(semantic,element){var mid,size,bounds,di=semantic.di,label=di.label;return label&&label.bounds?(bounds=label.bounds,size={width:Math.max(DEFAULT_LABEL_SIZE.width,bounds.width),height:bounds.height},mid={x:bounds.x+bounds.width/2,y:bounds.y+bounds.height/2}):(mid=getExternalLabelMid(element),size=DEFAULT_LABEL_SIZE),assign({x:mid.x-size.width/2,y:mid.y-size.height/2},size)}},{"./ModelUtil":160,"lodash/object/assign":502}],160:[function(require,module,exports){"use strict";function is(element,type){var bo=getBusinessObject(element);return bo&&"function"==typeof bo.$instanceOf&&bo.$instanceOf(type)}function getBusinessObject(element){return element&&element.businessObject||element}module.exports.is=is,module.exports.getBusinessObject=getBusinessObject},{}],161:[function(require,module,exports){"use strict";function css(attrs){return attrs.join(";")}function open(){lightbox||(lightbox=domify(LIGHTBOX_MARKUP),domDelegate.bind(lightbox,".backdrop","click",function(event){document.body.removeChild(lightbox)})),document.body.appendChild(lightbox)}var lightbox,domify=require("min-dom/lib/domify"),domDelegate=require("min-dom/lib/delegate"),logoData=module.exports.BPMNIO_LOGO="iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAMAAADypuvZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADBQTFRFiMte9PrwldFwfcZPqtqN0+zEyOe1XLgjvuKncsJAZ70y6fXh3vDT////UrQV////G2zN+AAAABB0Uk5T////////////////////AOAjXRkAAAHDSURBVHjavJZJkoUgDEBJmAX8979tM8u3E6x20VlYJfFFMoL4vBDxATxZcakIOJTWSmxvKWVIkJ8jHvlRv1F2LFrVISCZI+tCtQx+XfewgVTfyY3plPiQEAzI3zWy+kR6NBhFBYeBuscJLOUuA2WVLpCjVIaFzrNQZArxAZKUQm6gsj37L9Cb7dnIBUKxENaaMJQqMpDXvSL+ktxdGRm2IsKgJGGPg7atwUG5CcFUEuSv+CwQqizTrvDTNXdMU2bMiDWZd8d7QIySWVRsb2vBBioxOFt4OinPBapL+neAb5KL5IJ8szOza2/DYoipUCx+CjO0Bpsv0V6mktNZ+k8rlABlWG0FrOpKYVo8DT3dBeLEjUBAj7moDogVii7nSS9QzZnFcOVBp1g2PyBQ3Vr5aIapN91VJy33HTJLC1iX2FY6F8gRdaAeIEfVONgtFCzZTmoLEdOjBDfsIOA6128gw3eu1shAajdZNAORxuQDJN5A5PbEG6gNIu24QJD5iNyRMZIr6bsHbCtCU/OaOaSvgkUyDMdDa1BXGf5HJ1To+/Ym6mCKT02Y+/Sa126ZKyd3jxhzpc1r8zVL6YM1Qy/kR4ABAFJ6iQUnivhAAAAAAElFTkSuQmCC",LIGHTBOX_STYLES=css(["z-index: 1001","position: fixed","top: 0","left: 0","right: 0","bottom: 0"]),BACKDROP_STYLES=css(["width: 100%","height: 100%","background: rgba(0,0,0,0.2)"]),NOTICE_STYLES=css(["position: absolute","left: 50%","top: 40%","margin: 0 -130px","width: 260px","padding: 10px","background: white","border: solid 1px #AAA","border-radius: 3px","font-family: Helvetica, Arial, sans-serif","font-size: 14px","line-height: 1.2em"]),LIGHTBOX_MARKUP='<div class="bjs-powered-by-lightbox" style="'+LIGHTBOX_STYLES+'"><div class="backdrop" style="'+BACKDROP_STYLES+'"></div><div class="notice" style="'+NOTICE_STYLES+'"><a href="http://bpmn.io" target="_blank" style="float: left; margin-right: 10px"><img src="data:image/png;base64,'+logoData+'"></a>Web-based tooling for BPMN, DMN and CMMN diagrams powered by <a href="http://bpmn.io" target="_blank">bpmn.io</a>.</div></div>';module.exports.open=open},{"min-dom/lib/delegate":521,"min-dom/lib/domify":522}],162:[function(require,module,exports){module.exports=require("./lib/simple")},{"./lib/simple":164}],163:[function(require,module,exports){"use strict";function BpmnModdle(packages,options){Moddle.call(this,packages,options)}var isString=require("lodash/lang/isString"),isFunction=require("lodash/lang/isFunction"),assign=require("lodash/object/assign"),Moddle=require("moddle"),XmlReader=require("moddle-xml/lib/reader"),XmlWriter=require("moddle-xml/lib/writer");BpmnModdle.prototype=Object.create(Moddle.prototype),module.exports=BpmnModdle,BpmnModdle.prototype.fromXML=function(xmlStr,typeName,options,done){isString(typeName)||(done=options,options=typeName,typeName="bpmn:Definitions"),isFunction(options)&&(done=options,options={});var reader=new XmlReader(assign({model:this,lax:!0},options)),rootHandler=reader.handler(typeName);reader.fromXML(xmlStr,rootHandler,done)},BpmnModdle.prototype.toXML=function(element,options,done){isFunction(options)&&(done=options,options={});var writer=new XmlWriter(options);try{var result=writer.toXML(element);done(null,result)}catch(e){done(e)}}},{"lodash/lang/isFunction":494,"lodash/lang/isString":499,"lodash/object/assign":502,moddle:530,"moddle-xml/lib/reader":528,"moddle-xml/lib/writer":529}],164:[function(require,module,exports){"use strict";var assign=require("lodash/object/assign"),BpmnModdle=require("./bpmn-moddle"),packages={bpmn:require("../resources/bpmn/json/bpmn.json"),bpmndi:require("../resources/bpmn/json/bpmndi.json"),dc:require("../resources/bpmn/json/dc.json"),di:require("../resources/bpmn/json/di.json")};module.exports=function(additionalPackages,options){return new BpmnModdle(assign({},packages,additionalPackages),options)}},{"../resources/bpmn/json/bpmn.json":165,"../resources/bpmn/json/bpmndi.json":166,"../resources/bpmn/json/dc.json":167,"../resources/bpmn/json/di.json":168,"./bpmn-moddle":163,"lodash/object/assign":502}],165:[function(require,module,exports){module.exports={name:"BPMN20",uri:"http://www.omg.org/spec/BPMN/20100524/MODEL",associations:[],types:[{name:"Interface",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"operations",type:"Operation",isMany:!0},{name:"implementationRef",type:"String",isAttr:!0}]},{name:"Operation",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"inMessageRef",type:"Message",isReference:!0},{name:"outMessageRef",type:"Message",isReference:!0},{name:"errorRef",type:"Error",isMany:!0,isReference:!0},{name:"implementationRef",type:"String",isAttr:!0}]},{name:"EndPoint",superClass:["RootElement"]},{name:"Auditing",superClass:["BaseElement"]},{name:"GlobalTask",superClass:["CallableElement"],properties:[{name:"resources",type:"ResourceRole",isMany:!0}]},{name:"Monitoring",superClass:["BaseElement"]},{name:"Performer",superClass:["ResourceRole"]},{name:"Process",superClass:["FlowElementsContainer","CallableElement"],properties:[{name:"processType",type:"ProcessType",isAttr:!0},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"properties",type:"Property",isMany:!0},{name:"laneSets",type:"LaneSet",isMany:!0,replaces:"FlowElementsContainer#laneSets"},{name:"flowElements",type:"FlowElement",isMany:!0,replaces:"FlowElementsContainer#flowElements"},{name:"artifacts",type:"Artifact",isMany:!0},{name:"resources",type:"ResourceRole",isMany:!0},{name:"correlationSubscriptions",type:"CorrelationSubscription",isMany:!0},{name:"supports",type:"Process",isMany:!0,isReference:!0},{name:"definitionalCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"isExecutable",isAttr:!0,type:"Boolean"}]},{name:"LaneSet",superClass:["BaseElement"],properties:[{name:"lanes",type:"Lane",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Lane",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"partitionElementRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"partitionElement",type:"BaseElement"},{name:"flowNodeRef",type:"FlowNode",isMany:!0,isReference:!0},{name:"childLaneSet",type:"LaneSet",xml:{serialize:"xsi:type"}}]},{name:"GlobalManualTask",superClass:["GlobalTask"]},{name:"ManualTask",superClass:["Task"]},{name:"UserTask",superClass:["Task"],properties:[{name:"renderings",type:"Rendering",isMany:!0},{name:"implementation",isAttr:!0,type:"String"}]},{name:"Rendering",superClass:["BaseElement"]},{name:"HumanPerformer",superClass:["Performer"]},{name:"PotentialOwner",superClass:["HumanPerformer"]},{name:"GlobalUserTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"renderings",type:"Rendering",isMany:!0}]},{name:"Gateway",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"gatewayDirection",type:"GatewayDirection",default:"Unspecified",isAttr:!0}]},{name:"EventBasedGateway",superClass:["Gateway"],properties:[{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"eventGatewayType",type:"EventBasedGatewayType",isAttr:!0,default:"Exclusive"}]},{name:"ComplexGateway",superClass:["Gateway"],properties:[{name:"activationCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ExclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"InclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ParallelGateway",superClass:["Gateway"]},{name:"RootElement",isAbstract:!0,superClass:["BaseElement"]},{name:"Relationship",superClass:["BaseElement"],properties:[{name:"type",isAttr:!0,type:"String"},{name:"direction",type:"RelationshipDirection",isAttr:!0},{name:"source",isMany:!0,isReference:!0,type:"Element"},{name:"target",isMany:!0,isReference:!0,type:"Element"}]},{name:"BaseElement",isAbstract:!0,properties:[{name:"id",isAttr:!0,type:"String",isId:!0},{name:"documentation",type:"Documentation",isMany:!0},{name:"extensionDefinitions",type:"ExtensionDefinition",isMany:!0,isReference:!0},{name:"extensionElements",type:"ExtensionElements"}]},{name:"Extension",properties:[{name:"mustUnderstand",default:!1,isAttr:!0,type:"Boolean"},{name:"definition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"extensionAttributeDefinitions",type:"ExtensionAttributeDefinition",isMany:!0}]},{name:"ExtensionAttributeDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"type",isAttr:!0,type:"String"},{name:"isReference",default:!1,isAttr:!0,type:"Boolean"},{name:"extensionDefinition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionElements",properties:[{name:"valueRef",isAttr:!0,isReference:!0,type:"Element"},{name:"values",type:"Element",isMany:!0},{name:"extensionAttributeDefinition",type:"ExtensionAttributeDefinition",isAttr:!0,isReference:!0}]},{name:"Documentation",superClass:["BaseElement"],properties:[{name:"text",type:"String",isBody:!0},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Event",isAbstract:!0,superClass:["FlowNode","InteractionNode"],properties:[{name:"properties",type:"Property",isMany:!0}]},{name:"IntermediateCatchEvent",superClass:["CatchEvent"]},{name:"IntermediateThrowEvent",superClass:["ThrowEvent"]},{name:"EndEvent",superClass:["ThrowEvent"]},{name:"StartEvent",superClass:["CatchEvent"],properties:[{name:"isInterrupting",default:!0,isAttr:!0,type:"Boolean"}]},{name:"ThrowEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"inputSet",type:"InputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"CatchEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"parallelMultiple",isAttr:!0,type:"Boolean",default:!1},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"outputSet",type:"OutputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"BoundaryEvent",superClass:["CatchEvent"],properties:[{name:"cancelActivity",default:!0,isAttr:!0,type:"Boolean"},{name:"attachedToRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"EventDefinition",isAbstract:!0,superClass:["RootElement"]},{name:"CancelEventDefinition",superClass:["EventDefinition"]},{name:"ErrorEventDefinition",superClass:["EventDefinition"],properties:[{name:"errorRef",type:"Error",isAttr:!0,isReference:!0}]},{name:"TerminateEventDefinition",superClass:["EventDefinition"]},{name:"EscalationEventDefinition",superClass:["EventDefinition"],properties:[{name:"escalationRef",type:"Escalation",isAttr:!0,isReference:!0}]},{name:"Escalation",properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"escalationCode",isAttr:!0,type:"String"}],superClass:["RootElement"]},{name:"CompensateEventDefinition",superClass:["EventDefinition"],properties:[{name:"waitForCompletion",isAttr:!0,type:"Boolean"},{name:"activityRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"TimerEventDefinition",superClass:["EventDefinition"],properties:[{name:"timeDate",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeCycle",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeDuration",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"LinkEventDefinition",superClass:["EventDefinition"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"target",type:"LinkEventDefinition",isAttr:!0,isReference:!0},{name:"source",type:"LinkEventDefinition",isMany:!0,isReference:!0}]},{name:"MessageEventDefinition",superClass:["EventDefinition"],properties:[{name:"messageRef",type:"Message",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"ConditionalEventDefinition",superClass:["EventDefinition"],properties:[{name:"condition",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"SignalEventDefinition",superClass:["EventDefinition"],properties:[{name:"signalRef",type:"Signal",isAttr:!0,isReference:!0}]},{name:"Signal",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ImplicitThrowEvent",superClass:["ThrowEvent"]},{name:"DataState",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"ItemAwareElement",superClass:["BaseElement"],properties:[{name:"itemSubjectRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"dataState",type:"DataState"}]},{name:"DataAssociation",superClass:["BaseElement"],properties:[{name:"assignment",type:"Assignment",isMany:!0},{name:"sourceRef",type:"ItemAwareElement",isMany:!0,isReference:!0},{name:"targetRef",type:"ItemAwareElement",isReference:!0},{name:"transformation",type:"FormalExpression",xml:{serialize:"property"}}]},{name:"DataInput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"inputSetRef",type:"InputSet",isVirtual:!0,isMany:!0,isReference:!0},{name:"inputSetWithOptional",type:"InputSet",isVirtual:!0,isMany:!0,isReference:!0},{name:"inputSetWithWhileExecuting",type:"InputSet",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"DataOutput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"outputSetRef",type:"OutputSet",isVirtual:!0,isMany:!0,isReference:!0},{name:"outputSetWithOptional",type:"OutputSet",isVirtual:!0,isMany:!0,isReference:!0},{name:"outputSetWithWhileExecuting",type:"OutputSet",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"InputSet",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"dataInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"optionalInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"whileExecutingInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"outputSetRefs",type:"OutputSet",isMany:!0,isReference:!0}]},{name:"OutputSet",superClass:["BaseElement"],properties:[{name:"dataOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"inputSetRefs",type:"InputSet",isMany:!0,isReference:!0},{name:"optionalOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"whileExecutingOutputRefs",type:"DataOutput",isMany:!0,isReference:!0}]},{name:"Property",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"DataInputAssociation",superClass:["DataAssociation"]},{name:"DataOutputAssociation",superClass:["DataAssociation"]},{name:"InputOutputSpecification",superClass:["BaseElement"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"inputSets",type:"InputSet",isMany:!0},{name:"outputSets",type:"OutputSet",isMany:!0}]},{name:"DataObject",superClass:["FlowElement","ItemAwareElement"],properties:[{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"}]},{name:"InputOutputBinding",properties:[{name:"inputDataRef",type:"InputSet",isAttr:!0,isReference:!0},{name:"outputDataRef",type:"OutputSet",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"Assignment",superClass:["BaseElement"],properties:[{name:"from",type:"Expression",xml:{serialize:"xsi:type"}},{name:"to",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"DataStore",superClass:["RootElement","ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"capacity",isAttr:!0,type:"Integer"},{name:"isUnlimited",default:!0,isAttr:!0,type:"Boolean"}]},{name:"DataStoreReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataStoreRef",type:"DataStore",isAttr:!0,isReference:!0}]},{name:"DataObjectReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataObjectRef",type:"DataObject",isAttr:!0,isReference:!0}]},{name:"ConversationLink",superClass:["BaseElement"],properties:[{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ConversationAssociation",superClass:["BaseElement"],properties:[{name:"innerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0},{name:"outerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0}]},{name:"CallConversation",superClass:["ConversationNode"],properties:[{name:"calledCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"Conversation",superClass:["ConversationNode"]},{name:"SubConversation",superClass:["ConversationNode"],properties:[{name:"conversationNodes",type:"ConversationNode",isMany:!0}]},{name:"ConversationNode",isAbstract:!0,superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRefs",type:"Participant",isMany:!0,isReference:!0},{name:"messageFlowRefs",type:"MessageFlow",isMany:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0}]},{name:"GlobalConversation",superClass:["Collaboration"]},{name:"PartnerEntity",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"PartnerRole",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"CorrelationProperty",superClass:["RootElement"],properties:[{name:"correlationPropertyRetrievalExpression",type:"CorrelationPropertyRetrievalExpression",isMany:!0},{name:"name",isAttr:!0,type:"String"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Error",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"errorCode",isAttr:!0,type:"String"}]},{
name:"CorrelationKey",superClass:["BaseElement"],properties:[{name:"correlationPropertyRef",type:"CorrelationProperty",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Expression",superClass:["BaseElement"],isAbstract:!1,properties:[{name:"body",type:"String",isBody:!0}]},{name:"FormalExpression",superClass:["Expression"],properties:[{name:"language",isAttr:!0,type:"String"},{name:"evaluatesToTypeRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Message",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"itemRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"ItemDefinition",superClass:["RootElement"],properties:[{name:"itemKind",type:"ItemKind",isAttr:!0},{name:"structureRef",type:"String",isAttr:!0},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"import",type:"Import",isAttr:!0,isReference:!0}]},{name:"FlowElement",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"categoryValueRef",type:"CategoryValue",isMany:!0,isReference:!0}]},{name:"SequenceFlow",superClass:["FlowElement"],properties:[{name:"isImmediate",isAttr:!0,type:"Boolean"},{name:"conditionExpression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"sourceRef",type:"FlowNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"FlowNode",isAttr:!0,isReference:!0}]},{name:"FlowElementsContainer",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"laneSets",type:"LaneSet",isMany:!0},{name:"flowElements",type:"FlowElement",isMany:!0}]},{name:"CallableElement",isAbstract:!0,superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"supportedInterfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"ioBinding",type:"InputOutputBinding",isMany:!0,xml:{serialize:"property"}}]},{name:"FlowNode",isAbstract:!0,superClass:["FlowElement"],properties:[{name:"incoming",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"outgoing",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"lanes",type:"Lane",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"CorrelationPropertyRetrievalExpression",superClass:["BaseElement"],properties:[{name:"messagePath",type:"FormalExpression"},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"CorrelationPropertyBinding",superClass:["BaseElement"],properties:[{name:"dataPath",type:"FormalExpression"},{name:"correlationPropertyRef",type:"CorrelationProperty",isAttr:!0,isReference:!0}]},{name:"Resource",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"resourceParameters",type:"ResourceParameter",isMany:!0}]},{name:"ResourceParameter",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isRequired",isAttr:!0,type:"Boolean"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"CorrelationSubscription",superClass:["BaseElement"],properties:[{name:"correlationKeyRef",type:"CorrelationKey",isAttr:!0,isReference:!0},{name:"correlationPropertyBinding",type:"CorrelationPropertyBinding",isMany:!0}]},{name:"MessageFlow",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"MessageFlowAssociation",superClass:["BaseElement"],properties:[{name:"innerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0},{name:"outerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0}]},{name:"InteractionNode",isAbstract:!0,properties:[{name:"incomingConversationLinks",type:"ConversationLink",isVirtual:!0,isMany:!0,isReference:!0},{name:"outgoingConversationLinks",type:"ConversationLink",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"Participant",superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"interfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"participantMultiplicity",type:"ParticipantMultiplicity"},{name:"endPointRefs",type:"EndPoint",isMany:!0,isReference:!0},{name:"processRef",type:"Process",isAttr:!0,isReference:!0}]},{name:"ParticipantAssociation",superClass:["BaseElement"],properties:[{name:"innerParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"outerParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"ParticipantMultiplicity",properties:[{name:"minimum",default:0,isAttr:!0,type:"Integer"},{name:"maximum",default:1,isAttr:!0,type:"Integer"}]},{name:"Collaboration",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"participants",type:"Participant",isMany:!0},{name:"messageFlows",type:"MessageFlow",isMany:!0},{name:"artifacts",type:"Artifact",isMany:!0},{name:"conversations",type:"ConversationNode",isMany:!0},{name:"conversationAssociations",type:"ConversationAssociation"},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0},{name:"messageFlowAssociations",type:"MessageFlowAssociation",isMany:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"choreographyRef",type:"Choreography",isMany:!0,isReference:!0},{name:"conversationLinks",type:"ConversationLink",isMany:!0}]},{name:"ChoreographyActivity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"participantRefs",type:"Participant",isMany:!0,isReference:!0},{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"loopType",type:"ChoreographyLoopType",default:"None",isAttr:!0}]},{name:"CallChoreography",superClass:["ChoreographyActivity"],properties:[{name:"calledChoreographyRef",type:"Choreography",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"SubChoreography",superClass:["ChoreographyActivity","FlowElementsContainer"],properties:[{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"ChoreographyTask",superClass:["ChoreographyActivity"],properties:[{name:"messageFlowRef",type:"MessageFlow",isMany:!0,isReference:!0}]},{name:"Choreography",superClass:["FlowElementsContainer","Collaboration"]},{name:"GlobalChoreographyTask",superClass:["Choreography"],properties:[{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"TextAnnotation",superClass:["Artifact"],properties:[{name:"text",type:"String"},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Group",superClass:["Artifact"],properties:[{name:"categoryValueRef",type:"CategoryValue",isAttr:!0,isReference:!0}]},{name:"Association",superClass:["Artifact"],properties:[{name:"associationDirection",type:"AssociationDirection",isAttr:!0},{name:"sourceRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"targetRef",type:"BaseElement",isAttr:!0,isReference:!0}]},{name:"Category",superClass:["RootElement"],properties:[{name:"categoryValue",type:"CategoryValue",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Artifact",isAbstract:!0,superClass:["BaseElement"]},{name:"CategoryValue",superClass:["BaseElement"],properties:[{name:"categorizedFlowElements",type:"FlowElement",isVirtual:!0,isMany:!0,isReference:!0},{name:"value",isAttr:!0,type:"String"}]},{name:"Activity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"isForCompensation",default:!1,isAttr:!0,type:"Boolean"},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"boundaryEventRefs",type:"BoundaryEvent",isMany:!0,isReference:!0},{name:"properties",type:"Property",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"startQuantity",default:1,isAttr:!0,type:"Integer"},{name:"resources",type:"ResourceRole",isMany:!0},{name:"completionQuantity",default:1,isAttr:!0,type:"Integer"},{name:"loopCharacteristics",type:"LoopCharacteristics"}]},{name:"ServiceTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"SubProcess",superClass:["Activity","FlowElementsContainer","InteractionNode"],properties:[{name:"triggeredByEvent",default:!1,isAttr:!0,type:"Boolean"},{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"LoopCharacteristics",isAbstract:!0,superClass:["BaseElement"]},{name:"MultiInstanceLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"isSequential",default:!1,isAttr:!0,type:"Boolean"},{name:"behavior",type:"MultiInstanceBehavior",default:"All",isAttr:!0},{name:"loopCardinality",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopDataInputRef",type:"ItemAwareElement",isReference:!0},{name:"loopDataOutputRef",type:"ItemAwareElement",isReference:!0},{name:"inputDataItem",type:"DataInput",xml:{serialize:"property"}},{name:"outputDataItem",type:"DataOutput",xml:{serialize:"property"}},{name:"complexBehaviorDefinition",type:"ComplexBehaviorDefinition",isMany:!0},{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"oneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0},{name:"noneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0}]},{name:"StandardLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"testBefore",default:!1,isAttr:!0,type:"Boolean"},{name:"loopCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopMaximum",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"CallActivity",superClass:["Activity"],properties:[{name:"calledElement",type:"String",isAttr:!0}]},{name:"Task",superClass:["Activity","InteractionNode"]},{name:"SendTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ReceiveTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ScriptTask",superClass:["Task"],properties:[{name:"scriptFormat",isAttr:!0,type:"String"},{name:"script",type:"String"}]},{name:"BusinessRuleTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"AdHocSubProcess",superClass:["SubProcess"],properties:[{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"ordering",type:"AdHocOrdering",isAttr:!0},{name:"cancelRemainingInstances",default:!0,isAttr:!0,type:"Boolean"}]},{name:"Transaction",superClass:["SubProcess"],properties:[{name:"protocol",isAttr:!0,type:"String"},{name:"method",isAttr:!0,type:"String"}]},{name:"GlobalScriptTask",superClass:["GlobalTask"],properties:[{name:"scriptLanguage",isAttr:!0,type:"String"},{name:"script",isAttr:!0,type:"String"}]},{name:"GlobalBusinessRuleTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"ComplexBehaviorDefinition",superClass:["BaseElement"],properties:[{name:"condition",type:"FormalExpression"},{name:"event",type:"ImplicitThrowEvent"}]},{name:"ResourceRole",superClass:["BaseElement"],properties:[{name:"resourceRef",type:"Resource",isReference:!0},{name:"resourceParameterBindings",type:"ResourceParameterBinding",isMany:!0},{name:"resourceAssignmentExpression",type:"ResourceAssignmentExpression"},{name:"name",isAttr:!0,type:"String"}]},{name:"ResourceParameterBinding",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"parameterRef",type:"ResourceParameter",isAttr:!0,isReference:!0}]},{name:"ResourceAssignmentExpression",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}}],superClass:["BaseElement"]},{name:"Import",properties:[{name:"importType",isAttr:!0,type:"String"},{name:"location",isAttr:!0,type:"String"},{name:"namespace",isAttr:!0,type:"String"}]},{name:"Definitions",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"targetNamespace",isAttr:!0,type:"String"},{name:"expressionLanguage",default:"http://www.w3.org/1999/XPath",isAttr:!0,type:"String"},{name:"typeLanguage",default:"http://www.w3.org/2001/XMLSchema",isAttr:!0,type:"String"},{name:"imports",type:"Import",isMany:!0},{name:"extensions",type:"Extension",isMany:!0},{name:"rootElements",type:"RootElement",isMany:!0},{name:"diagrams",isMany:!0,type:"bpmndi:BPMNDiagram"},{name:"exporter",isAttr:!0,type:"String"},{name:"relationships",type:"Relationship",isMany:!0},{name:"exporterVersion",isAttr:!0,type:"String"}]}],emumerations:[{name:"ProcessType",literalValues:[{name:"None"},{name:"Public"},{name:"Private"}]},{name:"GatewayDirection",literalValues:[{name:"Unspecified"},{name:"Converging"},{name:"Diverging"},{name:"Mixed"}]},{name:"EventBasedGatewayType",literalValues:[{name:"Parallel"},{name:"Exclusive"}]},{name:"RelationshipDirection",literalValues:[{name:"None"},{name:"Forward"},{name:"Backward"},{name:"Both"}]},{name:"ItemKind",literalValues:[{name:"Physical"},{name:"Information"}]},{name:"ChoreographyLoopType",literalValues:[{name:"None"},{name:"Standard"},{name:"MultiInstanceSequential"},{name:"MultiInstanceParallel"}]},{name:"AssociationDirection",literalValues:[{name:"None"},{name:"One"},{name:"Both"}]},{name:"MultiInstanceBehavior",literalValues:[{name:"None"},{name:"One"},{name:"All"},{name:"Complex"}]},{name:"AdHocOrdering",literalValues:[{name:"Parallel"},{name:"Sequential"}]}],prefix:"bpmn",xml:{tagAlias:"lowerCase",typePrefix:"t"}}},{}],166:[function(require,module,exports){module.exports={name:"BPMNDI",uri:"http://www.omg.org/spec/BPMN/20100524/DI",types:[{name:"BPMNDiagram",properties:[{name:"plane",type:"BPMNPlane",redefines:"di:Diagram#rootElement"},{name:"labelStyle",type:"BPMNLabelStyle",isMany:!0}],superClass:["di:Diagram"]},{name:"BPMNPlane",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"}],superClass:["di:Plane"]},{name:"BPMNShape",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"isHorizontal",isAttr:!0,type:"Boolean"},{name:"isExpanded",isAttr:!0,type:"Boolean"},{name:"isMarkerVisible",isAttr:!0,type:"Boolean"},{name:"label",type:"BPMNLabel"},{name:"isMessageVisible",isAttr:!0,type:"Boolean"},{name:"participantBandKind",type:"ParticipantBandKind",isAttr:!0},{name:"choreographyActivityShape",type:"BPMNShape",isAttr:!0,isReference:!0}],superClass:["di:LabeledShape"]},{name:"BPMNEdge",properties:[{name:"label",type:"BPMNLabel"},{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"sourceElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#source"},{name:"targetElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#target"},{name:"messageVisibleKind",type:"MessageVisibleKind",isAttr:!0,default:"initiating"}],superClass:["di:LabeledEdge"]},{name:"BPMNLabel",properties:[{name:"labelStyle",type:"BPMNLabelStyle",isAttr:!0,isReference:!0,redefines:"di:DiagramElement#style"}],superClass:["di:Label"]},{name:"BPMNLabelStyle",properties:[{name:"font",type:"dc:Font"}],superClass:["di:Style"]}],emumerations:[{name:"ParticipantBandKind",literalValues:[{name:"top_initiating"},{name:"middle_initiating"},{name:"bottom_initiating"},{name:"top_non_initiating"},{name:"middle_non_initiating"},{name:"bottom_non_initiating"}]},{name:"MessageVisibleKind",literalValues:[{name:"initiating"},{name:"non_initiating"}]}],associations:[],prefix:"bpmndi"}},{}],167:[function(require,module,exports){module.exports={name:"DC",uri:"http://www.omg.org/spec/DD/20100524/DC",types:[{name:"Boolean"},{name:"Integer"},{name:"Real"},{name:"String"},{name:"Font",properties:[{name:"name",type:"String",isAttr:!0},{name:"size",type:"Real",isAttr:!0},{name:"isBold",type:"Boolean",isAttr:!0},{name:"isItalic",type:"Boolean",isAttr:!0},{name:"isUnderline",type:"Boolean",isAttr:!0},{name:"isStrikeThrough",type:"Boolean",isAttr:!0}]},{name:"Point",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0}]},{name:"Bounds",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0},{name:"width",type:"Real",isAttr:!0},{name:"height",type:"Real",isAttr:!0}]}],prefix:"dc",associations:[]}},{}],168:[function(require,module,exports){module.exports={name:"DI",uri:"http://www.omg.org/spec/DD/20100524/DI",types:[{name:"DiagramElement",isAbstract:!0,properties:[{name:"id",type:"String",isAttr:!0,isId:!0},{name:"extension",type:"Extension"},{name:"owningDiagram",type:"Diagram",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"owningElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"modelElement",isReadOnly:!0,isVirtual:!0,isReference:!0,type:"Element"},{name:"style",type:"Style",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"ownedElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isMany:!0}]},{name:"Node",isAbstract:!0,superClass:["DiagramElement"]},{name:"Edge",isAbstract:!0,superClass:["DiagramElement"],properties:[{name:"source",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"target",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"waypoint",isUnique:!1,isMany:!0,type:"dc:Point",xml:{serialize:"xsi:type"}}]},{name:"Diagram",isAbstract:!0,properties:[{name:"id",type:"String",isAttr:!0,isId:!0},{name:"rootElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0},{name:"name",isAttr:!0,type:"String"},{name:"documentation",isAttr:!0,type:"String"},{name:"resolution",isAttr:!0,type:"Real"},{name:"ownedStyle",type:"Style",isReadOnly:!0,isVirtual:!0,isMany:!0}]},{name:"Shape",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Plane",isAbstract:!0,superClass:["Node"],properties:[{name:"planeElement",type:"DiagramElement",subsettedProperty:"DiagramElement-ownedElement",isMany:!0}]},{name:"LabeledEdge",isAbstract:!0,superClass:["Edge"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isVirtual:!0,isMany:!0}]},{name:"LabeledShape",isAbstract:!0,superClass:["Shape"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isVirtual:!0,isMany:!0}]},{name:"Label",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Style",isAbstract:!0,properties:[{name:"id",type:"String",isAttr:!0,isId:!0}]},{name:"Extension",properties:[{name:"values",type:"Element",isMany:!0}]}],associations:[],prefix:"di",xml:{tagAlias:"lowerCase"}}},{}],169:[function(require,module,exports){module.exports={name:"Camunda",uri:"http://camunda.org/schema/1.0/bpmn",prefix:"camunda",xml:{tagAlias:"lowerCase"},associations:[],types:[{name:"InOutBinding",superClass:["Element"],isAbstract:!0,properties:[{name:"source",isAttr:!0,type:"String"},{name:"sourceExpression",isAttr:!0,type:"String"},{name:"target",isAttr:!0,type:"String"},{name:"businessKey",isAttr:!0,type:"String"},{name:"local",isAttr:!0,type:"Boolean",default:!1},{name:"variables",isAttr:!0,type:"String"}]},{name:"In",superClass:["InOutBinding"]},{name:"Out",superClass:["InOutBinding"]},{name:"AsyncCapable",isAbstract:!0,extends:["bpmn:Activity","bpmn:Gateway","bpmn:Event"],properties:[{name:"async",isAttr:!0,type:"Boolean",default:!1},{name:"asyncBefore",isAttr:!0,type:"Boolean",default:!1},{name:"asyncAfter",isAttr:!0,type:"Boolean",default:!1},{name:"exclusive",isAttr:!0,type:"Boolean",default:!0}]},{name:"JobPriorized",isAbstract:!0,extends:["bpmn:Process","camunda:AsyncCapable"],properties:[{name:"jobPriority",isAttr:!0,type:"String"}]},{name:"SignalEventDefinition",isAbstract:!0,extends:["bpmn:SignalEventDefinition"],properties:[{name:"async",isAttr:!0,type:"Boolean",default:!1}]},{name:"ErrorEventDefinition",isAbstract:!0,extends:["bpmn:ErrorEventDefinition"],properties:[{name:"errorCodeVariable",isAttr:!0,type:"String"},{name:"errorMessageVariable",isAttr:!0,type:"String"}]},{name:"PotentialStarter",superClass:["Element"],properties:[{name:"resourceAssignmentExpression",type:"bpmn:ResourceAssignmentExpression"}]},{name:"FormSupported",isAbstract:!0,extends:["bpmn:StartEvent","bpmn:UserTask"],properties:[{name:"formHandlerClass",isAttr:!0,type:"String"},{name:"formKey",isAttr:!0,type:"String"}]},{name:"Initiator",isAbstract:!0,extends:["bpmn:StartEvent"],properties:[{name:"initiator",isAttr:!0,type:"String"}]},{name:"ScriptTask",isAbstract:!0,extends:["bpmn:ScriptTask"],properties:[{name:"resultVariable",isAttr:!0,type:"String"},{name:"resource",isAttr:!0,type:"String"}]},{name:"Process",isAbstract:!0,extends:["bpmn:Process"],properties:[{name:"candidateStarterGroups",isAttr:!0,type:"String"},{name:"candidateStarterUsers",isAttr:!0,type:"String"},{name:"versionTag",isAttr:!0,type:"String"}]},{name:"EscalationEventDefinition",isAbstract:!0,extends:["bpmn:EscalationEventDefinition"],properties:[{name:"escalationCodeVariable",isAttr:!0,type:"String"}]},{name:"FormalExpression",isAbstract:!0,extends:["bpmn:FormalExpression"],properties:[{name:"resource",isAttr:!0,type:"String"}]},{name:"Assignable",extends:["bpmn:UserTask"],properties:[{name:"assignee",isAttr:!0,type:"String"},{name:"candidateUsers",isAttr:!0,type:"String"},{name:"candidateGroups",isAttr:!0,type:"String"},{name:"dueDate",isAttr:!0,type:"String"},{name:"followUpDate",isAttr:!0,type:"String"},{name:"priority",isAttr:!0,type:"String"}]},{name:"CallActivity",extends:["bpmn:CallActivity"],properties:[{name:"calledElementBinding",isAttr:!0,type:"String",default:"latest"},{name:"calledElementVersion",isAttr:!0,type:"String"},{name:"calledElementTenantId",isAttr:!0,type:"String"},{name:"caseRef",isAttr:!0,type:"String"},{name:"caseBinding",isAttr:!0,type:"String",default:"latest"},{name:"caseVersion",isAttr:!0,type:"String"},{name:"caseTenantId",isAttr:!0,type:"String"},{name:"variableMappingClass",isAttr:!0,type:"String"},{name:"variableMappingDelegateExpression",isAttr:!0,type:"String"}]},{name:"ServiceTaskLike",extends:["bpmn:ServiceTask","bpmn:BusinessRuleTask","bpmn:SendTask","bpmn:MessageEventDefinition"],properties:[{name:"expression",isAttr:!0,type:"String"},{name:"class",isAttr:!0,type:"String"},{name:"delegateExpression",isAttr:!0,type:"String"},{name:"resultVariable",isAttr:!0,type:"String"}]},{name:"DmnCapable",extends:["bpmn:BusinessRuleTask"],properties:[{name:"decisionRef",isAttr:!0,type:"String"},{name:"decisionRefBinding",isAttr:!0,type:"String",default:"latest"},{name:"decisionRefVersion",isAttr:!0,type:"String"},{name:"mapDecisionResult",isAttr:!0,type:"String",default:"resultList"},{name:"decisionRefTenantId",isAttr:!0,type:"String"}]},{name:"ExternalCapable",extends:["camunda:ServiceTaskLike"],properties:[{name:"type",isAttr:!0,type:"String"},{name:"topic",isAttr:!0,type:"String"}]},{name:"TaskPriorized",extends:["bpmn:Process","camunda:ExternalCapable"],properties:[{name:"taskPriority",isAttr:!0,type:"String"}]},{name:"Properties",superClass:["Element"],properties:[{name:"values",type:"Property",isMany:!0}]},{name:"Property",superClass:["Element"],properties:[{name:"id",type:"String",isAttr:!0},{name:"name",type:"String",isAttr:!0},{name:"value",type:"String",isAttr:!0}]},{name:"Connector",superClass:["Element"],properties:[{name:"inputOutput",type:"InputOutput"},{name:"connectorId",type:"String"}]},{name:"InputOutput",superClass:["Element"],properties:[{name:"inputOutput",type:"InputOutput"},{name:"connectorId",type:"String"},{name:"inputParameters",isMany:!0,type:"InputParameter"},{name:"outputParameters",isMany:!0,type:"OutputParameter"}]},{name:"InputOutputParameter",properties:[{name:"name",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"},{name:"definition",type:"InputOutputParameterDefinition"}]},{name:"InputOutputParameterDefinition",isAbstract:!0},{name:"List",superClass:["InputOutputParameterDefinition"],properties:[{name:"items",isMany:!0,type:"InputOutputParameterDefinition"}]},{name:"Map",superClass:["InputOutputParameterDefinition"],properties:[{name:"entries",isMany:!0,type:"Entry"}]},{name:"Entry",properties:[{name:"key",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"},{name:"definition",type:"InputOutputParameterDefinition"}]},{name:"Value",superClass:["InputOutputParameterDefinition"],properties:[{name:"id",isAttr:!0,type:"String"},{name:"name",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"}]},{name:"Script",superClass:["InputOutputParameterDefinition"],properties:[{name:"scriptFormat",isAttr:!0,type:"String"},{name:"resource",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"}]},{name:"Field",superClass:["Element"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"expression",type:"String"},{name:"stringValue",isAttr:!0,type:"String"},{name:"string",type:"String"}]},{name:"InputParameter",superClass:["InputOutputParameter"]},{name:"OutputParameter",superClass:["InputOutputParameter"]},{name:"Collectable",isAbstract:!0,extends:["bpmn:MultiInstanceLoopCharacteristics"],superClass:["camunda:AsyncCapable"],properties:[{name:"collection",isAttr:!0,type:"String"},{name:"elementVariable",isAttr:!0,type:"String"}]},{name:"FailedJobRetryTimeCycle",superClass:["Element"],properties:[{name:"body",isBody:!0,type:"String"}]},{name:"ExecutionListener",superClass:["Element"],properties:[{name:"expression",isAttr:!0,type:"String"},{name:"class",isAttr:!0,type:"String"},{name:"delegateExpression",isAttr:!0,type:"String"},{name:"event",isAttr:!0,type:"String"},{name:"script",type:"Script"},{name:"fields",type:"Field",isMany:!0}]},{name:"TaskListener",superClass:["Element"],properties:[{name:"expression",isAttr:!0,type:"String"},{name:"class",isAttr:!0,type:"String"},{name:"delegateExpression",isAttr:!0,type:"String"},{name:"event",isAttr:!0,type:"String"},{name:"script",type:"Script"},{name:"fields",type:"Field",isMany:!0}]},{name:"FormProperty",superClass:["Element"],properties:[{name:"id",type:"String",isAttr:!0},{name:"name",type:"String",isAttr:!0},{name:"type",type:"String",isAttr:!0},{name:"required",type:"String",isAttr:!0},{name:"readable",type:"String",isAttr:!0},{name:"writable",type:"String",isAttr:!0},{name:"variable",type:"String",isAttr:!0},{name:"expression",type:"String",isAttr:!0},{name:"datePattern",type:"String",isAttr:!0},{name:"default",type:"String",isAttr:!0},{name:"values",type:"Value",isMany:!0}]},{name:"FormData",superClass:["Element"],properties:[{name:"fields",type:"FormField",isMany:!0},{name:"businessKey",type:"String",isAttr:!0}]},{name:"FormField",superClass:["Element"],properties:[{name:"id",type:"String",isAttr:!0},{name:"label",type:"String",isAttr:!0},{name:"type",type:"String",isAttr:!0},{name:"datePattern",type:"String",isAttr:!0},{name:"defaultValue",type:"String",isAttr:!0},{name:"properties",type:"Properties"},{name:"validation",type:"Validation"},{name:"values",type:"Value",isMany:!0}]},{name:"Validation",superClass:["Element"],properties:[{name:"constraints",type:"Constraint",isMany:!0}]},{name:"Constraint",superClass:["Element"],properties:[{name:"name",type:"String",isAttr:!0},{name:"config",type:"String",isAttr:!0}]},{name:"ConditionalEventDefinition",isAbstract:!0,extends:["bpmn:ConditionalEventDefinition"],properties:[{name:"variableName",isAttr:!0,type:"String"},{name:"variableEvent",isAttr:!0,type:"String"}]}],emumerations:[]}},{}],170:[function(require,module,exports){function ClassList(el){if(!el||!el.nodeType)throw new Error("A DOM element reference is required");this.el=el,this.list=el.classList}try{var index=require("indexof")}catch(err){var index=require("component-indexof")}var re=/\s+/,toString=Object.prototype.toString;module.exports=function(el){return new ClassList(el)},ClassList.prototype.add=function(name){if(this.list)return this.list.add(name),this;var arr=this.array();return~index(arr,name)||arr.push(name),this.el.className=arr.join(" "),this},ClassList.prototype.remove=function(name){if("[object RegExp]"==toString.call(name))return this.removeMatching(name);if(this.list)return this.list.remove(name),this;var arr=this.array(),i=index(arr,name);return~i&&arr.splice(i,1),this.el.className=arr.join(" "),this},ClassList.prototype.removeMatching=function(re){for(var arr=this.array(),i=0;i<arr.length;i++)re.test(arr[i])&&this.remove(arr[i]);return this},ClassList.prototype.toggle=function(name,force){return this.list?(void 0!==force?force!==this.list.toggle(name,force)&&this.list.toggle(name):this.list.toggle(name),this):(void 0!==force?force?this.add(name):this.remove(name):this.has(name)?this.remove(name):this.add(name),this)},ClassList.prototype.array=function(){var className=this.el.getAttribute("class")||"",str=className.replace(/^\s+|\s+$/g,""),arr=str.split(re);return""===arr[0]&&arr.shift(),arr},ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name)}},{"component-indexof":174,indexof:174}],171:[function(require,module,exports){var matches=require("matches-selector");module.exports=function(element,selector,checkYoSelf,root){for(element=checkYoSelf?{parentNode:element}:element,root=root||document;(element=element.parentNode)&&element!==document;){if(matches(element,selector))return element;if(element===root)return}}},{"matches-selector":175}],172:[function(require,module,exports){try{var closest=require("closest")}catch(err){var closest=require("component-closest")}try{var event=require("event")}catch(err){var event=require("component-event")}exports.bind=function(el,selector,type,fn,capture){return event.bind(el,type,function(e){var target=e.target||e.srcElement;e.delegateTarget=closest(target,selector,!0,el),e.delegateTarget&&fn.call(el,e)},capture)},exports.unbind=function(el,type,fn,capture){event.unbind(el,type,fn,capture)}},{closest:171,"component-closest":171,"component-event":173,event:173}],173:[function(require,module,exports){var bind=window.addEventListener?"addEventListener":"attachEvent",unbind=window.removeEventListener?"removeEventListener":"detachEvent",prefix="addEventListener"!==bind?"on":"";exports.bind=function(el,type,fn,capture){return el[bind](prefix+type,fn,capture||!1),fn},exports.unbind=function(el,type,fn,capture){return el[unbind](prefix+type,fn,capture||!1),fn}},{}],174:[function(require,module,exports){module.exports=function(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}},{}],175:[function(require,module,exports){function match(el,selector){if(!el||1!==el.nodeType)return!1;if(vendor)return vendor.call(el,selector);for(var nodes=query.all(selector,el.parentNode),i=0;i<nodes.length;++i)if(nodes[i]==el)return!0;return!1}try{var query=require("query")}catch(err){var query=require("component-query")}var proto=Element.prototype,vendor=proto.matches||proto.webkitMatchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector;module.exports=match},{"component-query":176,query:176}],176:[function(require,module,exports){function one(selector,el){return el.querySelector(selector)}exports=module.exports=function(selector,el){return el=el||document,one(selector,el)},exports.all=function(selector,el){return el=el||document,el.querySelectorAll(selector)},exports.engine=function(obj){
if(!obj.one)throw new Error(".one callback required");if(!obj.all)throw new Error(".all callback required");return one=obj.one,exports.all=obj.all,exports}},{}],177:[function(require,module,exports){module.exports={__depends__:[require("diagram-js/lib/features/interaction-events")],__init__:["directEditing"],directEditing:["type",require("./lib/DirectEditing")]}},{"./lib/DirectEditing":178,"diagram-js/lib/features/interaction-events":233}],178:[function(require,module,exports){"use strict";function DirectEditing(eventBus,canvas){this._eventBus=eventBus,this._providers=[],this._textbox=new TextBox({container:canvas.getContainer(),keyHandler:bind(this._handleKey,this)})}var bind=require("lodash/function/bind"),find=require("lodash/collection/find"),TextBox=require("./TextBox");DirectEditing.$inject=["eventBus","canvas"],DirectEditing.prototype.registerProvider=function(provider){this._providers.push(provider)},DirectEditing.prototype.isActive=function(){return!!this._active},DirectEditing.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())},DirectEditing.prototype._fire=function(event){this._eventBus.fire("directEditing."+event,{active:this._active})},DirectEditing.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null},DirectEditing.prototype.complete=function(){var active=this._active;if(active){var text=this.getValue();text!==active.context.text&&active.provider.update(active.element,text,active.context.text),this._fire("complete"),this.close()}},DirectEditing.prototype.getValue=function(){return this._textbox.getValue()},DirectEditing.prototype._handleKey=function(e){e.stopPropagation();var key=e.keyCode||e.charCode;return 27===key?(e.preventDefault(),this.cancel()):13!==key||e.shiftKey?void 0:(e.preventDefault(),this.complete())},DirectEditing.prototype.activate=function(element){this.isActive()&&this.cancel();var context,provider=find(this._providers,function(p){return(context=p.activate(element))?p:null});return context&&(this._textbox.create(context.bounds,context.style,context.text),this._active={element:element,context:context,provider:provider},this._fire("activate")),!!context},module.exports=DirectEditing},{"./TextBox":179,"lodash/collection/find":368,"lodash/function/bind":380}],179:[function(require,module,exports){"use strict";function stopPropagation(event){event.stopPropagation()}function TextBox(options){this.container=options.container,this.content=document.createElement("div"),this.content.contentEditable="true",this.keyHandler=options.keyHandler||function(){}}var assign=require("lodash/object/assign"),domEvent=require("min-dom/lib/event"),domRemove=require("min-dom/lib/remove");module.exports=TextBox,TextBox.prototype.create=function(bounds,style,value){var content=this.content,container=this.container;return assign(content.style,{width:bounds.width+"px",height:bounds.height+"px",maxWidth:bounds.maxWidth+"px",maxHeight:bounds.maxHeight+"px",minWidth:bounds.minWidth+"px",minHeight:bounds.minHeight+"px",left:bounds.x+"px",top:bounds.y+"px",backgroundColor:"#ffffff",position:"absolute",overflowY:"auto",border:"1px solid #ccc",padding:"2px",wordWrap:"normal",textAlign:"center",outline:"none"},style||{}),content.innerText=value,domEvent.bind(content,"keydown",this.keyHandler),domEvent.bind(content,"mousedown",stopPropagation),container.appendChild(content),this.setCursor(),content},TextBox.prototype.destroy=function(){var content=this.content;content.innerText="",assign(content.style,{width:"",height:"",maxWidth:"",maxHeight:"",minWidth:"",minHeight:""}),domEvent.unbind(content,"keydown",this.keyHandler),domEvent.unbind(content,"mousedown",stopPropagation),domRemove(content)},TextBox.prototype.getValue=function(){return this.content.innerText},TextBox.prototype.setCursor=function(){if(this.content.focus(),this.content.scrollTop=this.content.scrollHeight,void 0!==window.getSelection&&void 0!==document.createRange){var range=document.createRange();range.selectNodeContents(this.content),range.collapse(!1);var selection=window.getSelection();selection.removeAllRanges(),selection.addRange(range)}else if(void 0!==document.body.createTextRange){var textRange=document.body.createTextRange();textRange.moveToElementText(this.content),textRange.collapse(!1),textRange.select()}}},{"lodash/object/assign":502,"min-dom/lib/event":523,"min-dom/lib/remove":526}],180:[function(require,module,exports){module.exports=require("./lib/Diagram")},{"./lib/Diagram":181}],181:[function(require,module,exports){"use strict";function bootstrap(bootstrapModules){function hasModule(m){return modules.indexOf(m)>=0}function addModule(m){modules.push(m)}function visit(m){hasModule(m)||((m.__depends__||[]).forEach(visit),hasModule(m)||(addModule(m),(m.__init__||[]).forEach(function(c){components.push(c)})))}var modules=[],components=[];bootstrapModules.forEach(visit);var injector=new di.Injector(modules);return components.forEach(function(c){try{injector["string"==typeof c?"get":"invoke"](c)}catch(e){throw console.error("Failed to instantiate component"),console.error(e.stack),e}}),injector}function createInjector(options){return options=options||{},bootstrap([{config:["value",options]},require("./core")].concat(options.modules||[]))}function Diagram(options,injector){this.injector=injector=injector||createInjector(options),this.get=injector.get,this.invoke=injector.invoke,this.get("eventBus").fire("diagram.init")}var di=require("didi");module.exports=Diagram,Diagram.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},Diagram.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")}},{"./core":190,didi:345}],182:[function(require,module,exports){"use strict";function isObject(element){return"object"==typeof element}function CommandInterceptor(eventBus){this._eventBus=eventBus}function unwrapEvent(fn,that){return function(event){return fn.call(that||null,event.context,event.command,event)}}var forEach=require("lodash/collection/forEach"),isFunction=require("lodash/lang/isFunction"),isArray=require("lodash/lang/isArray"),isNumber=require("lodash/lang/isNumber");CommandInterceptor.$inject=["eventBus"],module.exports=CommandInterceptor,CommandInterceptor.prototype.on=function(events,hook,priority,handlerFn,unwrap,that){if((isFunction(hook)||isNumber(hook))&&(that=unwrap,unwrap=handlerFn,handlerFn=priority,priority=hook,hook=null),isFunction(priority)&&(that=unwrap,unwrap=handlerFn,handlerFn=priority,priority=1e3),isObject(unwrap)&&(that=unwrap,unwrap=!1),!isFunction(handlerFn))throw new Error("handlerFn must be a function");isArray(events)||(events=[events]);var eventBus=this._eventBus;forEach(events,function(event){var fullEvent=["commandStack",event,hook].filter(function(e){return e}).join(".");eventBus.on(fullEvent,priority,unwrap?unwrapEvent(handlerFn,that):handlerFn,that)})},forEach(["canExecute","preExecute","preExecuted","execute","executed","postExecute","postExecuted","revert","reverted"],function(hook){CommandInterceptor.prototype[hook]=function(events,priority,handlerFn,unwrap,that){(isFunction(events)||isNumber(events))&&(that=unwrap,unwrap=handlerFn,handlerFn=priority,priority=events,events=null),this.on(events,hook,priority,handlerFn,unwrap,that)}})},{"lodash/collection/forEach":369,"lodash/lang/isArray":492,"lodash/lang/isFunction":494,"lodash/lang/isNumber":496}],183:[function(require,module,exports){"use strict";function CommandStack(eventBus,injector){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[]},this._injector=injector,this._eventBus=eventBus,this._uid=1,eventBus.on(["diagram.destroy","diagram.clear"],this.clear,this)}var unique=require("lodash/array/unique"),isArray=require("lodash/lang/isArray"),assign=require("lodash/object/assign"),InternalEvent=require("../core/EventBus").Event;CommandStack.$inject=["eventBus","injector"],module.exports=CommandStack,CommandStack.prototype.execute=function(command,context){if(!command)throw new Error("command required");var action={command:command,context:context};this._pushAction(action),this._internalExecute(action),this._popAction(action)},CommandStack.prototype.canExecute=function(command,context){var action={command:command,context:context},handler=this._getHandler(command),result=this._fire(command,"canExecute",action);if(void 0===result){if(!handler)return!1;handler.canExecute&&(result=handler.canExecute(context))}return result},CommandStack.prototype.clear=function(){this._stack.length=0,this._stackIdx=-1,this._fire("changed")},CommandStack.prototype.undo=function(){var next,action=this._getUndoAction();if(action){for(this._pushAction(action);action&&(this._internalUndo(action),(next=this._getUndoAction())&&next.id===action.id);)action=next;this._popAction()}},CommandStack.prototype.redo=function(){var next,action=this._getRedoAction();if(action){for(this._pushAction(action);action&&(this._internalExecute(action,!0),(next=this._getRedoAction())&&next.id===action.id);)action=next;this._popAction()}},CommandStack.prototype.register=function(command,handler){this._setHandler(command,handler)},CommandStack.prototype.registerHandler=function(command,handlerCls){if(!command||!handlerCls)throw new Error("command and handlerCls must be defined");var handler=this._injector.instantiate(handlerCls);this.register(command,handler)},CommandStack.prototype.canUndo=function(){return!!this._getUndoAction()},CommandStack.prototype.canRedo=function(){return!!this._getRedoAction()},CommandStack.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},CommandStack.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},CommandStack.prototype._internalUndo=function(action){var self=this,command=action.command,context=action.context,handler=this._getHandler(command);this._atomicDo(function(){self._fire(command,"revert",action),handler.revert&&self._markDirty(handler.revert(context)),self._revertedAction(action),self._fire(command,"reverted",action)})},CommandStack.prototype._fire=function(command,qualifier,event){arguments.length<3&&(event=qualifier,qualifier=null);var i,name,result,names=qualifier?[command+"."+qualifier,qualifier]:[command];for(event=assign(new InternalEvent,event),i=0;(name=names[i])&&(result=this._eventBus.fire("commandStack."+name,event),!event.cancelBubble);i++);return result},CommandStack.prototype._createId=function(){return this._uid++},CommandStack.prototype._atomicDo=function(fn){var execution=this._currentExecution;execution.atomic=!0;try{fn()}finally{execution.atomic=!1}},CommandStack.prototype._internalExecute=function(action,redo){var self=this,command=action.command,context=action.context,handler=this._getHandler(command);if(!handler)throw new Error("no command handler registered for <"+command+">");this._pushAction(action),redo||(this._fire(command,"preExecute",action),handler.preExecute&&handler.preExecute(context),this._fire(command,"preExecuted",action)),this._atomicDo(function(){self._fire(command,"execute",action),handler.execute&&self._markDirty(handler.execute(context)),self._executedAction(action,redo),self._fire(command,"executed",action)}),redo||(this._fire(command,"postExecute",action),handler.postExecute&&handler.postExecute(context),this._fire(command,"postExecuted",action)),this._popAction(action)},CommandStack.prototype._pushAction=function(action){var execution=this._currentExecution,actions=execution.actions,baseAction=actions[0];if(execution.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+action.command+")");action.id||(action.id=baseAction&&baseAction.id||this._createId()),actions.push(action)},CommandStack.prototype._popAction=function(){var execution=this._currentExecution,actions=execution.actions,dirty=execution.dirty;actions.pop(),actions.length||(this._eventBus.fire("elements.changed",{elements:unique(dirty)}),dirty.length=0,this._fire("changed"))},CommandStack.prototype._markDirty=function(elements){var execution=this._currentExecution;elements&&(elements=isArray(elements)?elements:[elements],execution.dirty=execution.dirty.concat(elements))},CommandStack.prototype._executedAction=function(action,redo){var stackIdx=++this._stackIdx;redo||this._stack.splice(stackIdx,this._stack.length,action)},CommandStack.prototype._revertedAction=function(action){this._stackIdx--},CommandStack.prototype._getHandler=function(command){return this._handlerMap[command]},CommandStack.prototype._setHandler=function(command,handler){if(!command||!handler)throw new Error("command and handler required");if(this._handlerMap[command])throw new Error("overriding handler for command <"+command+">");this._handlerMap[command]=handler}},{"../core/EventBus":188,"lodash/array/unique":361,"lodash/lang/isArray":492,"lodash/object/assign":502}],184:[function(require,module,exports){module.exports={commandStack:["type",require("./CommandStack")]}},{"./CommandStack":183}],185:[function(require,module,exports){"use strict";function round(number,resolution){return Math.round(number*resolution)/resolution}function ensurePx(number){return isNumber(number)?number+"px":number}function createContainer(options){options=assign({},{width:"100%",height:"100%"},options);var container=options.container||document.body,parent=document.createElement("div");return parent.setAttribute("class","djs-container"),assign(parent.style,{position:"relative",overflow:"hidden",width:ensurePx(options.width),height:ensurePx(options.height)}),container.appendChild(parent),parent}function createGroup(parent,cls){var group=svgCreate("g");return svgClasses(group).add(cls),svgAppend(parent,group),group}function Canvas(config,eventBus,graphicsFactory,elementRegistry){this._eventBus=eventBus,this._elementRegistry=elementRegistry,this._graphicsFactory=graphicsFactory,this._init(config||{})}function setCTM(node,m){var mstr="matrix("+m.a+","+m.b+","+m.c+","+m.d+","+m.e+","+m.f+")";node.setAttribute("transform",mstr)}var isNumber=require("lodash/lang/isNumber"),assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),every=require("lodash/collection/every"),debounce=require("lodash/function/debounce"),Collections=require("../util/Collections"),Elements=require("../util/Elements"),svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClasses=require("tiny-svg/lib/classes"),svgCreate=require("tiny-svg/lib/create"),svgTransform=require("tiny-svg/lib/transform"),createMatrix=require("tiny-svg/lib/geometry").createMatrix,REQUIRED_MODEL_ATTRS={shape:["x","y","width","height"],connection:["waypoints"]};Canvas.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],module.exports=Canvas,Canvas.prototype._init=function(config){var eventBus=this._eventBus,container=this._container=createContainer(config),svg=this._svg=svgCreate("svg");svgAttr(svg,{width:"100%",height:"100%"}),svgAppend(container,svg);var viewport=this._viewport=createGroup(svg,"viewport");this._layers={},!1!==config.deferUpdate&&(this._viewboxChanged=debounce(this._viewboxChanged,300)),eventBus.on("diagram.init",function(){eventBus.fire("canvas.init",{svg:svg,viewport:viewport}),this.resized()},this),eventBus.on("diagram.destroy",500,this._destroy,this),eventBus.on("diagram.clear",500,this._clear,this)},Canvas.prototype._destroy=function(emit){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});var parent=this._container.parentNode;parent&&parent.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._rootElement,delete this._viewport},Canvas.prototype._clear=function(){var self=this;this._elementRegistry.getAll().forEach(function(element){var type=Elements.getType(element);"root"===type?self.setRootElement(null,!0):self._removeElement(element,type)}),delete this._cachedViewbox},Canvas.prototype.getDefaultLayer=function(){return this.getLayer("base")},Canvas.prototype.getLayer=function(name){if(!name)throw new Error("must specify a name");var layer=this._layers[name];return layer||(layer=this._layers[name]=createGroup(this._viewport,"layer-"+name)),layer},Canvas.prototype.getContainer=function(){return this._container},Canvas.prototype._updateMarker=function(element,marker,add){var container;element.id||(element=this._elementRegistry.get(element)),(container=this._elementRegistry._elements[element.id])&&(forEach([container.gfx,container.secondaryGfx],function(gfx){gfx&&(add?svgClasses(gfx).add(marker):svgClasses(gfx).remove(marker))}),this._eventBus.fire("element.marker.update",{element:element,gfx:container.gfx,marker:marker,add:!!add}))},Canvas.prototype.addMarker=function(element,marker){this._updateMarker(element,marker,!0)},Canvas.prototype.removeMarker=function(element,marker){this._updateMarker(element,marker,!1)},Canvas.prototype.hasMarker=function(element,marker){element.id||(element=this._elementRegistry.get(element));var gfx=this.getGraphics(element);return svgClasses(gfx).has(marker)},Canvas.prototype.toggleMarker=function(element,marker){this.hasMarker(element,marker)?this.removeMarker(element,marker):this.addMarker(element,marker)},Canvas.prototype.getRootElement=function(){return this._rootElement||this.setRootElement({id:"__implicitroot",children:[]}),this._rootElement},Canvas.prototype.setRootElement=function(element,override){element&&this._ensureValid("root",element);var currentRoot=this._rootElement,elementRegistry=this._elementRegistry,eventBus=this._eventBus;if(currentRoot){if(!override)throw new Error("rootElement already set, need to specify override");eventBus.fire("root.remove",{element:currentRoot}),eventBus.fire("root.removed",{element:currentRoot}),elementRegistry.remove(currentRoot)}if(element){var gfx=this.getDefaultLayer();eventBus.fire("root.add",{element:element}),elementRegistry.add(element,gfx,this._svg),eventBus.fire("root.added",{element:element,gfx:gfx})}return this._rootElement=element,element},Canvas.prototype._ensureValid=function(type,element){if(!element.id)throw new Error("element must have an id");if(this._elementRegistry.get(element.id))throw new Error("element with id "+element.id+" already exists");var requiredAttrs=REQUIRED_MODEL_ATTRS[type];if(!every(requiredAttrs,function(attr){return void 0!==element[attr]}))throw new Error("must supply { "+requiredAttrs.join(", ")+" } with "+type)},Canvas.prototype._setParent=function(element,parent,parentIndex){Collections.add(parent.children,element,parentIndex),element.parent=parent},Canvas.prototype._addElement=function(type,element,parent,parentIndex){parent=parent||this.getRootElement();var eventBus=this._eventBus,graphicsFactory=this._graphicsFactory;this._ensureValid(type,element),eventBus.fire(type+".add",{element:element,parent:parent}),this._setParent(element,parent,parentIndex);var gfx=graphicsFactory.create(type,element);return this._elementRegistry.add(element,gfx),graphicsFactory.update(type,element,gfx),eventBus.fire(type+".added",{element:element,gfx:gfx}),element},Canvas.prototype.addShape=function(shape,parent,parentIndex){return this._addElement("shape",shape,parent,parentIndex)},Canvas.prototype.addConnection=function(connection,parent,parentIndex){return this._addElement("connection",connection,parent,parentIndex)},Canvas.prototype._removeElement=function(element,type){var elementRegistry=this._elementRegistry,graphicsFactory=this._graphicsFactory,eventBus=this._eventBus;if(element=elementRegistry.get(element.id||element))return eventBus.fire(type+".remove",{element:element}),graphicsFactory.remove(element),Collections.remove(element.parent&&element.parent.children,element),element.parent=null,eventBus.fire(type+".removed",{element:element}),elementRegistry.remove(element),element},Canvas.prototype.removeShape=function(shape){return this._removeElement(shape,"shape")},Canvas.prototype.removeConnection=function(connection){return this._removeElement(connection,"connection")},Canvas.prototype.getGraphics=function(element,secondary){return this._elementRegistry.getGraphics(element,secondary)},Canvas.prototype._changeViewbox=function(changeFn){this._eventBus.fire("canvas.viewbox.changing"),changeFn.apply(this),this._cachedViewbox=null,this._viewboxChanged()},Canvas.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},Canvas.prototype.viewbox=function(box){if(void 0===box&&this._cachedViewbox)return this._cachedViewbox;var innerBox,matrix,scale,x,y,viewport=this._viewport,outerBox=this.getSize();if(!box){innerBox=this.getDefaultLayer().getBBox();var transform=svgTransform(viewport);return matrix=transform?transform.matrix:createMatrix(),scale=round(matrix.a,1e3),x=round(-matrix.e||0,1e3),y=round(-matrix.f||0,1e3),box=this._cachedViewbox={x:x?x/scale:0,y:y?y/scale:0,width:outerBox.width/scale,height:outerBox.height/scale,scale:scale,inner:{width:innerBox.width,height:innerBox.height,x:innerBox.x,y:innerBox.y},outer:outerBox}}return this._changeViewbox(function(){scale=Math.min(outerBox.width/box.width,outerBox.height/box.height);var matrix=this._svg.createSVGMatrix().scale(scale).translate(-box.x,-box.y);svgTransform(viewport,matrix)}),box},Canvas.prototype.scroll=function(delta){var node=this._viewport,matrix=node.getCTM();return delta&&this._changeViewbox(function(){delta=assign({dx:0,dy:0},delta||{}),matrix=this._svg.createSVGMatrix().translate(delta.dx,delta.dy).multiply(matrix),setCTM(node,matrix)}),{x:matrix.e,y:matrix.f}},Canvas.prototype.zoom=function(newScale,center){if(!newScale)return this.viewbox(newScale).scale;if("fit-viewport"===newScale)return this._fitViewport(center);var outer,matrix;return this._changeViewbox(function(){"object"!=typeof center&&(outer=this.viewbox().outer,center={x:outer.width/2,y:outer.height/2}),matrix=this._setZoom(newScale,center)}),round(matrix.a,1e3)},Canvas.prototype._fitViewport=function(center){var newScale,newViewbox,vbox=this.viewbox(),outer=vbox.outer,inner=vbox.inner;return inner.x>=0&&inner.y>=0&&inner.x+inner.width<=outer.width&&inner.y+inner.height<=outer.height&&!center?newViewbox={x:0,y:0,width:Math.max(inner.width+inner.x,outer.width),height:Math.max(inner.height+inner.y,outer.height)}:(newScale=Math.min(1,outer.width/inner.width,outer.height/inner.height),newViewbox={x:inner.x+(center?inner.width/2-outer.width/newScale/2:0),y:inner.y+(center?inner.height/2-outer.height/newScale/2:0),width:outer.width/newScale,height:outer.height/newScale}),this.viewbox(newViewbox),this.viewbox(!1).scale},Canvas.prototype._setZoom=function(scale,center){var centerPoint,originalPoint,currentMatrix,scaleMatrix,newMatrix,svg=this._svg,viewport=this._viewport,matrix=svg.createSVGMatrix(),point=svg.createSVGPoint();currentMatrix=viewport.getCTM();var currentScale=currentMatrix.a;return center?(centerPoint=assign(point,center),originalPoint=centerPoint.matrixTransform(currentMatrix.inverse()),scaleMatrix=matrix.translate(originalPoint.x,originalPoint.y).scale(1/currentScale*scale).translate(-originalPoint.x,-originalPoint.y),newMatrix=currentMatrix.multiply(scaleMatrix)):newMatrix=matrix.scale(scale),setCTM(this._viewport,newMatrix),newMatrix},Canvas.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Canvas.prototype.getAbsoluteBBox=function(element){var bbox,vbox=this.viewbox();if(element.waypoints){var gfx=this.getGraphics(element),transformBBox=gfx.getBBox(!0);bbox=gfx.getBBox(),bbox.x-=transformBBox.x,bbox.y-=transformBBox.y,bbox.width+=2*transformBBox.x,bbox.height+=2*transformBBox.y}else bbox=element;return{x:bbox.x*vbox.scale-vbox.x*vbox.scale,y:bbox.y*vbox.scale-vbox.y*vbox.scale,width:bbox.width*vbox.scale,height:bbox.height*vbox.scale}},Canvas.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")}},{"../util/Collections":326,"../util/Elements":329,"lodash/collection/every":366,"lodash/collection/forEach":369,"lodash/function/debounce":381,"lodash/lang/isNumber":496,"lodash/object/assign":502,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/create":552,"tiny-svg/lib/geometry":553,"tiny-svg/lib/transform":556}],186:[function(require,module,exports){"use strict";function ElementFactory(){this._uid=12}var Model=require("../model"),assign=require("lodash/object/assign");module.exports=ElementFactory,ElementFactory.prototype.createRoot=function(attrs){return this.create("root",attrs)},ElementFactory.prototype.createLabel=function(attrs){return this.create("label",attrs)},ElementFactory.prototype.createShape=function(attrs){return this.create("shape",attrs)},ElementFactory.prototype.createConnection=function(attrs){return this.create("connection",attrs)},ElementFactory.prototype.create=function(type,attrs){return attrs=assign({},attrs||{}),attrs.id||(attrs.id=type+"_"+this._uid++),Model.create(type,attrs)}},{"../model":317,"lodash/object/assign":502}],187:[function(require,module,exports){"use strict";function ElementRegistry(){this._elements={}}var ELEMENT_ID="data-element-id",svgAttr=require("tiny-svg/lib/attr");module.exports=ElementRegistry,ElementRegistry.prototype.add=function(element,gfx,secondaryGfx){var id=element.id;this._validateId(id),svgAttr(gfx,ELEMENT_ID,id),secondaryGfx&&svgAttr(secondaryGfx,ELEMENT_ID,id),this._elements[id]={element:element,gfx:gfx,secondaryGfx:secondaryGfx}},ElementRegistry.prototype.remove=function(element){var elements=this._elements,id=element.id||element,container=id&&elements[id];container&&(svgAttr(container.gfx,ELEMENT_ID,""),container.secondaryGfx&&svgAttr(container.secondaryGfx,ELEMENT_ID,""),delete elements[id])},ElementRegistry.prototype.updateId=function(element,newId){this._validateId(newId),"string"==typeof element&&(element=this.get(element));var gfx=this.getGraphics(element),secondaryGfx=this.getGraphics(element,!0);this.remove(element),element.id=newId,this.add(element,gfx,secondaryGfx)},ElementRegistry.prototype.get=function(filter){var id;id="string"==typeof filter?filter:filter&&svgAttr(filter,ELEMENT_ID);var container=this._elements[id];return container&&container.element},ElementRegistry.prototype.filter=function(fn){var filtered=[];return this.forEach(function(element,gfx){fn(element,gfx)&&filtered.push(element)}),filtered},ElementRegistry.prototype.getAll=function(){return this.filter(function(e){return e})},ElementRegistry.prototype.forEach=function(fn){var map=this._elements;Object.keys(map).forEach(function(id){var container=map[id],element=container.element,gfx=container.gfx;return fn(element,gfx)})},ElementRegistry.prototype.getGraphics=function(filter,secondary){var id=filter.id||filter,container=this._elements[id];return container&&(secondary?container.secondaryGfx:container.gfx)},ElementRegistry.prototype._validateId=function(id){if(!id)throw new Error("element must have an id");if(this._elements[id])throw new Error("element with id "+id+" already added")}},{"tiny-svg/lib/attr":548}],188:[function(require,module,exports){"use strict";function EventBus(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function Event(){}function invokeFunction(fn,args){return fn.apply(null,args)}var isFunction=require("lodash/lang/isFunction"),isArray=require("lodash/lang/isArray"),isNumber=require("lodash/lang/isNumber"),bind=require("lodash/function/bind"),assign=require("lodash/object/assign"),slice=Array.prototype.slice;module.exports=EventBus,EventBus.prototype.on=function(events,priority,callback,that){if(events=isArray(events)?events:[events],isFunction(priority)&&(that=callback,callback=priority,priority=1e3),!isNumber(priority))throw new Error("priority must be a number");var actualCallback=callback;that&&(actualCallback=bind(callback,that),actualCallback.__fn=callback.__fn||callback);var self=this,listener={priority:priority,callback:actualCallback};events.forEach(function(e){self._addListener(e,listener)})},EventBus.prototype.once=function(event,priority,callback,that){function wrappedCallback(){return self.off(event,wrappedCallback),callback.apply(that,arguments)}var self=this;if(isFunction(priority)&&(that=callback,callback=priority,priority=1e3),!isNumber(priority))throw new Error("priority must be a number");wrappedCallback.__fn=callback,this.on(event,priority,wrappedCallback)},EventBus.prototype.off=function(event,callback){var listener,listenerCallback,idx,listeners=this._getListeners(event);if(callback)for(idx=listeners.length-1;listener=listeners[idx];idx--)(listenerCallback=listener.callback)!==callback&&listenerCallback.__fn!==callback||listeners.splice(idx,1);else listeners.length=0},EventBus.prototype.fire=function(type,data){var event,listeners,returnValue,args;if(args=slice.call(arguments),"object"==typeof type&&(event=type,type=event.type),!type)throw new Error("no event type specified");if(listeners=this._listeners[type]){data instanceof Event?event=data:(event=new Event,event.init(data)),args[0]=event;var originalType=event.type;type!==originalType&&(event.type=type);try{returnValue=this._invokeListeners(event,args,listeners)}finally{type!==originalType&&(event.type=originalType)}return void 0===returnValue&&event.defaultPrevented&&(returnValue=!1),returnValue}},EventBus.prototype.handleError=function(error){return!1===this.fire("error",{error:error})},EventBus.prototype._destroy=function(){this._listeners={}},EventBus.prototype._invokeListeners=function(event,args,listeners){var idx,listener,returnValue;for(idx=0;(listener=listeners[idx])&&!event.cancelBubble;idx++)returnValue=this._invokeListener(event,args,listener);return returnValue},EventBus.prototype._invokeListener=function(event,args,listener){var returnValue;try{returnValue=invokeFunction(listener.callback,args),void 0!==returnValue&&(event.returnValue=returnValue,event.stopPropagation()),!1===returnValue&&event.preventDefault()}catch(e){if(!this.handleError(e))throw console.error("unhandled error in event listener"),console.error(e.stack),e}return returnValue},EventBus.prototype._addListener=function(event,newListener){var existingListener,idx,listeners=this._getListeners(event);for(idx=0;existingListener=listeners[idx];idx++)if(existingListener.priority<newListener.priority)return void listeners.splice(idx,0,newListener);listeners.push(newListener)},EventBus.prototype._getListeners=function(name){var listeners=this._listeners[name];return listeners||(this._listeners[name]=listeners=[]),listeners},module.exports.Event=Event,Event.prototype.stopPropagation=function(){this.cancelBubble=!0},Event.prototype.preventDefault=function(){this.defaultPrevented=!0},Event.prototype.init=function(data){assign(this,data||{})}},{"lodash/function/bind":380,"lodash/lang/isArray":492,"lodash/lang/isFunction":494,"lodash/lang/isNumber":496,"lodash/object/assign":502}],189:[function(require,module,exports){"use strict";function GraphicsFactory(eventBus,elementRegistry){this._eventBus=eventBus,this._elementRegistry=elementRegistry}function prependTo(newNode,parentNode){parentNode.insertBefore(newNode,parentNode.firstChild)}var forEach=require("lodash/collection/forEach"),reduce=require("lodash/collection/reduce"),GraphicsUtil=require("../util/GraphicsUtil"),translate=require("../util/SvgTransformUtil").translate,domClear=require("min-dom/lib/clear"),svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClasses=require("tiny-svg/lib/classes"),svgCreate=require("tiny-svg/lib/create"),svgRemove=require("tiny-svg/lib/remove");GraphicsFactory.$inject=["eventBus","elementRegistry"],module.exports=GraphicsFactory,GraphicsFactory.prototype._getChildren=function(element){var childrenGfx,gfx=this._elementRegistry.getGraphics(element);return element.parent?(childrenGfx=GraphicsUtil.getChildren(gfx))||(childrenGfx=svgCreate("g"),svgClasses(childrenGfx).add("djs-children"),svgAppend(gfx.parentNode,childrenGfx)):childrenGfx=gfx,childrenGfx},GraphicsFactory.prototype._clear=function(gfx){
var visual=GraphicsUtil.getVisual(gfx);return domClear(visual),visual},GraphicsFactory.prototype._createContainer=function(type,parentGfx){var outerGfx=svgCreate("g");svgClasses(outerGfx).add("djs-group"),svgAppend(parentGfx,outerGfx);var gfx=svgCreate("g");svgClasses(gfx).add("djs-element"),svgClasses(gfx).add("djs-"+type),svgAppend(outerGfx,gfx);var visual=svgCreate("g");return svgClasses(visual).add("djs-visual"),svgAppend(gfx,visual),gfx},GraphicsFactory.prototype.create=function(type,element){var childrenGfx=this._getChildren(element.parent);return this._createContainer(type,childrenGfx)},GraphicsFactory.prototype.updateContainments=function(elements){var parents,self=this,elementRegistry=this._elementRegistry;parents=reduce(elements,function(map,e){return e.parent&&(map[e.parent.id]=e.parent),map},{}),forEach(parents,function(parent){var childGfx=self._getChildren(parent),children=parent.children;children&&forEach(children.slice().reverse(),function(c){prependTo(elementRegistry.getGraphics(c).parentNode,childGfx)})})},GraphicsFactory.prototype.drawShape=function(visual,element){return this._eventBus.fire("render.shape",{gfx:visual,element:element})},GraphicsFactory.prototype.getShapePath=function(element){return this._eventBus.fire("render.getShapePath",element)},GraphicsFactory.prototype.drawConnection=function(visual,element){return this._eventBus.fire("render.connection",{gfx:visual,element:element})},GraphicsFactory.prototype.getConnectionPath=function(waypoints){return this._eventBus.fire("render.getConnectionPath",waypoints)},GraphicsFactory.prototype.update=function(type,element,gfx){if(element.parent){var visual=this._clear(gfx);if("shape"===type)this.drawShape(visual,element),translate(gfx,element.x,element.y);else{if("connection"!==type)throw new Error("unknown type: "+type);this.drawConnection(visual,element)}element.hidden?svgAttr(gfx,"display","none"):svgAttr(gfx,"display","block")}},GraphicsFactory.prototype.remove=function(element){var gfx=this._elementRegistry.getGraphics(element);svgRemove(gfx.parentNode)}},{"../util/GraphicsUtil":332,"../util/SvgTransformUtil":342,"lodash/collection/forEach":369,"lodash/collection/reduce":374,"min-dom/lib/clear":519,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/create":552,"tiny-svg/lib/remove":555}],190:[function(require,module,exports){module.exports={__depends__:[require("../draw")],__init__:["canvas"],canvas:["type",require("./Canvas")],elementRegistry:["type",require("./ElementRegistry")],elementFactory:["type",require("./ElementFactory")],eventBus:["type",require("./EventBus")],graphicsFactory:["type",require("./GraphicsFactory")]}},{"../draw":194,"./Canvas":185,"./ElementFactory":186,"./ElementRegistry":187,"./EventBus":188,"./GraphicsFactory":189}],191:[function(require,module,exports){"use strict";function BaseRenderer(eventBus,renderPriority){var self=this;renderPriority=renderPriority||DEFAULT_RENDER_PRIORITY,eventBus.on(["render.shape","render.connection"],renderPriority,function(evt,context){var type=evt.type,element=context.element,visuals=context.gfx;if(self.canRender(element))return"render.shape"===type?self.drawShape(visuals,element):self.drawConnection(visuals,element)}),eventBus.on(["render.getShapePath","render.getConnectionPath"],renderPriority,function(evt,element){if(self.canRender(element))return"render.getShapePath"===evt.type?self.getShapePath(element):self.getConnectionPath(element)})}var DEFAULT_RENDER_PRIORITY=1e3;BaseRenderer.prototype.canRender=function(){},BaseRenderer.prototype.drawShape=function(){},BaseRenderer.prototype.drawConnection=function(){},BaseRenderer.prototype.getShapePath=function(){},BaseRenderer.prototype.getConnectionPath=function(){},module.exports=BaseRenderer},{}],192:[function(require,module,exports){"use strict";function DefaultRenderer(eventBus,styles){BaseRenderer.call(this,eventBus,DEFAULT_RENDER_PRIORITY),this.CONNECTION_STYLE=styles.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=styles.style({fill:"white",stroke:"fuchsia",strokeWidth:2})}var inherits=require("inherits"),BaseRenderer=require("./BaseRenderer"),renderUtil=require("../util/RenderUtil"),componentsToPath=renderUtil.componentsToPath,createLine=renderUtil.createLine,svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create"),DEFAULT_RENDER_PRIORITY=1;inherits(DefaultRenderer,BaseRenderer),DefaultRenderer.prototype.canRender=function(){return!0},DefaultRenderer.prototype.drawShape=function(visuals,element){var rect=svgCreate("rect");return svgAttr(rect,{x:0,y:0,width:element.width||0,height:element.height||0}),svgAttr(rect,this.SHAPE_STYLE),svgAppend(visuals,rect),rect},DefaultRenderer.prototype.drawConnection=function(visuals,connection){var line=createLine(connection.waypoints,this.CONNECTION_STYLE);return svgAppend(visuals,line),line},DefaultRenderer.prototype.getShapePath=function(shape){var x=shape.x,y=shape.y,width=shape.width,height=shape.height;return componentsToPath([["M",x,y],["l",width,0],["l",0,height],["l",-width,0],["z"]])},DefaultRenderer.prototype.getConnectionPath=function(connection){var idx,point,waypoints=connection.waypoints,connectionPath=[];for(idx=0;point=waypoints[idx];idx++)point=point.original||point,connectionPath.push([0===idx?"M":"L",point.x,point.y]);return componentsToPath(connectionPath)},DefaultRenderer.$inject=["eventBus","styles"],module.exports=DefaultRenderer},{"../util/RenderUtil":341,"./BaseRenderer":191,inherits:354,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/create":552}],193:[function(require,module,exports){"use strict";function Styles(){var defaultTraits={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},self=this;this.cls=function(className,traits,additionalAttrs){var attrs=this.style(traits,additionalAttrs);return assign(attrs,{class:className})},this.style=function(traits,additionalAttrs){isArray(traits)||additionalAttrs||(additionalAttrs=traits,traits=[]);var attrs=reduce(traits,function(attrs,t){return assign(attrs,defaultTraits[t]||{})},{});return additionalAttrs?assign(attrs,additionalAttrs):attrs},this.computeStyle=function(custom,traits,defaultStyles){return isArray(traits)||(defaultStyles=traits,traits=[]),self.style(traits||[],assign({},defaultStyles,custom||{}))}}var isArray=require("lodash/lang/isArray"),assign=require("lodash/object/assign"),reduce=require("lodash/collection/reduce");module.exports=Styles},{"lodash/collection/reduce":374,"lodash/lang/isArray":492,"lodash/object/assign":502}],194:[function(require,module,exports){module.exports={__init__:["defaultRenderer"],defaultRenderer:["type",require("./DefaultRenderer")],styles:["type",require("./Styles")]}},{"./DefaultRenderer":192,"./Styles":193}],195:[function(require,module,exports){"use strict";function last(arr){return arr&&arr[arr.length-1]}function sortTopOrMiddle(element){return element.y}function sortLeftOrCenter(element){return element.x}function AlignElements(modeling){this._modeling=modeling}var filter=require("lodash/collection/filter"),forEach=require("lodash/collection/forEach"),sortBy=require("lodash/collection/sortBy"),ALIGNMENT_SORTING={left:sortLeftOrCenter,center:sortLeftOrCenter,right:function(element){return element.x+element.width},top:sortTopOrMiddle,middle:sortTopOrMiddle,bottom:function(element){return element.y+element.height}};module.exports=AlignElements,AlignElements.$inject=["modeling"],AlignElements.prototype._getOrientationDetails=function(type){var vertical=["top","bottom","middle"],axis="x",dimension="width";return-1!==vertical.indexOf(type)&&(axis="y",dimension="height"),{axis:axis,dimension:dimension}},AlignElements.prototype._isType=function(type,types){return-1!==types.indexOf(type)},AlignElements.prototype._alignmentPosition=function(type,sortedElements){var centeredElements,firstElement,lastElement,orientation=this._getOrientationDetails(type),axis=orientation.axis,dimension=orientation.dimension,alignment={},centers={},hasSharedCenters=!1;if(this._isType(type,["left","top"]))alignment[type]=sortedElements[0][axis];else if(this._isType(type,["right","bottom"]))lastElement=last(sortedElements),alignment[type]=lastElement[axis]+lastElement[dimension];else if(this._isType(type,["center","middle"])){if(forEach(sortedElements,function(element){var center=element[axis]+Math.round(element[dimension]/2);centers[center]?centers[center].elements.push(element):centers[center]={elements:[element],center:center}}),centeredElements=sortBy(centers,function(center){return center.elements.length>1&&(hasSharedCenters=!0),center.elements.length}),hasSharedCenters)return alignment[type]=last(centeredElements).center,alignment;firstElement=sortedElements[0],sortedElements=sortBy(sortedElements,function(element){return element[axis]+element[dimension]}),lastElement=last(sortedElements),alignment[type]=function(first,last){return Math.round((first[axis]+last[axis]+last[dimension])/2)}(firstElement,lastElement)}return alignment},AlignElements.prototype.trigger=function(elements,type){var modeling=this._modeling,filteredElements=filter(elements,function(element){return!(element.waypoints||element.host||element.labelTarget)}),sortFn=ALIGNMENT_SORTING[type],sortedElements=sortBy(filteredElements,sortFn),alignment=this._alignmentPosition(type,sortedElements);modeling.alignElements(sortedElements,alignment)}},{"lodash/collection/filter":367,"lodash/collection/forEach":369,"lodash/collection/sortBy":378}],196:[function(require,module,exports){"use strict";module.exports={__init__:["alignElements"],alignElements:["type",require("./AlignElements")]}},{"./AlignElements":195}],197:[function(require,module,exports){"use strict";function AttachSupport(eventBus,modeling,movePreview,rules){CommandInterceptor.call(this,eventBus),eventBus.on("shape.move.start",HIGH_PRIORITY,function(e){var context=e.context,shapes=context.shapes,validatedShapes=context.validatedShapes;context.shapes=addAttached(shapes),context.validatedShapes=removeAttached(validatedShapes)}),this.postExecuted(["elements.move"],function(event){var context=event.context,delta=context.delta,newParent=context.newParent,closure=context.closure,enclosedElements=closure.enclosedElements,attachers=getAttachers(enclosedElements);forEach(attachers,function(attacher){enclosedElements[attacher.id]||modeling.moveShape(attacher,delta,newParent)})}),this.postExecuted(["elements.move"],function(e){var attachers,context=e.context,shapes=context.shapes,newHost=context.newHost;shapes.length>1||(attachers=newHost?shapes:filter(shapes,function(s){return!!s.host}),forEach(attachers,function(attacher){modeling.updateAttachment(attacher,newHost)}))}),this.postExecuted(["elements.move"],function(e){var shapes=e.context.shapes;forEach(shapes,function(shape){forEach(shape.attachers,function(attacher){forEach(attacher.outgoing.slice(),function(connection){rules.allowed("connection.reconnectStart",{connection:connection,source:connection.source,target:connection.target})||modeling.removeConnection(connection)}),forEach(attacher.incoming.slice(),function(connection){rules.allowed("connection.reconnectEnd",{connection:connection,source:connection.source,target:connection.target})||modeling.removeConnection(connection)})})})}),this.postExecute(["shape.create"],function(e){var context=e.context,shape=context.shape,host=context.host;host&&modeling.updateAttachment(shape,host)}),this.postExecute(["shape.replace"],function(e){var context=e.context,oldShape=context.oldShape,newShape=context.newShape;saveClear(oldShape.attachers,function(attacher){"attach"===rules.allowed("elements.move",{target:newShape,shapes:[attacher]})?modeling.updateAttachment(attacher,newShape):modeling.removeShape(attacher)}),newShape.attachers.length&&forEach(newShape.attachers,function(attacher){var delta=getNewAttachShapeDelta(attacher,oldShape,newShape);modeling.moveShape(attacher,delta,attacher.parent)})}),this.postExecute(["shape.resize"],function(event){var context=event.context,shape=context.shape,oldBounds=context.oldBounds,newBounds=context.newBounds,attachers=shape.attachers;attachers.length&&forEach(attachers,function(attacher){var delta=getNewAttachShapeDelta(attacher,oldBounds,newBounds);modeling.moveShape(attacher,delta,attacher.parent),attacher.label&&modeling.moveShape(attacher.label,delta,attacher.label.parent)})}),this.preExecute(["shape.delete"],function(event){var shape=event.context.shape;saveClear(shape.attachers,function(attacher){modeling.removeShape(attacher)}),shape.host&&modeling.updateAttachment(shape,null)}),eventBus.on("spaceTool.move",function(event){var movingShapes=event.context.movingShapes,movingAttachers=filter(movingShapes,function(shape){return shape.host&&shape.host.id});forEach(movingAttachers,function(shape){Collections.remove(movingShapes,shape),shape.label&&Collections.remove(movingShapes,shape.label)})})}function getAttachers(shapes){return flatten(map(shapes,function(s){return s.attachers||[]}))}function addAttached(elements){var attachers=getAttachers(elements);return union(elements,attachers)}function removeAttached(elements){var ids=groupBy(elements,"id");return filter(elements,function(element){for(;element;){if(element.host&&ids[element.host.id])return!1;element=element.parent}return!0})}var forEach=require("lodash/collection/forEach"),flatten=require("lodash/array/flatten"),union=require("lodash/array/union"),filter=require("lodash/collection/filter"),groupBy=require("lodash/collection/groupBy"),map=require("lodash/collection/map"),saveClear=require("../../util/Removal").saveClear,Collections=require("../../util/Collections"),getNewAttachShapeDelta=require("../../util/AttachUtil").getNewAttachShapeDelta,inherits=require("inherits"),HIGH_PRIORITY=1500,CommandInterceptor=require("../../command/CommandInterceptor");inherits(AttachSupport,CommandInterceptor),AttachSupport.$inject=["eventBus","modeling","movePreview","rules"],module.exports=AttachSupport},{"../../command/CommandInterceptor":182,"../../util/AttachUtil":324,"../../util/Collections":326,"../../util/Removal":340,inherits:354,"lodash/array/flatten":356,"lodash/array/union":359,"lodash/collection/filter":367,"lodash/collection/forEach":369,"lodash/collection/groupBy":370,"lodash/collection/map":373}],198:[function(require,module,exports){module.exports={__depends__:[require("../move"),require("../label-support")],__init__:["attachSupport"],attachSupport:["type",require("./AttachSupport")]}},{"../label-support":237,"../move":269,"./AttachSupport":197}],199:[function(require,module,exports){"use strict";function AutoResize(eventBus,elementRegistry,modeling,rules){CommandInterceptor.call(this,eventBus),this._elementRegistry=elementRegistry,this._modeling=modeling,this._rules=rules;var self=this;this.postExecuted(["shape.create"],function(event){var context=event.context,hints=context.hints,shape=context.shape,parent=context.parent||context.newParent;hints&&!1===hints.root||self._expand([shape],parent)}),this.postExecuted(["elements.move"],function(event){var context=event.context,elements=flatten(values(context.closure.topLevel)),hints=context.hints;if(!hints||!1!==hints.autoResize){var expandings=groupBy(elements,function(element){return element.parent.id});forEach(expandings,function(elements,parentId){self._expand(elements,parentId)})}})}var inherits=require("inherits"),getBoundingBox=require("../../util/Elements").getBBox,asTRBL=require("../../layout/LayoutUtil").asTRBL,asBounds=require("../../layout/LayoutUtil").asBounds,assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),values=require("lodash/object/values"),flatten=require("lodash/array/flatten"),groupBy=require("lodash/collection/groupBy"),CommandInterceptor=require("../../command/CommandInterceptor");AutoResize.$inject=["eventBus","elementRegistry","modeling","rules"],inherits(AutoResize,CommandInterceptor),module.exports=AutoResize,AutoResize.prototype._getOptimalBounds=function(elements,target){var offset=this.getOffset(target),padding=this.getPadding(target),elementsTrbl=asTRBL(getBoundingBox(elements)),targetTrbl=asTRBL(target),newTrbl={};return elementsTrbl.top-targetTrbl.top<padding.top&&(newTrbl.top=elementsTrbl.top-offset.top),elementsTrbl.left-targetTrbl.left<padding.left&&(newTrbl.left=elementsTrbl.left-offset.left),targetTrbl.right-elementsTrbl.right<padding.right&&(newTrbl.right=elementsTrbl.right+offset.right),targetTrbl.bottom-elementsTrbl.bottom<padding.bottom&&(newTrbl.bottom=elementsTrbl.bottom+offset.bottom),asBounds(assign({},targetTrbl,newTrbl))},AutoResize.prototype._expand=function(elements,target){if("string"==typeof target&&(target=this._elementRegistry.get(target)),this._rules.allowed("element.autoResize",{elements:elements,target:target})){var newBounds=this._getOptimalBounds(elements,target);this.resize(target,newBounds);var parent=target.parent;parent&&this._expand([target],parent)}},AutoResize.prototype.getOffset=function(shape){return{top:60,bottom:60,left:100,right:100}},AutoResize.prototype.getPadding=function(shape){return{top:2,bottom:2,left:15,right:15}},AutoResize.prototype.resize=function(target,newBounds){this._modeling.resizeShape(target,newBounds)}},{"../../command/CommandInterceptor":182,"../../layout/LayoutUtil":315,"../../util/Elements":329,inherits:354,"lodash/array/flatten":356,"lodash/collection/forEach":369,"lodash/collection/groupBy":370,"lodash/object/assign":502,"lodash/object/values":513}],200:[function(require,module,exports){function AutoResizeProvider(eventBus){RuleProvider.call(this,eventBus);var self=this;this.addRule("element.autoResize",function(context){return self.canResize(context.elements,context.target)})}var RuleProvider=require("../rules/RuleProvider"),inherits=require("inherits");AutoResizeProvider.$inject=["eventBus"],inherits(AutoResizeProvider,RuleProvider),module.exports=AutoResizeProvider,AutoResizeProvider.prototype.canResize=function(elements,target){return!1}},{"../rules/RuleProvider":288,inherits:354}],201:[function(require,module,exports){"use strict";function AutoScroll(config,eventBus,canvas,mouseTracking){this._canvas=canvas,this._mouseTracking=mouseTracking,this._opts=assign({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},config);var self=this;eventBus.on("drag.move",function(e){var point=self._toBorderPoint(e);self.startScroll(point)}),eventBus.on(["drag.cleanup"],function(){self.stopScroll()})}function between(val,start,end){return start<val&&val<end}var assign=require("lodash/object/assign"),EventUtil=require("../../util/Event");AutoScroll.$inject=["config.autoScroll","eventBus","canvas","mouseTracking"],module.exports=AutoScroll,AutoScroll.prototype.startScroll=function(point){var canvas=this._canvas,opts=this._opts,self=this,clientRect=canvas.getContainer().getBoundingClientRect(),diff=[point.x,point.y,clientRect.width-point.x,clientRect.height-point.y];this.stopScroll();for(var dx=0,dy=0,i=0;i<4;i++)between(diff[i],opts.scrollThresholdOut[i],opts.scrollThresholdIn[i])&&(0===i?dx=opts.scrollStep:1==i?dy=opts.scrollStep:2==i?dx=-opts.scrollStep:3==i&&(dy=-opts.scrollStep));0===dx&&0===dy||(canvas.scroll({dx:dx,dy:dy}),this._scrolling=setTimeout(function(){self.startScroll(point)},opts.scrollRepeatTimeout))},AutoScroll.prototype.stopScroll=function(){clearTimeout(this._scrolling)},AutoScroll.prototype.setOptions=function(options){this._opts=assign({},this._opts,options)},AutoScroll.prototype._toBorderPoint=function(event){var clientRect=this._canvas._container.getBoundingClientRect(),globalPosition=EventUtil.toPoint(event.originalEvent);return{x:globalPosition.x-clientRect.left,y:globalPosition.y-clientRect.top}}},{"../../util/Event":330,"lodash/object/assign":502}],202:[function(require,module,exports){module.exports={__depends__:[require("../dragging"),require("../mouse-tracking")],__init__:["autoScroll"],autoScroll:["type",require("./AutoScroll")]}},{"../dragging":225,"../mouse-tracking":266,"./AutoScroll":201}],203:[function(require,module,exports){"use strict";function BendpointMove(injector,eventBus,canvas,dragging,graphicsFactory,rules,modeling){function redrawConnection(data){graphicsFactory.update("connection",data.connection,data.connectionGfx)}function filterRedundantWaypoints(waypoints){waypoints=waypoints.slice();for(var point,previousPoint,nextPoint,idx=0;waypoints[idx];)point=waypoints[idx],previousPoint=waypoints[idx-1],nextPoint=waypoints[idx+1],0===Geometry.pointDistance(point,nextPoint)||Geometry.pointsOnLine(previousPoint,nextPoint,point)?waypoints.splice(idx,1):idx++;return waypoints}var connectionDocking=injector.get("connectionDocking",!1);this.start=function(event,connection,bendpointIndex,insert){var type,context,waypoints=connection.waypoints,gfx=canvas.getGraphics(connection);type=insert||0!==bendpointIndex?insert||bendpointIndex!==waypoints.length-1?COMMAND_BENDPOINT_UPDATE:COMMAND_RECONNECT_END:COMMAND_RECONNECT_START,context={connection:connection,bendpointIndex:bendpointIndex,insert:insert,type:type},dragging.init(event,"bendpoint.move",{data:{connection:connection,connectionGfx:gfx,context:context}})},eventBus.on("bendpoint.move.start",function(e){var context=e.context,connection=context.connection,originalWaypoints=connection.waypoints,waypoints=originalWaypoints.slice(),insert=context.insert,idx=context.bendpointIndex;context.originalWaypoints=originalWaypoints,insert&&waypoints.splice(idx,0,null),connection.waypoints=waypoints,context.draggerGfx=BendpointUtil.addBendpoint(canvas.getLayer("overlays")),svgClasses(context.draggerGfx).add("djs-dragging"),canvas.addMarker(connection,MARKER_CONNECT_UPDATING)}),eventBus.on("bendpoint.move.hover",function(e){e.context.hover=e.hover,canvas.addMarker(e.hover,MARKER_CONNECT_HOVER)}),eventBus.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(e){var hover=e.context.hover;hover&&(canvas.removeMarker(hover,MARKER_CONNECT_HOVER),canvas.removeMarker(hover,e.context.target?MARKER_OK:MARKER_NOT_OK))}),eventBus.on("bendpoint.move.move",function(e){var source,target,context=e.context,moveType=context.type,connection=e.connection;connection.waypoints[context.bendpointIndex]={x:e.x,y:e.y},connectionDocking&&(context.hover&&(moveType===COMMAND_RECONNECT_START&&(source=context.hover),moveType===COMMAND_RECONNECT_END&&(target=context.hover)),connection.waypoints=connectionDocking.getCroppedWaypoints(connection,source,target));var allowed=context.allowed=rules.allowed(context.type,context);allowed?context.hover&&(canvas.removeMarker(context.hover,MARKER_NOT_OK),canvas.addMarker(context.hover,MARKER_OK),context.target=context.hover):!1===allowed&&context.hover&&(canvas.removeMarker(context.hover,MARKER_OK),canvas.addMarker(context.hover,MARKER_NOT_OK),context.target=null),translate(context.draggerGfx,e.x,e.y),redrawConnection(e)}),eventBus.on(["bendpoint.move.end","bendpoint.move.cancel"],function(e){var context=e.context,hover=context.hover,connection=context.connection;svgRemove(context.draggerGfx),context.newWaypoints=connection.waypoints.slice(),connection.waypoints=context.originalWaypoints,canvas.removeMarker(connection,MARKER_CONNECT_UPDATING),hover&&(canvas.removeMarker(hover,MARKER_OK),canvas.removeMarker(hover,MARKER_NOT_OK))}),eventBus.on("bendpoint.move.end",function(e){var hints,context=e.context,waypoints=context.newWaypoints,bendpointIndex=context.bendpointIndex,bendpoint=waypoints[bendpointIndex],allowed=context.allowed;if(bendpoint.x=round(bendpoint.x),bendpoint.y=round(bendpoint.y),allowed&&context.type===COMMAND_RECONNECT_START)modeling.reconnectStart(context.connection,context.target,bendpoint);else if(allowed&&context.type===COMMAND_RECONNECT_END)modeling.reconnectEnd(context.connection,context.target,bendpoint);else{if(!1===allowed||context.type!==COMMAND_BENDPOINT_UPDATE)return redrawConnection(e),!1;hints={bendpointMove:{insert:e.context.insert,bendpointIndex:bendpointIndex}},modeling.updateWaypoints(context.connection,filterRedundantWaypoints(waypoints),hints)}}),eventBus.on("bendpoint.move.cancel",function(e){redrawConnection(e)})}var Geometry=require("../../util/Geometry"),BendpointUtil=require("./BendpointUtil"),MARKER_OK="connect-ok",MARKER_NOT_OK="connect-not-ok",MARKER_CONNECT_HOVER="connect-hover",MARKER_CONNECT_UPDATING="djs-updating",COMMAND_BENDPOINT_UPDATE="connection.updateWaypoints",COMMAND_RECONNECT_START="connection.reconnectStart",COMMAND_RECONNECT_END="connection.reconnectEnd",round=Math.round,svgClasses=require("tiny-svg/lib/classes"),svgRemove=require("tiny-svg/lib/remove"),translate=require("../../util/SvgTransformUtil").translate;BendpointMove.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","rules","modeling"],module.exports=BendpointMove},{"../../util/Geometry":331,"../../util/SvgTransformUtil":342,"./BendpointUtil":205,"tiny-svg/lib/classes":549,"tiny-svg/lib/remove":555}],204:[function(require,module,exports){"use strict";function BendpointSnapping(eventBus){function snapTo(values,value){if(isArray(values)){for(var i=values.length;i--;)if(abs(values[i]-value)<=TOLERANCE)return values[i]}else{values=+values;var rem=value%values;if(rem<TOLERANCE)return value-rem;if(rem>values-TOLERANCE)return value-rem+values}return value}function mid(element){if(element.width)return{x:round(element.width/2+element.x),y:round(element.height/2+element.y)}}function getConnectionSegmentSnaps(context){var snapPoints=context.snapPoints,connection=context.connection,waypoints=connection.waypoints,segmentStart=context.segmentStart,segmentStartIndex=context.segmentStartIndex,segmentEnd=context.segmentEnd,segmentEndIndex=context.segmentEndIndex,axis=context.axis;if(snapPoints)return snapPoints;var referenceWaypoints=[waypoints[segmentStartIndex-1],segmentStart,segmentEnd,waypoints[segmentEndIndex+1]];return segmentStartIndex<2&&referenceWaypoints.unshift(mid(connection.source)),segmentEndIndex>waypoints.length-3&&referenceWaypoints.unshift(mid(connection.target)),context.snapPoints=snapPoints={horizontal:[],vertical:[]},forEach(referenceWaypoints,function(p){p&&(p=p.original||p,"y"===axis&&snapPoints.horizontal.push(p.y),"x"===axis&&snapPoints.vertical.push(p.x))}),snapPoints}function getBendpointSnaps(context){var snapPoints=context.snapPoints,waypoints=context.connection.waypoints,bendpointIndex=context.bendpointIndex;if(snapPoints)return snapPoints;var referenceWaypoints=[waypoints[bendpointIndex-1],waypoints[bendpointIndex+1]];return context.snapPoints=snapPoints={horizontal:[],vertical:[]},forEach(referenceWaypoints,function(p){p&&(p=p.original||p,snapPoints.horizontal.push(p.y),snapPoints.vertical.push(p.x))}),snapPoints}eventBus.on("connectionSegment.move.move",1500,function(event){var sx,sy,context=event.context,snapPoints=getConnectionSegmentSnaps(context),x=event.x,y=event.y;if(snapPoints){sx=snapTo(snapPoints.vertical,x),sy=snapTo(snapPoints.horizontal,y);var cx=x-sx,cy=y-sy;assign(event,{dx:event.dx-cx,dy:event.dy-cy,x:sx,y:sy})}}),eventBus.on("bendpoint.move.move",1500,function(event){var sx,sy,context=event.context,snapPoints=getBendpointSnaps(context),target=context.target,targetMid=target&&mid(target),x=event.x,y=event.y;if(snapPoints){sx=snapTo(targetMid?snapPoints.vertical.concat([targetMid.x]):snapPoints.vertical,x),sy=snapTo(targetMid?snapPoints.horizontal.concat([targetMid.y]):snapPoints.horizontal,y);var cx=x-sx,cy=y-sy;assign(event,{dx:event.dx-cx,dy:event.dy-cy,x:event.x-cx,y:event.y-cy})}})}var assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),isArray=require("lodash/lang/isArray"),abs=Math.abs,round=Math.round,TOLERANCE=10;BendpointSnapping.$inject=["eventBus"],module.exports=BendpointSnapping},{"lodash/collection/forEach":369,"lodash/lang/isArray":492,"lodash/object/assign":502}],205:[function(require,module,exports){"use strict";function createParallelDragger(parentGfx,position,alignment){var draggerGfx=svgCreate("g");svgAppend(parentGfx,draggerGfx);var visual=svgCreate("rect");svgAttr(visual,{x:-7,y:-1.5,width:14,height:3}),svgClasses(visual).add("djs-visual"),svgAppend(draggerGfx,visual);var hit=svgCreate("rect");return svgAttr(hit,{x:-10,y:-4.5,width:20,height:9}),svgClasses(hit).add("djs-hit"),svgAppend(draggerGfx,hit),rotate(draggerGfx,"h"===alignment?90:0,0,0),draggerGfx}var Events=require("../../util/Event"),Geometry=require("../../util/Geometry"),BENDPOINT_CLS=module.exports.BENDPOINT_CLS="djs-bendpoint",SEGMENT_DRAGGER_CLS=module.exports.SEGMENT_DRAGGER_CLS="djs-segment-dragger",svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClasses=require("tiny-svg/lib/classes"),svgCreate=require("tiny-svg/lib/create"),rotate=require("../../util/SvgTransformUtil").rotate,translate=require("../../util/SvgTransformUtil").translate;module.exports.toCanvasCoordinates=function(canvas,event){var offset,position=Events.toPoint(event),clientRect=canvas._container.getBoundingClientRect();offset={x:clientRect.left,y:clientRect.top};var viewbox=canvas.viewbox();return{x:viewbox.x+(position.x-offset.x)/viewbox.scale,y:viewbox.y+(position.y-offset.y)/viewbox.scale}},module.exports.addBendpoint=function(parentGfx,cls){var groupGfx=svgCreate("g");svgClasses(groupGfx).add(BENDPOINT_CLS),svgAppend(parentGfx,groupGfx);var visual=svgCreate("circle");svgAttr(visual,{cx:0,cy:0,r:4}),svgClasses(visual).add("djs-visual"),svgAppend(groupGfx,visual);var hit=svgCreate("circle");return svgAttr(hit,{cx:0,cy:0,r:10}),svgClasses(hit).add("djs-hit"),svgAppend(groupGfx,hit),cls&&svgClasses(groupGfx).add(cls),groupGfx},module.exports.addSegmentDragger=function(parentGfx,segmentStart,segmentEnd){var groupGfx=svgCreate("g"),mid=Geometry.getMidPoint(segmentStart,segmentEnd),alignment=Geometry.pointsAligned(segmentStart,segmentEnd);return svgAppend(parentGfx,groupGfx),createParallelDragger(groupGfx,mid,alignment),svgClasses(groupGfx).add(SEGMENT_DRAGGER_CLS),svgClasses(groupGfx).add("h"===alignment?"vertical":"horizontal"),translate(groupGfx,mid.x,mid.y),groupGfx}},{"../../util/Event":330,"../../util/Geometry":331,"../../util/SvgTransformUtil":342,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/create":552}],206:[function(require,module,exports){"use strict";function Bendpoints(eventBus,canvas,interactionEvents,bendpointMove,connectionSegmentMove){function getConnectionIntersection(waypoints,event){var localPosition=BendpointUtil.toCanvasCoordinates(canvas,event);return getApproxIntersection(waypoints,localPosition)}function isIntersectionMiddle(intersection,waypoints,treshold){var p0,p1,mid,aligned,xDelta,yDelta,idx=intersection.index,p=intersection.point;return!(idx<=0||intersection.bendpoint)&&(p0=waypoints[idx-1],p1=waypoints[idx],mid=getMidPoint(p0,p1),aligned=pointsAligned(p0,p1),xDelta=Math.abs(p.x-mid.x),yDelta=Math.abs(p.y-mid.y),aligned&&xDelta<=treshold&&yDelta<=treshold)}function activateBendpointMove(event,connection){var waypoints=connection.waypoints,intersection=getConnectionIntersection(waypoints,event);intersection&&(isIntersectionMiddle(intersection,waypoints,10)?connectionSegmentMove.start(event,connection,intersection.index):bendpointMove.start(event,connection,intersection.index,!intersection.bendpoint))}function bindInteractionEvents(node,eventName,element){domEvent.bind(node,eventName,function(event){interactionEvents.triggerMouseEvent(eventName,event,element),event.stopPropagation()})}function getBendpointsContainer(element,create){var layer=canvas.getLayer("overlays"),gfx=domQuery(".djs-bendpoints[data-element-id="+element.id+"]",layer);return!gfx&&create&&(gfx=svgCreate("g"),svgAttr(gfx,{"data-element-id":element.id}),svgClasses(gfx).add("djs-bendpoints"),svgAppend(layer,gfx),bindInteractionEvents(gfx,"mousedown",element),bindInteractionEvents(gfx,"click",element),bindInteractionEvents(gfx,"dblclick",element)),gfx}
function createBendpoints(gfx,connection){connection.waypoints.forEach(function(p,idx){var bendpoint=BendpointUtil.addBendpoint(gfx);svgAppend(gfx,bendpoint),translate(bendpoint,p.x,p.y)}),BendpointUtil.addBendpoint(gfx,"floating")}function createSegmentDraggers(gfx,connection){for(var segmentStart,segmentEnd,waypoints=connection.waypoints,i=1;i<waypoints.length;i++)segmentStart=waypoints[i-1],segmentEnd=waypoints[i],pointsAligned(segmentStart,segmentEnd)&&BendpointUtil.addSegmentDragger(gfx,segmentStart,segmentEnd)}function clearBendpoints(gfx){forEach(domQuery.all("."+BENDPOINT_CLS,gfx),function(node){svgRemove(node)})}function clearSegmentDraggers(gfx){forEach(domQuery.all("."+SEGMENT_DRAGGER_CLS,gfx),function(node){svgRemove(node)})}function addHandles(connection){var gfx=getBendpointsContainer(connection);return gfx||(gfx=getBendpointsContainer(connection,!0),createBendpoints(gfx,connection),createSegmentDraggers(gfx,connection)),gfx}function updateHandles(connection){var gfx=getBendpointsContainer(connection);gfx&&(clearSegmentDraggers(gfx),clearBendpoints(gfx),createSegmentDraggers(gfx,connection),createBendpoints(gfx,connection))}eventBus.on("connection.changed",function(event){updateHandles(event.element)}),eventBus.on("connection.remove",function(event){var gfx=getBendpointsContainer(event.element);gfx&&svgRemove(gfx)}),eventBus.on("element.marker.update",function(event){var bendpointsGfx,element=event.element;element.waypoints&&(bendpointsGfx=addHandles(element),event.add?svgClasses(bendpointsGfx).add(event.marker):svgClasses(bendpointsGfx).remove(event.marker))}),eventBus.on("element.mousemove",function(event){var bendpointsGfx,floating,intersection,element=event.element,waypoints=element.waypoints;if(waypoints){if(bendpointsGfx=getBendpointsContainer(element,!0),!(floating=domQuery(".floating",bendpointsGfx)))return;intersection=getConnectionIntersection(waypoints,event.originalEvent),intersection&&translate(floating,intersection.point.x,intersection.point.y)}}),eventBus.on("element.mousedown",function(event){var originalEvent=event.originalEvent,element=event.element,waypoints=element.waypoints;waypoints&&activateBendpointMove(originalEvent,element)}),eventBus.on("selection.changed",function(event){var newSelection=event.newSelection,primary=newSelection[0];primary&&primary.waypoints&&addHandles(primary)}),eventBus.on("element.hover",function(event){var element=event.element;element.waypoints&&(addHandles(element),interactionEvents.registerEvent(event.gfx,"mousemove","element.mousemove"))}),eventBus.on("element.out",function(event){interactionEvents.unregisterEvent(event.gfx,"mousemove","element.mousemove")}),this.addHandles=addHandles,this.updateHandles=updateHandles,this.getBendpointsContainer=getBendpointsContainer}var forEach=require("lodash/collection/forEach"),domEvent=require("min-dom/lib/event"),domQuery=require("min-dom/lib/query"),BendpointUtil=require("./BendpointUtil"),pointsAligned=require("../../util/Geometry").pointsAligned,getMidPoint=require("../../util/Geometry").getMidPoint,BENDPOINT_CLS=BendpointUtil.BENDPOINT_CLS,SEGMENT_DRAGGER_CLS=BendpointUtil.SEGMENT_DRAGGER_CLS,getApproxIntersection=require("../../util/LineIntersection").getApproxIntersection,svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClasses=require("tiny-svg/lib/classes"),svgCreate=require("tiny-svg/lib/create"),svgRemove=require("tiny-svg/lib/remove"),translate=require("../../util/SvgTransformUtil").translate;Bendpoints.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"],module.exports=Bendpoints},{"../../util/Geometry":331,"../../util/LineIntersection":335,"../../util/SvgTransformUtil":342,"./BendpointUtil":205,"lodash/collection/forEach":369,"min-dom/lib/event":523,"min-dom/lib/query":525,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/create":552,"tiny-svg/lib/remove":555}],207:[function(require,module,exports){"use strict";function axisAdd(point,axis,delta){return axisSet(point,axis,point[axis]+delta)}function axisSet(point,axis,value){return{x:"x"===axis?value:point.x,y:"y"===axis?value:point.y}}function axisFenced(position,segmentStart,segmentEnd,axis){var maxValue=Math.max(segmentStart[axis],segmentEnd[axis]),minValue=Math.min(segmentStart[axis],segmentEnd[axis]);return axisSet(segmentStart,axis,Math.min(Math.max(minValue+20,position[axis]),maxValue-20))}function flipAxis(axis){return"x"===axis?"y":"x"}function getDocking(point,referenceElement,moveAxis){var referenceMid,inverseAxis;return point.original?point.original:(referenceMid=LayoutUtil.getMid(referenceElement),inverseAxis=flipAxis(moveAxis),axisSet(point,inverseAxis,referenceMid[inverseAxis]))}function ConnectionSegmentMove(injector,eventBus,canvas,dragging,graphicsFactory,rules,modeling){function cropConnection(connection,newWaypoints){if(!connectionDocking)return newWaypoints;var croppedWaypoints,oldWaypoints=connection.waypoints;return connection.waypoints=newWaypoints,croppedWaypoints=connectionDocking.getCroppedWaypoints(connection),connection.waypoints=oldWaypoints,croppedWaypoints}function redrawConnection(data){graphicsFactory.update("connection",data.connection,data.connectionGfx)}function updateDragger(context,segmentOffset,event){var newWaypoints=context.newWaypoints,segmentStartIndex=context.segmentStartIndex+segmentOffset,segmentStart=newWaypoints[segmentStartIndex],segmentEndIndex=context.segmentEndIndex+segmentOffset,segmentEnd=newWaypoints[segmentEndIndex],axis=flipAxis(context.axis),draggerPosition=axisFenced(event,segmentStart,segmentEnd,axis);translate(context.draggerGfx,draggerPosition.x,draggerPosition.y)}function filterRedundantWaypoints(waypoints,segmentStartIndex){var segmentOffset=0;return{waypoints:waypoints.filter(function(r,idx){return!Geometry.pointsOnLine(waypoints[idx-1],waypoints[idx+1],r)||(segmentOffset=idx<=segmentStartIndex?segmentOffset-1:segmentOffset,!1)}),segmentOffset:segmentOffset}}var connectionDocking=injector.get("connectionDocking",!1);this.start=function(event,connection,idx){var context,direction,axis,gfx=canvas.getGraphics(connection),segmentStartIndex=idx-1,segmentEndIndex=idx,waypoints=connection.waypoints,segmentStart=waypoints[segmentStartIndex],segmentEnd=waypoints[segmentEndIndex];(direction=Geometry.pointsAligned(segmentStart,segmentEnd))&&(axis="v"===direction?"y":"x",0===segmentStartIndex&&(segmentStart=getDocking(segmentStart,connection.source,axis)),segmentEndIndex===waypoints.length-1&&(segmentEnd=getDocking(segmentEnd,connection.target,axis)),context={connection:connection,segmentStartIndex:segmentStartIndex,segmentEndIndex:segmentEndIndex,segmentStart:segmentStart,segmentEnd:segmentEnd,axis:axis},dragging.init(event,{x:(segmentStart.x+segmentEnd.x)/2,y:(segmentStart.y+segmentEnd.y)/2},"connectionSegment.move",{cursor:"x"===axis?"resize-ew":"resize-ns",data:{connection:connection,connectionGfx:gfx,context:context}}))},eventBus.on("connectionSegment.move.start",function(e){var context=e.context,connection=e.connection,layer=canvas.getLayer("overlays");context.originalWaypoints=connection.waypoints.slice(),context.draggerGfx=BendpointUtil.addSegmentDragger(layer,context.segmentStart,context.segmentEnd),svgClasses(context.draggerGfx).add("djs-dragging"),canvas.addMarker(connection,MARKER_CONNECT_UPDATING)}),eventBus.on("connectionSegment.move.move",function(e){var context=e.context,connection=context.connection,segmentStartIndex=context.segmentStartIndex,segmentEndIndex=context.segmentEndIndex,segmentStart=context.segmentStart,segmentEnd=context.segmentEnd,axis=context.axis,newWaypoints=context.originalWaypoints.slice(),newSegmentStart=axisAdd(segmentStart,axis,e["d"+axis]),newSegmentEnd=axisAdd(segmentEnd,axis,e["d"+axis]),waypointCount=newWaypoints.length,segmentOffset=0;newWaypoints[segmentStartIndex]=newSegmentStart,newWaypoints[segmentEndIndex]=newSegmentEnd;var sourceToSegmentOrientation,targetToSegmentOrientation;segmentStartIndex<2&&(sourceToSegmentOrientation=LayoutUtil.getOrientation(connection.source,newSegmentStart),1===segmentStartIndex?"intersect"===sourceToSegmentOrientation&&(newWaypoints.shift(),newWaypoints[0]=newSegmentStart,segmentOffset--):"intersect"!==sourceToSegmentOrientation&&(newWaypoints.unshift(segmentStart),segmentOffset++)),segmentEndIndex>waypointCount-3&&(targetToSegmentOrientation=LayoutUtil.getOrientation(connection.target,newSegmentEnd),segmentEndIndex===waypointCount-2?"intersect"===targetToSegmentOrientation&&(newWaypoints.pop(),newWaypoints[newWaypoints.length-1]=newSegmentEnd):"intersect"!==targetToSegmentOrientation&&newWaypoints.push(segmentEnd)),context.newWaypoints=connection.waypoints=cropConnection(connection,newWaypoints),updateDragger(context,segmentOffset,e),context.newSegmentStartIndex=segmentStartIndex+segmentOffset,redrawConnection(e)}),eventBus.on("connectionSegment.move.hover",function(e){e.context.hover=e.hover,canvas.addMarker(e.hover,MARKER_CONNECT_HOVER)}),eventBus.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(e){var hover=e.context.hover;hover&&canvas.removeMarker(hover,MARKER_CONNECT_HOVER)}),eventBus.on("connectionSegment.move.cleanup",function(e){var context=e.context,connection=context.connection;context.draggerGfx&&svgRemove(context.draggerGfx),canvas.removeMarker(connection,MARKER_CONNECT_UPDATING)}),eventBus.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(e){var context=e.context;context.connection.waypoints=context.originalWaypoints,redrawConnection(e)}),eventBus.on("connectionSegment.move.end",function(e){var context=e.context,connection=context.connection,newWaypoints=context.newWaypoints,newSegmentStartIndex=context.newSegmentStartIndex;newWaypoints=newWaypoints.map(function(p){return{original:p.original,x:Math.round(p.x),y:Math.round(p.y)}});var filtered=filterRedundantWaypoints(newWaypoints,newSegmentStartIndex),filteredWaypoints=filtered.waypoints,croppedWaypoints=cropConnection(connection,filteredWaypoints),segmentOffset=filtered.segmentOffset,hints={segmentMove:{segmentStartIndex:context.segmentStartIndex,newSegmentStartIndex:newSegmentStartIndex+segmentOffset}};modeling.updateWaypoints(connection,croppedWaypoints,hints)})}var Geometry=require("../../util/Geometry"),BendpointUtil=require("./BendpointUtil"),LayoutUtil=require("../../layout/LayoutUtil"),MARKER_CONNECT_HOVER="connect-hover",MARKER_CONNECT_UPDATING="djs-updating",svgClasses=require("tiny-svg/lib/classes"),svgRemove=require("tiny-svg/lib/remove"),translate=require("../../util/SvgTransformUtil").translate;ConnectionSegmentMove.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","rules","modeling"],module.exports=ConnectionSegmentMove},{"../../layout/LayoutUtil":315,"../../util/Geometry":331,"../../util/SvgTransformUtil":342,"./BendpointUtil":205,"tiny-svg/lib/classes":549,"tiny-svg/lib/remove":555}],208:[function(require,module,exports){module.exports={__depends__:[require("../dragging"),require("../rules")],__init__:["bendpoints","bendpointSnapping"],bendpoints:["type",require("./Bendpoints")],bendpointMove:["type",require("./BendpointMove")],connectionSegmentMove:["type",require("./ConnectionSegmentMove")],bendpointSnapping:["type",require("./BendpointSnapping")]}},{"../dragging":225,"../rules":290,"./BendpointMove":203,"./BendpointSnapping":204,"./Bendpoints":206,"./ConnectionSegmentMove":207}],209:[function(require,module,exports){"use strict";function ChangeSupport(eventBus,canvas,elementRegistry,graphicsFactory){eventBus.on("element.changed",function(event){var element=event.element;(element.parent||element===canvas.getRootElement())&&(event.gfx=elementRegistry.getGraphics(element)),event.gfx&&eventBus.fire(getElementType(element)+".changed",event)}),eventBus.on("elements.changed",function(event){var elements=event.elements;elements.forEach(function(e){eventBus.fire("element.changed",{element:e})}),graphicsFactory.updateContainments(elements)}),eventBus.on("shape.changed",function(event){graphicsFactory.update("shape",event.element,event.gfx)}),eventBus.on("connection.changed",function(event){graphicsFactory.update("connection",event.element,event.gfx)})}var getElementType=require("../../util/Elements").getType;ChangeSupport.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"],module.exports=ChangeSupport},{"../../util/Elements":329}],210:[function(require,module,exports){module.exports={__init__:["changeSupport"],changeSupport:["type",require("./ChangeSupport")]}},{"./ChangeSupport":209}],211:[function(require,module,exports){"use strict";function Clipboard(){}module.exports=Clipboard,Clipboard.prototype.get=function(){return this._data},Clipboard.prototype.set=function(data){this._data=data},Clipboard.prototype.clear=function(){var data=this._data;return delete this._data,data},Clipboard.prototype.isEmpty=function(){return!this._data}},{}],212:[function(require,module,exports){module.exports={clipboard:["type",require("./Clipboard")]}},{"./Clipboard":211}],213:[function(require,module,exports){"use strict";function Connect(eventBus,dragging,modeling,rules,canvas,graphicsFactory){function canConnect(source,target){return rules.allowed("connection.create",{source:source,target:target})}function crop(start,end,source,target){var sourcePath=graphicsFactory.getShapePath(source),targetPath=target&&graphicsFactory.getShapePath(target),connectionPath=graphicsFactory.getConnectionPath({waypoints:[start,end]});return start=LayoutUtil.getElementLineIntersection(sourcePath,connectionPath,!0)||start,end=target&&LayoutUtil.getElementLineIntersection(targetPath,connectionPath,!1)||end,[start,end]}eventBus.on("connect.move",function(event){var endPosition,waypoints,context=event.context,source=context.source,target=context.target,visual=context.visual,sourcePosition=context.sourcePosition;endPosition={x:event.x,y:event.y},waypoints=crop(sourcePosition,endPosition,source,target),svgAttr(visual,{points:[waypoints[0].x,waypoints[0].y,waypoints[1].x,waypoints[1].y]})}),eventBus.on("connect.hover",function(event){var canExecute,context=event.context,source=context.source,hover=event.hover;null!==(canExecute=context.canExecute=canConnect(source,hover))&&(context.target=hover,canvas.addMarker(hover,canExecute?MARKER_OK:MARKER_NOT_OK))}),eventBus.on(["connect.out","connect.cleanup"],function(event){var context=event.context;context.target&&canvas.removeMarker(context.target,context.canExecute?MARKER_OK:MARKER_NOT_OK),context.target=null}),eventBus.on("connect.cleanup",function(event){var context=event.context;context.visual&&svgRemove(context.visual)}),eventBus.on("connect.start",function(event){var visual,context=event.context;visual=svgCreate("polyline"),svgAttr(visual,{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"}),svgAppend(canvas.getDefaultLayer(),visual),context.visual=visual}),eventBus.on("connect.end",function(event){var context=event.context,source=context.source,sourcePosition=context.sourcePosition,target=context.target,targetPosition={x:event.x,y:event.y},canExecute=context.canExecute||canConnect(source,target);if(!canExecute)return!1;var attrs=null,hints={connectionStart:sourcePosition,connectionEnd:targetPosition};"object"==typeof canExecute&&(attrs=canExecute),modeling.connect(source,target,attrs,hints)}),this.start=function(event,source,sourcePosition,autoActivate){"object"!=typeof sourcePosition&&(autoActivate=sourcePosition,sourcePosition=LayoutUtil.getMid(source)),dragging.init(event,"connect",{autoActivate:autoActivate,data:{shape:source,context:{source:source,sourcePosition:sourcePosition}}})}}var LayoutUtil=require("../../layout/LayoutUtil"),MARKER_OK="connect-ok",MARKER_NOT_OK="connect-not-ok",svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create"),svgRemove=require("tiny-svg/lib/remove");Connect.$inject=["eventBus","dragging","modeling","rules","canvas","graphicsFactory"],module.exports=Connect},{"../../layout/LayoutUtil":315,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/create":552,"tiny-svg/lib/remove":555}],214:[function(require,module,exports){module.exports={__depends__:[require("../selection"),require("../rules"),require("../dragging")],connect:["type",require("./Connect")]}},{"../dragging":225,"../rules":290,"../selection":296,"./Connect":213}],215:[function(require,module,exports){"use strict";function ContextPad(eventBus,overlays){this._providers=[],this._eventBus=eventBus,this._overlays=overlays,this._current=null,this._init()}function addClasses(element,classNames){var classes=domClasses(element);(isArray(classNames)?classNames:classNames.split(/\s+/g)).forEach(function(cls){classes.add(cls)})}var isFunction=require("lodash/lang/isFunction"),isArray=require("lodash/lang/isArray"),forEach=require("lodash/collection/forEach"),domDelegate=require("min-dom/lib/delegate"),domEvent=require("min-dom/lib/event"),domAttr=require("min-dom/lib/attr"),domQuery=require("min-dom/lib/query"),domClasses=require("min-dom/lib/classes"),domify=require("min-dom/lib/domify");ContextPad.$inject=["eventBus","overlays"],module.exports=ContextPad,ContextPad.prototype._init=function(){var eventBus=this._eventBus,self=this;eventBus.on("selection.changed",function(e){var selection=e.newSelection;1===selection.length?self.open(selection[0]):self.close()}),eventBus.on("elements.delete",function(event){var elements=event.elements;forEach(elements,function(e){self.isOpen(e)&&self.close()})}),eventBus.on("element.changed",function(event){var element=event.element,current=self._current;current&&current.element===element&&self.open(element,!0)})},ContextPad.prototype.registerProvider=function(provider){this._providers.push(provider)},ContextPad.prototype.getEntries=function(element){var entries={};return forEach(this._providers,function(provider){var e=provider.getContextPadEntries(element);forEach(e,function(entry,id){entries[id]=entry})}),entries},ContextPad.prototype.trigger=function(action,event,autoActivate){var entry,handler,originalEvent,element=this._current.element,entries=this._current.entries,button=event.delegateTarget||event.target;if(!button)return event.preventDefault();if(entry=entries[domAttr(button,"data-action")],handler=entry.action,originalEvent=event.originalEvent||event,isFunction(handler)){if("click"===action)return handler(originalEvent,element,autoActivate)}else if(handler[action])return handler[action](originalEvent,element,autoActivate);event.preventDefault()},ContextPad.prototype.open=function(element,force){!force&&this.isOpen(element)||(this.close(),this._updateAndOpen(element))},ContextPad.prototype._updateAndOpen=function(element){var entries=this.getEntries(element),pad=this.getPad(element),html=pad.html;forEach(entries,function(entry,id){var container,grouping=entry.group||"default",control=domify(entry.html||'<div class="entry" draggable="true"></div>');domAttr(control,"data-action",id),container=domQuery("[data-group="+grouping+"]",html),container||(container=domify('<div class="group" data-group="'+grouping+'"></div>'),html.appendChild(container)),container.appendChild(control),entry.className&&addClasses(control,entry.className),entry.title&&domAttr(control,"title",entry.title),entry.imageUrl&&control.appendChild(domify('<img src="'+entry.imageUrl+'">'))}),domClasses(html).add("open"),this._current={element:element,pad:pad,entries:entries},this._eventBus.fire("contextPad.open",{current:this._current})},ContextPad.prototype.getPad=function(element){if(this.isOpen())return this._current.pad;var self=this,overlays=this._overlays,html=domify('<div class="djs-context-pad"></div>');domDelegate.bind(html,".entry","click",function(event){self.trigger("click",event)}),domDelegate.bind(html,".entry","dragstart",function(event){self.trigger("dragstart",event)}),domEvent.bind(html,"mousedown",function(event){event.stopPropagation()}),this._overlayId=overlays.add(element,"context-pad",{position:{right:-9,top:-6},html:html});var pad=overlays.get(this._overlayId);return this._eventBus.fire("contextPad.create",{element:element,pad:pad}),pad},ContextPad.prototype.close=function(){this.isOpen()&&(this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},ContextPad.prototype.isOpen=function(element){return!(!this._current||element&&this._current.element!==element)}},{"lodash/collection/forEach":369,"lodash/lang/isArray":492,"lodash/lang/isFunction":494,"min-dom/lib/attr":517,"min-dom/lib/classes":518,"min-dom/lib/delegate":521,"min-dom/lib/domify":522,"min-dom/lib/event":523,"min-dom/lib/query":525}],216:[function(require,module,exports){module.exports={__depends__:[require("../interaction-events"),require("../overlays")],contextPad:["type",require("./ContextPad")]}},{"../interaction-events":233,"../overlays":274,"./ContextPad":215}],217:[function(require,module,exports){"use strict";function CopyPaste(eventBus,modeling,elementFactory,rules,clipboard,canvas){this._eventBus=eventBus,this._modeling=modeling,this._elementFactory=elementFactory,this._rules=rules,this._canvas=canvas,this._clipboard=clipboard,this._descriptors=[],this.registerDescriptor(function(element,descriptor){return descriptor.priority=1,descriptor.id=element.id,element.parent&&(descriptor.parent=element.parent.id),element.labelTarget&&(descriptor.priority=4,descriptor.labelTarget=element.labelTarget.id),element.host&&(descriptor.priority=2,descriptor.host=element.host.id),"number"==typeof element.x&&(descriptor.x=element.x,descriptor.y=element.y),element.width&&(descriptor.width=element.width,descriptor.height=element.height),element.waypoints&&(descriptor.priority=3,descriptor.waypoints=[],forEach(element.waypoints,function(waypoint){var wp={x:waypoint.x,y:waypoint.y};waypoint.original&&(wp.original={x:waypoint.original.x,y:waypoint.original.y}),descriptor.waypoints.push(wp)})),element.source&&element.target&&(descriptor.source=element.source.id,descriptor.target=element.target.id),descriptor})}var isArray=require("lodash/lang/isArray"),forEach=require("lodash/collection/forEach"),map=require("lodash/collection/map"),find=require("lodash/collection/find"),findIndex=require("lodash/array/findIndex"),sortBy=require("lodash/collection/sortBy"),reduce=require("lodash/collection/reduce"),getBBox=require("../../util/Elements").getBBox,PositionUtil=require("../../util/PositionUtil"),CopyPasteUtil=require("../../util/CopyPasteUtil"),ElementsUtil=require("../../util/Elements");CopyPaste.$inject=["eventBus","modeling","elementFactory","rules","clipboard","canvas"],module.exports=CopyPaste,CopyPaste.prototype.copy=function(selectedElements){var tree,bbox,clipboard=this._clipboard;if(isArray(selectedElements)||(selectedElements=selectedElements?[selectedElements]:[]),selectedElements.length)return tree=this.createTree(selectedElements),bbox=this._bbox=PositionUtil.center(getBBox(tree.allShapes)),delete tree.allShapes,forEach(tree,function(elements){forEach(elements,function(element){var delta,labelTarget;element.labelTarget?(labelTarget=find(elements,{id:element.labelTarget}),delta=labelTarget.waypoints?PositionUtil.delta(element,labelTarget.waypoints[0]):PositionUtil.delta(element,labelTarget)):3===element.priority?(delta=[],forEach(element.waypoints,function(waypoint){var waypointDelta=PositionUtil.delta(waypoint,bbox);delta.push(waypointDelta)},this)):delta=PositionUtil.delta(element,bbox),element.delta=delta})}),this._eventBus.fire("elements.copy",{context:{tree:tree}}),0===Object.keys(tree).length?clipboard.clear():clipboard.set(tree),this._eventBus.fire("elements.copied",{context:{tree:tree}}),tree},CopyPaste.prototype.paste=function(context){var newTree,clipboard=this._clipboard,modeling=this._modeling,eventBus=this._eventBus,rules=this._rules,tree=clipboard.get(),topParent=context.element,position=context.point;if(!clipboard.isEmpty()){if(newTree=reduce(tree,function(pasteTree,elements,depthStr){var depth=parseInt(depthStr,10);return isNaN(depth)?pasteTree:(pasteTree[depth]=elements,pasteTree)},{},this),!rules.allowed("elements.paste",{tree:newTree,target:topParent}))return void eventBus.fire("elements.paste.rejected",{context:{tree:newTree,position:position,target:topParent}});modeling.pasteElements(newTree,topParent,position)}},CopyPaste.prototype._computeDelta=function(elements,element){var bbox=this._bbox,delta={};return element.labelTarget?(console.log(elements),PositionUtil.delta(element,element.labelTarget)):(3===element.priority?(delta=[],forEach(element.waypoints,function(waypoint){var waypointDelta=PositionUtil.delta(waypoint,bbox);delta.push(waypointDelta)},this)):delta=PositionUtil.delta(element,bbox),delta)},CopyPaste.prototype.hasRelations=function(elements,element){var source,target;return!(element.waypoints&&(source=find(elements,{id:element.source.id}),target=find(elements,{id:element.target.id}),!source||!target))&&!(element.labelTarget&&!find(elements,{id:element.labelTarget.id}))},CopyPaste.prototype.registerDescriptor=function(descriptor){if("function"!=typeof descriptor)throw new Error("the descriptor must be a function");if(-1!==this._descriptors.indexOf(descriptor))throw new Error("this descriptor is already registered");this._descriptors.push(descriptor)},CopyPaste.prototype._executeDescriptors=function(data){return data.descriptor||(data.descriptor={}),forEach(this._descriptors,function(descriptor){data.descriptor=descriptor(data.element,data.descriptor)}),data},CopyPaste.prototype.createTree=function(elements){function canCopy(collection,element){return rules.allowed("element.copy",{collection:collection,element:element})}function includeElement(data){var element,idx=findIndex(includedElements,{element:data.element});if(-1===idx)return includedElements.push(data);element=includedElements[idx],element.depth<data.depth&&(includedElements.splice(idx,1),includedElements.push(data))}var _elements,rules=this._rules,tree={},includedElements=[],topLevel=CopyPasteUtil.getTopLevel(elements);return tree.allShapes=[],ElementsUtil.eachElement(topLevel,function(element,i,depth){var nestedChildren=element.children;if(!element.labelTarget)return element.label&&includeElement({element:element.label,depth:depth}),function(lists){forEach(lists,function(list){list&&list.length&&forEach(list,function(elem){elem.label&&includeElement({element:elem.label,depth:depth}),includeElement({element:elem,depth:depth})})})}([element.attachers,element.incoming,element.outgoing]),includeElement({element:element,depth:depth}),nestedChildren||void 0}),includedElements=map(includedElements,function(data){return this._executeDescriptors(data)},this),includedElements=sortBy(includedElements,function(data){return data.descriptor.priority}),_elements=map(includedElements,function(data){return data.element}),forEach(includedElements,function(data){var depth=data.depth;this.hasRelations(tree.allShapes,data.element)&&canCopy(_elements,data.element)&&(tree.allShapes.push(data.element),tree[depth]||(tree[depth]=[]),tree[depth].push(data.descriptor))},this),tree}},{"../../util/CopyPasteUtil":327,"../../util/Elements":329,"../../util/PositionUtil":339,"lodash/array/findIndex":355,"lodash/collection/find":368,"lodash/collection/forEach":369,"lodash/collection/map":373,"lodash/collection/reduce":374,"lodash/collection/sortBy":378,"lodash/lang/isArray":492}],218:[function(require,module,exports){module.exports={__depends__:[require("../clipboard"),require("../rules"),require("../mouse-tracking")],__init__:["copyPaste"],copyPaste:["type",require("./CopyPaste")]}},{"../clipboard":212,"../mouse-tracking":266,"../rules":290,"./CopyPaste":217}],219:[function(require,module,exports){"use strict";function Create(eventBus,dragging,rules,modeling,canvas,styles,graphicsFactory){function canCreate(shape,target,source,position){return source?rules.allowed("shape.append",{source:source,shape:shape,target:target,position:position}):rules.allowed("shape.create",{shape:shape,target:target,position:position})}function setMarker(element,marker){[MARKER_ATTACH,MARKER_OK,MARKER_NOT_OK,MARKER_NEW_PARENT].forEach(function(m){m===marker?canvas.addMarker(element,m):canvas.removeMarker(element,m)})}function createVisual(shape){var group,preview,visual;group=svgCreate("g"),svgAttr(group,styles.cls("djs-drag-group",["no-events"])),svgAppend(canvas.getDefaultLayer(),group),preview=svgCreate("g"),svgClasses(preview).add("djs-dragger"),svgAppend(group,preview),translate(preview,shape.width/-2,shape.height/-2);var visualGroup=svgCreate("g");return svgClasses(visualGroup).add("djs-visual"),svgAppend(preview,visualGroup),visual=visualGroup,graphicsFactory.drawShape(visual,shape),group}eventBus.on("create.move",function(event){var canExecute,context=event.context,hover=event.hover,position={x:event.x,y:event.y};canExecute=context.canExecute=hover&&canCreate(context.shape,hover,context.source,position),hover&&null!==canExecute&&(context.target=hover,"attach"===canExecute?setMarker(hover,MARKER_ATTACH):setMarker(hover,context.canExecute?MARKER_NEW_PARENT:MARKER_NOT_OK))}),eventBus.on("create.move",LOW_PRIORITY,function(event){var context=event.context,shape=context.shape,visual=context.visual;visual||(visual=context.visual=createVisual(shape)),translate(visual,event.x,event.y)}),eventBus.on(["create.end","create.out","create.cleanup"],function(event){var context=event.context,target=context.target;target&&setMarker(target,null)}),eventBus.on("create.end",function(event){var isAttach,context=event.context,source=context.source,shape=context.shape,target=context.target,canExecute=context.canExecute,position={x:event.x,y:event.y};if(!canExecute)return!1;source?shape=modeling.appendShape(source,shape,position,target):(isAttach="attach"===canExecute,shape=modeling.createShape(shape,position,target,isAttach)),context.shape=shape}),eventBus.on("create.cleanup",function(event){var context=event.context;context.visual&&svgRemove(context.visual)}),this.start=function(event,shape,source){dragging.init(event,"create",{cursor:"grabbing",autoActivate:!0,data:{shape:shape,context:{shape:shape,source:source}}})}}var LOW_PRIORITY=750,MARKER_OK="drop-ok",MARKER_NOT_OK="drop-not-ok",MARKER_ATTACH="attach-ok",MARKER_NEW_PARENT="new-parent",svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClasses=require("tiny-svg/lib/classes"),svgCreate=require("tiny-svg/lib/create"),svgRemove=require("tiny-svg/lib/remove"),translate=require("../../util/SvgTransformUtil").translate;Create.$inject=["eventBus","dragging","rules","modeling","canvas","styles","graphicsFactory"],module.exports=Create},{"../../util/SvgTransformUtil":342,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/create":552,"tiny-svg/lib/remove":555}],220:[function(require,module,exports){module.exports={__depends__:[require("../dragging"),require("../selection"),require("../rules")],create:["type",require("./Create")]}},{"../dragging":225,"../rules":290,"../selection":296,"./Create":219}],221:[function(require,module,exports){"use strict";function DistributeElements(modeling){this._modeling=modeling,this._filters=[],this.registerFilter(function(elements,axis,dimension){var avgDimension,elementsSize=0,numOfShapes=0;return forEach(elements,function(element){element.waypoints||element.labelTarget||(elementsSize+=element[dimension],numOfShapes+=1)}),avgDimension=Math.round(elementsSize/numOfShapes),filter(elements,function(element){return element[dimension]<avgDimension+50})})}var sortBy=require("lodash/collection/sortBy"),forEach=require("lodash/collection/forEach"),filter=require("lodash/collection/filter"),AXIS_DIMENSIONS={horizontal:["x","width"],vertical:["y","height"]};module.exports=DistributeElements,DistributeElements.$inject=["modeling"],DistributeElements.prototype.registerFilter=function(filterFn){
if("function"!=typeof filterFn)throw new Error("the filter has to be a function");this._filters.push(filterFn)},DistributeElements.prototype.trigger=function(elements,orientation){var groups,distributableElements,modeling=this._modeling;if(!(elements.length<3||(this._setOrientation(orientation),distributableElements=this._filterElements(elements),groups=this._createGroups(distributableElements),groups.length<=2)))return modeling.distributeElements(groups,this._axis,this._dimension),groups},DistributeElements.prototype._filterElements=function(elements){var filters=this._filters,axis=this._axis,dimension=this._dimension,distributableElements=[].concat(elements);return filters.length?(forEach(filters,function(filterFn){distributableElements=filterFn(distributableElements,axis,dimension)}),distributableElements):elements},DistributeElements.prototype._createGroups=function(elements){var rangeGroups=[],axis=this._axis,dimension=this._dimension;if(!axis)throw new Error('must have a defined "axis" and "dimension"');var sortedElements=sortBy(elements,axis);return forEach(sortedElements,function(element,idx){var range,elementRange=this._findRange(element,axis,dimension),previous=rangeGroups[rangeGroups.length-1];previous&&this._hasIntersection(previous.range,elementRange)?rangeGroups[rangeGroups.length-1].elements.push(element):(range={range:elementRange,elements:[element]},rangeGroups.push(range))},this),rangeGroups},DistributeElements.prototype._setOrientation=function(direction){var orientation=AXIS_DIMENSIONS[direction];this._axis=orientation[0],this._dimension=orientation[1]},DistributeElements.prototype._hasIntersection=function(rangeA,rangeB){return Math.max(rangeA.min,rangeA.max)>=Math.min(rangeB.min,rangeB.max)&&Math.min(rangeA.min,rangeA.max)<=Math.max(rangeB.min,rangeB.max)},DistributeElements.prototype._findRange=function(element){var axis=element[this._axis];return{min:axis+5,max:axis+element[this._dimension]-5}}},{"lodash/collection/filter":367,"lodash/collection/forEach":369,"lodash/collection/sortBy":378}],222:[function(require,module,exports){"use strict";module.exports={__init__:["distributeElements"],distributeElements:["type",require("./DistributeElements")]}},{"./DistributeElements":221}],223:[function(require,module,exports){"use strict";function suppressEvent(event){event instanceof MouseEvent?Event.stopEvent(event,!0):Event.preventDefault(event)}function getLength(point){return Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2))}function substract(p1,p2){return{x:p1.x-p2.x,y:p1.y-p2.y}}function Dragging(eventBus,canvas,selection){function toLocalPoint(globalPosition){var viewbox=canvas.viewbox(),clientRect=canvas._container.getBoundingClientRect();return{x:viewbox.x+round((globalPosition.x-clientRect.left)/viewbox.scale),y:viewbox.y+round((globalPosition.y-clientRect.top)/viewbox.scale)}}function fire(type,dragContext){dragContext=dragContext||context;var event=assign(new EventBusEvent,dragContext.payload,dragContext.data);return!1!==eventBus.fire("drag."+type,event)&&eventBus.fire(dragContext.prefix+"."+type,event)}function move(event,activate){var payload=context.payload,displacement=context.displacement,globalStart=context.globalStart,globalCurrent=Event.toPoint(event),globalDelta=substract(globalCurrent,globalStart),localStart=context.localStart,localCurrent=toLocalPoint(globalCurrent),localDelta=substract(localCurrent,localStart);if(!context.active&&(activate||getLength(globalDelta)>context.threshold)){if(assign(payload,{x:localStart.x+displacement.x,y:localStart.y+displacement.y,dx:0,dy:0},{originalEvent:event}),!1===fire("start"))return cancel();context.active=!0,context.keepSelection||(payload.previousSelection=selection.get(),selection.select(null)),context.cursor&&Cursor.set(context.cursor),canvas.addMarker(canvas.getRootElement(),DRAG_ACTIVE_CLS)}suppressEvent(event),context.active&&(assign(payload,{x:localCurrent.x+displacement.x,y:localCurrent.y+displacement.y,dx:localDelta.x,dy:localDelta.y},{originalEvent:event}),fire("move"))}function end(event){var previousContext,returnValue=!0;context.active&&(event&&(context.payload.originalEvent=event,suppressEvent(event)),returnValue=fire("end")),!1===returnValue&&fire("rejected"),previousContext=cleanup(!0!==returnValue),fire("ended",previousContext)}function checkCancel(event){27===event.which&&(event.preventDefault(),cancel())}function trapClickAndEnd(event){var untrap;context.active&&(untrap=ClickTrap.install(),setTimeout(untrap,400)),end(event)}function trapTouch(event){move(event)}function hover(event){var payload=context.payload;payload.hoverGfx=event.gfx,payload.hover=event.element,fire("hover")}function out(event){fire("out");var payload=context.payload;payload.hoverGfx=null,payload.hover=null}function cancel(restore){var previousContext;if(context){var wasActive=context.active;wasActive&&fire("cancel"),previousContext=cleanup(restore),wasActive&&fire("canceled",previousContext)}}function cleanup(restore){var previousContext,endDrag;fire("cleanup"),Cursor.unset(),endDrag=context.trapClick?trapClickAndEnd:end,domEvent.unbind(document,"mousemove",move),domEvent.unbind(document,"mousedown",endDrag,!0),domEvent.unbind(document,"mouseup",endDrag,!0),domEvent.unbind(document,"keyup",checkCancel),domEvent.unbind(document,"touchstart",trapTouch,!0),domEvent.unbind(document,"touchcancel",cancel,!0),domEvent.unbind(document,"touchmove",move,!0),domEvent.unbind(document,"touchend",end,!0),eventBus.off("element.hover",hover),eventBus.off("element.out",out),canvas.removeMarker(canvas.getRootElement(),DRAG_ACTIVE_CLS);var previousSelection=context.payload.previousSelection;return!1!==restore&&previousSelection&&!selection.get().length&&selection.select(previousSelection),previousContext=context,context=null,previousContext}function init(event,relativeTo,prefix,options){context&&cancel(!1),"string"==typeof relativeTo&&(options=prefix,prefix=relativeTo,relativeTo=null),options=assign({},defaultOptions,options||{});var originalEvent,globalStart,endDrag,data=options.data||{};endDrag=options.trapClick?trapClickAndEnd:end,event?(originalEvent=Event.getOriginal(event)||event,globalStart=Event.toPoint(event),suppressEvent(event)):(originalEvent=null,globalStart={x:0,y:0});var localStart=toLocalPoint(globalStart);relativeTo||(relativeTo=localStart),context=assign({prefix:prefix,data:data,payload:{},globalStart:globalStart,displacement:substract(relativeTo,localStart),localStart:localStart},options),options.manual||("undefined"!=typeof TouchEvent&&originalEvent instanceof TouchEvent?(domEvent.bind(document,"touchstart",trapTouch,!0),domEvent.bind(document,"touchcancel",cancel,!0),domEvent.bind(document,"touchmove",move,!0),domEvent.bind(document,"touchend",end,!0)):(domEvent.bind(document,"mousemove",move),domEvent.bind(document,"mousedown",endDrag,!0),domEvent.bind(document,"mouseup",endDrag,!0)),domEvent.bind(document,"keyup",checkCancel),eventBus.on("element.hover",hover),eventBus.on("element.out",out)),fire("init"),options.autoActivate&&move(event,!0)}var context,defaultOptions={threshold:5,trapClick:!0};eventBus.on("diagram.destroy",cancel),this.init=init,this.move=move,this.hover=hover,this.out=out,this.end=end,this.cancel=cancel,this.context=function(){return context},this.setOptions=function(options){assign(defaultOptions,options)}}var round=Math.round,assign=require("lodash/object/assign"),domEvent=require("min-dom/lib/event"),Event=require("../../util/Event"),ClickTrap=require("../../util/ClickTrap"),Cursor=require("../../util/Cursor"),EventBusEvent=require("../../core/EventBus").Event,DRAG_ACTIVE_CLS="djs-drag-active";Dragging.$inject=["eventBus","canvas","selection"],module.exports=Dragging},{"../../core/EventBus":188,"../../util/ClickTrap":325,"../../util/Cursor":328,"../../util/Event":330,"lodash/object/assign":502,"min-dom/lib/event":523}],224:[function(require,module,exports){"use strict";function getGfx(target){return domClosest(target,"svg, .djs-element",!0)}function HoverFix(eventBus,dragging,elementRegistry){var self=this;eventBus.on("drag.start",function(event){eventBus.once("drag.move",function(){eventBus.once("drag.move",function(event){self.ensureHover(event)})})}),this.ensureHover=function(event){if(!event.hover){var position,target,element,gfx,originalEvent=event.originalEvent;originalEvent instanceof MouseEvent&&(position=Event.toPoint(originalEvent),target=document.elementFromPoint(position.x,position.y),(gfx=getGfx(target))&&(element=elementRegistry.get(gfx),dragging.hover({element:element,gfx:gfx})))}}}var domClosest=require("min-dom/lib/closest"),Event=require("../../util/Event");HoverFix.$inject=["eventBus","dragging","elementRegistry"],module.exports=HoverFix},{"../../util/Event":330,"min-dom/lib/closest":520}],225:[function(require,module,exports){module.exports={__init__:["hoverFix"],__depends__:[require("../selection")],dragging:["type",require("./Dragging")],hoverFix:["type",require("./HoverFix")]}},{"../selection":296,"./Dragging":223,"./HoverFix":224}],226:[function(require,module,exports){"use strict";function EditorActions(eventBus,commandStack,modeling,selection,zoomScroll,copyPaste,canvas,rules,mouseTracking){this._actions={undo:function(){commandStack.undo()},redo:function(){commandStack.redo()},copy:function(){var selectedElements=selection.get();copyPaste.copy(selectedElements)},paste:function(){var context=mouseTracking.getHoverContext();copyPaste.paste(context)},stepZoom:function(opts){zoomScroll.stepZoom(opts.value)},zoom:function(opts){canvas.zoom(opts.value)},removeSelection:function(){var selectedElements=selection.get();if(selectedElements.length){var removableElements,allowed=rules.allowed("elements.delete",{elements:selectedElements});if(!1===allowed)return;removableElements=isArray(allowed)?allowed:selectedElements,removableElements.length&&modeling.removeElements(removableElements.slice())}},moveCanvas:function(opts){var dx=0,dy=0,invertY=opts.invertY,speed=opts.speed,actualSpeed=speed/Math.min(Math.sqrt(canvas.viewbox().scale),1);switch(opts.direction){case"left":dx=actualSpeed;break;case"up":dy=actualSpeed;break;case"right":dx=-actualSpeed;break;case"down":dy=-actualSpeed}dy&&invertY&&(dy=-dy),canvas.scroll({dx:dx,dy:dy})}}}function error(action,message){return new Error(action+" "+message)}var forEach=require("lodash/collection/forEach"),isArray=require("lodash/lang/isArray");EditorActions.$inject=["eventBus","commandStack","modeling","selection","zoomScroll","copyPaste","canvas","rules","mouseTracking"],module.exports=EditorActions,EditorActions.prototype.trigger=function(action,opts){if(!this._actions[action])throw error(action,"is not a registered action");return this._actions[action](opts)},EditorActions.prototype.register=function(actions,listener){if("string"==typeof actions)return this._registerAction(actions,listener);forEach(actions,function(listener,action){this._registerAction(action,listener)},this)},EditorActions.prototype._registerAction=function(action,listener){if(this.isRegistered(action))throw error(action,"is already registered");this._actions[action]=listener},EditorActions.prototype.unregister=function(action){if(!this.isRegistered(action))throw error(action,"is not a registered action");this._actions[action]=void 0},EditorActions.prototype.length=function(){return Object.keys(this._actions).length},EditorActions.prototype.isRegistered=function(action){return!!this._actions[action]}},{"lodash/collection/forEach":369,"lodash/lang/isArray":492}],227:[function(require,module,exports){module.exports={__depends__:[require("../selection"),require("../copy-paste"),require("../../navigation/zoomscroll")],__init__:["editorActions"],editorActions:["type",require("./EditorActions")]}},{"../../navigation/zoomscroll":323,"../copy-paste":218,"../selection":296,"./EditorActions":226}],228:[function(require,module,exports){"use strict";function GlobalConnect(eventBus,dragging,connect,canvas,toolManager){var self=this;this._dragging=dragging,toolManager.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),eventBus.on("global-connect.hover",function(event){var context=event.context,startTarget=event.hover,canStartConnect=context.canStartConnect=self.canStartConnect(startTarget);null!==canStartConnect&&(context.startTarget=startTarget,canvas.addMarker(startTarget,canStartConnect?MARKER_OK:MARKER_NOT_OK))}),eventBus.on(["global-connect.out","global-connect.cleanup"],function(event){var startTarget=event.context.startTarget,canStartConnect=event.context.canStartConnect;startTarget&&canvas.removeMarker(startTarget,canStartConnect?MARKER_OK:MARKER_NOT_OK)}),eventBus.on(["global-connect.ended"],function(event){var context=event.context,startTarget=context.startTarget,startPosition={x:event.x,y:event.y};if(self.canStartConnect(startTarget))return eventBus.once("element.out",function(){eventBus.once(["connect.ended","connect.canceled"],function(){eventBus.fire("global-connect.drag.ended")}),connect.start(null,startTarget,startPosition)}),!1})}var MARKER_OK="connect-ok",MARKER_NOT_OK="connect-not-ok";GlobalConnect.$inject=["eventBus","dragging","connect","canvas","toolManager"],module.exports=GlobalConnect,GlobalConnect.prototype.start=function(event){this._dragging.init(event,"global-connect",{trapClick:!1,data:{context:{}}})},GlobalConnect.prototype.toggle=function(){this.isActive()?this._dragging.cancel():this.start()},GlobalConnect.prototype.isActive=function(){var context=this._dragging.context();return context&&/^global-connect/.test(context.prefix)},GlobalConnect.prototype.registerProvider=function(provider){this._provider=provider},GlobalConnect.prototype.canStartConnect=function(startTarget){return this._provider.canStartConnect(startTarget)}},{}],229:[function(require,module,exports){module.exports={__depends__:[require("../connect"),require("../rules"),require("../dragging"),require("../tool-manager")],globalConnect:["type",require("./GlobalConnect")]}},{"../connect":214,"../dragging":225,"../rules":290,"../tool-manager":305,"./GlobalConnect":228}],230:[function(require,module,exports){"use strict";function HandTool(eventBus,canvas,dragging,toolManager){this._dragging=dragging,toolManager.registerTool("hand",{tool:"hand",dragging:"hand.move"}),eventBus.on("element.mousedown",HIGH_PRIORITY,function(event){if(hasPrimaryModifier(event))return this.activateMove(event.originalEvent),!1},this),eventBus.on("hand.end",function(event){var target=event.originalEvent.target;if(!(event.hover||target instanceof SVGElement))return!1;eventBus.once("hand.ended",function(){this.activateMove(event.originalEvent,{reactivate:!0})},this)},this),eventBus.on("hand.move.move",function(event){var scale=canvas.viewbox().scale;canvas.scroll({dx:event.dx*scale,dy:event.dy*scale})}),eventBus.on("hand.move.end",function(event){var context=event.context,reactivate=context.reactivate;return!hasPrimaryModifier(event)&&reactivate&&eventBus.once("hand.move.ended",function(event){this.activateHand(event.originalEvent,!0,!0)},this),!1},this)}var hasPrimaryModifier=require("../../util/Mouse").hasPrimaryModifier,HIGH_PRIORITY=1500;HandTool.$inject=["eventBus","canvas","dragging","toolManager"],module.exports=HandTool,HandTool.prototype.activateMove=function(event,autoActivate,context){"object"==typeof autoActivate&&(context=autoActivate,autoActivate=!1),this._dragging.init(event,"hand.move",{autoActivate:autoActivate,cursor:"grab",data:{context:context||{}}})},HandTool.prototype.activateHand=function(event,autoActivate,reactivate){this._dragging.init(event,"hand",{trapClick:!1,autoActivate:autoActivate,cursor:"grab",data:{context:{reactivate:reactivate}}})},HandTool.prototype.toggle=function(){this.isActive()?this._dragging.cancel():this.activateHand()},HandTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^hand/.test(context.prefix)}},{"../../util/Mouse":337}],231:[function(require,module,exports){"use strict";module.exports={__depends__:[require("../tool-manager")],__init__:["handTool"],handTool:["type",require("./HandTool")]}},{"../tool-manager":305,"./HandTool":230}],232:[function(require,module,exports){"use strict";function InteractionEvents(eventBus,elementRegistry,styles){function fire(type,event,element){if(isPrimaryButton(event)){var target,gfx;element?gfx=elementRegistry.getGraphics(element):(target=event.delegateTarget||event.target)&&(gfx=target,element=elementRegistry.get(gfx)),gfx&&element&&!1===eventBus.fire(type,{element:element,gfx:gfx,originalEvent:event})&&(event.stopPropagation(),event.preventDefault())}}function mouseHandler(type){var fn=handlers[type];return fn||(fn=handlers[type]=function(event){fire(type,event)}),fn}function triggerMouseEvent(eventName,event,targetElement){var localEventName=bindings[eventName];if(!localEventName)throw new Error("unmapped DOM event name <"+eventName+">");return fire(localEventName,event,targetElement)}function registerEvent(node,event,localEvent){var handler=mouseHandler(localEvent);handler.$delegate=domDelegate.bind(node,elementSelector,event,handler)}function unregisterEvent(node,event,localEvent){domDelegate.unbind(node,event,mouseHandler(localEvent).$delegate)}function registerEvents(svg){forEach(bindings,function(val,key){registerEvent(svg,key,val)})}function unregisterEvents(svg){forEach(bindings,function(val,key){unregisterEvent(svg,key,val)})}var HIT_STYLE=styles.cls("djs-hit",["no-fill","no-border"],{stroke:"white",strokeWidth:15}),handlers={},bindings={mouseover:"element.hover",mouseout:"element.out",click:"element.click",dblclick:"element.dblclick",mousedown:"element.mousedown",mouseup:"element.mouseup"},elementSelector="svg, .djs-element";eventBus.on("canvas.destroy",function(event){unregisterEvents(event.svg)}),eventBus.on("canvas.init",function(event){registerEvents(event.svg)}),eventBus.on(["shape.added","connection.added"],function(event){var hit,element=event.element,gfx=event.gfx;element.waypoints?hit=createLine(element.waypoints):(hit=svgCreate("rect"),svgAttr(hit,{x:0,y:0,width:element.width,height:element.height})),svgAttr(hit,HIT_STYLE),svgAppend(gfx,hit)}),eventBus.on("shape.changed",LOW_PRIORITY,function(event){var element=event.element,gfx=event.gfx,hit=domQuery(".djs-hit",gfx);svgAttr(hit,{width:element.width,height:element.height})}),eventBus.on("connection.changed",function(event){var element=event.element,gfx=event.gfx,hit=domQuery(".djs-hit",gfx);updateLine(hit,element.waypoints)}),this.fire=fire,this.triggerMouseEvent=triggerMouseEvent,this.mouseHandler=mouseHandler,this.registerEvent=registerEvent,this.unregisterEvent=unregisterEvent}var forEach=require("lodash/collection/forEach"),domDelegate=require("min-dom/lib/delegate"),isPrimaryButton=require("../../util/Mouse").isPrimaryButton,svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create"),domQuery=require("min-dom/lib/query"),renderUtil=require("../../util/RenderUtil"),createLine=renderUtil.createLine,updateLine=renderUtil.updateLine,LOW_PRIORITY=500;InteractionEvents.$inject=["eventBus","elementRegistry","styles"],module.exports=InteractionEvents},{"../../util/Mouse":337,"../../util/RenderUtil":341,"lodash/collection/forEach":369,"min-dom/lib/delegate":521,"min-dom/lib/query":525,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/create":552}],233:[function(require,module,exports){module.exports={__init__:["interactionEvents"],interactionEvents:["type",require("./InteractionEvents")]}},{"./InteractionEvents":232}],234:[function(require,module,exports){"use strict";function Keyboard(config,eventBus,editorActions){var self=this;this._config=config||{},this._eventBus=eventBus,this._editorActions=editorActions,this._listeners=[],this._keyHandler=function(event){var i,l,target=event.target,listeners=self._listeners,code=event.keyCode||event.charCode||-1;if(!target||!domMatches(target,"input, textarea")&&"true"!==target.contentEditable)for(i=0;l=listeners[i];i++)l(code,event)&&(event.preventDefault(),event.stopPropagation())},eventBus.on("diagram.destroy",function(){self._fire("destroy"),self.unbind(),self._listeners=null}),eventBus.on("diagram.init",function(){self._fire("init"),config&&config.bindTo&&self.bind(config.bindTo)}),this._init()}function hasModifier(modifiers){return modifiers.ctrlKey||modifiers.metaKey||modifiers.shiftKey||modifiers.altKey}function isCmd(modifiers){return modifiers.ctrlKey||modifiers.metaKey}function isShift(modifiers){return modifiers.shiftKey}var domEvent=require("min-dom/lib/event"),domMatches=require("min-dom/lib/matches");Keyboard.$inject=["config.keyboard","eventBus","editorActions"],module.exports=Keyboard,Keyboard.prototype.bind=function(node){this.unbind(),this._node=node,domEvent.bind(node,"keydown",this._keyHandler,!0),this._fire("bind")},Keyboard.prototype.getBinding=function(){return this._node},Keyboard.prototype.unbind=function(){var node=this._node;node&&(this._fire("unbind"),domEvent.unbind(node,"keydown",this._keyHandler,!0)),this._node=null},Keyboard.prototype._fire=function(event){this._eventBus.fire("keyboard."+event,{node:this._node,listeners:this._listeners})},Keyboard.prototype._init=function(){function undo(key,modifiers){if(isCmd(modifiers)&&!isShift(modifiers)&&90===key)return editorActions.trigger("undo"),!0}function redo(key,modifiers){if(isCmd(modifiers)&&(89===key||90===key&&isShift(modifiers)))return editorActions.trigger("redo"),!0}function copy(key,modifiers){if(isCmd(modifiers)&&67===key)return editorActions.trigger("copy"),!0}function paste(key,modifiers){if(isCmd(modifiers)&&86===key)return editorActions.trigger("paste"),!0}function zoomIn(key,modifiers){if((107===key||187===key||171===key||61===key)&&isCmd(modifiers))return editorActions.trigger("stepZoom",{value:1}),!0}function zoomOut(key,modifiers){if((109===key||189===key||173===key)&&isCmd(modifiers))return editorActions.trigger("stepZoom",{value:-1}),!0}function zoomDefault(key,modifiers){if((96===key||48===key)&&isCmd(modifiers))return editorActions.trigger("zoom",{value:1}),!0}function removeSelection(key,modifiers){if(46===key)return editorActions.trigger("removeSelection"),!0}function moveCanvas(key,modifiers){if([37,38,39,40].indexOf(key)>=0){var opts={invertY:config.invertY,speed:config.speed||50};switch(key){case 37:opts.direction="left";break;case 38:opts.direction="up";break;case 39:opts.direction="right";break;case 40:opts.direction="down"}return editorActions.trigger("moveCanvas",opts),!0}}var listeners=this._listeners,editorActions=this._editorActions,config=this._config;listeners.push(undo),listeners.push(redo),listeners.push(copy),listeners.push(paste),listeners.push(removeSelection),listeners.push(zoomIn),listeners.push(zoomOut),listeners.push(zoomDefault),listeners.push(moveCanvas)},Keyboard.prototype.addListener=function(listenerFn){this._listeners.push(listenerFn)},Keyboard.prototype.hasModifier=hasModifier,Keyboard.prototype.isCmd=isCmd,Keyboard.prototype.isShift=isShift},{"min-dom/lib/event":523,"min-dom/lib/matches":524}],235:[function(require,module,exports){module.exports={__init__:["keyboard"],keyboard:["type",require("./Keyboard")]}},{"./Keyboard":234}],236:[function(require,module,exports){"use strict";function LabelSupport(eventBus,modeling,movePreview){CommandInterceptor.call(this,eventBus),eventBus.on("shape.move.start",HIGH_PRIORITY,function(e){var context=e.context,shapes=context.shapes,validatedShapes=context.validatedShapes;context.shapes=removeLabels(shapes),context.validatedShapes=removeLabels(validatedShapes)}),eventBus.on("shape.move.start",LOW_PRIORITY,function(e){var context=e.context,shapes=context.shapes,labels=[];forEach(shapes,function(element){var label=element.label;label&&!label.hidden&&-1===context.shapes.indexOf(label)&&labels.push(label),element.labelTarget&&labels.push(element)}),forEach(labels,function(label){movePreview.makeDraggable(context,label,!0)})}),this.postExecuted(["elements.move"],function(e){var context=e.context,closure=context.closure,enclosedElements=closure.enclosedElements;forEach(enclosedElements,function(e){e.label&&!enclosedElements[e.label.id]&&modeling.moveShape(e.label,context.delta,e.parent)})})}function removeLabels(elements){return filter(elements,function(element){return-1===elements.indexOf(element.labelTarget)})}var forEach=require("lodash/collection/forEach"),filter=require("lodash/collection/filter"),inherits=require("inherits"),LOW_PRIORITY=250,HIGH_PRIORITY=1400,CommandInterceptor=require("../../command/CommandInterceptor");inherits(LabelSupport,CommandInterceptor),LabelSupport.$inject=["eventBus","modeling","movePreview"],module.exports=LabelSupport},{"../../command/CommandInterceptor":182,inherits:354,"lodash/collection/filter":367,"lodash/collection/forEach":369}],237:[function(require,module,exports){module.exports={__depends__:[require("../move")],__init__:["labelSupport"],labelSupport:["type",require("./LabelSupport")]}},{"../move":269,"./LabelSupport":236}],238:[function(require,module,exports){"use strict";function LassoTool(eventBus,canvas,dragging,elementRegistry,selection,toolManager){this._selection=selection,this._dragging=dragging;var self=this,visuals={create:function(context){var frame,container=canvas.getDefaultLayer();frame=context.frame=svgCreate("rect"),svgAttr(frame,{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),svgAppend(container,frame)},update:function(context){var frame=context.frame,bbox=context.bbox;svgAttr(frame,{x:bbox.x,y:bbox.y,width:bbox.width,height:bbox.height})},remove:function(context){context.frame&&svgRemove(context.frame)}};toolManager.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),eventBus.on("lasso.selection.end",function(event){var target=event.originalEvent.target;(event.hover||target instanceof SVGElement)&&eventBus.once("lasso.selection.ended",function(){self.activateLasso(event.originalEvent,!0)})}),eventBus.on("lasso.end",function(event){var bbox=toBBox(event),elements=elementRegistry.filter(function(element){return element});self.select(elements,bbox)}),eventBus.on("lasso.start",function(event){var context=event.context;context.bbox=toBBox(event),visuals.create(context)}),eventBus.on("lasso.move",function(event){var context=event.context;context.bbox=toBBox(event),visuals.update(context)}),eventBus.on("lasso.cleanup",function(event){var context=event.context;visuals.remove(context)}),eventBus.on("element.mousedown",1500,function(event){hasSecondaryModifier(event)&&(self.activateLasso(event.originalEvent),event.stopPropagation())})}function toBBox(event){var start={x:event.x-event.dx,y:event.y-event.dy},end={x:event.x,y:event.y};return start.x<=end.x&&start.y<end.y||start.x<end.x&&start.y<=end.y?{x:start.x,y:start.y,width:end.x-start.x,height:end.y-start.y}:start.x>=end.x&&start.y<end.y||start.x>end.x&&start.y<=end.y?{x:end.x,y:start.y,width:start.x-end.x,height:end.y-start.y}:start.x<=end.x&&start.y>end.y||start.x<end.x&&start.y>=end.y?{x:start.x,y:end.y,width:end.x-start.x,height:start.y-end.y}:start.x>=end.x&&start.y>end.y||start.x>end.x&&start.y>=end.y?{x:end.x,y:end.y,width:start.x-end.x,height:start.y-end.y}:{x:end.x,y:end.y,width:0,height:0}}var values=require("lodash/object/values"),getEnclosedElements=require("../../util/Elements").getEnclosedElements,hasSecondaryModifier=require("../../util/Mouse").hasSecondaryModifier,svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create"),svgRemove=require("tiny-svg/lib/remove");LassoTool.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager"],module.exports=LassoTool,LassoTool.prototype.activateLasso=function(event,autoActivate){this._dragging.init(event,"lasso",{autoActivate:autoActivate,cursor:"crosshair",data:{context:{}}})},LassoTool.prototype.activateSelection=function(event){this._dragging.init(event,"lasso.selection",{trapClick:!1,cursor:"crosshair",data:{context:{}}})},LassoTool.prototype.select=function(elements,bbox){var selectedElements=getEnclosedElements(elements,bbox);this._selection.select(values(selectedElements))},LassoTool.prototype.toggle=function(){this.isActive()?this._dragging.cancel():this.activateSelection()},LassoTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^lasso/.test(context.prefix)}},{"../../util/Elements":329,"../../util/Mouse":337,"lodash/object/values":513,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/create":552,"tiny-svg/lib/remove":555}],239:[function(require,module,exports){"use strict";module.exports={__depends__:[require("../tool-manager")],__init__:["lassoTool"],lassoTool:["type",require("./LassoTool")]}},{"../tool-manager":305,"./LassoTool":238}],240:[function(require,module,exports){"use strict";function Modeling(eventBus,elementFactory,commandStack){this._eventBus=eventBus,this._elementFactory=elementFactory,this._commandStack=commandStack;var self=this;eventBus.on("diagram.init",function(){self.registerHandlers(commandStack)})}var forEach=require("lodash/collection/forEach"),model=require("../../model");Modeling.$inject=["eventBus","elementFactory","commandStack"],module.exports=Modeling,Modeling.prototype.getHandlers=function(){return{"shape.append":require("./cmd/AppendShapeHandler"),"shape.create":require("./cmd/CreateShapeHandler"),"shape.delete":require("./cmd/DeleteShapeHandler"),"shape.move":require("./cmd/MoveShapeHandler"),"shape.resize":require("./cmd/ResizeShapeHandler"),"shape.replace":require("./cmd/ReplaceShapeHandler"),"shape.toggleCollapse":require("./cmd/ToggleShapeCollapseHandler"),spaceTool:require("./cmd/SpaceToolHandler"),"label.create":require("./cmd/CreateLabelHandler"),"connection.create":require("./cmd/CreateConnectionHandler"),"connection.delete":require("./cmd/DeleteConnectionHandler"),"connection.move":require("./cmd/MoveConnectionHandler"),"connection.layout":require("./cmd/LayoutConnectionHandler"),"connection.updateWaypoints":require("./cmd/UpdateWaypointsHandler"),"connection.reconnectStart":require("./cmd/ReconnectConnectionHandler"),"connection.reconnectEnd":require("./cmd/ReconnectConnectionHandler"),"elements.move":require("./cmd/MoveElementsHandler"),"elements.delete":require("./cmd/DeleteElementsHandler"),"elements.distribute":require("./cmd/DistributeElementsHandler"),"elements.align":require("./cmd/AlignElementsHandler"),"element.updateAttachment":require("./cmd/UpdateAttachmentHandler"),"elements.paste":require("./cmd/PasteHandler")}},Modeling.prototype.registerHandlers=function(commandStack){forEach(this.getHandlers(),function(handler,id){commandStack.registerHandler(id,handler)})},Modeling.prototype.moveShape=function(shape,delta,newParent,newParentIndex,hints){"object"==typeof newParentIndex&&(hints=newParentIndex,newParentIndex=null);var context={shape:shape,delta:delta,newParent:newParent,newParentIndex:newParentIndex,hints:hints||{}};this._commandStack.execute("shape.move",context)},Modeling.prototype.updateAttachment=function(shape,newHost){var context={shape:shape,newHost:newHost};this._commandStack.execute("element.updateAttachment",context)},Modeling.prototype.moveElements=function(shapes,delta,target,isAttach,hints){"object"==typeof isAttach&&(hints=isAttach,isAttach=void 0);var newHost,newParent=target;!0===isAttach&&(newHost=target,newParent=target.parent),!1===isAttach&&(newHost=null);var context={shapes:shapes,delta:delta,newParent:newParent,newHost:newHost,hints:hints||{}};this._commandStack.execute("elements.move",context)},Modeling.prototype.moveConnection=function(connection,delta,newParent,newParentIndex,hints){"object"==typeof newParentIndex&&(hints=newParentIndex,newParentIndex=void 0);var context={connection:connection,delta:delta,newParent:newParent,newParentIndex:newParentIndex,hints:hints||{}};this._commandStack.execute("connection.move",context)},Modeling.prototype.layoutConnection=function(connection,hints){var context={
connection:connection,hints:hints||{}};this._commandStack.execute("connection.layout",context)},Modeling.prototype.createConnection=function(source,target,targetIndex,connection,parent,hints){"object"==typeof targetIndex&&(hints=parent,parent=connection,connection=targetIndex,targetIndex=void 0),connection=this._create("connection",connection);var context={source:source,target:target,parent:parent,parentIndex:targetIndex,connection:connection,hints:hints};return this._commandStack.execute("connection.create",context),context.connection},Modeling.prototype.createShape=function(shape,position,target,targetIndex,isAttach,hints){"number"!=typeof targetIndex&&(hints=isAttach,isAttach=targetIndex),"boolean"!=typeof isAttach&&(hints=isAttach,isAttach=!1),shape=this._create("shape",shape);var context={position:position,shape:shape,parent:target,parentIndex:targetIndex,host:shape.host,hints:hints||{}};return isAttach&&(context.parent=target.parent,context.host=target),this._commandStack.execute("shape.create",context),context.shape},Modeling.prototype.createLabel=function(labelTarget,position,label,parent){label=this._create("label",label);var context={labelTarget:labelTarget,position:position,parent:parent||labelTarget.parent,shape:label};return this._commandStack.execute("label.create",context),context.shape},Modeling.prototype.appendShape=function(source,shape,position,parent,connection,connectionParent){shape=this._create("shape",shape);var context={source:source,position:position,parent:parent,shape:shape,connection:connection,connectionParent:connectionParent};return this._commandStack.execute("shape.append",context),context.shape},Modeling.prototype.removeElements=function(elements){var context={elements:elements};this._commandStack.execute("elements.delete",context)},Modeling.prototype.distributeElements=function(groups,axis,dimension){var context={groups:groups,axis:axis,dimension:dimension};this._commandStack.execute("elements.distribute",context)},Modeling.prototype.removeShape=function(shape,hints){var context={shape:shape,hints:hints||{}};this._commandStack.execute("shape.delete",context)},Modeling.prototype.removeConnection=function(connection,hints){var context={connection:connection,hints:hints||{}};this._commandStack.execute("connection.delete",context)},Modeling.prototype.replaceShape=function(oldShape,newShape,hints){var context={oldShape:oldShape,newData:newShape,hints:hints||{}};return this._commandStack.execute("shape.replace",context),context.newShape},Modeling.prototype.pasteElements=function(tree,topParent,position){var context={tree:tree,topParent:topParent,position:position};this._commandStack.execute("elements.paste",context)},Modeling.prototype.alignElements=function(elements,alignment){var context={elements:elements,alignment:alignment};this._commandStack.execute("elements.align",context)},Modeling.prototype.resizeShape=function(shape,newBounds){var context={shape:shape,newBounds:newBounds};this._commandStack.execute("shape.resize",context)},Modeling.prototype.createSpace=function(movingShapes,resizingShapes,delta,direction){var context={movingShapes:movingShapes,resizingShapes:resizingShapes,delta:delta,direction:direction};this._commandStack.execute("spaceTool",context)},Modeling.prototype.updateWaypoints=function(connection,newWaypoints,hints){var context={connection:connection,newWaypoints:newWaypoints,hints:hints||{}};this._commandStack.execute("connection.updateWaypoints",context)},Modeling.prototype.reconnectStart=function(connection,newSource,dockingOrPoints){var context={connection:connection,newSource:newSource,dockingOrPoints:dockingOrPoints};this._commandStack.execute("connection.reconnectStart",context)},Modeling.prototype.reconnectEnd=function(connection,newTarget,dockingOrPoints){var context={connection:connection,newTarget:newTarget,dockingOrPoints:dockingOrPoints};this._commandStack.execute("connection.reconnectEnd",context)},Modeling.prototype.connect=function(source,target,attrs,hints){return this.createConnection(source,target,attrs||{},source.parent,hints)},Modeling.prototype._create=function(type,attrs){return attrs instanceof model.Base?attrs:this._elementFactory.create(type,attrs)},Modeling.prototype.toggleCollapse=function(shape,hints){var context={shape:shape,hints:hints||{}};this._commandStack.execute("shape.toggleCollapse",context)}},{"../../model":317,"./cmd/AlignElementsHandler":241,"./cmd/AppendShapeHandler":242,"./cmd/CreateConnectionHandler":243,"./cmd/CreateLabelHandler":244,"./cmd/CreateShapeHandler":245,"./cmd/DeleteConnectionHandler":246,"./cmd/DeleteElementsHandler":247,"./cmd/DeleteShapeHandler":248,"./cmd/DistributeElementsHandler":249,"./cmd/LayoutConnectionHandler":250,"./cmd/MoveConnectionHandler":251,"./cmd/MoveElementsHandler":252,"./cmd/MoveShapeHandler":253,"./cmd/PasteHandler":255,"./cmd/ReconnectConnectionHandler":256,"./cmd/ReplaceShapeHandler":257,"./cmd/ResizeShapeHandler":258,"./cmd/SpaceToolHandler":259,"./cmd/ToggleShapeCollapseHandler":260,"./cmd/UpdateAttachmentHandler":261,"./cmd/UpdateWaypointsHandler":262,"lodash/collection/forEach":369}],241:[function(require,module,exports){"use strict";function AlignElements(modeling,canvas){this._modeling=modeling,this._canvas=canvas}var forEach=require("lodash/collection/forEach");AlignElements.$inject=["modeling","canvas"],module.exports=AlignElements,AlignElements.prototype.preExecute=function(context){var modeling=this._modeling,elements=context.elements,alignment=context.alignment;forEach(elements,function(element){var delta={x:0,y:0};alignment.left?delta.x=alignment.left-element.x:alignment.right?delta.x=alignment.right-element.width-element.x:alignment.center?delta.x=alignment.center-Math.round(element.width/2)-element.x:alignment.top?delta.y=alignment.top-element.y:alignment.bottom?delta.y=alignment.bottom-element.height-element.y:alignment.middle&&(delta.y=alignment.middle-Math.round(element.height/2)-element.y),modeling.moveElements([element],delta,element.parent)})},AlignElements.prototype.postExecute=function(context){}},{"lodash/collection/forEach":369}],242:[function(require,module,exports){"use strict";function AppendShapeHandler(modeling){this._modeling=modeling}function existsConnection(source,target){return any(source.outgoing,function(c){return c.target===target})}var any=require("lodash/collection/any");require("inherits")(AppendShapeHandler,require("./NoopHandler")),AppendShapeHandler.$inject=["modeling"],module.exports=AppendShapeHandler,AppendShapeHandler.prototype.preExecute=function(context){if(!context.source)throw new Error("source required");var parent=context.parent||context.source.parent,shape=this._modeling.createShape(context.shape,context.position,parent);context.shape=shape},AppendShapeHandler.prototype.postExecute=function(context){var parent=context.connectionParent||context.shape.parent;existsConnection(context.source,context.shape)||this._modeling.connect(context.source,context.shape,context.connection,parent)}},{"./NoopHandler":254,inherits:354,"lodash/collection/any":365}],243:[function(require,module,exports){"use strict";function CreateConnectionHandler(canvas,layouter){this._canvas=canvas,this._layouter=layouter}CreateConnectionHandler.$inject=["canvas","layouter"],module.exports=CreateConnectionHandler,CreateConnectionHandler.prototype.execute=function(context){var connection=context.connection,source=context.source,target=context.target,parent=context.parent,hints=context.hints;if(!source||!target)throw new Error("source and target required");if(!parent)throw new Error("parent required");return connection.source=source,connection.target=target,connection.waypoints||(connection.waypoints=this._layouter.layoutConnection(connection,hints)),this._canvas.addConnection(connection,parent),connection},CreateConnectionHandler.prototype.revert=function(context){var connection=context.connection;this._canvas.removeConnection(connection),connection.source=null,connection.target=null}},{}],244:[function(require,module,exports){"use strict";function CreateLabelHandler(canvas){CreateShapeHandler.call(this,canvas)}function ensureValidDimensions(label){["width","height"].forEach(function(prop){void 0===label[prop]&&(label[prop]=0)})}var inherits=require("inherits"),CreateShapeHandler=require("./CreateShapeHandler");inherits(CreateLabelHandler,CreateShapeHandler),CreateLabelHandler.$inject=["canvas"],module.exports=CreateLabelHandler;var originalExecute=CreateShapeHandler.prototype.execute;CreateLabelHandler.prototype.execute=function(context){var label=context.shape;return ensureValidDimensions(label),label.labelTarget=context.labelTarget,originalExecute.call(this,context)};var originalRevert=CreateShapeHandler.prototype.revert;CreateLabelHandler.prototype.revert=function(context){return context.shape.labelTarget=null,originalRevert.call(this,context)}},{"./CreateShapeHandler":245,inherits:354}],245:[function(require,module,exports){"use strict";function CreateShapeHandler(canvas){this._canvas=canvas}var assign=require("lodash/object/assign"),round=Math.round;CreateShapeHandler.$inject=["canvas"],module.exports=CreateShapeHandler,CreateShapeHandler.prototype.execute=function(context){var shape=context.shape,positionOrBounds=context.position,parent=context.parent,parentIndex=context.parentIndex;if(!parent)throw new Error("parent required");if(!positionOrBounds)throw new Error("position required");return void 0!==positionOrBounds.width?assign(shape,positionOrBounds):assign(shape,{x:positionOrBounds.x-round(shape.width/2),y:positionOrBounds.y-round(shape.height/2)}),this._canvas.addShape(shape,parent,parentIndex),shape},CreateShapeHandler.prototype.revert=function(context){this._canvas.removeShape(context.shape)}},{"lodash/object/assign":502}],246:[function(require,module,exports){"use strict";function DeleteConnectionHandler(canvas,modeling){this._canvas=canvas,this._modeling=modeling}var Collections=require("../../../util/Collections");DeleteConnectionHandler.$inject=["canvas","modeling"],module.exports=DeleteConnectionHandler,DeleteConnectionHandler.prototype.preExecute=function(context){var connection=context.connection;connection.label&&this._modeling.removeShape(connection.label)},DeleteConnectionHandler.prototype.execute=function(context){var connection=context.connection,parent=connection.parent;return context.parent=parent,context.parentIndex=Collections.indexOf(parent.children,connection),context.source=connection.source,context.target=connection.target,this._canvas.removeConnection(connection),connection.source=null,connection.target=null,connection.label=null,connection},DeleteConnectionHandler.prototype.revert=function(context){var connection=context.connection,parent=context.parent,parentIndex=context.parentIndex;return connection.source=context.source,connection.target=context.target,Collections.add(parent.children,connection,parentIndex),this._canvas.addConnection(connection,parent),connection}},{"../../../util/Collections":326}],247:[function(require,module,exports){"use strict";function DeleteElementsHandler(modeling,elementRegistry){this._modeling=modeling,this._elementRegistry=elementRegistry}var forEach=require("lodash/collection/forEach");require("inherits")(DeleteElementsHandler,require("./NoopHandler")),DeleteElementsHandler.$inject=["modeling","elementRegistry"],module.exports=DeleteElementsHandler,DeleteElementsHandler.prototype.postExecute=function(context){var modeling=this._modeling,elementRegistry=this._elementRegistry,elements=context.elements;forEach(elements,function(element){elementRegistry.get(element.id)&&(element.waypoints?modeling.removeConnection(element):modeling.removeShape(element))})}},{"./NoopHandler":254,inherits:354,"lodash/collection/forEach":369}],248:[function(require,module,exports){"use strict";function DeleteShapeHandler(canvas,modeling){this._canvas=canvas,this._modeling=modeling}var Collections=require("../../../util/Collections"),saveClear=require("../../../util/Removal").saveClear;DeleteShapeHandler.$inject=["canvas","modeling"],module.exports=DeleteShapeHandler,DeleteShapeHandler.prototype.preExecute=function(context){var modeling=this._modeling,shape=context.shape,label=shape.label;shape.labelTarget&&(context.labelTarget=shape.labelTarget,shape.labelTarget=null),label&&this._modeling.removeShape(label,{nested:!0}),saveClear(shape.incoming,function(connection){modeling.removeConnection(connection,{nested:!0})}),saveClear(shape.outgoing,function(connection){modeling.removeConnection(connection,{nested:!0})}),saveClear(shape.children,function(e){modeling.removeShape(e,{nested:!0})})},DeleteShapeHandler.prototype.execute=function(context){var canvas=this._canvas,shape=context.shape,oldParent=shape.parent;return context.oldParent=oldParent,context.oldParentIndex=Collections.indexOf(oldParent.children,shape),shape.label=null,canvas.removeShape(shape),shape},DeleteShapeHandler.prototype.revert=function(context){var canvas=this._canvas,shape=context.shape,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,labelTarget=context.labelTarget;return Collections.add(oldParent.children,shape,oldParentIndex),labelTarget&&(labelTarget.label=shape),canvas.addShape(shape,oldParent),shape}},{"../../../util/Collections":326,"../../../util/Removal":340}],249:[function(require,module,exports){"use strict";function DistributeElements(modeling){this._modeling=modeling}var forEach=require("lodash/collection/forEach"),sortBy=require("lodash/collection/sortBy");DistributeElements.$inject=["modeling"],module.exports=DistributeElements;var OFF_AXIS={x:"y",y:"x"};DistributeElements.prototype.preExecute=function(context){function updateRange(group,element){group.range.min=Math.min(element[axis],group.range.min),group.range.max=Math.max(element[axis]+element[dimension],group.range.max)}function center(element){return element[axis]+element[dimension]/2}function lastIdx(arr){return arr.length-1}function rangeDiff(range){return range.max-range.min}function centerElement(refCenter,element){var delta={y:0};delta[axis]=refCenter-center(element),delta[axis]&&(delta[OFF_AXIS[axis]]=0,modeling.moveElements([element],delta,element.parent))}var margin,spaceInBetween,modeling=this._modeling,groups=context.groups,axis=context.axis,dimension=context.dimension,firstGroup=groups[0],lastGroupIdx=lastIdx(groups),lastGroup=groups[lastGroupIdx],groupsSize=0;forEach(groups,function(group,idx){var sortedElements,refElem,refCenter;if(group.elements.length<2)return void(idx&&idx!==groups.length-1&&(updateRange(group,group.elements[0]),groupsSize+=rangeDiff(group.range)));sortedElements=sortBy(group.elements,axis),refElem=sortedElements[0],idx===lastGroupIdx&&(refElem=sortedElements[lastIdx(sortedElements)]),refCenter=center(refElem),group.range=null,forEach(sortedElements,function(element){if(centerElement(refCenter,element),null===group.range)return void(group.range={min:element[axis],max:element[axis]+element[dimension]});updateRange(group,element)}),idx&&idx!==groups.length-1&&(groupsSize+=rangeDiff(group.range))}),spaceInBetween=Math.abs(lastGroup.range.min-firstGroup.range.max),(margin=Math.round((spaceInBetween-groupsSize)/(groups.length-1)))<groups.length-1||forEach(groups,function(group,groupIdx){var prevGroup,delta={};group!==firstGroup&&group!==lastGroup&&(prevGroup=groups[groupIdx-1],group.range.max=0,forEach(group.elements,function(element,idx){delta[OFF_AXIS[axis]]=0,delta[axis]=prevGroup.range.max-element[axis]+margin,group.range.min!==element[axis]&&(delta[axis]+=element[axis]-group.range.min),delta[axis]&&modeling.moveElements([element],delta,element.parent),group.range.max=Math.max(element[axis]+element[dimension],idx?group.range.max:0)}))})},DistributeElements.prototype.postExecute=function(context){}},{"lodash/collection/forEach":369,"lodash/collection/sortBy":378}],250:[function(require,module,exports){"use strict";function LayoutConnectionHandler(layouter,canvas){this._layouter=layouter,this._canvas=canvas}function sendToFront(connection){function findIndex(array,obj){var index=array.indexOf(obj);if(index<0&&obj){index=findIndex(array,obj.parent)}return index}var connectionSiblings=connection.parent.children,connectionIdx=connectionSiblings.indexOf(connection),sourceIdx=findIndex(connectionSiblings,connection.source),targetIdx=findIndex(connectionSiblings,connection.target),insertIndex=Math.max(sourceIdx+1,targetIdx+1,connectionIdx);return connectionIdx<insertIndex&&(connectionSiblings.splice(insertIndex,0,connection),connectionSiblings.splice(connectionIdx,1)),insertIndex}var assign=require("lodash/object/assign");LayoutConnectionHandler.$inject=["layouter","canvas"],module.exports=LayoutConnectionHandler,LayoutConnectionHandler.prototype.execute=function(context){var connection=context.connection,parent=connection.parent,connectionSiblings=parent.children,oldIndex=connectionSiblings.indexOf(connection),oldWaypoints=connection.waypoints;return assign(context,{oldWaypoints:oldWaypoints,oldIndex:oldIndex}),sendToFront(connection),connection.waypoints=this._layouter.layoutConnection(connection,context.hints),connection},LayoutConnectionHandler.prototype.revert=function(context){var connection=context.connection,parent=connection.parent,connectionSiblings=parent.children,currentIndex=connectionSiblings.indexOf(connection),oldIndex=context.oldIndex;return connection.waypoints=context.oldWaypoints,oldIndex!==currentIndex&&(connectionSiblings.splice(currentIndex,1),connectionSiblings.splice(oldIndex,0,connection)),connection}},{"lodash/object/assign":502}],251:[function(require,module,exports){"use strict";function MoveConnectionHandler(){}var forEach=require("lodash/collection/forEach"),Collections=require("../../../util/Collections");module.exports=MoveConnectionHandler,MoveConnectionHandler.prototype.execute=function(context){var connection=context.connection,delta=context.delta,newParent=context.newParent||connection.parent,newParentIndex=context.newParentIndex,oldParent=connection.parent;return context.oldParent=oldParent,context.oldParentIndex=Collections.remove(oldParent.children,connection),Collections.add(newParent.children,connection,newParentIndex),connection.parent=newParent,forEach(connection.waypoints,function(p){p.x+=delta.x,p.y+=delta.y,p.original&&(p.original.x+=delta.x,p.original.y+=delta.y)}),connection},MoveConnectionHandler.prototype.revert=function(context){var connection=context.connection,newParent=connection.parent,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,delta=context.delta;return Collections.remove(newParent.children,connection),Collections.add(oldParent.children,connection,oldParentIndex),connection.parent=oldParent,forEach(connection.waypoints,function(p){p.x-=delta.x,p.y-=delta.y,p.original&&(p.original.x-=delta.x,p.original.y-=delta.y)}),connection}},{"../../../util/Collections":326,"lodash/collection/forEach":369}],252:[function(require,module,exports){"use strict";function MoveElementsHandler(modeling){this._helper=new MoveHelper(modeling)}var MoveHelper=require("./helper/MoveHelper");MoveElementsHandler.$inject=["modeling"],module.exports=MoveElementsHandler,MoveElementsHandler.prototype.preExecute=function(context){context.closure=this._helper.getClosure(context.shapes)},MoveElementsHandler.prototype.postExecute=function(context){var primaryShape,hints=context.hints;hints&&hints.primaryShape&&(primaryShape=hints.primaryShape,hints.oldParent=primaryShape.parent),this._helper.moveClosure(context.closure,context.delta,context.newParent,context.newHost,primaryShape)},MoveElementsHandler.prototype.execute=function(context){},MoveElementsHandler.prototype.revert=function(context){}},{"./helper/MoveHelper":264}],253:[function(require,module,exports){"use strict";function MoveShapeHandler(modeling){this._modeling=modeling,this._helper=new MoveHelper(modeling)}var assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),pick=require("lodash/object/pick"),MoveHelper=require("./helper/MoveHelper"),Collections=require("../../../util/Collections"),getMovedSourceAnchor=require("./helper/AnchorsHelper").getMovedSourceAnchor,getMovedTargetAnchor=require("./helper/AnchorsHelper").getMovedTargetAnchor;MoveShapeHandler.$inject=["modeling"],module.exports=MoveShapeHandler,MoveShapeHandler.prototype.execute=function(context){var shape=context.shape,delta=context.delta,newParent=context.newParent||shape.parent,newParentIndex=context.newParentIndex,oldParent=shape.parent;return context.oldBounds=pick(shape,["x","y","width","height"]),context.oldParent=oldParent,context.oldParentIndex=Collections.remove(oldParent.children,shape),Collections.add(newParent.children,shape,newParentIndex),assign(shape,{parent:newParent,x:shape.x+delta.x,y:shape.y+delta.y}),shape},MoveShapeHandler.prototype.postExecute=function(context){var shape=context.shape,delta=context.delta,hints=context.hints,modeling=this._modeling;!1!==hints.layout&&(forEach(shape.incoming,function(c){modeling.layoutConnection(c,{connectionEnd:getMovedTargetAnchor(c,shape,delta)})}),forEach(shape.outgoing,function(c){modeling.layoutConnection(c,{connectionStart:getMovedSourceAnchor(c,shape,delta)})})),!1!==hints.recurse&&this.moveChildren(context)},MoveShapeHandler.prototype.revert=function(context){var shape=context.shape,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,delta=context.delta;return Collections.add(oldParent.children,shape,oldParentIndex),assign(shape,{parent:oldParent,x:shape.x-delta.x,y:shape.y-delta.y}),shape},MoveShapeHandler.prototype.moveChildren=function(context){var delta=context.delta,shape=context.shape;this._helper.moveRecursive(shape.children,delta,null)},MoveShapeHandler.prototype.getNewParent=function(context){return context.newParent||context.shape.parent}},{"../../../util/Collections":326,"./helper/AnchorsHelper":263,"./helper/MoveHelper":264,"lodash/collection/forEach":369,"lodash/object/assign":502,"lodash/object/pick":511}],254:[function(require,module,exports){"use strict";function NoopHandler(){}module.exports=NoopHandler,NoopHandler.prototype.execute=function(){},NoopHandler.prototype.revert=function(){}},{}],255:[function(require,module,exports){"use strict";function removeProperties(element,properties){forEach(properties,function(prop){element[prop]&&delete element[prop]})}function PasteHandler(eventBus,canvas,selection,elementFactory,modeling,rules){this._eventBus=eventBus,this._canvas=canvas,this._selection=selection,this._elementFactory=elementFactory,this._modeling=modeling,this._rules=rules}var forEach=require("lodash/collection/forEach"),map=require("lodash/collection/map"),sortBy=require("lodash/collection/sortBy"),clone=require("lodash/lang/clone");require("inherits")(PasteHandler,require("./NoopHandler")),PasteHandler.$inject=["eventBus","canvas","selection","elementFactory","modeling","rules"],module.exports=PasteHandler,PasteHandler.prototype.preExecute=function(context){var eventBus=this._eventBus,tree=context.tree,topParent=context.topParent,position=context.position;tree.createdElements={},tree.labels=[],forEach(tree,function(elements,depthStr){var depth=parseInt(depthStr,10);isNaN(depth)||(depth||(elements=map(elements,function(descriptor){return descriptor.parent=topParent,descriptor})),elements=sortBy(elements,"priority"),forEach(elements,function(descriptor){var hints,newPosition,id=descriptor.id,parent=descriptor.parent,isAttach=!1,element=clone(descriptor);if(depth&&(element.parent=this._getCreatedElement(parent,tree)),parent){if(eventBus.fire("element.paste",{createdElements:tree.createdElements,descriptor:element}),parent=element.parent,element.waypoints)return void((element=this._createConnection(element,parent,position,tree))&&(tree.createdElements[id]={element:element,descriptor:descriptor}));if(element.parent!==topParent&&(hints={root:!1}),element.host&&(isAttach=!0,parent=this._getCreatedElement(element.host,tree)),element.labelTarget)return tree.labels.push(element);newPosition={x:Math.round(position.x+element.delta.x+element.width/2),y:Math.round(position.y+element.delta.y+element.height/2)},removeProperties(element,["id","parent","delta","host","priority"]),(element=this._createShape(element,parent,newPosition,isAttach,hints))&&(tree.createdElements[id]={element:element,descriptor:descriptor})}},this))},this)},PasteHandler.prototype.postExecute=function(context){var modeling=this._modeling,selection=this._selection,tree=context.tree,labels=tree.labels,topLevelElements=[];forEach(labels,function(labelDescriptor){var label,labelTargetPos,newPosition,labelTarget=this._getCreatedElement(labelDescriptor.labelTarget,tree);labelTarget&&(label=labelTarget.label)&&(labelTargetPos={x:labelTarget.x,y:labelTarget.y},labelTarget.waypoints&&(labelTargetPos=labelTarget.waypoints[0]),newPosition={x:Math.round(labelTargetPos.x-label.x+labelDescriptor.delta.x),y:Math.round(labelTargetPos.y-label.y+labelDescriptor.delta.y)},modeling.moveShape(label,newPosition,labelTarget.parent))},this),forEach(tree[0],function(descriptor){var id=descriptor.id,toplevel=tree.createdElements[id];toplevel&&topLevelElements.push(toplevel.element)}),selection.select(topLevelElements)},PasteHandler.prototype._createConnection=function(element,parent,parentCenter,tree){var source,target,modeling=this._modeling,rules=this._rules;return element.waypoints=map(element.waypoints,function(waypoint,idx){return{x:Math.round(parentCenter.x+element.delta[idx].x),y:Math.round(parentCenter.y+element.delta[idx].y)}}),source=this._getCreatedElement(element.source,tree),target=this._getCreatedElement(element.target,tree),source&&target&&rules.allowed("element.paste",{source:source,target:target})?(removeProperties(element,["id","parent","delta","source","target","width","height","priority"]),modeling.createConnection(source,target,element,parent)):null},PasteHandler.prototype._createShape=function(element,parent,position,isAttach,hints){var modeling=this._modeling,elementFactory=this._elementFactory;if(!this._rules.allowed("element.paste",{element:element,position:position,parent:parent}))return null;var shape=elementFactory.createShape(element);return modeling.createShape(shape,position,parent,isAttach,hints),shape},PasteHandler.prototype._getCreatedElement=function(id,tree){return tree.createdElements[id]&&tree.createdElements[id].element}},{"./NoopHandler":254,inherits:354,"lodash/collection/forEach":369,"lodash/collection/map":373,"lodash/collection/sortBy":378,"lodash/lang/clone":490}],256:[function(require,module,exports){"use strict";function ReconnectConnectionHandler(){}var isArray=require("lodash/lang/isArray");ReconnectConnectionHandler.$inject=[],module.exports=ReconnectConnectionHandler,ReconnectConnectionHandler.prototype.execute=function(context){var newWaypoints,newSource=context.newSource,newTarget=context.newTarget,connection=context.connection,dockingOrPoints=context.dockingOrPoints,oldWaypoints=connection.waypoints;if(!newSource&&!newTarget)throw new Error("newSource or newTarget are required");if(newSource&&newTarget)throw new Error("must specify either newSource or newTarget");return context.oldWaypoints=oldWaypoints,isArray(dockingOrPoints)?newWaypoints=dockingOrPoints:(newWaypoints=oldWaypoints.slice(),newWaypoints.splice(newSource?0:-1,1,dockingOrPoints)),newSource&&(context.oldSource=connection.source,connection.source=newSource),newTarget&&(context.oldTarget=connection.target,connection.target=newTarget),connection.waypoints=newWaypoints,connection},ReconnectConnectionHandler.prototype.revert=function(context){var newSource=context.newSource,newTarget=context.newTarget,connection=context.connection;return newSource&&(connection.source=context.oldSource),newTarget&&(connection.target=context.oldTarget),connection.waypoints=context.oldWaypoints,connection}},{"lodash/lang/isArray":492}],257:[function(require,module,exports){"use strict";function ReplaceShapeHandler(modeling,rules){this._modeling=modeling,this._rules=rules}var forEach=require("lodash/collection/forEach");ReplaceShapeHandler.$inject=["modeling","rules"],module.exports=ReplaceShapeHandler,ReplaceShapeHandler.prototype.preExecute=function(context){function canReconnect(type,source,target,connection){return rules.allowed(type,{source:source,target:target,connection:connection})}var newShape,self=this,modeling=this._modeling,rules=this._rules,oldShape=context.oldShape,newData=context.newData,hints=context.hints,position={x:newData.x,y:newData.y};newShape=context.newShape=context.newShape||self.createShape(newData,position,oldShape.parent),oldShape.host&&modeling.updateAttachment(newShape,oldShape.host);var children;!1!==hints.moveChildren&&(children=oldShape.children.slice(),modeling.moveElements(children,{x:0,y:0},newShape));var incoming=oldShape.incoming.slice(),outgoing=oldShape.outgoing.slice();forEach(incoming,function(connection){var waypoints=connection.waypoints,docking=waypoints[waypoints.length-1];canReconnect("connection.reconnectEnd",connection.source,newShape,connection)&&self.reconnectEnd(connection,newShape,docking)}),forEach(outgoing,function(connection){var waypoints=connection.waypoints,docking=waypoints[0],target=connection.target;canReconnect("connection.reconnectStart",newShape,target,connection)&&self.reconnectStart(connection,newShape,docking)})},ReplaceShapeHandler.prototype.postExecute=function(context){var modeling=this._modeling,oldShape=context.oldShape,newShape=context.newShape;forEach(newShape.incoming,function(c){modeling.layoutConnection(c,{endChanged:!0})}),forEach(newShape.outgoing,function(c){modeling.layoutConnection(c,{startChanged:!0})}),modeling.removeShape(oldShape)},ReplaceShapeHandler.prototype.execute=function(context){},ReplaceShapeHandler.prototype.revert=function(context){},ReplaceShapeHandler.prototype.createShape=function(shape,position,target){return this._modeling.createShape(shape,position,target)},ReplaceShapeHandler.prototype.reconnectStart=function(connection,newSource,dockingPoint){this._modeling.reconnectStart(connection,newSource,dockingPoint)},ReplaceShapeHandler.prototype.reconnectEnd=function(connection,newTarget,dockingPoint){this._modeling.reconnectEnd(connection,newTarget,dockingPoint)}},{"lodash/collection/forEach":369}],258:[function(require,module,exports){"use strict";function ResizeShapeHandler(modeling){this._modeling=modeling}var assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),getResizedSourceAnchor=require("./helper/AnchorsHelper").getResizedSourceAnchor,getResizedTargetAnchor=require("./helper/AnchorsHelper").getResizedTargetAnchor;ResizeShapeHandler.$inject=["modeling"],module.exports=ResizeShapeHandler,ResizeShapeHandler.prototype.execute=function(context){var shape=context.shape,newBounds=context.newBounds;if(void 0===newBounds.x||void 0===newBounds.y||void 0===newBounds.width||void 0===newBounds.height)throw new Error("newBounds must have {x, y, width, height} properties");if(newBounds.width<10||newBounds.height<10)throw new Error("width and height cannot be less than 10px");return context.oldBounds={width:shape.width,height:shape.height,x:shape.x,y:shape.y},assign(shape,{width:newBounds.width,height:newBounds.height,x:newBounds.x,y:newBounds.y}),shape},ResizeShapeHandler.prototype.postExecute=function(context){var shape=context.shape,oldBounds=context.oldBounds,modeling=this._modeling;forEach(shape.incoming,function(c){modeling.layoutConnection(c,{connectionEnd:getResizedTargetAnchor(c,shape,oldBounds)})}),forEach(shape.outgoing,function(c){modeling.layoutConnection(c,{connectionStart:getResizedSourceAnchor(c,shape,oldBounds)})})},ResizeShapeHandler.prototype.revert=function(context){var shape=context.shape,oldBounds=context.oldBounds;return assign(shape,{width:oldBounds.width,height:oldBounds.height,x:oldBounds.x,y:oldBounds.y}),shape}},{"./helper/AnchorsHelper":263,"lodash/collection/forEach":369,"lodash/object/assign":502}],259:[function(require,module,exports){
"use strict";function SpaceToolHandler(modeling){this._modeling=modeling}var forEach=require("lodash/collection/forEach"),SpaceUtil=require("../../space-tool/SpaceUtil");SpaceToolHandler.$inject=["modeling"],module.exports=SpaceToolHandler,SpaceToolHandler.prototype.preExecute=function(context){var modeling=this._modeling,resizingShapes=context.resizingShapes,delta=context.delta,direction=context.direction;forEach(resizingShapes,function(shape){var newBounds=SpaceUtil.resizeBounds(shape,direction,delta);modeling.resizeShape(shape,newBounds)})},SpaceToolHandler.prototype.postExecute=function(context){var modeling=this._modeling,movingShapes=context.movingShapes,delta=context.delta;modeling.moveElements(movingShapes,delta,void 0,!1,{autoResize:!1})},SpaceToolHandler.prototype.execute=function(context){},SpaceToolHandler.prototype.revert=function(context){}},{"../../space-tool/SpaceUtil":302,"lodash/collection/forEach":369}],260:[function(require,module,exports){"use strict";function ToggleShapeCollapseHandler(modeling){this._modeling=modeling}function getElementsVisibility(elements){var result={};return elements.forEach(function(e){result[e.id]=e.hidden}),result}function setHidden(elements,newHidden){elements.forEach(function(element){element.hidden=newHidden})}function restoreVisibility(elements,lastState){elements.forEach(function(e){e.hidden=lastState[e.id]})}ToggleShapeCollapseHandler.$inject=["modeling"],module.exports=ToggleShapeCollapseHandler,ToggleShapeCollapseHandler.prototype.execute=function(context){var shape=context.shape,children=shape.children;return context.oldChildrenVisibility=getElementsVisibility(children),shape.collapsed=!shape.collapsed,setHidden(children,shape.collapsed),[shape].concat(children)},ToggleShapeCollapseHandler.prototype.revert=function(context){var shape=context.shape,oldChildrenVisibility=context.oldChildrenVisibility,children=shape.children;return restoreVisibility(children,oldChildrenVisibility),shape.collapsed=!shape.collapsed,[shape].concat(children)}},{}],261:[function(require,module,exports){"use strict";function UpdateAttachmentHandler(modeling){this._modeling=modeling}function removeAttacher(host,attacher){return Collections.remove(host&&host.attachers,attacher)}function addAttacher(host,attacher,idx){if(host){var attachers=host.attachers;attachers||(host.attachers=attachers=[]),Collections.add(attachers,attacher,idx)}}var Collections=require("../../../util/Collections");module.exports=UpdateAttachmentHandler,UpdateAttachmentHandler.$inject=["modeling"],UpdateAttachmentHandler.prototype.execute=function(context){var shape=context.shape,newHost=context.newHost,oldHost=shape.host;return context.oldHost=oldHost,context.attacherIdx=removeAttacher(oldHost,shape),addAttacher(newHost,shape),shape.host=newHost,shape},UpdateAttachmentHandler.prototype.revert=function(context){var shape=context.shape,newHost=context.newHost,oldHost=context.oldHost,attacherIdx=context.attacherIdx;return shape.host=oldHost,removeAttacher(newHost,shape),addAttacher(oldHost,shape,attacherIdx),shape}},{"../../../util/Collections":326}],262:[function(require,module,exports){"use strict";function UpdateWaypointsHandler(){}module.exports=UpdateWaypointsHandler,UpdateWaypointsHandler.prototype.execute=function(context){var connection=context.connection,newWaypoints=context.newWaypoints;return context.oldWaypoints=connection.waypoints,connection.waypoints=newWaypoints,connection},UpdateWaypointsHandler.prototype.revert=function(context){var connection=context.connection,oldWaypoints=context.oldWaypoints;return connection.waypoints=oldWaypoints,connection}},{}],263:[function(require,module,exports){"use strict";function getResizedSourceAnchor(connection,shape,oldBounds){var waypoints=safeGetWaypoints(connection),oldAnchor=waypoints[0];return getNewAttachPoint(oldAnchor.original||oldAnchor,oldBounds,shape)}function getResizedTargetAnchor(connection,shape,oldBounds){var waypoints=safeGetWaypoints(connection),oldAnchor=waypoints[waypoints.length-1];return getNewAttachPoint(oldAnchor.original||oldAnchor,oldBounds,shape)}function getMovedSourceAnchor(connection,source,moveDelta){return getResizedSourceAnchor(connection,source,substractPosition(source,moveDelta))}function getMovedTargetAnchor(connection,target,moveDelta){return getResizedTargetAnchor(connection,target,substractPosition(target,moveDelta))}function substractPosition(bounds,delta){return{x:bounds.x-delta.x,y:bounds.y-delta.y,width:bounds.width,height:bounds.height}}function safeGetWaypoints(connection){var waypoints=connection.waypoints;if(!waypoints.length)throw new Error("connection#"+connection.id+": no waypoints");return waypoints}var getNewAttachPoint=require("../../../../util/AttachUtil").getNewAttachPoint;module.exports.getResizedSourceAnchor=getResizedSourceAnchor,module.exports.getResizedTargetAnchor=getResizedTargetAnchor,module.exports.getMovedSourceAnchor=getMovedSourceAnchor,module.exports.getMovedTargetAnchor=getMovedTargetAnchor},{"../../../../util/AttachUtil":324}],264:[function(require,module,exports){"use strict";function MoveHelper(modeling){this._modeling=modeling}var forEach=require("lodash/collection/forEach"),Elements=require("../../../../util/Elements"),getMovedSourceAnchor=require("./AnchorsHelper").getMovedSourceAnchor,getMovedTargetAnchor=require("./AnchorsHelper").getMovedTargetAnchor;module.exports=MoveHelper,MoveHelper.prototype.moveRecursive=function(elements,delta,newParent){return elements?this.moveClosure(this.getClosure(elements),delta,newParent):[]},MoveHelper.prototype.moveClosure=function(closure,delta,newParent,newHost,primaryShape){var modeling=this._modeling,allShapes=closure.allShapes,allConnections=closure.allConnections,enclosedConnections=closure.enclosedConnections,topLevel=closure.topLevel,keepParent=!1;primaryShape&&primaryShape.parent===newParent&&(keepParent=!0),forEach(allShapes,function(shape){modeling.moveShape(shape,delta,topLevel[shape.id]&&!keepParent&&newParent,{recurse:!1,layout:!1})}),forEach(allConnections,function(c){var sourceMoved=!!allShapes[c.source.id],targetMoved=!!allShapes[c.target.id];enclosedConnections[c.id]&&sourceMoved&&targetMoved?modeling.moveConnection(c,delta,topLevel[c.id]&&!keepParent&&newParent):modeling.layoutConnection(c,{connectionStart:sourceMoved&&getMovedSourceAnchor(c,c.source,delta),connectionEnd:targetMoved&&getMovedTargetAnchor(c,c.target,delta)})})},MoveHelper.prototype.getClosure=function(elements){return Elements.getClosure(elements)}},{"../../../../util/Elements":329,"./AnchorsHelper":263,"lodash/collection/forEach":369}],265:[function(require,module,exports){"use strict";function MouseTracking(eventBus,canvas){this._eventBus=eventBus,this._canvas=canvas,this._init()}var bind=require("lodash/function/bind");MouseTracking.$inject=["eventBus","canvas"],module.exports=MouseTracking,MouseTracking.prototype.getHoverContext=function(){var viewbox=this._canvas.viewbox();return{element:this._hoverElement,point:{x:viewbox.x+Math.round(this._mouseX/viewbox.scale),y:viewbox.y+Math.round(this._mouseY/viewbox.scale)}}},MouseTracking.prototype._init=function(){var eventBus=this._eventBus,canvas=this._canvas,container=canvas.getContainer();this._setMousePosition=bind(this._setMousePosition,this),container.addEventListener("mousemove",this._setMousePosition),eventBus.on("diagram.destroy",function(){container.removeEventListener("mousemove",this._setMousePosition)},this),eventBus.on("element.hover",this._setHoverElement,this)},MouseTracking.prototype._setHoverElement=function(event){this._hoverElement=event.element},MouseTracking.prototype._setMousePosition=function(event){this._mouseX=event.layerX,this._mouseY=event.layerY}},{"lodash/function/bind":380}],266:[function(require,module,exports){"use strict";module.exports={__init__:["mouseTracking"],mouseTracking:["type",require("./MouseTracking")]}},{"./MouseTracking":265}],267:[function(require,module,exports){"use strict";function mid(element){return{x:element.x+round(element.width/2),y:element.y+round(element.height/2)}}function MoveEvents(eventBus,dragging,modeling,selection,rules){function canMove(shapes,delta,position,target){return rules.allowed("elements.move",{shapes:shapes,delta:delta,position:position,target:target})}function start(event,element,activate){if(!element.waypoints&&element.parent){var referencePoint=mid(element);dragging.init(event,referencePoint,"shape.move",{cursor:"grabbing",autoActivate:activate,data:{shape:element,context:{}}})}}eventBus.on("shape.move.start",HIGH_PRIORITY,function(event){var context=event.context,shape=event.shape,shapes=selection.get().slice();-1===shapes.indexOf(shape)&&(shapes=[shape]),shapes=removeNested(shapes),assign(context,{shapes:shapes,validatedShapes:shapes,shape:shape})}),eventBus.on("shape.move.start",MEDIUM_PRIORITY,function(event){var context=event.context,validatedShapes=context.validatedShapes;if(!(context.canExecute=canMove(validatedShapes)))return event.stopPropagation(),!1}),eventBus.on("shape.move.move",LOW_PRIORITY,function(event){var canExecute,context=event.context,validatedShapes=context.validatedShapes,hover=event.hover,delta={x:event.dx,y:event.dy},position={x:event.x,y:event.y};if(canExecute=canMove(validatedShapes,delta,position,hover),context.delta=delta,context.canExecute=canExecute,null===canExecute)return void(context.target=null);context.target=hover}),eventBus.on("shape.move.end",function(event){var context=event.context,delta=context.delta,canExecute=context.canExecute,isAttach="attach"===canExecute,shapes=context.shapes;if(!canExecute)return!1;delta.x=round(delta.x),delta.y=round(delta.y),modeling.moveElements(shapes,delta,context.target,isAttach,{primaryShape:context.shape})}),eventBus.on("element.mousedown",function(event){var originalEvent=getOriginalEvent(event);if(!originalEvent)throw new Error("must supply DOM mousedown event");start(originalEvent,event.element)}),this.start=start}function removeNested(elements){var ids=groupBy(elements,"id");return filter(elements,function(element){for(;element=element.parent;)if(ids[element.id])return!1;return!0})}var assign=require("lodash/object/assign"),filter=require("lodash/collection/filter"),groupBy=require("lodash/collection/groupBy"),LOW_PRIORITY=500,MEDIUM_PRIORITY=1250,HIGH_PRIORITY=1500,getOriginalEvent=require("../../util/Event").getOriginal,round=Math.round;MoveEvents.$inject=["eventBus","dragging","modeling","selection","rules"],module.exports=MoveEvents},{"../../util/Event":330,"lodash/collection/filter":367,"lodash/collection/groupBy":370,"lodash/object/assign":502}],268:[function(require,module,exports){"use strict";function MovePreview(eventBus,elementRegistry,canvas,styles,previewSupport){function getVisualDragShapes(shapes){return removeEdges(getAllDraggedElements(shapes))}function getAllDraggedElements(shapes){var allShapes=Elements.selfAndAllChildren(shapes,!0),allConnections=map(allShapes,function(shape){return(shape.incoming||[]).concat(shape.outgoing||[])});return flatten(allShapes.concat(allConnections),!0)}function setMarker(element,marker){[MARKER_ATTACH,MARKER_OK,MARKER_NOT_OK,MARKER_NEW_PARENT].forEach(function(m){m===marker?canvas.addMarker(element,m):canvas.removeMarker(element,m)})}function makeDraggable(context,element,addMarker){previewSupport.addDragger(element,context.dragGroup),addMarker&&canvas.addMarker(element,MARKER_DRAGGING),context.allDraggedElements?context.allDraggedElements.push(element):context.allDraggedElements=[element]}this.makeDraggable=makeDraggable,eventBus.on("shape.move.start",LOW_PRIORITY,function(event){var context=event.context,dragShapes=context.shapes,allDraggedElements=context.allDraggedElements,visuallyDraggedShapes=getVisualDragShapes(dragShapes);if(!context.dragGroup){var dragGroup=svgCreate("g");svgAttr(dragGroup,styles.cls("djs-drag-group",["no-events"]));var defaultLayer=canvas.getDefaultLayer();svgAppend(defaultLayer,dragGroup),context.dragGroup=dragGroup}visuallyDraggedShapes.forEach(function(shape){previewSupport.addDragger(shape,context.dragGroup)}),allDraggedElements=allDraggedElements?flatten(allDraggedElements,getAllDraggedElements(dragShapes)):getAllDraggedElements(dragShapes),forEach(allDraggedElements,function(e){canvas.addMarker(e,MARKER_DRAGGING)}),context.allDraggedElements=allDraggedElements,context.differentParents=haveDifferentParents(dragShapes)}),eventBus.on("shape.move.move",LOW_PRIORITY,function(event){var context=event.context,dragGroup=context.dragGroup,target=context.target,parent=context.shape.parent,canExecute=context.canExecute;target&&("attach"===canExecute?setMarker(target,MARKER_ATTACH):context.canExecute&&target&&target.id!==parent.id?setMarker(target,MARKER_NEW_PARENT):setMarker(target,context.canExecute?MARKER_OK:MARKER_NOT_OK)),translate(dragGroup,event.dx,event.dy)}),eventBus.on(["shape.move.out","shape.move.cleanup"],function(event){var context=event.context,target=context.target;target&&setMarker(target,null)}),eventBus.on("shape.move.cleanup",function(event){var context=event.context,allDraggedElements=context.allDraggedElements,dragGroup=context.dragGroup;forEach(allDraggedElements,function(e){canvas.removeMarker(e,MARKER_DRAGGING)}),dragGroup&&svgClear(dragGroup)})}function removeEdges(elements){return filter(elements,function(element){if(isConnection(element)){var srcFound=find(elements,element.source),targetFound=find(elements,element.target);return srcFound&&targetFound}return!0})}function haveDifferentParents(elements){return 1!==size(groupBy(elements,function(e){return e.parent&&e.parent.id}))}function isConnection(element){return element.waypoints}var flatten=require("lodash/array/flatten"),forEach=require("lodash/collection/forEach"),filter=require("lodash/collection/filter"),find=require("lodash/collection/find"),size=require("lodash/collection/size"),groupBy=require("lodash/collection/groupBy"),map=require("lodash/collection/map"),Elements=require("../../util/Elements"),svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClear=require("tiny-svg/lib/clear"),svgCreate=require("tiny-svg/lib/create"),translate=require("../../util/SvgTransformUtil").translate,LOW_PRIORITY=500,MARKER_DRAGGING="djs-dragging",MARKER_OK="drop-ok",MARKER_NOT_OK="drop-not-ok",MARKER_NEW_PARENT="new-parent",MARKER_ATTACH="attach-ok";MovePreview.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"],module.exports=MovePreview},{"../../util/Elements":329,"../../util/SvgTransformUtil":342,"lodash/array/flatten":356,"lodash/collection/filter":367,"lodash/collection/find":368,"lodash/collection/forEach":369,"lodash/collection/groupBy":370,"lodash/collection/map":373,"lodash/collection/size":376,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/clear":550,"tiny-svg/lib/create":552}],269:[function(require,module,exports){module.exports={__depends__:[require("../interaction-events"),require("../selection"),require("../outline"),require("../rules"),require("../dragging"),require("../preview-support")],__init__:["move","movePreview"],move:["type",require("./Move")],movePreview:["type",require("./MovePreview")]}},{"../dragging":225,"../interaction-events":233,"../outline":272,"../preview-support":280,"../rules":290,"../selection":296,"./Move":267,"./MovePreview":268}],270:[function(require,module,exports){"use strict";function OrderingProvider(eventBus){CommandInterceptor.call(this,eventBus);var self=this;this.preExecute(["shape.create","connection.create"],function(event){var context=event.context,element=context.shape||context.connection,parent=context.parent,ordering=self.getOrdering(element,parent);ordering&&(void 0!==ordering.parent&&(context.parent=ordering.parent),context.parentIndex=ordering.index)}),this.preExecute(["shape.move","connection.move"],function(event){var context=event.context,element=context.shape||context.connection,parent=context.newParent||element.parent,ordering=self.getOrdering(element,parent);ordering&&(void 0!==ordering.parent&&(context.newParent=ordering.parent),context.newParentIndex=ordering.index)})}var inherits=require("inherits"),CommandInterceptor=require("../../command/CommandInterceptor");OrderingProvider.prototype.getOrdering=function(element,newParent){return null},inherits(OrderingProvider,CommandInterceptor),module.exports=OrderingProvider},{"../../command/CommandInterceptor":182,inherits:354}],271:[function(require,module,exports){"use strict";function Outline(eventBus,styles,elementRegistry){function createOutline(gfx,bounds){var outline=svgCreate("rect");return svgAttr(outline,assign({x:10,y:10,width:100,height:100},OUTLINE_STYLE)),svgAppend(gfx,outline),outline}this.offset=6;var OUTLINE_STYLE=styles.cls("djs-outline",["no-fill"]),self=this;eventBus.on(["shape.added","shape.changed"],LOW_PRIORITY,function(event){var element=event.element,gfx=event.gfx,outline=domQuery(".djs-outline",gfx);outline||(outline=createOutline(gfx,element)),self.updateShapeOutline(outline,element)}),eventBus.on(["connection.added","connection.changed"],function(event){var element=event.element,gfx=event.gfx,outline=domQuery(".djs-outline",gfx);outline||(outline=createOutline(gfx,element)),self.updateConnectionOutline(outline,element)})}var getBBox=require("../../util/Elements").getBBox,LOW_PRIORITY=500,svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create"),domQuery=require("min-dom/lib/query"),assign=require("lodash/object/assign");Outline.prototype.updateShapeOutline=function(outline,element){svgAttr(outline,{x:-this.offset,y:-this.offset,width:element.width+2*this.offset,height:element.height+2*this.offset})},Outline.prototype.updateConnectionOutline=function(outline,connection){var bbox=getBBox(connection);svgAttr(outline,{x:bbox.x-this.offset,y:bbox.y-this.offset,width:bbox.width+2*this.offset,height:bbox.height+2*this.offset})},Outline.$inject=["eventBus","styles","elementRegistry"],module.exports=Outline},{"../../util/Elements":329,"lodash/object/assign":502,"min-dom/lib/query":525,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/create":552}],272:[function(require,module,exports){"use strict";module.exports={__init__:["outline"],outline:["type",require("./Outline")]}},{"./Outline":271}],273:[function(require,module,exports){"use strict";function createRoot(parent){var root=domify('<div class="djs-overlay-container" style="position: absolute; width: 0; height: 0;" />');return parent.insertBefore(root,parent.firstChild),root}function setPosition(el,x,y){assign(el.style,{left:x+"px",top:y+"px"})}function setVisible(el,visible){el.style.display=!1===visible?"none":""}function Overlays(eventBus,canvas,elementRegistry){this._eventBus=eventBus,this._canvas=canvas,this._elementRegistry=elementRegistry,this._ids=ids,this._overlayDefaults={show:{minZoom:.7,maxZoom:5}},this._overlays={},this._overlayContainers=[],this._overlayRoot=createRoot(canvas.getContainer()),this._init()}var isArray=require("lodash/lang/isArray"),isString=require("lodash/lang/isString"),isObject=require("lodash/lang/isObject"),assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),find=require("lodash/collection/find"),filter=require("lodash/collection/filter"),domify=require("min-dom/lib/domify"),domClasses=require("min-dom/lib/classes"),domAttr=require("min-dom/lib/attr"),domRemove=require("min-dom/lib/remove"),domClear=require("min-dom/lib/clear"),getBBox=require("../../util/Elements").getBBox,ids=new(require("../../util/IdGenerator"))("ov");Overlays.$inject=["eventBus","canvas","elementRegistry"],module.exports=Overlays,Overlays.prototype.get=function(search){if(isString(search)&&(search={id:search}),isString(search.element)&&(search.element=this._elementRegistry.get(search.element)),search.element){var container=this._getOverlayContainer(search.element,!0);return container?search.type?filter(container.overlays,{type:search.type}):container.overlays.slice():[]}return search.type?filter(this._overlays,{type:search.type}):search.id?this._overlays[search.id]:null},Overlays.prototype.add=function(element,type,overlay){if(isObject(type)&&(overlay=type,type=null),element.id||(element=this._elementRegistry.get(element)),!overlay.position)throw new Error("must specifiy overlay position");if(!overlay.html)throw new Error("must specifiy overlay html");if(!element)throw new Error("invalid element specified");var id=this._ids.next();return overlay=assign({},this._overlayDefaults,overlay,{id:id,type:type,element:element,html:overlay.html}),this._addOverlay(overlay),id},Overlays.prototype.remove=function(filter){var overlays=this.get(filter)||[];isArray(overlays)||(overlays=[overlays]);var self=this;forEach(overlays,function(overlay){var container=self._getOverlayContainer(overlay.element,!0);if(overlay&&(domRemove(overlay.html),domRemove(overlay.htmlContainer),delete overlay.htmlContainer,delete overlay.element,delete self._overlays[overlay.id]),container){var idx=container.overlays.indexOf(overlay);-1!==idx&&container.overlays.splice(idx,1)}})},Overlays.prototype.show=function(){setVisible(this._overlayRoot)},Overlays.prototype.hide=function(){setVisible(this._overlayRoot,!1)},Overlays.prototype.clear=function(){this._overlays={},this._overlayContainers=[],domClear(this._overlayRoot)},Overlays.prototype._updateOverlayContainer=function(container){var element=container.element,html=container.html,x=element.x,y=element.y;if(element.waypoints){var bbox=getBBox(element);x=bbox.x,y=bbox.y}setPosition(html,x,y),domAttr(container.html,"data-container-id",element.id)},Overlays.prototype._updateOverlay=function(overlay){var position=overlay.position,htmlContainer=overlay.htmlContainer,element=overlay.element,left=position.left,top=position.top;if(void 0!==position.right){var width;width=element.waypoints?getBBox(element).width:element.width,left=-1*position.right+width}if(void 0!==position.bottom){var height;height=element.waypoints?getBBox(element).height:element.height,top=-1*position.bottom+height}setPosition(htmlContainer,left||0,top||0)},Overlays.prototype._createOverlayContainer=function(element){var html=domify('<div class="djs-overlays" style="position: absolute" />');this._overlayRoot.appendChild(html);var container={html:html,element:element,overlays:[]};return this._updateOverlayContainer(container),this._overlayContainers.push(container),container},Overlays.prototype._updateRoot=function(viewbox){var a=viewbox.scale||1,d=viewbox.scale||1,matrix="matrix("+a+",0,0,"+d+","+-1*viewbox.x*a+","+-1*viewbox.y*d+")";this._overlayRoot.style.transform=matrix,this._overlayRoot.style["-ms-transform"]=matrix,this._overlayRoot.style["-webkit-transform"]=matrix},Overlays.prototype._getOverlayContainer=function(element,raw){var container=find(this._overlayContainers,function(c){return c.element===element});return container||raw?container:this._createOverlayContainer(element)},Overlays.prototype._addOverlay=function(overlay){var htmlContainer,overlayContainer,id=overlay.id,element=overlay.element,html=overlay.html;html.get&&(html=html.get(0)),isString(html)&&(html=domify(html)),overlayContainer=this._getOverlayContainer(element),htmlContainer=domify('<div class="djs-overlay" data-overlay-id="'+id+'" style="position: absolute">'),htmlContainer.appendChild(html),overlay.type&&domClasses(htmlContainer).add("djs-overlay-"+overlay.type),overlay.htmlContainer=htmlContainer,overlayContainer.overlays.push(overlay),overlayContainer.html.appendChild(htmlContainer),this._overlays[id]=overlay,this._updateOverlay(overlay),this._updateOverlayVisibilty(overlay,this._canvas.viewbox())},Overlays.prototype._updateOverlayVisibilty=function(overlay,viewbox){var show=overlay.show,htmlContainer=overlay.htmlContainer,visible=!0;show&&((show.minZoom>viewbox.scale||show.maxZoom<viewbox.scale)&&(visible=!1),setVisible(htmlContainer,visible))},Overlays.prototype._updateOverlaysVisibilty=function(viewbox){var self=this;forEach(this._overlays,function(overlay){self._updateOverlayVisibilty(overlay,viewbox)})},Overlays.prototype._init=function(){function updateViewbox(viewbox){self._updateRoot(viewbox),self._updateOverlaysVisibilty(viewbox),self.show()}var eventBus=this._eventBus,self=this;eventBus.on("canvas.viewbox.changing",function(event){self.hide()}),eventBus.on("canvas.viewbox.changed",function(event){updateViewbox(event.viewbox)}),eventBus.on(["shape.remove","connection.remove"],function(e){var element=e.element,overlays=self.get({element:element});forEach(overlays,function(o){self.remove(o.id)});var container=self._getOverlayContainer(element);if(container){domRemove(container.html);var i=self._overlayContainers.indexOf(container);-1!==i&&self._overlayContainers.splice(i,1)}}),eventBus.on("element.changed",500,function(e){var element=e.element,container=self._getOverlayContainer(element,!0);container&&(forEach(container.overlays,function(overlay){self._updateOverlay(overlay)}),self._updateOverlayContainer(container))}),eventBus.on("element.marker.update",function(e){var container=self._getOverlayContainer(e.element,!0);container&&domClasses(container.html)[e.add?"add":"remove"](e.marker)}),eventBus.on("diagram.clear",this.clear,this)}},{"../../util/Elements":329,"../../util/IdGenerator":333,"lodash/collection/filter":367,"lodash/collection/find":368,"lodash/collection/forEach":369,"lodash/lang/isArray":492,"lodash/lang/isObject":497,"lodash/lang/isString":499,"lodash/object/assign":502,"min-dom/lib/attr":517,"min-dom/lib/classes":518,"min-dom/lib/clear":519,"min-dom/lib/domify":522,"min-dom/lib/remove":526}],274:[function(require,module,exports){module.exports={__init__:["overlays"],overlays:["type",require("./Overlays")]}},{"./Overlays":273}],275:[function(require,module,exports){"use strict";function Palette(eventBus,canvas,dragging){this._eventBus=eventBus,this._canvas=canvas,this._dragging=dragging,this._providers=[];var self=this;eventBus.on("tool-manager.update",function(event){var tool=event.tool;self.updateToolHighlight(tool)}),eventBus.on("i18n.changed",function(){self._update()})}function addClasses(element,classNames){var classes=domClasses(element);(isArray(classNames)?classNames:classNames.split(/\s+/g)).forEach(function(cls){classes.add(cls)})}var isFunction=require("lodash/lang/isFunction"),isArray=require("lodash/lang/isArray"),forEach=require("lodash/collection/forEach"),domify=require("min-dom/lib/domify"),domQuery=require("min-dom/lib/query"),domAttr=require("min-dom/lib/attr"),domClear=require("min-dom/lib/clear"),domClasses=require("min-dom/lib/classes"),domMatches=require("min-dom/lib/matches"),domDelegate=require("min-dom/lib/delegate"),domEvent=require("min-dom/lib/event");Palette.$inject=["eventBus","canvas","dragging"],module.exports=Palette,Palette.prototype.registerProvider=function(provider){this._providers.push(provider),this._container||this._init(),this._update()},Palette.prototype.getEntries=function(){var entries={};return forEach(this._providers,function(provider){var e=provider.getPaletteEntries();forEach(e,function(entry,id){entries[id]=entry})}),entries},Palette.prototype._init=function(){var canvas=this._canvas,eventBus=this._eventBus,parent=canvas.getContainer(),container=this._container=domify(Palette.HTML_MARKUP),self=this;parent.appendChild(container),domDelegate.bind(container,".djs-palette-toggle, .entry","click",function(event){var target=event.delegateTarget;if(domMatches(target,".djs-palette-toggle"))return self.toggle();self.trigger("click",event)}),domEvent.bind(container,"mousedown",function(event){event.stopPropagation()}),domDelegate.bind(container,".entry","dragstart",function(event){self.trigger("dragstart",event)}),eventBus.fire("palette.create",{html:container}),eventBus.on("canvas.resized",this.triggerTwoColumn,this)},Palette.prototype._update=function(){var entriesContainer=domQuery(".djs-palette-entries",this._container),entries=this._entries=this.getEntries();domClear(entriesContainer),forEach(entries,function(entry,id){var grouping=entry.group||"default",container=domQuery("[data-group="+grouping+"]",entriesContainer);container||(container=domify('<div class="group" data-group="'+grouping+'"></div>'),entriesContainer.appendChild(container));var html=entry.html||(entry.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),control=domify(html);container.appendChild(control),entry.separator||(domAttr(control,"data-action",id),entry.title&&domAttr(control,"title",entry.title),entry.className&&addClasses(control,entry.className),entry.imageUrl&&control.appendChild(domify('<img src="'+entry.imageUrl+'">')))}),this.open(!0)},Palette.prototype.trigger=function(action,event,autoActivate){var entry,handler,originalEvent,entries=this._entries,button=event.delegateTarget||event.target;if(!button)return event.preventDefault();(entry=entries[domAttr(button,"data-action")])&&(handler=entry.action,originalEvent=event.originalEvent||event,isFunction(handler)?"click"===action&&handler(originalEvent,autoActivate):handler[action]&&handler[action](originalEvent,autoActivate),event.preventDefault())},Palette.prototype.triggerTwoColumn=function(){var canvas=this._canvas,parent=canvas.getContainer();parent.clientHeight<650?domClasses(parent).add("two-column"):domClasses(parent).remove("two-column")},Palette.prototype.close=function(){var canvas=this._canvas,parent=canvas.getContainer();domClasses(this._container).remove("open"),domClasses(parent).remove("two-column")},Palette.prototype.open=function(){domClasses(this._container).add("open"),this.triggerTwoColumn()},Palette.prototype.toggle=function(open){this.isOpen()?this.close():this.open()},Palette.prototype.isActiveTool=function(tool){return tool&&this._activeTool===tool},Palette.prototype.updateToolHighlight=function(name){var entriesContainer,toolsContainer;this._toolsContainer||(entriesContainer=domQuery(".djs-palette-entries",this._container),this._toolsContainer=domQuery("[data-group=tools]",entriesContainer)),toolsContainer=this._toolsContainer,forEach(toolsContainer.children,function(tool){var actionName=tool.getAttribute("data-action");actionName&&(actionName=actionName.replace("-tool",""),tool.classList.contains("entry")&&actionName===name?domClasses(tool).add("highlighted-entry"):domClasses(tool).remove("highlighted-entry"))})},Palette.prototype.isOpen=function(){return this._container&&domClasses(this._container).has("open")},Palette.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>'},{"lodash/collection/forEach":369,"lodash/lang/isArray":492,"lodash/lang/isFunction":494,"min-dom/lib/attr":517,"min-dom/lib/classes":518,"min-dom/lib/clear":519,"min-dom/lib/delegate":521,"min-dom/lib/domify":522,"min-dom/lib/event":523,"min-dom/lib/matches":524,"min-dom/lib/query":525}],276:[function(require,module,exports){"use strict";module.exports={__depends__:[require("../tool-manager")],__init__:["palette"],palette:["type",require("./Palette")]}},{"../tool-manager":305,"./Palette":275}],277:[function(require,module,exports){"use strict";function PopupMenu(eventBus,canvas){this._eventBus=eventBus,this._canvas=canvas,this._providers={}}var forEach=require("lodash/collection/forEach"),assign=require("lodash/object/assign"),find=require("lodash/collection/find"),domDelegate=require("min-dom/lib/delegate"),domify=require("min-dom/lib/domify"),domClasses=require("min-dom/lib/classes"),domAttr=require("min-dom/lib/attr"),domRemove=require("min-dom/lib/remove");PopupMenu.$inject=["eventBus","canvas"],PopupMenu.prototype.registerProvider=function(id,provider){this._providers[id]=provider},PopupMenu.prototype.create=function(id,element){var provider=this._providers[id];if(!provider)throw new Error("Provider is not registered: "+id);if(!element)throw new Error("Element is missing");var current=this._current={provider:provider,className:id,element:element}
;return provider.getHeaderEntries&&(current.headerEntries=provider.getHeaderEntries(element)),current.entries=provider.getEntries(element),this},PopupMenu.prototype.isEmpty=function(){var current=this._current;return 0===current.entries.length&&current.headerEntries&&0===current.headerEntries.length},PopupMenu.prototype.open=function(position){if(!position)throw new Error("the position argument is missing");this.isOpen()&&this.close();var current=this._current,canvas=this._canvas,parent=canvas.getContainer();if(current.position=position,current.container=this._createContainer(),current.headerEntries){var headerEntriesContainer=this._createEntries(current.headerEntries,"djs-popup-header");current.container.appendChild(headerEntriesContainer)}if(current.entries){var entriesContainer=this._createEntries(current.entries,"djs-popup-body");current.container.appendChild(entriesContainer)}return this._attachContainer(current.container,parent,position.cursor),this},PopupMenu.prototype.close=function(){this.isOpen()&&(this._unbindHandlers(),domRemove(this._current.container),this._current.container=null)},PopupMenu.prototype.isOpen=function(){return!!this._current.container},PopupMenu.prototype.trigger=function(event){event.preventDefault();var element=event.delegateTarget||event.target,entryId=domAttr(element,"data-id"),entry=this._getEntry(entryId);if(entry.action)return entry.action.call(null,event,entry)},PopupMenu.prototype._getEntry=function(entryId){var search={id:entryId},entry=find(this._current.entries,search)||find(this._current.headerEntries,search);if(!entry)throw new Error("entry not found");return entry},PopupMenu.prototype._createContainer=function(){var container=domify('<div class="djs-popup">'),position=this._current.position,className=this._current.className;return assign(container.style,{position:"absolute",left:position.x+"px",top:position.y+"px",visibility:"hidden"}),domClasses(container).add(className),container},PopupMenu.prototype._attachContainer=function(container,parent,cursor){var self=this;domDelegate.bind(container,".entry","click",function(event){self.trigger(event)});var zoom=this._canvas.zoom();container.style.transformOrigin="top left",container.style.transform="scale("+zoom+")",parent.appendChild(container),cursor&&this._assureIsInbounds(container,cursor),this._bindHandlers()},PopupMenu.prototype._assureIsInbounds=function(container,cursor){var left,top,canvas=this._canvas,clientRect=canvas._container.getBoundingClientRect(),containerX=container.offsetLeft,containerY=container.offsetTop,containerWidth=container.scrollWidth,containerHeight=container.scrollHeight,overAxis={},cursorPosition={x:cursor.x-clientRect.left,y:cursor.y-clientRect.top};containerX+containerWidth>clientRect.width&&(overAxis.x=!0),containerY+containerHeight>clientRect.height&&(overAxis.y=!0),overAxis.x&&overAxis.y?(left=cursorPosition.x-containerWidth+"px",top=cursorPosition.y-containerHeight+"px"):overAxis.x?(left=cursorPosition.x-containerWidth+"px",top=cursorPosition.y+"px"):overAxis.y&&cursorPosition.y<containerHeight?(left=cursorPosition.x+"px",top="10px"):overAxis.y&&(left=cursorPosition.x+"px",top=cursorPosition.y-containerHeight+"px"),assign(container.style,{left:left,top:top},{visibility:"visible","z-index":1e3})},PopupMenu.prototype._createEntries=function(entries,className){var entriesContainer=domify("<div>"),self=this;return domClasses(entriesContainer).add(className),forEach(entries,function(entry){var entryContainer=self._createEntry(entry,entriesContainer);entriesContainer.appendChild(entryContainer)}),entriesContainer},PopupMenu.prototype._createEntry=function(entry){if(!entry.id)throw new Error("every entry must have the id property set");var entryContainer=domify("<div>"),entryClasses=domClasses(entryContainer);if(entryClasses.add("entry"),entry.className&&entryClasses.add(entry.className),domAttr(entryContainer,"data-id",entry.id),entry.label){var label=domify("<span>");label.textContent=entry.label,entryContainer.appendChild(label)}return entry.imageUrl&&entryContainer.appendChild(domify('<img src="'+entry.imageUrl+'" />')),!0===entry.active&&entryClasses.add("active"),!0===entry.disabled&&entryClasses.add("disabled"),entry.title&&(entryContainer.title=entry.title),entryContainer},PopupMenu.prototype._bindHandlers=function(){function close(){self.close()}var eventBus=this._eventBus,self=this;eventBus.once("contextPad.close",close),eventBus.once("canvas.viewbox.changing",close),eventBus.once("commandStack.changed",close)},PopupMenu.prototype._unbindHandlers=function(){function close(){self.close()}var eventBus=this._eventBus,self=this;eventBus.off("contextPad.close",close),eventBus.off("canvas.viewbox.changed",close),eventBus.off("commandStack.changed",close)},module.exports=PopupMenu},{"lodash/collection/find":368,"lodash/collection/forEach":369,"lodash/object/assign":502,"min-dom/lib/attr":517,"min-dom/lib/classes":518,"min-dom/lib/delegate":521,"min-dom/lib/domify":522,"min-dom/lib/remove":526}],278:[function(require,module,exports){"use strict";module.exports={__init__:["popupMenu"],popupMenu:["type",require("./PopupMenu")]}},{"./PopupMenu":277}],279:[function(require,module,exports){"use strict";function PreviewSupport(elementRegistry,canvas,styles){this._elementRegistry=elementRegistry,this._canvas=canvas,this._styles=styles}function removeMarkers(gfx){gfx.children&&forEach(gfx.children,function(child){removeMarkers(child)}),gfx.style.markerStart="",gfx.style.markerEnd=""}function isConnection(element){return element.waypoints}var forEach=require("lodash/collection/forEach"),svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClone=require("tiny-svg/lib/clone"),svgCreate=require("tiny-svg/lib/create");module.exports=PreviewSupport,PreviewSupport.$inject=["elementRegistry","canvas","styles"],PreviewSupport.prototype.getGfx=function(element){return this._elementRegistry.getGraphics(element)},PreviewSupport.prototype.addDragger=function(shape,group){var gfx=this.getGfx(shape),dragger=svgClone(gfx),bbox=gfx.getBoundingClientRect();return isConnection(shape)&&removeMarkers(dragger),svgAttr(dragger,this._styles.cls("djs-dragger",[],{x:bbox.top,y:bbox.left})),svgAppend(group,dragger),dragger},PreviewSupport.prototype.addFrame=function(shape,group){var frame=svgCreate("rect",{class:"djs-resize-overlay",width:shape.width,height:shape.height,x:shape.x,y:shape.y});return svgAppend(group,frame),frame}},{"lodash/collection/forEach":369,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/clone":551,"tiny-svg/lib/create":552}],280:[function(require,module,exports){"use strict";module.exports={__init__:["previewSupport"],previewSupport:["type",require("./PreviewSupport")]}},{"./PreviewSupport":279}],281:[function(require,module,exports){"use strict";function Replace(modeling){this._modeling=modeling}module.exports=Replace,Replace.$inject=["modeling"],Replace.prototype.replaceElement=function(oldElement,newElementData,options){var modeling=this._modeling,newElement=null;return oldElement.waypoints||(newElementData.x=Math.ceil(oldElement.x+(newElementData.width||oldElement.width)/2),newElementData.y=Math.ceil(oldElement.y+(newElementData.height||oldElement.height)/2),newElement=modeling.replaceShape(oldElement,newElementData,options)),newElement}},{}],282:[function(require,module,exports){"use strict";module.exports={__init__:["replace"],replace:["type",require("./Replace")]}},{"./Replace":281}],283:[function(require,module,exports){"use strict";function Resize(eventBus,rules,modeling,dragging){this._dragging=dragging,this._rules=rules;var self=this;eventBus.on("resize.start",function(event){var context=event.context,resizeConstraints=context.resizeConstraints,minBounds=context.minBounds;void 0===resizeConstraints&&(void 0===minBounds&&(minBounds=self.computeMinResizeBox(context)),context.resizeConstraints={min:asTRBL(minBounds)})}),eventBus.on("resize.move",function(event){var delta,newBounds,context=event.context,shape=context.shape,direction=context.direction,resizeConstraints=context.resizeConstraints;delta={x:event.dx,y:event.dy},context.delta=delta,newBounds=ResizeUtil.resizeBounds(shape,direction,delta),context.newBounds=ResizeUtil.ensureConstraints(newBounds,resizeConstraints),context.canExecute=self.canResize(context)}),eventBus.on("resize.end",function(event){var context=event.context,shape=context.shape,canExecute=context.canExecute,newBounds=context.newBounds;canExecute&&(newBounds=roundBounds(newBounds),modeling.resizeShape(shape,newBounds))})}var pick=require("lodash/object/pick"),assign=require("lodash/object/assign"),ResizeUtil=require("./ResizeUtil"),asTRBL=require("../../layout/LayoutUtil").asTRBL,roundBounds=require("../../layout/LayoutUtil").roundBounds;Resize.prototype.canResize=function(context){var rules=this._rules,ctx=pick(context,["newBounds","shape","delta","direction"]);return rules.allowed("shape.resize",ctx)},Resize.prototype.activate=function(event,shape,contextOrDirection){var context,direction,dragging=this._dragging;if("string"==typeof contextOrDirection&&(contextOrDirection={direction:contextOrDirection}),context=assign({shape:shape},contextOrDirection),!(direction=context.direction))throw new Error("must provide a direction (nw|se|ne|sw)");dragging.init(event,"resize",{autoActivate:!0,cursor:"resize-"+(/nw|se/.test(direction)?"nwse":"nesw"),data:{shape:shape,context:context}})},Resize.prototype.computeMinResizeBox=function(context){var minDimensions,childrenBounds,shape=context.shape,direction=context.direction;return minDimensions=context.minDimensions||{width:10,height:10},childrenBounds=ResizeUtil.computeChildrenBBox(shape,context.childrenBoxPadding),ResizeUtil.getMinResizeBounds(direction,shape,minDimensions,childrenBounds)},Resize.$inject=["eventBus","rules","modeling","dragging"],module.exports=Resize},{"../../layout/LayoutUtil":315,"./ResizeUtil":286,"lodash/object/assign":502,"lodash/object/pick":511}],284:[function(require,module,exports){"use strict";function ResizeHandles(eventBus,canvas,selection,resize){this._resize=resize,this._canvas=canvas;var self=this;eventBus.on("selection.changed",function(e){var newSelection=e.newSelection;self.removeResizers(),1===newSelection.length&&forEach(newSelection,self.addResizer,self)}),eventBus.on("shape.changed",function(e){var shape=e.element;selection.isSelected(shape)&&(self.removeResizers(),self.addResizer(shape))})}var forEach=require("lodash/collection/forEach"),svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClasses=require("tiny-svg/lib/classes"),svgClear=require("tiny-svg/lib/clear"),svgCreate=require("tiny-svg/lib/create"),domEvent=require("min-dom/lib/event"),isPrimaryButton=require("../../util/Mouse").isPrimaryButton,asTRBL=require("../../layout/LayoutUtil").asTRBL,transform=require("../../util/SvgTransformUtil").transform;ResizeHandles.prototype.makeDraggable=function(element,gfx,direction){function startResize(event){isPrimaryButton(event)&&resize.activate(event,element,direction)}var resize=this._resize;domEvent.bind(gfx,"mousedown",startResize),domEvent.bind(gfx,"touchstart",startResize)},ResizeHandles.prototype._createResizer=function(element,x,y,rotation,direction){var resizersParent=this._getResizersParent(),group=svgCreate("g");svgClasses(group).add("djs-resizer"),svgClasses(group).add("djs-resizer-"+element.id),svgClasses(group).add("djs-resizer-"+direction),svgAppend(resizersParent,group);var visual=svgCreate("rect");svgAttr(visual,{x:-7,y:-7,width:5,height:5}),svgClasses(visual).add("djs-resizer-visual"),svgAppend(group,visual);var hit=svgCreate("rect");return svgAttr(hit,{x:-7,y:-7,width:20,height:20}),svgClasses(hit).add("djs-resizer-hit"),svgAppend(group,hit),transform(group,x,y,rotation),group},ResizeHandles.prototype.createResizer=function(element,direction){var resizer,trbl=asTRBL(element);resizer="nw"===direction?this._createResizer(element,trbl.left,trbl.top,0,direction):"ne"===direction?this._createResizer(element,trbl.right,trbl.top,90,direction):"se"===direction?this._createResizer(element,trbl.right,trbl.bottom,180,direction):this._createResizer(element,trbl.left,trbl.bottom,270,direction),this.makeDraggable(element,resizer,direction)},ResizeHandles.prototype.addResizer=function(shape){this._resize.canResize({shape:shape})&&(this.createResizer(shape,"nw"),this.createResizer(shape,"ne"),this.createResizer(shape,"se"),this.createResizer(shape,"sw"))},ResizeHandles.prototype.removeResizers=function(){var resizersParent=this._getResizersParent();svgClear(resizersParent)},ResizeHandles.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},ResizeHandles.$inject=["eventBus","canvas","selection","resize"],module.exports=ResizeHandles},{"../../layout/LayoutUtil":315,"../../util/Mouse":337,"../../util/SvgTransformUtil":342,"lodash/collection/forEach":369,"min-dom/lib/event":523,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/clear":550,"tiny-svg/lib/create":552}],285:[function(require,module,exports){"use strict";function ResizePreview(eventBus,elementRegistry,canvas,styles,previewSupport){eventBus.on("resize.move",LOW_PRIORITY,function(event){var context=event.context,shape=context.shape,bounds=context.newBounds,frame=context.frame;frame||(frame=context.frame=previewSupport.addFrame(shape,canvas.getDefaultLayer()),canvas.addMarker(shape,MARKER_RESIZING)),bounds.width>5&&svgAttr(frame,{x:bounds.x,width:bounds.width}),bounds.height>5&&svgAttr(frame,{y:bounds.y,height:bounds.height}),context.canExecute?svgClasses(frame).remove(MARKER_RESIZE_NOT_OK):svgClasses(frame).add(MARKER_RESIZE_NOT_OK)}),eventBus.on("resize.cleanup",function(event){var context=event.context,shape=context.shape;context.frame&&svgRemove(context.frame),canvas.removeMarker(shape,MARKER_RESIZING)})}var MARKER_RESIZING="djs-resizing",MARKER_RESIZE_NOT_OK="resize-not-ok",LOW_PRIORITY=500,svgAttr=require("tiny-svg/lib/attr"),svgRemove=require("tiny-svg/lib/remove"),svgClasses=require("tiny-svg/lib/classes");ResizePreview.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"],module.exports=ResizePreview},{"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/remove":555}],286:[function(require,module,exports){"use strict";function isNumber(a){return"number"==typeof a}function applyConstraints(attr,trbl,resizeConstraints){var value=trbl[attr],minValue=resizeConstraints.min&&resizeConstraints.min[attr],maxValue=resizeConstraints.max&&resizeConstraints.max[attr];return isNumber(minValue)&&(value=(/top|left/.test(attr)?min:max)(value,minValue)),isNumber(maxValue)&&(value=(/top|left/.test(attr)?max:min)(value,maxValue)),value}function asPadding(mayBePadding,defaultValue){return void 0!==mayBePadding?mayBePadding:DEFAULT_CHILD_BOX_PADDING}function addPadding(bbox,padding){var left,right,top,bottom;return"object"==typeof padding?(left=asPadding(padding.left),right=asPadding(padding.right),top=asPadding(padding.top),bottom=asPadding(padding.bottom)):left=right=top=bottom=asPadding(padding),{x:bbox.x-left,y:bbox.y-top,width:bbox.width+left+right,height:bbox.height+top+bottom}}function isBBoxChild(element){return!element.waypoints&&"label"!==element.type}function computeChildrenBBox(shapeOrChildren,padding){var elements;if(elements=void 0===shapeOrChildren.length?filter(shapeOrChildren.children,isBBoxChild):shapeOrChildren,elements.length)return addPadding(getBBox(elements),padding)}var filter=require("lodash/collection/filter"),max=Math.max,min=Math.min,DEFAULT_CHILD_BOX_PADDING=20,getBBox=require("../../util/Elements").getBBox,asTRBL=require("../../layout/LayoutUtil").asTRBL,asBounds=require("../../layout/LayoutUtil").asBounds;module.exports.substractTRBL=function(trblA,trblB){return{top:trblA.top-trblB.top,right:trblA.right-trblB.right,bottom:trblA.bottom-trblB.bottom,left:trblA.left-trblB.left}},module.exports.resizeBounds=function(bounds,direction,delta){var dx=delta.x,dy=delta.y;switch(direction){case"nw":return{x:bounds.x+dx,y:bounds.y+dy,width:bounds.width-dx,height:bounds.height-dy};case"sw":return{x:bounds.x+dx,y:bounds.y,width:bounds.width-dx,height:bounds.height+dy};case"ne":return{x:bounds.x,y:bounds.y+dy,width:bounds.width+dx,height:bounds.height-dy};case"se":return{x:bounds.x,y:bounds.y,width:bounds.width+dx,height:bounds.height+dy};default:throw new Error("unrecognized direction: "+direction)}},module.exports.resizeTRBL=function(bounds,resize){return{x:bounds.x+(resize.left||0),y:bounds.y+(resize.top||0),width:bounds.width-(resize.left||0)+(resize.right||0),height:bounds.height-(resize.top||0)+(resize.bottom||0)}},module.exports.reattachPoint=function(bounds,newBounds,point){var sx=bounds.width/newBounds.width,sy=bounds.height/newBounds.height;return{x:Math.round(newBounds.x+newBounds.width/2)-Math.floor((bounds.x+bounds.width/2-point.x)/sx),y:Math.round(newBounds.y+newBounds.height/2)-Math.floor((bounds.y+bounds.height/2-point.y)/sy)}},module.exports.ensureConstraints=function(currentBounds,resizeConstraints){if(!resizeConstraints)return currentBounds;var currentTrbl=asTRBL(currentBounds);return asBounds({top:applyConstraints("top",currentTrbl,resizeConstraints),right:applyConstraints("right",currentTrbl,resizeConstraints),bottom:applyConstraints("bottom",currentTrbl,resizeConstraints),left:applyConstraints("left",currentTrbl,resizeConstraints)})},module.exports.getMinResizeBounds=function(direction,currentBounds,minDimensions,childrenBounds){var currentBox=asTRBL(currentBounds),minBox={top:/n/.test(direction)?currentBox.bottom-minDimensions.height:currentBox.top,left:/w/.test(direction)?currentBox.right-minDimensions.width:currentBox.left,bottom:/s/.test(direction)?currentBox.top+minDimensions.height:currentBox.bottom,right:/e/.test(direction)?currentBox.left+minDimensions.width:currentBox.right},childrenBox=childrenBounds?asTRBL(childrenBounds):minBox,combinedBox={top:min(minBox.top,childrenBox.top),left:min(minBox.left,childrenBox.left),bottom:max(minBox.bottom,childrenBox.bottom),right:max(minBox.right,childrenBox.right)};return asBounds(combinedBox)},module.exports.addPadding=addPadding,module.exports.computeChildrenBBox=computeChildrenBBox},{"../../layout/LayoutUtil":315,"../../util/Elements":329,"lodash/collection/filter":367}],287:[function(require,module,exports){module.exports={__depends__:[require("../rules"),require("../dragging"),require("../preview-support")],__init__:["resize","resizePreview","resizeHandles"],resize:["type",require("./Resize")],resizePreview:["type",require("./ResizePreview")],resizeHandles:["type",require("./ResizeHandles")]}},{"../dragging":225,"../preview-support":280,"../rules":290,"./Resize":283,"./ResizeHandles":284,"./ResizePreview":285}],288:[function(require,module,exports){"use strict";function RuleProvider(eventBus){CommandInterceptor.call(this,eventBus),this.init()}var inherits=require("inherits"),CommandInterceptor=require("../../command/CommandInterceptor");RuleProvider.$inject=["eventBus"],inherits(RuleProvider,CommandInterceptor),module.exports=RuleProvider,RuleProvider.prototype.addRule=function(actions,priority,fn){var self=this;"string"==typeof actions&&(actions=[actions]),actions.forEach(function(action){self.canExecute(action,priority,function(context,action,event){return fn(context)},!0)})},RuleProvider.prototype.init=function(){}},{"../../command/CommandInterceptor":182,inherits:354}],289:[function(require,module,exports){"use strict";function Rules(injector){this._commandStack=injector.get("commandStack",!1)}Rules.$inject=["injector"],module.exports=Rules,Rules.prototype.allowed=function(action,context){var allowed=!0,commandStack=this._commandStack;return commandStack&&(allowed=commandStack.canExecute(action,context)),void 0===allowed||allowed}},{}],290:[function(require,module,exports){module.exports={__init__:["rules"],rules:["type",require("./Rules")]}},{"./Rules":289}],291:[function(require,module,exports){"use strict";function SearchPad(canvas,eventBus,overlays,selection){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=canvas,this._eventBus=eventBus,this._overlays=overlays,this._selection=selection,this._container=domify(SearchPad.BOX_HTML),this._searchInput=domQuery(SearchPad.INPUT_SELECTOR,this._container),this._resultsContainer=domQuery(SearchPad.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),eventBus.on(["canvas.destroy","diagram.destroy"],this.close,this)}function constructOverlay(box){var w=box.width+12,h=box.height+12;return{position:{bottom:h-6,right:w-6},show:!0,html:'<div style="'+["width: "+w+"px","height: "+h+"px"].join("; ")+'" class="'+SearchPad.OVERLAY_CLASS+'"></div>'}}function createInnerTextNode(parentNode,tokens,template){var text=createHtmlText(tokens),childNode=domify(template);childNode.innerHTML=text,parentNode.appendChild(childNode)}function createHtmlText(tokens){var htmlText="";return tokens.forEach(function(t){t.matched?htmlText+='<strong class="'+SearchPad.RESULT_HIGHLIGHT_CLASS+'">'+t.matched+"</strong>":htmlText+=t.normal}),""!==htmlText?htmlText:null}var domClear=require("min-dom/lib/clear"),domDelegate=require("min-dom/lib/delegate"),domQuery=require("min-dom/lib/query"),domClasses=require("min-dom/lib/classes"),domAttr=require("min-dom/lib/attr"),domify=require("min-dom/lib/domify"),getBoundingBox=require("../../util/Elements").getBBox;SearchPad.$inject=["canvas","eventBus","overlays","selection"],SearchPad.prototype._bindEvents=function(){function listen(el,selector,type,fn){self._eventMaps.push({el:el,type:type,listener:domDelegate.bind(el,selector,type,fn)})}var self=this;listen(document,"html","click",function(e){self.close()}),listen(this._container,SearchPad.INPUT_SELECTOR,"click",function(e){e.stopPropagation(),e.delegateTarget.focus()}),listen(this._container,SearchPad.RESULT_SELECTOR,"mouseover",function(e){e.stopPropagation(),self._scrollToNode(e.delegateTarget),self._preselect(e.delegateTarget)}),listen(this._container,SearchPad.RESULT_SELECTOR,"click",function(e){e.stopPropagation(),self._select(e.delegateTarget)}),listen(this._container,SearchPad.INPUT_SELECTOR,"keydown",function(e){38===e.keyCode&&e.preventDefault(),40===e.keyCode&&e.preventDefault()}),listen(this._container,SearchPad.INPUT_SELECTOR,"keyup",function(e){if(27===e.keyCode)return self.close();if(13===e.keyCode){var selected=self._getCurrentResult();return selected?self._select(selected):self.close()}return 38===e.keyCode?self._scrollToDirection(!0):40===e.keyCode?self._scrollToDirection():void(37!==e.keyCode&&39!==e.keyCode&&self._search(e.delegateTarget.value))})},SearchPad.prototype._unbindEvents=function(){this._eventMaps.forEach(function(m){domDelegate.unbind(m.el,m.type,m.listener)})},SearchPad.prototype._search=function(pattern){var self=this;if(this._clearResults(),pattern&&""!==pattern){var searchResults=this._searchProvider.find(pattern);if(searchResults.length){searchResults.forEach(function(result){var id=result.element.id,node=self._createResultNode(result,id);self._results[id]={element:result.element,node:node}});var node=domQuery(SearchPad.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(node),this._preselect(node)}}},SearchPad.prototype._scrollToDirection=function(previous){var selected=this._getCurrentResult();if(selected){var node=previous?selected.previousElementSibling:selected.nextElementSibling;node&&(this._scrollToNode(node),this._preselect(node))}},SearchPad.prototype._scrollToNode=function(node){if(node&&node!==this._getCurrentResult()){var nodeOffset=node.offsetTop,containerScroll=this._resultsContainer.scrollTop,bottomScroll=nodeOffset-this._resultsContainer.clientHeight+node.clientHeight;nodeOffset<containerScroll?this._resultsContainer.scrollTop=nodeOffset:containerScroll<bottomScroll&&(this._resultsContainer.scrollTop=bottomScroll)}},SearchPad.prototype._clearResults=function(){domClear(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")},SearchPad.prototype._getCurrentResult=function(){return domQuery(SearchPad.RESULT_SELECTED_SELECTOR,this._resultsContainer)},SearchPad.prototype._createResultNode=function(result,id){var node=domify(SearchPad.RESULT_HTML);return result.primaryTokens.length>0&&createInnerTextNode(node,result.primaryTokens,SearchPad.RESULT_PRIMARY_HTML),createInnerTextNode(node,result.secondaryTokens,SearchPad.RESULT_SECONDARY_HTML),domAttr(node,SearchPad.RESULT_ID_ATTRIBUTE,id),this._resultsContainer.appendChild(node),node},SearchPad.prototype.registerProvider=function(provider){this._searchProvider=provider},SearchPad.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,domClasses(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))},SearchPad.prototype.close=function(){this.isOpen()&&(this._unbindEvents(),this._open=!1,domClasses(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))},SearchPad.prototype.toggle=function(){this.isOpen()?this.close():this.open()},SearchPad.prototype.isOpen=function(){return this._open},SearchPad.prototype._preselect=function(node){var selectedNode=this._getCurrentResult();if(node!==selectedNode){selectedNode&&domClasses(selectedNode).remove(SearchPad.RESULT_SELECTED_CLASS);var id=domAttr(node,SearchPad.RESULT_ID_ATTRIBUTE),element=this._results[id].element;domClasses(node).add(SearchPad.RESULT_SELECTED_CLASS),this._resetOverlay(element),this._centerViewbox(element),this._selection.select(element),this._eventBus.fire("searchPad.preselected",element)}},SearchPad.prototype._select=function(node){var id=domAttr(node,SearchPad.RESULT_ID_ATTRIBUTE),element=this._results[id].element;this.close(),this._resetOverlay(),this._centerViewbox(element),this._selection.select(element),this._eventBus.fire("searchPad.selected",element)},SearchPad.prototype._centerViewbox=function(element){var viewbox=this._canvas.viewbox(),box=getBoundingBox(element),newViewbox={x:box.x+box.width/2-viewbox.outer.width/2,y:box.y+box.height/2-viewbox.outer.height/2,width:viewbox.outer.width,height:viewbox.outer.height};this._canvas.viewbox(newViewbox),this._canvas.zoom(viewbox.scale)},SearchPad.prototype._resetOverlay=function(element){if(this._overlayId&&this._overlays.remove(this._overlayId),element){var box=getBoundingBox(element),overlay=constructOverlay(box);this._overlayId=this._overlays.add(element,overlay)}},module.exports=SearchPad,SearchPad.CONTAINER_SELECTOR=".djs-search-container",SearchPad.INPUT_SELECTOR=".djs-search-input input",SearchPad.RESULTS_CONTAINER_SELECTOR=".djs-search-results",SearchPad.RESULT_SELECTOR=".djs-search-result",SearchPad.RESULT_SELECTED_CLASS="djs-search-result-selected",SearchPad.RESULT_SELECTED_SELECTOR="."+SearchPad.RESULT_SELECTED_CLASS,SearchPad.RESULT_ID_ATTRIBUTE="data-result-id",SearchPad.RESULT_HIGHLIGHT_CLASS="djs-search-highlight",SearchPad.OVERLAY_CLASS="djs-search-overlay",SearchPad.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>',SearchPad.RESULT_HTML='<div class="djs-search-result"></div>',SearchPad.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>',SearchPad.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>'},{"../../util/Elements":329,"min-dom/lib/attr":517,"min-dom/lib/classes":518,"min-dom/lib/clear":519,"min-dom/lib/delegate":521,"min-dom/lib/domify":522,"min-dom/lib/query":525}],292:[function(require,module,exports){module.exports={__depends__:[require("../overlays"),require("../selection")],searchPad:["type",require("./SearchPad")]}},{"../overlays":274,"../selection":296,"./SearchPad":291}],293:[function(require,module,exports){"use strict";function Selection(eventBus){this._eventBus=eventBus,this._selectedElements=[];var self=this;eventBus.on(["shape.remove","connection.remove"],function(e){var element=e.element;self.deselect(element)}),eventBus.on(["diagram.clear"],function(e){self.select(null)})}var isArray=require("lodash/lang/isArray"),forEach=require("lodash/collection/forEach");Selection.$inject=["eventBus"],module.exports=Selection,Selection.prototype.deselect=function(element){var selectedElements=this._selectedElements,idx=selectedElements.indexOf(element);if(-1!==idx){var oldSelection=selectedElements.slice();selectedElements.splice(idx,1),this._eventBus.fire("selection.changed",{oldSelection:oldSelection,newSelection:selectedElements})}},Selection.prototype.get=function(){return this._selectedElements},Selection.prototype.isSelected=function(element){return-1!==this._selectedElements.indexOf(element)},Selection.prototype.select=function(elements,add){var selectedElements=this._selectedElements,oldSelection=selectedElements.slice();isArray(elements)||(elements=elements?[elements]:[]),add?forEach(elements,function(element){-1===selectedElements.indexOf(element)&&selectedElements.push(element)}):this._selectedElements=selectedElements=elements.slice(),this._eventBus.fire("selection.changed",{oldSelection:oldSelection,newSelection:selectedElements})}},{"lodash/collection/forEach":369,"lodash/lang/isArray":492}],294:[function(require,module,exports){"use strict";function SelectionBehavior(eventBus,selection,canvas,elementRegistry){eventBus.on("create.end",500,function(e){e.context.canExecute&&selection.select(e.context.shape)}),eventBus.on("connect.end",500,function(e){e.context.canExecute&&e.context.target&&selection.select(e.context.target)}),eventBus.on("shape.move.end",500,function(e){var previousSelection=e.previousSelection||[],shape=elementRegistry.get(e.context.shape.id);find(previousSelection,function(selectedShape){return shape.id===selectedShape.id})||selection.select(shape)}),eventBus.on("element.click",function(event){var element=event.element;element===canvas.getRootElement()&&(element=null);var isSelected=selection.isSelected(element),isMultiSelect=selection.get().length>1,add=hasPrimaryModifier(event);if(isSelected&&isMultiSelect)return add?selection.deselect(element):selection.select(element);isSelected?selection.deselect(element):selection.select(element,add)})}var hasPrimaryModifier=require("../../util/Mouse").hasPrimaryModifier,find=require("lodash/collection/find");SelectionBehavior.$inject=["eventBus","selection","canvas","elementRegistry"],module.exports=SelectionBehavior},{"../../util/Mouse":337,"lodash/collection/find":368}],295:[function(require,module,exports){"use strict";function SelectionVisuals(events,canvas,selection,styles){function addMarker(e,cls){canvas.addMarker(e,cls)}function removeMarker(e,cls){canvas.removeMarker(e,cls)}this._multiSelectionBox=null,events.on("element.hover",function(event){addMarker(event.element,MARKER_HOVER)}),events.on("element.out",function(event){removeMarker(event.element,MARKER_HOVER)}),events.on("selection.changed",function(event){function deselect(s){removeMarker(s,MARKER_SELECTED)}function select(s){addMarker(s,MARKER_SELECTED)}var oldSelection=event.oldSelection,newSelection=event.newSelection;forEach(oldSelection,function(e){-1===newSelection.indexOf(e)&&deselect(e)}),forEach(newSelection,function(e){-1===oldSelection.indexOf(e)&&select(e)})})}var forEach=require("lodash/collection/forEach"),MARKER_HOVER="hover",MARKER_SELECTED="selected";SelectionVisuals.$inject=["eventBus","canvas","selection","styles"],module.exports=SelectionVisuals},{"lodash/collection/forEach":369}],296:[function(require,module,exports){module.exports={__init__:["selectionVisuals","selectionBehavior"],__depends__:[require("../interaction-events"),require("../outline")],selection:["type",require("./Selection")],selectionVisuals:["type",require("./SelectionVisuals")],
selectionBehavior:["type",require("./SelectionBehavior")]}},{"../interaction-events":233,"../outline":272,"./Selection":293,"./SelectionBehavior":294,"./SelectionVisuals":295}],297:[function(require,module,exports){"use strict";function SnapContext(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}function SnapPoints(defaultSnaps){this._snapValues={}}var forEach=require("lodash/collection/forEach"),snapTo=require("./SnapUtil").snapTo;SnapContext.prototype.getSnapOrigin=function(snapLocation){return this._snapOrigins[snapLocation]},SnapContext.prototype.setSnapOrigin=function(snapLocation,initialValue){this._snapOrigins[snapLocation]=initialValue,-1===this._snapLocations.indexOf(snapLocation)&&this._snapLocations.push(snapLocation)},SnapContext.prototype.addDefaultSnap=function(type,point){var snapValues=this._defaultSnaps[type];snapValues||(snapValues=this._defaultSnaps[type]=[]),snapValues.push(point)},SnapContext.prototype.getSnapLocations=function(){return this._snapLocations},SnapContext.prototype.setSnapLocations=function(snapLocations){this._snapLocations=snapLocations},SnapContext.prototype.pointsForTarget=function(target){var targetId=target.id||target,snapPoints=this._targets[targetId];return snapPoints||(snapPoints=this._targets[targetId]=new SnapPoints,snapPoints.initDefaults(this._defaultSnaps)),snapPoints},module.exports=SnapContext,SnapPoints.prototype.add=function(snapLocation,point){var snapValues=this._snapValues[snapLocation];snapValues||(snapValues=this._snapValues[snapLocation]={x:[],y:[]}),-1===snapValues.x.indexOf(point.x)&&snapValues.x.push(point.x),-1===snapValues.y.indexOf(point.y)&&snapValues.y.push(point.y)},SnapPoints.prototype.snap=function(point,snapLocation,axis,tolerance){var snappingValues=this._snapValues[snapLocation];return snappingValues&&snapTo(point[axis],snappingValues[axis],tolerance)},SnapPoints.prototype.initDefaults=function(defaultSnaps){var self=this;forEach(defaultSnaps||{},function(snapPoints,snapLocation){forEach(snapPoints,function(point){self.add(snapLocation,point)})})}},{"./SnapUtil":298,"lodash/collection/forEach":369}],298:[function(require,module,exports){"use strict";function snapTo(value,values,tolerance){tolerance=void 0===tolerance?10:tolerance;var idx,snapValue;for(idx=0;idx<values.length;idx++)if(snapValue=values[idx],abs(snapValue-value)<=tolerance)return snapValue}function topLeft(bounds){return{x:bounds.x,y:bounds.y}}function mid(bounds,defaultValue){return!bounds||isNaN(bounds.x)||isNaN(bounds.y)?defaultValue:{x:round(bounds.x+bounds.width/2),y:round(bounds.y+bounds.height/2)}}function bottomRight(bounds){return{x:bounds.x+bounds.width,y:bounds.y+bounds.height}}var abs=Math.abs,round=Math.round;module.exports.snapTo=snapTo,module.exports.topLeft=topLeft,module.exports.mid=mid,module.exports.bottomRight=bottomRight,module.exports.isSnapped=function(event,axis){var snapped=event.snapped;return!!snapped&&("string"==typeof axis?snapped[axis]:snapped.x&&snapped.y)},module.exports.setSnapped=function(event,axis,value){if("string"!=typeof axis)throw new Error("axis must be in [x, y]");if("number"!=typeof value&&!1!==value)throw new Error("value must be Number or false");var delta,previousValue=event[axis],snapped=event.snapped=event.snapped||{};return!1===value?snapped[axis]=!1:(snapped[axis]=!0,delta=value-previousValue,event[axis]+=delta,event["d"+axis]+=delta),previousValue}},{}],299:[function(require,module,exports){"use strict";function Snapping(eventBus,canvas){this._canvas=canvas;var self=this;eventBus.on(["shape.move.start","create.start"],function(event){self.initSnap(event)}),eventBus.on(["shape.move.move","shape.move.end","create.move","create.end"],HIGHER_PRIORITY,function(event){event.originalEvent&&event.originalEvent.ctrlKey||isSnapped(event)||self.snap(event)}),eventBus.on(["shape.move.cleanup","create.cleanup"],function(event){self.hide()}),this._asyncHide=debounce(this.hide,1e3)}var filter=require("lodash/collection/filter"),forEach=require("lodash/collection/forEach"),debounce=require("lodash/function/debounce"),mid=require("./SnapUtil").mid,SnapContext=require("./SnapContext"),SnapUtil=require("./SnapUtil"),HIGHER_PRIORITY=1250,isSnapped=SnapUtil.isSnapped,setSnapped=SnapUtil.setSnapped,svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClasses=require("tiny-svg/lib/classes"),svgCreate=require("tiny-svg/lib/create");Snapping.$inject=["eventBus","canvas"],module.exports=Snapping,Snapping.prototype.initSnap=function(event){var context=event.context,shape=context.shape,snapContext=context.snapContext;snapContext||(snapContext=context.snapContext=new SnapContext);var snapMid=mid(shape,event);return snapContext.setSnapOrigin("mid",{x:snapMid.x-event.x,y:snapMid.y-event.y}),snapContext},Snapping.prototype.snap=function(event){var context=event.context,snapContext=context.snapContext,shape=context.shape,target=context.target,snapLocations=snapContext.getSnapLocations();if(target){var snapPoints=snapContext.pointsForTarget(target);snapPoints.initialized||(this.addTargetSnaps(snapPoints,shape,target),snapPoints.initialized=!0);var snapping={x:isSnapped(event,"x"),y:isSnapped(event,"y")};forEach(snapLocations,function(location){var snapOrigin=snapContext.getSnapOrigin(location),snapCurrent={x:event.x+snapOrigin.x,y:event.y+snapOrigin.y};if(forEach(["x","y"],function(axis){var locationSnapping;snapping[axis]||void 0!==(locationSnapping=snapPoints.snap(snapCurrent,location,axis,7))&&(snapping[axis]={value:locationSnapping,originValue:locationSnapping-snapOrigin[axis]})}),snapping.x&&snapping.y)return!1}),this.showSnapLine("vertical",snapping.x&&snapping.x.value),this.showSnapLine("horizontal",snapping.y&&snapping.y.value),forEach(["x","y"],function(axis){var axisSnapping=snapping[axis];"object"==typeof axisSnapping&&setSnapped(event,axis,axisSnapping.originValue)})}},Snapping.prototype._createLine=function(orientation){var root=this._canvas.getLayer("snap"),line=svgCreate("path");return svgAttr(line,{d:"M0,0 L0,0"}),svgClasses(line).add("djs-snap-line"),svgAppend(root,line),{update:function(position){"number"!=typeof position?svgAttr(line,{display:"none"}):"horizontal"===orientation?svgAttr(line,{d:"M-100000,"+position+" L+100000,"+position,display:""}):svgAttr(line,{d:"M "+position+",-100000 L "+position+", +100000",display:""})}}},Snapping.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}},Snapping.prototype.showSnapLine=function(orientation,position){var line=this.getSnapLine(orientation);line&&line.update(position),this._asyncHide()},Snapping.prototype.getSnapLine=function(orientation){return this._snapLines||this._createSnapLines(),this._snapLines[orientation]},Snapping.prototype.hide=function(){forEach(this._snapLines,function(l){l.update()})},Snapping.prototype.addTargetSnaps=function(snapPoints,shape,target){var siblings=this.getSiblings(shape,target);forEach(siblings,function(s){snapPoints.add("mid",mid(s))})},Snapping.prototype.getSiblings=function(element,target){return target&&filter(target.children,function(e){return!e.hidden&&!e.labelTarget&&!e.waypoints&&e.host!==element&&e!==element})}},{"./SnapContext":297,"./SnapUtil":298,"lodash/collection/filter":367,"lodash/collection/forEach":369,"lodash/function/debounce":381,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/create":552}],300:[function(require,module,exports){"use strict";function SpaceTool(eventBus,dragging,canvas,modeling,rules,toolManager){this._canvas=canvas,this._dragging=dragging,this._modeling=modeling,this._rules=rules,this._toolManager=toolManager;var self=this;toolManager.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),eventBus.on("spaceTool.selection.end",function(event){var target=event.originalEvent.target;(event.hover||target instanceof SVGElement)&&eventBus.once("spaceTool.selection.ended",function(){self.activateMakeSpace(event.originalEvent)})}),eventBus.on("spaceTool.move",HIGH_PRIORITY,function(event){var context=event.context;context.initialized||(context.initialized=self.initializeMakeSpace(event,context))}),eventBus.on("spaceTool.end",function(event){var context=event.context,axis=context.axis,direction=context.direction,movingShapes=context.movingShapes,resizingShapes=context.resizingShapes;if(context.initialized){var delta={x:round(event.dx),y:round(event.dy)};delta[AXIS_INVERTED[axis]]=0;var insideBounds=!0;forEach(resizingShapes,function(shape){if("w"===direction&&event.x>shape.x+shape.width||"e"===direction&&event.x<shape.x||"n"===direction&&event.y>shape.y+shape.height||"s"===direction&&event.y<shape.y)return void(insideBounds=!1)}),insideBounds&&self.makeSpace(movingShapes,resizingShapes,delta,direction),eventBus.once("spaceTool.ended",function(event){self.activateSelection(event.originalEvent,!0,!0)})}})}var SpaceUtil=require("./SpaceUtil"),Cursor=require("../../util/Cursor"),hasPrimaryModifier=require("../../util/Mouse").hasPrimaryModifier,abs=Math.abs,round=Math.round,HIGH_PRIORITY=1500,AXIS_TO_DIMENSION={x:"width",y:"height"},AXIS_INVERTED={x:"y",y:"x"},getAllChildren=require("../../util/Elements").selfAndAllChildren,assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach");SpaceTool.$inject=["eventBus","dragging","canvas","modeling","rules","toolManager"],module.exports=SpaceTool,SpaceTool.prototype.activateSelection=function(event,autoActivate,reactivate){this._dragging.init(event,"spaceTool.selection",{trapClick:!1,cursor:"crosshair",autoActivate:autoActivate,data:{context:{reactivate:reactivate}}})},SpaceTool.prototype.activateMakeSpace=function(event){this._dragging.init(event,"spaceTool",{autoActivate:!0,cursor:"crosshair",data:{context:{}}})},SpaceTool.prototype.makeSpace=function(movingShapes,resizingShapes,delta,direction){return this._modeling.createSpace(movingShapes,resizingShapes,delta,direction)},SpaceTool.prototype.initializeMakeSpace=function(event,context){var axis=abs(event.dx)>abs(event.dy)?"x":"y",offset=event["d"+axis],spacePos=event[axis]-offset;if(abs(offset)<5)return!1;offset<0&&(offset*=-1),hasPrimaryModifier(event)&&(offset*=-1);var rootShape=this._canvas.getRootElement(),allShapes=getAllChildren(rootShape,!0),adjustments=this.calculateAdjustments(allShapes,axis,offset,spacePos);return assign(context,adjustments,{axis:axis,direction:SpaceUtil.getDirection(axis,offset)}),Cursor.set("resize-"+("x"===axis?"ew":"ns")),!0},SpaceTool.prototype.calculateAdjustments=function(elements,axis,offset,spacePos){var movingShapes=[],resizingShapes=[],rules=this._rules;return elements.forEach(function(shape){var shapeStart=shape[axis],shapeEnd=shapeStart+shape[AXIS_TO_DIMENSION[axis]];if(shape.parent&&!shape.waypoints)return offset>0&&shapeStart>spacePos?movingShapes.push(shape):offset<0&&shapeEnd<spacePos?movingShapes.push(shape):shapeStart<spacePos&&shapeEnd>spacePos&&rules.allowed("shape.resize",{shape:shape})?resizingShapes.push(shape):void 0}),{movingShapes:movingShapes,resizingShapes:resizingShapes}},SpaceTool.prototype.toggle=function(){this.isActive()?this._dragging.cancel():this.activateSelection()},SpaceTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^spaceTool/.test(context.prefix)}},{"../../util/Cursor":328,"../../util/Elements":329,"../../util/Mouse":337,"./SpaceUtil":302,"lodash/collection/forEach":369,"lodash/object/assign":502}],301:[function(require,module,exports){"use strict";function SpaceToolPreview(eventBus,elementRegistry,canvas,styles,previewSupport){function addPreviewGfx(collection,dragGroup){forEach(collection,function(element){previewSupport.addDragger(element,dragGroup),canvas.addMarker(element,MARKER_DRAGGING)})}eventBus.on("spaceTool.selection.start",function(event){var space=canvas.getLayer("space"),context=event.context,orientation={x:"M 0,-10000 L 0,10000",y:"M -10000,0 L 10000,0"},crosshairGroup=svgCreate("g");svgAttr(crosshairGroup,styles.cls("djs-crosshair-group",["no-events"])),svgAppend(space,crosshairGroup);var pathX=svgCreate("path");svgAttr(pathX,"d",orientation.x),svgClasses(pathX).add("djs-crosshair"),svgAppend(crosshairGroup,pathX);var pathY=svgCreate("path");svgAttr(pathY,"d",orientation.y),svgClasses(pathY).add("djs-crosshair"),svgAppend(crosshairGroup,pathY),context.crosshairGroup=crosshairGroup}),eventBus.on("spaceTool.selection.move",function(event){var crosshairGroup=event.context.crosshairGroup;translate(crosshairGroup,event.x,event.y)}),eventBus.on("spaceTool.selection.cleanup",function(event){var context=event.context,crosshairGroup=context.crosshairGroup;crosshairGroup&&svgRemove(crosshairGroup)}),eventBus.on("spaceTool.move",LOW_PRIORITY,function(event){var context=event.context,line=context.line,axis=context.axis,movingShapes=context.movingShapes,resizingShapes=context.resizingShapes;if(context.initialized){if(!context.dragGroup){var spaceLayer=canvas.getLayer("space");line=svgCreate("path"),svgAttr(line,"d","M0,0 L0,0"),svgClasses(line).add("djs-crosshair"),svgAppend(spaceLayer,line),context.line=line;var dragGroup=svgCreate("g");svgAttr(dragGroup,styles.cls("djs-drag-group",["no-events"])),svgAppend(canvas.getDefaultLayer(),dragGroup),addPreviewGfx(movingShapes,dragGroup);addPreviewGfx(context.movingConnections=elementRegistry.filter(function(element){var sourceIsMoving=!1;forEach(movingShapes,function(shape){forEach(shape.outgoing,function(connection){element===connection&&(sourceIsMoving=!0)})});var targetIsMoving=!1;forEach(movingShapes,function(shape){forEach(shape.incoming,function(connection){element===connection&&(targetIsMoving=!0)})});var sourceIsResizing=!1;forEach(resizingShapes,function(shape){forEach(shape.outgoing,function(connection){element===connection&&(sourceIsResizing=!0)})});var targetIsResizing=!1;return forEach(resizingShapes,function(shape){forEach(shape.incoming,function(connection){element===connection&&(targetIsResizing=!0)})}),isConnection(element)&&(sourceIsMoving||sourceIsResizing)&&(targetIsMoving||targetIsResizing)}),dragGroup),context.dragGroup=dragGroup}if(!context.frameGroup){var frameGroup=svgCreate("g");svgAttr(frameGroup,styles.cls("djs-frame-group",["no-events"])),svgAppend(canvas.getDefaultLayer(),frameGroup);var frames=[];forEach(resizingShapes,function(shape){var frame=previewSupport.addFrame(shape,frameGroup);frames.push({element:frame,initialWidth:frame.getBBox().width,initialHeight:frame.getBBox().height}),canvas.addMarker(shape,MARKER_RESIZING)}),context.frameGroup=frameGroup,context.frames=frames}var orientation={x:"M"+event.x+", -10000 L"+event.x+", 10000",y:"M -10000, "+event.y+" L 10000, "+event.y};svgAttr(line,{path:orientation[axis],display:""});var opposite={x:"y",y:"x"},delta={x:event.dx,y:event.dy};delta[opposite[context.axis]]=0,translate(context.dragGroup,delta.x,delta.y),forEach(context.frames,function(frame){frame.initialWidth+delta.x>5&&svgAttr(frame.element,{width:frame.initialWidth+delta.x}),frame.initialHeight+delta.y>5&&svgAttr(frame.element,{height:frame.initialHeight+delta.y})})}}),eventBus.on("spaceTool.cleanup",function(event){var context=event.context,movingShapes=context.movingShapes,movingConnections=context.movingConnections,resizingShapes=context.resizingShapes,line=context.line,dragGroup=context.dragGroup,frameGroup=context.frameGroup;forEach(movingShapes,function(shape){canvas.removeMarker(shape,MARKER_DRAGGING)}),forEach(movingConnections,function(connection){canvas.removeMarker(connection,MARKER_DRAGGING)}),dragGroup&&(svgRemove(line),svgRemove(dragGroup)),forEach(resizingShapes,function(shape){canvas.removeMarker(shape,MARKER_RESIZING)}),frameGroup&&svgRemove(frameGroup)})}function isConnection(element){return element.waypoints}var forEach=require("lodash/collection/forEach"),MARKER_DRAGGING="djs-dragging",MARKER_RESIZING="djs-resizing",LOW_PRIORITY=250,svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgClasses=require("tiny-svg/lib/classes"),svgCreate=require("tiny-svg/lib/create"),svgRemove=require("tiny-svg/lib/remove"),translate=require("../../util/SvgTransformUtil").translate;SpaceToolPreview.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"],module.exports=SpaceToolPreview},{"../../util/SvgTransformUtil":342,"lodash/collection/forEach":369,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/classes":549,"tiny-svg/lib/create":552,"tiny-svg/lib/remove":555}],302:[function(require,module,exports){"use strict";function getDirection(axis,offset){if("x"===axis){if(offset>0)return"e";if(offset<0)return"w"}if("y"===axis){if(offset>0)return"s";if(offset<0)return"n"}return null}module.exports.getDirection=getDirection,module.exports.resizeBounds=function(bounds,direction,delta){var dx=delta.x,dy=delta.y;switch(direction){case"n":return{x:bounds.x,y:bounds.y+dy,width:bounds.width,height:bounds.height-dy};case"s":return{x:bounds.x,y:bounds.y,width:bounds.width,height:bounds.height+dy};case"w":return{x:bounds.x+dx,y:bounds.y,width:bounds.width-dx,height:bounds.height};case"e":return{x:bounds.x,y:bounds.y,width:bounds.width+dx,height:bounds.height};default:throw new Error("unrecognized direction: "+direction)}}},{}],303:[function(require,module,exports){"use strict";module.exports={__init__:["spaceToolPreview"],__depends__:[require("../dragging"),require("../rules"),require("../tool-manager"),require("../preview-support")],spaceTool:["type",require("./SpaceTool")],spaceToolPreview:["type",require("./SpaceToolPreview")]}},{"../dragging":225,"../preview-support":280,"../rules":290,"../tool-manager":305,"./SpaceTool":300,"./SpaceToolPreview":301}],304:[function(require,module,exports){"use strict";function ToolManager(eventBus,dragging){this._eventBus=eventBus,this._dragging=dragging,this._tools=[],this._active=null}var forEach=require("lodash/collection/forEach");ToolManager.$inject=["eventBus","dragging"],module.exports=ToolManager,ToolManager.prototype.registerTool=function(name,events){var tools=this._tools;if(!events)throw new Error('A tool has to be registered with it\'s "events"');tools.push(name),this.bindEvents(name,events)},ToolManager.prototype.isActive=function(tool){return tool&&this._active===tool},ToolManager.prototype.length=function(tool){return this._tools.length},ToolManager.prototype.setActive=function(tool){var eventBus=this._eventBus;this._active!==tool&&(this._active=tool,eventBus.fire("tool-manager.update",{tool:tool}))},ToolManager.prototype.bindEvents=function(name,events){var eventBus=this._eventBus,dragging=this._dragging,eventsToRegister=[];eventBus.on(events.tool+".init",function(event){if(!event.context.reactivate&&this.isActive(name))return this.setActive(null),void dragging.cancel();this.setActive(name)},this),forEach(events,function(event){eventsToRegister.push(event+".ended"),eventsToRegister.push(event+".canceled")}),eventBus.on(eventsToRegister,250,function(event){var originalEvent=event.originalEvent;!this._active||originalEvent&&"tools"===originalEvent.target.parentNode.getAttribute("data-group")||this.setActive(null)},this)}},{"lodash/collection/forEach":369}],305:[function(require,module,exports){"use strict";module.exports={__depends__:[require("../dragging")],__init__:["toolManager"],toolManager:["type",require("./ToolManager")]}},{"../dragging":225,"./ToolManager":304}],306:[function(require,module,exports){"use strict";function createRoot(parent){var root=domify('<div class="djs-tooltip-container" style="position: absolute; width: 0; height: 0;" />');return parent.insertBefore(root,parent.firstChild),root}function setPosition(el,x,y){assign(el.style,{left:x+"px",top:y+"px"})}function setVisible(el,visible){el.style.display=!1===visible?"none":""}function Tooltips(eventBus,canvas){this._eventBus=eventBus,this._canvas=canvas,this._ids=ids,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=createRoot(canvas.getContainer());var self=this;domDelegate.bind(this._tooltipRoot,tooltipSelector,"mousedown",function(event){event.stopPropagation()}),domDelegate.bind(this._tooltipRoot,tooltipSelector,"mouseover",function(event){self.trigger("mouseover",event)}),domDelegate.bind(this._tooltipRoot,tooltipSelector,"mouseout",function(event){self.trigger("mouseout",event)}),this._init()}var isString=require("lodash/lang/isString"),assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),domify=require("min-dom/lib/domify"),domAttr=require("min-dom/lib/attr"),domClasses=require("min-dom/lib/classes"),domRemove=require("min-dom/lib/remove"),domDelegate=require("min-dom/lib/delegate"),ids=new(require("../../util/IdGenerator"))("tt"),tooltipSelector=".djs-tooltip";Tooltips.$inject=["eventBus","canvas"],module.exports=Tooltips,Tooltips.prototype.add=function(tooltip){if(!tooltip.position)throw new Error("must specifiy tooltip position");if(!tooltip.html)throw new Error("must specifiy tooltip html");var id=this._ids.next();return tooltip=assign({},this._tooltipDefaults,tooltip,{id:id}),this._addTooltip(tooltip),tooltip.timeout&&this.setTimeout(tooltip),id},Tooltips.prototype.trigger=function(action,event){var node=event.delegateTarget||event.target,tooltip=this.get(domAttr(node,"data-tooltip-id"));tooltip&&("mouseover"===action&&tooltip.timeout&&this.clearTimeout(tooltip),"mouseout"===action&&tooltip.timeout&&(tooltip.timeout=1e3,this.setTimeout(tooltip)))},Tooltips.prototype.get=function(id){return"string"!=typeof id&&(id=id.id),this._tooltips[id]},Tooltips.prototype.clearTimeout=function(tooltip){if(tooltip=this.get(tooltip)){var removeTimer=tooltip.removeTimer;removeTimer&&(clearTimeout(removeTimer),tooltip.removeTimer=null)}},Tooltips.prototype.setTimeout=function(tooltip){if(tooltip=this.get(tooltip)){this.clearTimeout(tooltip);var self=this;tooltip.removeTimer=setTimeout(function(){self.remove(tooltip)},tooltip.timeout)}},Tooltips.prototype.remove=function(id){var tooltip=this.get(id);tooltip&&(domRemove(tooltip.html),domRemove(tooltip.htmlContainer),delete tooltip.htmlContainer,delete this._tooltips[tooltip.id])},Tooltips.prototype.show=function(){setVisible(this._tooltipRoot)},Tooltips.prototype.hide=function(){setVisible(this._tooltipRoot,!1)},Tooltips.prototype._updateRoot=function(viewbox){var a=viewbox.scale||1,d=viewbox.scale||1,matrix="matrix("+a+",0,0,"+d+","+-1*viewbox.x*a+","+-1*viewbox.y*d+")";this._tooltipRoot.style.transform=matrix,this._tooltipRoot.style["-ms-transform"]=matrix},Tooltips.prototype._addTooltip=function(tooltip){var htmlContainer,id=tooltip.id,html=tooltip.html,tooltipRoot=this._tooltipRoot;html.get&&(html=html.get(0)),isString(html)&&(html=domify(html)),htmlContainer=domify('<div data-tooltip-id="'+id+'" class="djs-tooltip" style="position: absolute">'),htmlContainer.appendChild(html),tooltip.type&&domClasses(htmlContainer).add("djs-tooltip-"+tooltip.type),tooltip.className&&domClasses(htmlContainer).add(tooltip.className),tooltip.htmlContainer=htmlContainer,tooltipRoot.appendChild(htmlContainer),this._tooltips[id]=tooltip,this._updateTooltip(tooltip)},Tooltips.prototype._updateTooltip=function(tooltip){var position=tooltip.position;setPosition(tooltip.htmlContainer,position.x,position.y)},Tooltips.prototype._updateTooltipVisibilty=function(viewbox){forEach(this._tooltips,function(tooltip){var show=tooltip.show,htmlContainer=tooltip.htmlContainer,visible=!0;show&&((show.minZoom>viewbox.scale||show.maxZoom<viewbox.scale)&&(visible=!1),setVisible(htmlContainer,visible))})},Tooltips.prototype._init=function(){function updateViewbox(viewbox){self._updateRoot(viewbox),self._updateTooltipVisibilty(viewbox),self.show()}var self=this;this._eventBus.on("canvas.viewbox.changing",function(event){self.hide()}),this._eventBus.on("canvas.viewbox.changed",function(event){updateViewbox(event.viewbox)})}},{"../../util/IdGenerator":333,"lodash/collection/forEach":369,"lodash/lang/isString":499,"lodash/object/assign":502,"min-dom/lib/attr":517,"min-dom/lib/classes":518,"min-dom/lib/delegate":521,"min-dom/lib/domify":522,"min-dom/lib/remove":526}],307:[function(require,module,exports){module.exports={__init__:["tooltips"],tooltips:["type",require("./Tooltips")]}},{"./Tooltips":306}],308:[function(require,module,exports){"use strict";function TouchFix(canvas,eventBus){var self=this;eventBus.on("canvas.init",function(e){self.addBBoxMarker(e.svg)})}var svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create");TouchFix.$inject=["canvas","eventBus"],module.exports=TouchFix,TouchFix.prototype.addBBoxMarker=function(svg){var markerStyle={fill:"none",class:"outer-bound-marker"},rect1=svgCreate("rect");svgAttr(rect1,{x:-1e4,y:1e4,width:10,height:10}),svgAttr(rect1,markerStyle),svgAppend(svg,rect1);var rect2=svgCreate("rect");svgAttr(rect2,{x:1e4,y:1e4,width:10,height:10}),svgAttr(rect2,markerStyle),svgAppend(svg,rect2)}},{"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/create":552}],309:[function(require,module,exports){"use strict";function log(){}function get(service,injector){return injector.get(service,!1)}function createTouchRecognizer(node){function stopEvent(event){Event.stopEvent(event,!0)}function stopMouse(event){forEach(mouseEvents,function(e){domEvent.bind(node,e,stopEvent,!0)})}function allowMouse(event){setTimeout(function(){forEach(mouseEvents,function(e){domEvent.unbind(node,e,stopEvent,!0)})},500)}domEvent.bind(node,"touchstart",stopMouse,!0),domEvent.bind(node,"touchend",allowMouse,!0),domEvent.bind(node,"touchcancel",allowMouse,!0);var recognizer=new Hammer.Manager(node,{inputClass:Hammer.TouchInput,recognizers:[]}),tap=new Hammer.Tap,pan=new Hammer.Pan({threshold:10}),press=new Hammer.Press,pinch=new Hammer.Pinch,doubleTap=new Hammer.Tap({event:"doubletap",taps:2});return pinch.requireFailure(pan),pinch.requireFailure(press),recognizer.add([pan,press,pinch,doubleTap,tap]),recognizer.reset=function(force){var recognizers=this.recognizers,session=this.session;session.stopped||(log("recognizer","stop"),recognizer.stop(force),setTimeout(function(){var i,r;for(log("recognizer","reset"),i=0;r=recognizers[i];i++)r.reset(),r.state=8;session.curRecognizer=null},0))},recognizer.on("hammer.input",function(event){event.srcEvent.defaultPrevented&&recognizer.reset(!0)}),recognizer}function TouchInteractionEvents(injector,canvas,eventBus,elementRegistry,interactionEvents){function handler(type){return function(event){log("element",type,event),interactionEvents.fire(type,event)}}function getGfx(target){return domClosest(target,"svg, .djs-element",!0)}function initEvents(svg){function startGrabCanvas(event){function update(e){var dx=e.deltaX-lx,dy=e.deltaY-ly;canvas.scroll({dx:dx,dy:dy}),lx=e.deltaX,ly=e.deltaY}function end(e){recognizer.off("panmove",update),recognizer.off("panend",end),recognizer.off("pancancel",end),log("canvas","grab end")}log("canvas","grab start");var lx=0,ly=0;recognizer.on("panmove",update),recognizer.on("panend",end),recognizer.on("pancancel",end)}function startGrab(event){var gfx=getGfx(event.target),element=gfx&&elementRegistry.get(gfx);if(move&&canvas.getRootElement()!==element)return log("element","move start",element,event,!0),move.start(event,element,!0);startGrabCanvas(event)}function startZoom(e){function update(e){var ratio=1-(1-e.scale)/1.5,newZoom=Math.max(MIN_ZOOM,Math.min(MAX_ZOOM,ratio*zoom));canvas.zoom(newZoom,mid),Event.stopEvent(e,!0)}function end(e){recognizer.off("pinchmove",update),recognizer.off("pinchend",end),recognizer.off("pinchcancel",end),recognizer.reset(!0),log("canvas","zoom end")}log("canvas","zoom start");var zoom=canvas.zoom(),mid=e.center;recognizer.on("pinchmove",update),recognizer.on("pinchend",end),recognizer.on("pinchcancel",end)}recognizer=createTouchRecognizer(svg),recognizer.on("doubletap",handler("element.dblclick")),recognizer.on("tap",handler("element.click")),recognizer.on("panstart",startGrab),recognizer.on("press",startGrab),recognizer.on("pinchstart",startZoom)}var recognizer,dragging=get("dragging",injector),move=get("move",injector),contextPad=get("contextPad",injector),palette=get("palette",injector);dragging&&eventBus.on("drag.move",function(event){var originalEvent=event.originalEvent;if(originalEvent&&!(originalEvent instanceof MouseEvent)){var position=Event.toPoint(originalEvent),node=document.elementFromPoint(position.x,position.y),gfx=getGfx(node),element=gfx&&elementRegistry.get(gfx);element!==event.hover&&(event.hover&&dragging.out(event),element&&(dragging.hover({element:element,gfx:gfx}),event.hover=element,event.hoverGfx=gfx))}}),contextPad&&eventBus.on("contextPad.create",function(event){var node=event.pad.html,padRecognizer=createTouchRecognizer(node);padRecognizer.on("panstart",function(event){log("context-pad","panstart",event),contextPad.trigger("dragstart",event,!0)}),padRecognizer.on("press",function(event){log("context-pad","press",event),contextPad.trigger("dragstart",event,!0)}),padRecognizer.on("tap",function(event){log("context-pad","tap",event),contextPad.trigger("click",event)})}),palette&&eventBus.on("palette.create",function(event){var node=event.html,padRecognizer=createTouchRecognizer(node);padRecognizer.on("panstart",function(event){log("palette","panstart",event),palette.trigger("dragstart",event,!0)}),padRecognizer.on("press",function(event){log("palette","press",event),palette.trigger("dragstart",event,!0)}),padRecognizer.on("tap",function(event){log("palette","tap",event),palette.trigger("click",event)})}),eventBus.on("canvas.init",function(event){initEvents(event.svg)})}var forEach=require("lodash/collection/forEach"),domEvent=require("min-dom/lib/event"),domClosest=require("min-dom/lib/closest"),Hammer=require("hammerjs"),Event=require("../../util/Event"),MIN_ZOOM=.2,MAX_ZOOM=4,mouseEvents=["mousedown","mouseup","mouseover","mouseout","click","dblclick"];TouchInteractionEvents.$inject=["injector","canvas","eventBus","elementRegistry","interactionEvents","touchFix"],module.exports=TouchInteractionEvents},{"../../util/Event":330,hammerjs:351,"lodash/collection/forEach":369,"min-dom/lib/closest":520,"min-dom/lib/event":523}],310:[function(require,module,exports){module.exports={__depends__:[require("../interaction-events")],__init__:["touchInteractionEvents"],touchInteractionEvents:["type",require("./TouchInteractionEvents")],touchFix:["type",require("./TouchFix")]}},{"../interaction-events":233,"./TouchFix":308,"./TouchInteractionEvents":309}],311:[function(require,module,exports){module.exports={translate:["value",require("./translate")]}},{"./translate":312}],312:[function(require,module,exports){"use strict";module.exports=function(template,replacements){return replacements=replacements||{},template.replace(/{([^}]+)}/g,function(_,key){return replacements[key]||"{"+key+"}"})}},{}],313:[function(require,module,exports){"use strict";function BaseLayouter(){}var getMid=require("./LayoutUtil").getMid;module.exports=BaseLayouter,BaseLayouter.prototype.layoutConnection=function(connection,hints){return hints=hints||{},[hints.connectionStart||getMid(connection.source),hints.connectionEnd||getMid(connection.target)]}},{"./LayoutUtil":315}],314:[function(require,module,exports){"use strict";function dockingToPoint(docking){return assign({original:docking.point.original||docking.point},docking.actual)}function CroppingConnectionDocking(elementRegistry,graphicsFactory){this._elementRegistry=elementRegistry,this._graphicsFactory=graphicsFactory}var assign=require("lodash/object/assign"),LayoutUtil=require("./LayoutUtil");CroppingConnectionDocking.$inject=["elementRegistry","graphicsFactory"],module.exports=CroppingConnectionDocking,CroppingConnectionDocking.prototype.getCroppedWaypoints=function(connection,source,target){source=source||connection.source,target=target||connection.target
;var sourceDocking=this.getDockingPoint(connection,source,!0),targetDocking=this.getDockingPoint(connection,target),croppedWaypoints=connection.waypoints.slice(sourceDocking.idx+1,targetDocking.idx);return croppedWaypoints.unshift(dockingToPoint(sourceDocking)),croppedWaypoints.push(dockingToPoint(targetDocking)),croppedWaypoints},CroppingConnectionDocking.prototype.getDockingPoint=function(connection,shape,dockStart){var dockingIdx,dockingPoint,croppedPoint,waypoints=connection.waypoints;return dockingIdx=dockStart?0:waypoints.length-1,dockingPoint=waypoints[dockingIdx],croppedPoint=this._getIntersection(shape,connection,dockStart),{point:dockingPoint,actual:croppedPoint||dockingPoint,idx:dockingIdx}},CroppingConnectionDocking.prototype._getIntersection=function(shape,connection,takeFirst){var shapePath=this._getShapePath(shape),connectionPath=this._getConnectionPath(connection);return LayoutUtil.getElementLineIntersection(shapePath,connectionPath,takeFirst)},CroppingConnectionDocking.prototype._getConnectionPath=function(connection){return this._graphicsFactory.getConnectionPath(connection)},CroppingConnectionDocking.prototype._getShapePath=function(shape){return this._graphicsFactory.getShapePath(shape)},CroppingConnectionDocking.prototype._getGfx=function(element){return this._elementRegistry.getGraphics(element)}},{"./LayoutUtil":315,"lodash/object/assign":502}],315:[function(require,module,exports){"use strict";function roundBounds(bounds){return{x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)}}function roundPoint(point){return{x:Math.round(point.x),y:Math.round(point.y)}}function asTRBL(bounds){return{top:bounds.y,right:bounds.x+(bounds.width||0),bottom:bounds.y+(bounds.height||0),left:bounds.x}}function asBounds(trbl){return{x:trbl.left,y:trbl.top,width:trbl.right-trbl.left,height:trbl.bottom-trbl.top}}function getMid(bounds){return roundPoint({x:bounds.x+(bounds.width||0)/2,y:bounds.y+(bounds.height||0)/2})}function getOrientation(rect,reference,padding){padding=padding||0,isObject(padding)||(padding={x:padding,y:padding});var rectOrientation=asTRBL(rect),referenceOrientation=asTRBL(reference),top=rectOrientation.bottom+padding.y<=referenceOrientation.top,right=rectOrientation.left-padding.x>=referenceOrientation.right,bottom=rectOrientation.top-padding.y>=referenceOrientation.bottom,left=rectOrientation.right+padding.x<=referenceOrientation.left,vertical=top?"top":bottom?"bottom":null,horizontal=left?"left":right?"right":null;return horizontal&&vertical?vertical+"-"+horizontal:horizontal||vertical||"intersect"}function getElementLineIntersection(elementPath,linePath,cropStart){var intersections=getIntersections(elementPath,linePath);return 1===intersections.length?roundPoint(intersections[0]):2===intersections.length&&pointDistance(intersections[0],intersections[1])<1?roundPoint(intersections[0]):intersections.length>1?(intersections=sortBy(intersections,function(i){var distance=Math.floor(100*i.t2)||1;return distance=100-distance,distance=(distance<10?"0":"")+distance,i.segment2+"#"+distance}),roundPoint(intersections[cropStart?0:intersections.length-1])):null}function getIntersections(a,b){return intersection(a,b)}var isObject=require("lodash/lang/isObject"),sortBy=require("lodash/collection/sortBy"),pointDistance=require("../util/Geometry").pointDistance,intersection=require("../util/Intersection").intersection;module.exports.roundBounds=roundBounds,module.exports.roundPoint=roundPoint,module.exports.asTRBL=asTRBL,module.exports.asBounds=asBounds,module.exports.getMid=getMid,module.exports.getOrientation=getOrientation,module.exports.getElementLineIntersection=getElementLineIntersection,module.exports.getIntersections=getIntersections},{"../util/Geometry":331,"../util/Intersection":334,"lodash/collection/sortBy":378,"lodash/lang/isObject":497}],316:[function(require,module,exports){"use strict";function inRange(a,start,end){return a>=start&&a<=end}function isInRange(axis,a,b){var size={x:"width",y:"height"};return inRange(a[axis],b[axis],b[axis]+b[size[axis]])}function getDirections(orientation,defaultLayout){switch(orientation){case"intersect":return null;case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return defaultLayout}}var isArray=require("lodash/lang/isArray"),find=require("lodash/collection/find"),without=require("lodash/array/without"),assign=require("lodash/object/assign"),LayoutUtil=require("./LayoutUtil"),Geometry=require("../util/Geometry"),getOrientation=LayoutUtil.getOrientation,getMid=LayoutUtil.getMid,pointsAligned=Geometry.pointsAligned,pointInRect=Geometry.pointInRect,pointDistance=Geometry.pointDistance,INTERSECTION_THRESHOLD=20,ORIENTATION_THRESHOLD={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};module.exports.getBendpoints=function(a,b,directions){directions=directions||"h:h";var xmid,ymid;if("h:v"===directions)return[{x:b.x,y:a.y}];if("v:h"===directions)return[{x:a.x,y:b.y}];if("h:h"===directions)return xmid=Math.round((b.x-a.x)/2+a.x),[{x:xmid,y:a.y},{x:xmid,y:b.y}];if("v:v"===directions)return ymid=Math.round((b.y-a.y)/2+a.y),[{x:a.x,y:ymid},{x:b.x,y:ymid}];throw new Error("unknown directions: <"+directions+">: directions must be specified as {a direction}:{b direction} (direction in h|v)")},module.exports.connectPoints=function(a,b,directions){var points=[];return pointsAligned(a,b)||(points=this.getBendpoints(a,b,directions)),points.unshift(a),points.push(b),points},module.exports.connectRectangles=function(source,target,start,end,hints){var preferredLayouts=hints&&hints.preferredLayouts||[],preferredLayout=without(preferredLayouts,"straight")[0]||"h:h",threshold=ORIENTATION_THRESHOLD[preferredLayout]||0,orientation=getOrientation(source,target,threshold),directions=getDirections(orientation,preferredLayout);if(start=start||getMid(source),end=end||getMid(target),directions){if("h:h"===directions)switch(orientation){case"top-right":case"right":case"bottom-right":start={original:start,x:source.x,y:start.y},end={original:end,x:target.x+target.width,y:end.y};break;case"top-left":case"left":case"bottom-left":start={original:start,x:source.x+source.width,y:start.y},end={original:end,x:target.x,y:end.y}}if("v:v"===directions)switch(orientation){case"top-left":case"top":case"top-right":start={original:start,x:start.x,y:source.y+source.height},end={original:end,x:end.x,y:target.y};break;case"bottom-left":case"bottom":case"bottom-right":start={original:start,x:start.x,y:source.y},end={original:end,x:end.x,y:target.y+target.height}}return this.connectPoints(start,end,directions)}},module.exports.repairConnection=function(source,target,start,end,waypoints,hints){isArray(start)&&(waypoints=start,hints=end,start=getMid(source),end=getMid(target)),hints=assign({preferredLayouts:[]},hints),waypoints=waypoints||[];var repairedWaypoints,preferredLayouts=hints.preferredLayouts,layoutStraight=-1!==preferredLayouts.indexOf("straight");return layoutStraight&&(repairedWaypoints=this.layoutStraight(source,target,start,end,hints)),repairedWaypoints||(hints.connectionEnd?(repairedWaypoints=this._repairConnectionSide(target,source,end,waypoints.slice().reverse()),repairedWaypoints=repairedWaypoints&&repairedWaypoints.reverse()):hints.connectionStart?repairedWaypoints=this._repairConnectionSide(source,target,start,waypoints):waypoints&&waypoints.length&&(repairedWaypoints=waypoints)),repairedWaypoints||(repairedWaypoints=this.connectRectangles(source,target,start,end,hints)),repairedWaypoints},module.exports.layoutStraight=function(source,target,start,end,hints){var primaryAxis,orientation,axis={};return orientation=getOrientation(source,target),/^(top|bottom|left|right)$/.test(orientation)?(/top|bottom/.test(orientation)&&(primaryAxis="x"),/left|right/.test(orientation)&&(primaryAxis="y"),"target"===hints.preserveDocking?isInRange(primaryAxis,end,source)?(axis[primaryAxis]=end[primaryAxis],[{x:void 0!==axis.x?axis.x:start.x,y:void 0!==axis.y?axis.y:start.y,original:{x:void 0!==axis.x?axis.x:start.x,y:void 0!==axis.y?axis.y:start.y}},{x:end.x,y:end.y}]):null:isInRange(primaryAxis,start,target)?(axis[primaryAxis]=start[primaryAxis],[{x:start.x,y:start.y},{x:void 0!==axis.x?axis.x:end.x,y:void 0!==axis.y?axis.y:end.y,original:{x:void 0!==axis.x?axis.x:end.x,y:void 0!==axis.y?axis.y:end.y}}]):null):null},module.exports._repairConnectionSide=function(moved,other,newDocking,points){if(function(moved,other,points){return points.length<3||!(points.length>4)&&!!find(points,function(p,idx){var q=points[idx-1];return q&&pointDistance(p,q)<3})}(moved,other,points))return null;var slicedPoints,oldDocking=points[0],newPoints=points.slice();return newPoints[0]=newDocking,newPoints[1]=function(candidate,oldPeer,newPeer){switch(pointsAligned(oldPeer,candidate)){case"v":return{x:candidate.x,y:newPeer.y};case"h":return{x:newPeer.x,y:candidate.y}}return{x:candidate.x,y:candidate.y}}(newPoints[1],oldDocking,newDocking),slicedPoints=function(points,a,b){var i;for(i=points.length-2;0!==i;i--)if(pointInRect(points[i],a,INTERSECTION_THRESHOLD)||pointInRect(points[i],b,INTERSECTION_THRESHOLD))return points.slice(i);return points}(newPoints,moved,other),slicedPoints!==newPoints?this._repairConnectionSide(moved,other,newDocking,slicedPoints):newPoints}},{"../util/Geometry":331,"./LayoutUtil":315,"lodash/array/without":362,"lodash/collection/find":368,"lodash/lang/isArray":492,"lodash/object/assign":502}],317:[function(require,module,exports){"use strict";function Base(){Object.defineProperty(this,"businessObject",{writable:!0}),parentRefs.bind(this,"parent"),labelRefs.bind(this,"label"),outgoingRefs.bind(this,"outgoing"),incomingRefs.bind(this,"incoming")}function Shape(){Base.call(this),parentRefs.bind(this,"children"),attacherRefs.bind(this,"host"),attacherRefs.bind(this,"attachers")}function Root(){Shape.call(this)}function Label(){Shape.call(this),labelRefs.bind(this,"labelTarget")}function Connection(){Base.call(this),outgoingRefs.bind(this,"source"),incomingRefs.bind(this,"target")}var assign=require("lodash/object/assign"),inherits=require("inherits"),Refs=require("object-refs"),parentRefs=new Refs({name:"children",enumerable:!0,collection:!0},{name:"parent"}),labelRefs=new Refs({name:"label",enumerable:!0},{name:"labelTarget"}),attacherRefs=new Refs({name:"attachers",collection:!0},{name:"host"}),outgoingRefs=new Refs({name:"outgoing",collection:!0},{name:"source"}),incomingRefs=new Refs({name:"incoming",collection:!0},{name:"target"});inherits(Shape,Base),inherits(Root,Shape),inherits(Label,Shape),inherits(Connection,Base);var types={connection:Connection,shape:Shape,label:Label,root:Root};module.exports.create=function(type,attrs){var Type=types[type];if(!Type)throw new Error("unknown type: <"+type+">");return assign(new Type,attrs)},module.exports.Base=Base,module.exports.Root=Root,module.exports.Shape=Shape,module.exports.Connection=Connection,module.exports.Label=Label},{inherits:354,"lodash/object/assign":502,"object-refs":539}],318:[function(require,module,exports){"use strict";function length(point){return Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2))}function MoveCanvas(eventBus,canvas){function handleMove(event){var start=context.start,position=EventUtil.toPoint(event),delta=substract(position,start);if(!context.dragging&&length(delta)>THRESHOLD&&(context.dragging=!0,ClickTrap.install(),Cursor.set("grab")),context.dragging){var lastPosition=context.last||context.start;delta=substract(position,lastPosition),canvas.scroll({dx:delta.x,dy:delta.y}),context.last=position}event.preventDefault()}function handleEnd(event){domEvent.unbind(document,"mousemove",handleMove),domEvent.unbind(document,"mouseup",handleEnd),context=null,Cursor.unset()}function handleStart(event){domClosest(event.target,".djs-draggable")||event.button||event.ctrlKey||event.shiftKey||event.altKey||(context={start:EventUtil.toPoint(event)},domEvent.bind(document,"mousemove",handleMove),domEvent.bind(document,"mouseup",handleEnd))}var context,container=canvas._container;domEvent.bind(container,"mousedown",handleStart)}var Cursor=require("../../util/Cursor"),ClickTrap=require("../../util/ClickTrap"),substract=require("../../util/Math").substract,domEvent=require("min-dom/lib/event"),domClosest=require("min-dom/lib/closest"),EventUtil=require("../../util/Event"),THRESHOLD=15;MoveCanvas.$inject=["eventBus","canvas"],module.exports=MoveCanvas},{"../../util/ClickTrap":325,"../../util/Cursor":328,"../../util/Event":330,"../../util/Math":336,"min-dom/lib/closest":520,"min-dom/lib/event":523}],319:[function(require,module,exports){module.exports={__init__:["moveCanvas"],moveCanvas:["type",require("./MoveCanvas")]}},{"./MoveCanvas":318}],320:[function(require,module,exports){module.exports={__depends__:[require("../../features/touch")]}},{"../../features/touch":310}],321:[function(require,module,exports){"use strict";function ZoomScroll(eventBus,canvas,config){this._enabled=!1,this._canvas=canvas,this._container=canvas._container,this._handleWheel=bind(this._handleWheel,this);var newEnabled=!config||!1!==config.enabled,self=this;eventBus.on("canvas.init",function(e){self._init(newEnabled)})}var domEvent=require("min-dom/lib/event"),domClosest=require("min-dom/lib/closest"),hasPrimaryModifier=require("../../util/Mouse").hasPrimaryModifier,hasSecondaryModifier=require("../../util/Mouse").hasSecondaryModifier,isMac=require("../../util/Platform").isMac,getStepRange=require("./ZoomUtil").getStepRange,cap=require("./ZoomUtil").cap,log10=require("../../util/Math").log10,bind=require("lodash/function/bind"),RANGE={min:.2,max:4};ZoomScroll.$inject=["eventBus","canvas","config.zoomScroll"],module.exports=ZoomScroll,ZoomScroll.prototype.scroll=function(delta){this._canvas.scroll(delta)},ZoomScroll.prototype.reset=function(){this._canvas.zoom("fit-viewport")},ZoomScroll.prototype.zoom=function(direction,position){var canvas=this._canvas,currentZoom=canvas.zoom(!1),factor=Math.pow(1+Math.abs(direction),direction>0?1:-1);canvas.zoom(cap(RANGE,currentZoom*factor),position)},ZoomScroll.prototype._handleWheel=function(event){if(!domClosest(event.target,".djs-scrollable",!0)){var element=this._container;event.preventDefault();var factor,isVerticalScroll=hasPrimaryModifier(event),isHorizontalScroll=hasSecondaryModifier(event);if(isVerticalScroll||isHorizontalScroll){factor=isMac?0===event.deltaMode?1.25:50:0===event.deltaMode?.025:.5;var delta={};isHorizontalScroll?delta.dx=factor*(event.deltaX||event.deltaY):delta.dy=factor*event.deltaY,this.scroll(delta)}else{factor=0===event.deltaMode?.025:.5;var elementRect=element.getBoundingClientRect(),offset={x:event.clientX-elementRect.left,y:event.clientY-elementRect.top};this.zoom(event.deltaY*factor/-5,offset)}}},ZoomScroll.prototype.stepZoom=function(direction,position){var canvas=this._canvas,stepRange=getStepRange(RANGE,10);direction=direction>0?1:-1;var currentLinearZoomLevel=log10(canvas.zoom()),newLinearZoomLevel=Math.round(currentLinearZoomLevel/stepRange)*stepRange;newLinearZoomLevel+=stepRange*direction;var newLogZoomLevel=Math.pow(10,newLinearZoomLevel);canvas.zoom(cap(RANGE,newLogZoomLevel),position)},ZoomScroll.prototype.toggle=function(newEnabled){var element=this._container,handleWheel=this._handleWheel,oldEnabled=this._enabled;return void 0===newEnabled&&(newEnabled=!oldEnabled),oldEnabled!==newEnabled&&domEvent[newEnabled?"bind":"unbind"](element,"wheel",handleWheel,!1),this._enabled=newEnabled,newEnabled},ZoomScroll.prototype._init=function(newEnabled){this.toggle(newEnabled)}},{"../../util/Math":336,"../../util/Mouse":337,"../../util/Platform":338,"./ZoomUtil":322,"lodash/function/bind":380,"min-dom/lib/closest":520,"min-dom/lib/event":523}],322:[function(require,module,exports){"use strict";var log10=require("../../util/Math").log10;module.exports.getStepRange=function(range,steps){var minLinearRange=log10(range.min),maxLinearRange=log10(range.max);return(Math.abs(minLinearRange)+Math.abs(maxLinearRange))/steps},module.exports.cap=function(range,scale){return Math.max(range.min,Math.min(range.max,scale))}},{"../../util/Math":336}],323:[function(require,module,exports){module.exports={__init__:["zoomScroll"],zoomScroll:["type",require("./ZoomScroll")]}},{"./ZoomScroll":321}],324:[function(require,module,exports){"use strict";function getNewAttachPoint(point,oldBounds,newBounds){var oldCenter=center(oldBounds),newCenter=center(newBounds),oldDelta=delta(point,oldCenter),newDelta={x:oldDelta.x*(newBounds.width/oldBounds.width),y:oldDelta.y*(newBounds.height/oldBounds.height)};return roundPoint({x:newCenter.x+newDelta.x,y:newCenter.y+newDelta.y})}function getNewAttachShapeDelta(shape,oldBounds,newBounds){var shapeCenter=center(shape),oldCenter=center(oldBounds),newCenter=center(newBounds),shapeDelta=delta(shape,shapeCenter),oldCenterDelta=delta(shapeCenter,oldCenter),newCenterDelta={x:oldCenterDelta.x*(newBounds.width/oldBounds.width),y:oldCenterDelta.y*(newBounds.height/oldBounds.height)},newShapeCenter={x:newCenter.x+newCenterDelta.x,y:newCenter.y+newCenterDelta.y};return roundPoint({x:newShapeCenter.x+shapeDelta.x-shape.x,y:newShapeCenter.y+shapeDelta.y-shape.y})}var roundPoint=require("../layout/LayoutUtil").roundPoint,center=require("./PositionUtil").center,delta=require("./PositionUtil").delta;module.exports.getNewAttachPoint=getNewAttachPoint,module.exports.getNewAttachShapeDelta=getNewAttachShapeDelta},{"../layout/LayoutUtil":315,"./PositionUtil":339}],325:[function(require,module,exports){"use strict";function trap(event){stopEvent(event),toggle(!1)}function toggle(active){domEvent[active?"bind":"unbind"](document.body,"click",trap,!0)}function install(){return toggle(!0),function(){toggle(!1)}}var domEvent=require("min-dom/lib/event"),stopEvent=require("./Event").stopEvent;module.exports.install=install},{"./Event":330,"min-dom/lib/event":523}],326:[function(require,module,exports){"use strict";module.exports.remove=function(collection,element){if(!collection||!element)return-1;var idx=collection.indexOf(element);return-1!==idx&&collection.splice(idx,1),idx},module.exports.add=function(collection,element,idx){if(collection&&element){"number"!=typeof idx&&(idx=-1);var currentIdx=collection.indexOf(element);if(-1!==currentIdx){if(currentIdx===idx)return;if(-1===idx)return;collection.splice(currentIdx,1)}-1!==idx?collection.splice(idx,0,element):collection.push(element)}},module.exports.indexOf=function(collection,element){return collection&&element?collection.indexOf(element):-1}},{}],327:[function(require,module,exports){"use strict";function getTopLevel(elements){var topLevel={},parents=[],result=[],clearedParents=[];return forEach(elements,function(element){var parent=element.parent;topLevel[parent.id]||(topLevel[parent.id]=[]),-1===parents.indexOf(parent.id)&&parents.push(parent.id),topLevel[parent.id].push(element)}),forEach(parents,function(parent){forEach(topLevel[parent],function(element){topLevel[element.id]&&clearedParents.push(element.id)})}),forEach(parents,function(parent){-1===clearedParents.indexOf(parent)&&(result=result.concat(topLevel[parent]))}),result}var forEach=require("lodash/collection/forEach");module.exports.getTopLevel=getTopLevel},{"lodash/collection/forEach":369}],328:[function(require,module,exports){"use strict";var domClasses=require("min-dom/lib/classes"),CURSOR_CLS_PATTERN=/^djs-cursor-.*$/;module.exports.set=function(mode){var classes=domClasses(document.body);classes.removeMatching(CURSOR_CLS_PATTERN),mode&&classes.add("djs-cursor-"+mode)},module.exports.unset=function(){this.set(null)},module.exports.has=function(mode){return domClasses(document.body).has("djs-cursor-"+mode)}},{"min-dom/lib/classes":518}],329:[function(require,module,exports){"use strict";function add(elements,e,unique){var canAdd=!unique||-1===elements.indexOf(e);return canAdd&&elements.push(e),canAdd}function eachElement(elements,fn,depth){depth=depth||0,isArray(elements)||(elements=[elements]),forEach(elements,function(s,i){var filter=fn(s,i,depth);isArray(filter)&&filter.length&&eachElement(filter,fn,depth+1)})}function selfAndChildren(elements,unique,maxDepth){var result=[],processedChildren=[];return eachElement(elements,function(element,i,depth){add(result,element,unique);var children=element.children;if((-1===maxDepth||depth<maxDepth)&&children&&add(processedChildren,children,unique))return children}),result}function selfAndDirectChildren(elements,allowDuplicates){return selfAndChildren(elements,!allowDuplicates,1)}function selfAndAllChildren(elements,allowDuplicates){return selfAndChildren(elements,!allowDuplicates,-1)}function getClosure(elements){function handleConnection(c){topLevel[c.source.id]&&topLevel[c.target.id]&&(topLevel[c.id]=c),allShapes[c.source.id]&&allShapes[c.target.id]&&(enclosedConnections[c.id]=enclosedElements[c.id]=c),allConnections[c.id]=c}function handleElement(element){if(enclosedElements[element.id]=element,!element.waypoints)return allShapes[element.id]=element,forEach(element.incoming,handleConnection),forEach(element.outgoing,handleConnection),element.children;enclosedConnections[element.id]=allConnections[element.id]=element}var topLevel=groupBy(elements,function(e){return e.id}),allShapes={},allConnections={},enclosedElements={},enclosedConnections={};return eachElement(elements,handleElement),{allShapes:allShapes,allConnections:allConnections,topLevel:topLevel,enclosedConnections:enclosedConnections,enclosedElements:enclosedElements}}function getBBox(elements,stopRecursion){stopRecursion=!!stopRecursion,isArray(elements)||(elements=[elements]);var minX,minY,maxX,maxY;return forEach(elements,function(element){var bbox=element;element.waypoints&&!stopRecursion&&(bbox=getBBox(element.waypoints,!0));var x=bbox.x,y=bbox.y,height=bbox.height||0,width=bbox.width||0;(x<minX||void 0===minX)&&(minX=x),(y<minY||void 0===minY)&&(minY=y),(x+width>maxX||void 0===maxX)&&(maxX=x+width),(y+height>maxY||void 0===maxY)&&(maxY=y+height)}),{x:minX,y:minY,height:maxY-minY,width:maxX-minX}}function getEnclosedElements(elements,bbox){var filteredElements={};return forEach(elements,function(element){var e=element;e.waypoints&&(e=getBBox(e)),!isNumber(bbox.y)&&e.x>bbox.x&&(filteredElements[element.id]=element),!isNumber(bbox.x)&&e.y>bbox.y&&(filteredElements[element.id]=element),e.x>bbox.x&&e.y>bbox.y&&(isNumber(bbox.width)&&isNumber(bbox.height)&&e.width+e.x<bbox.width+bbox.x&&e.height+e.y<bbox.height+bbox.y?filteredElements[element.id]=element:isNumber(bbox.width)&&isNumber(bbox.height)||(filteredElements[element.id]=element))}),filteredElements}function getElementType(element){return"waypoints"in element?"connection":"x"in element?"shape":"root"}var isArray=require("lodash/lang/isArray"),isNumber=require("lodash/lang/isNumber"),groupBy=require("lodash/collection/groupBy"),forEach=require("lodash/collection/forEach");module.exports.add=add,module.exports.eachElement=eachElement,module.exports.selfAndDirectChildren=selfAndDirectChildren,module.exports.selfAndAllChildren=selfAndAllChildren,module.exports.getBBox=getBBox,module.exports.getEnclosedElements=getEnclosedElements,module.exports.getClosure=getClosure,module.exports.getType=getElementType},{"lodash/collection/forEach":369,"lodash/collection/groupBy":370,"lodash/lang/isArray":492,"lodash/lang/isNumber":496}],330:[function(require,module,exports){"use strict";function __preventDefault(event){return event&&event.preventDefault()}function __stopPropagation(event,immediate){event&&(event.stopPropagation&&event.stopPropagation(),immediate&&event.stopImmediatePropagation&&event.stopImmediatePropagation())}function getOriginal(event){return event.originalEvent||event.srcEvent}function stopEvent(event,immediate){stopPropagation(event,immediate),preventDefault(event)}function preventDefault(event){__preventDefault(event),__preventDefault(getOriginal(event))}function stopPropagation(event,immediate){__stopPropagation(event,immediate),__stopPropagation(getOriginal(event),immediate)}function toPoint(event){return event.pointers&&event.pointers.length&&(event=event.pointers[0]),event.touches&&event.touches.length&&(event=event.touches[0]),event?{x:event.clientX,y:event.clientY}:null}module.exports.getOriginal=getOriginal,module.exports.stopEvent=stopEvent,module.exports.preventDefault=preventDefault,module.exports.stopPropagation=stopPropagation,module.exports.toPoint=toPoint},{}],331:[function(require,module,exports){"use strict";function pointDistance(a,b){return a&&b?Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)):-1}function pointsAligned(a,b){return Math.abs(a.x-b.x)<=ALIGNED_THRESHOLD?"h":Math.abs(a.y-b.y)<=ALIGNED_THRESHOLD&&"v"}module.exports.pointDistance=pointDistance,module.exports.pointsOnLine=function(p,q,r){if(!p||!q||!r)return!1;var val=(q.x-p.x)*(r.y-p.y)-(q.y-p.y)*(r.x-p.x),dist=pointDistance(p,q);return Math.abs(val/dist)<5};var ALIGNED_THRESHOLD=2;module.exports.pointsAligned=pointsAligned,module.exports.pointInRect=function(p,rect,tolerance){return tolerance=tolerance||0,p.x>rect.x-tolerance&&p.y>rect.y-tolerance&&p.x<rect.x+rect.width+tolerance&&p.y<rect.y+rect.height+tolerance},module.exports.getMidPoint=function(p,q){return{x:Math.round(p.x+(q.x-p.x)/2),y:Math.round(p.y+(q.y-p.y)/2)}}},{}],332:[function(require,module,exports){"use strict";function getVisual(gfx){return domQuery(".djs-visual",gfx)}function getChildren(gfx){return gfx.parentNode.childNodes[1]}var domQuery=require("min-dom/lib/query");module.exports.getVisual=getVisual,module.exports.getChildren=getChildren},{"min-dom/lib/query":525}],333:[function(require,module,exports){"use strict";function IdGenerator(prefix){this._counter=0,this._prefix=(prefix?prefix+"-":"")+Math.floor(1e9*Math.random())+"-"}module.exports=IdGenerator,IdGenerator.prototype.next=function(){return this._prefix+ ++this._counter}},{}],334:[function(require,module,exports){"use strict";function is(o,type){return type=String.prototype.toLowerCase.call(type),"finite"==type?isFinite(o):!("array"!=type||!(o instanceof Array||Array.isArray&&Array.isArray(o)))||("null"==type&&null===o||type==typeof o&&null!==o||"object"==type&&o===Object(o)||Object.prototype.toString.call(o).slice(8,-1).toLowerCase()==type)}function clone(obj){if("function"==typeof obj||Object(obj)!==obj)return obj;var res=new obj.constructor;for(var key in obj)obj[has](key)&&(res[key]=clone(obj[key]));return res}function repush(array,item){for(var i=0,ii=array.length;i<ii;i++)if(array[i]===item)return array.push(array.splice(i,1)[0])}function cacher(f,scope,postprocessor){function newf(){var arg=Array.prototype.slice.call(arguments,0),args=arg.join("␀"),cache=newf.cache=newf.cache||{},count=newf.count=newf.count||[];return cache[has](args)?(repush(count,args),postprocessor?postprocessor(cache[args]):cache[args]):(count.length>=1e3&&delete cache[count.shift()],count.push(args),cache[args]=f.apply(scope,arg),postprocessor?postprocessor(cache[args]):cache[args])}return newf}function parsePathString(pathString){if(!pathString)return null;var pth=paths(pathString);if(pth.arr)return clone(pth.arr);var paramCounts={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},data=[];return is(pathString,"array")&&is(pathString[0],"array")&&(data=clone(pathString)),data.length||String(pathString).replace(pathCommand,function(a,b,c){var params=[],name=b.toLowerCase();if(c.replace(pathValues,function(a,b){b&&params.push(+b)}),"m"==name&&params.length>2&&(data.push([b].concat(params.splice(0,2))),name="l",b="m"==b?"l":"L"),"o"==name&&1==params.length&&data.push([b,params[0]]),"r"==name)data.push([b].concat(params));else for(;params.length>=paramCounts[name]&&(data.push([b].concat(params.splice(0,paramCounts[name]))),paramCounts[name]););}),data.toString=paths.toString,pth.arr=clone(data),data}function paths(ps){var p=paths.ps=paths.ps||{};return p[ps]?p[ps].sleep=100:p[ps]={sleep:100},setTimeout(function(){for(var key in p)p[has](key)&&key!=ps&&!--p[key].sleep&&delete p[key]}),p[ps]}function box(x,y,width,height){return null==x&&(x=y=width=height=0),null==y&&(y=x.y,width=x.width,height=x.height,x=x.x),{x:x,y:y,width:width,w:width,height:height,h:height,x2:x+width,y2:y+height,cx:x+width/2,cy:y+height/2,r1:math.min(width,height)/2,r2:math.max(width,height)/2,r0:math.sqrt(width*width+height*height)/2,path:rectPath(x,y,width,height),vb:[x,y,width,height].join(" ")}}function toString(){return this.join(",").replace(p2s,"$1")}function pathClone(pathArray){var res=clone(pathArray);return res.toString=toString,res}function getPointAtSegmentLength(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length){return null==length?bezlen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y):findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,getTotLen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length))}function getLengthFactory(istotal,subpath){function O(val){return+(+val).toFixed(3)}return cacher(function(path,length,onlystart){path instanceof Element&&(path=path.attr("d")),path=path2curve(path);for(var x,y,p,l,point,sp="",subpaths={},len=0,i=0,ii=path.length;i<ii;i++){if(p=path[i],"M"==p[0])x=+p[1],y=+p[2];else{if(l=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6]),len+l>length){if(subpath&&!subpaths.start){if(point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len),sp+=["C"+O(point.start.x),O(point.start.y),O(point.m.x),O(point.m.y),O(point.x),O(point.y)],onlystart)return sp;subpaths.start=sp,sp=["M"+O(point.x),O(point.y)+"C"+O(point.n.x),O(point.n.y),O(point.end.x),O(point.end.y),O(p[5]),O(p[6])].join(),len+=l,x=+p[5],y=+p[6];continue}if(!istotal&&!subpath)return point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len)}len+=l,x=+p[5],y=+p[6]}sp+=p.shift()+p}return subpaths.end=sp,point=istotal?len:subpath?subpaths:findDotsAtSegment(x,y,p[0],p[1],p[2],p[3],p[4],p[5],1)},null,clone)}function findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,t13=pow(t1,3),t12=pow(t1,2),t2=t*t,t3=t2*t,x=t13*p1x+3*t12*t*c1x+3*t1*t*t*c2x+t3*p2x,y=t13*p1y+3*t12*t*c1y+3*t1*t*t*c2y+t3*p2y,mx=p1x+2*t*(c1x-p1x)+t2*(c2x-2*c1x+p1x),my=p1y+2*t*(c1y-p1y)+t2*(c2y-2*c1y+p1y),nx=c1x+2*t*(c2x-c1x)+t2*(p2x-2*c2x+c1x),ny=c1y+2*t*(c2y-c1y)+t2*(p2y-2*c2y+c1y);return{x:x,y:y,m:{x:mx,y:my},n:{x:nx,y:ny},start:{x:t1*p1x+t*c1x,y:t1*p1y+t*c1y},end:{x:t1*c2x+t*p2x,y:t1*c2y+t*p2y},alpha:90-180*math.atan2(mx-nx,my-ny)/PI}}function bezierBBox(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y){is(p1x,"array")||(p1x=[p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y]);var bbox=curveDim.apply(null,p1x);return box(bbox.min.x,bbox.min.y,bbox.max.x-bbox.min.x,bbox.max.y-bbox.min.y)}function isPointInsideBBox(bbox,x,y){return x>=bbox.x&&x<=bbox.x+bbox.width&&y>=bbox.y&&y<=bbox.y+bbox.height}function isBBoxIntersect(bbox1,bbox2){return bbox1=box(bbox1),bbox2=box(bbox2),isPointInsideBBox(bbox2,bbox1.x,bbox1.y)||isPointInsideBBox(bbox2,bbox1.x2,bbox1.y)||isPointInsideBBox(bbox2,bbox1.x,bbox1.y2)||isPointInsideBBox(bbox2,bbox1.x2,bbox1.y2)||isPointInsideBBox(bbox1,bbox2.x,bbox2.y)||isPointInsideBBox(bbox1,bbox2.x2,bbox2.y)||isPointInsideBBox(bbox1,bbox2.x,bbox2.y2)||isPointInsideBBox(bbox1,bbox2.x2,bbox2.y2)||(bbox1.x<bbox2.x2&&bbox1.x>bbox2.x||bbox2.x<bbox1.x2&&bbox2.x>bbox1.x)&&(bbox1.y<bbox2.y2&&bbox1.y>bbox2.y||bbox2.y<bbox1.y2&&bbox2.y>bbox1.y)}function base3(t,p1,p2,p3,p4){return t*(t*(-3*p1+9*p2-9*p3+3*p4)+6*p1-12*p2+6*p3)-3*p1+3*p2}function bezlen(x1,y1,x2,y2,x3,y3,x4,y4,z){null==z&&(z=1),z=z>1?1:z<0?0:z;for(var z2=z/2,Tvalues=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],sum=0,i=0;i<12;i++){var ct=z2*Tvalues[i]+z2,xbase=base3(ct,x1,x2,x3,x4),ybase=base3(ct,y1,y2,y3,y4),comb=xbase*xbase+ybase*ybase;sum+=Cvalues[i]*math.sqrt(comb)}return z2*sum}function getTotLen(x1,y1,x2,y2,x3,y3,x4,y4,ll){if(!(ll<0||bezlen(x1,y1,x2,y2,x3,y3,x4,y4)<ll)){var l,step=.5,t2=1-step;for(l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2);abs(l-ll)>.01;)step/=2,t2+=(l<ll?1:-1)*step,l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2);return t2}}
function intersect(x1,y1,x2,y2,x3,y3,x4,y4){if(!(mmax(x1,x2)<mmin(x3,x4)||mmin(x1,x2)>mmax(x3,x4)||mmax(y1,y2)<mmin(y3,y4)||mmin(y1,y2)>mmax(y3,y4))){var nx=(x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4),ny=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4),denominator=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);if(denominator){var px=nx/denominator,py=ny/denominator,px2=+px.toFixed(2),py2=+py.toFixed(2);if(!(px2<+mmin(x1,x2).toFixed(2)||px2>+mmax(x1,x2).toFixed(2)||px2<+mmin(x3,x4).toFixed(2)||px2>+mmax(x3,x4).toFixed(2)||py2<+mmin(y1,y2).toFixed(2)||py2>+mmax(y1,y2).toFixed(2)||py2<+mmin(y3,y4).toFixed(2)||py2>+mmax(y3,y4).toFixed(2)))return{x:px,y:py}}}}function interHelper(bez1,bez2,justCount){if(!isBBoxIntersect(bezierBBox(bez1),bezierBBox(bez2)))return justCount?0:[];for(var l1=bezlen.apply(0,bez1),l2=bezlen.apply(0,bez2),n1=~~(l1/8),n2=~~(l2/8),dots1=[],dots2=[],xy={},res=justCount?0:[],i=0;i<n1+1;i++){var p=findDotsAtSegment.apply(0,bez1.concat(i/n1));dots1.push({x:p.x,y:p.y,t:i/n1})}for(i=0;i<n2+1;i++)p=findDotsAtSegment.apply(0,bez2.concat(i/n2)),dots2.push({x:p.x,y:p.y,t:i/n2});for(i=0;i<n1;i++)for(var j=0;j<n2;j++){var di=dots1[i],di1=dots1[i+1],dj=dots2[j],dj1=dots2[j+1],ci=abs(di1.x-di.x)<.001?"y":"x",cj=abs(dj1.x-dj.x)<.001?"y":"x",is=intersect(di.x,di.y,di1.x,di1.y,dj.x,dj.y,dj1.x,dj1.y);if(is){if(xy[is.x.toFixed(4)]==is.y.toFixed(4))continue;xy[is.x.toFixed(4)]=is.y.toFixed(4);var t1=di.t+abs((is[ci]-di[ci])/(di1[ci]-di[ci]))*(di1.t-di.t),t2=dj.t+abs((is[cj]-dj[cj])/(dj1[cj]-dj[cj]))*(dj1.t-dj.t);t1>=0&&t1<=1&&t2>=0&&t2<=1&&(justCount?res++:res.push({x:is.x,y:is.y,t1:t1,t2:t2}))}}return res}function pathIntersection(path1,path2){return interPathHelper(path1,path2)}function pathIntersectionNumber(path1,path2){return interPathHelper(path1,path2,1)}function interPathHelper(path1,path2,justCount){path1=path2curve(path1),path2=path2curve(path2);for(var x1,y1,x2,y2,x1m,y1m,x2m,y2m,bez1,bez2,res=justCount?0:[],i=0,ii=path1.length;i<ii;i++){var pi=path1[i];if("M"==pi[0])x1=x1m=pi[1],y1=y1m=pi[2];else{"C"==pi[0]?(bez1=[x1,y1].concat(pi.slice(1)),x1=bez1[6],y1=bez1[7]):(bez1=[x1,y1,x1,y1,x1m,y1m,x1m,y1m],x1=x1m,y1=y1m);for(var j=0,jj=path2.length;j<jj;j++){var pj=path2[j];if("M"==pj[0])x2=x2m=pj[1],y2=y2m=pj[2];else{"C"==pj[0]?(bez2=[x2,y2].concat(pj.slice(1)),x2=bez2[6],y2=bez2[7]):(bez2=[x2,y2,x2,y2,x2m,y2m,x2m,y2m],x2=x2m,y2=y2m);var intr=interHelper(bez1,bez2,justCount);if(justCount)res+=intr;else{for(var k=0,kk=intr.length;k<kk;k++)intr[k].segment1=i,intr[k].segment2=j,intr[k].bez1=bez1,intr[k].bez2=bez2;res=res.concat(intr)}}}}}return res}function isPointInsidePath(path,x,y){var bbox=pathBBox(path);return isPointInsideBBox(bbox,x,y)&&interPathHelper(path,[["M",x,y],["H",bbox.x2+10]],1)%2==1}function pathBBox(path){var pth=paths(path);if(pth.bbox)return clone(pth.bbox);if(!path)return box();path=path2curve(path);for(var p,x=0,y=0,X=[],Y=[],i=0,ii=path.length;i<ii;i++)if(p=path[i],"M"==p[0])x=p[1],y=p[2],X.push(x),Y.push(y);else{var dim=curveDim(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);X=X.concat(dim.min.x,dim.max.x),Y=Y.concat(dim.min.y,dim.max.y),x=p[5],y=p[6]}var xmin=mmin.apply(0,X),ymin=mmin.apply(0,Y),xmax=mmax.apply(0,X),ymax=mmax.apply(0,Y),bb=box(xmin,ymin,xmax-xmin,ymax-ymin);return pth.bbox=clone(bb),bb}function rectPath(x,y,w,h,r){if(r)return[["M",+x+ +r,y],["l",w-2*r,0],["a",r,r,0,0,1,r,r],["l",0,h-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-w,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-h],["a",r,r,0,0,1,r,-r],["z"]];var res=[["M",x,y],["l",w,0],["l",0,h],["l",-w,0],["z"]];return res.toString=toString,res}function ellipsePath(x,y,rx,ry,a){if(null==a&&null==ry&&(ry=rx),x=+x,y=+y,rx=+rx,ry=+ry,null!=a)var rad=Math.PI/180,x1=x+rx*Math.cos(-ry*rad),x2=x+rx*Math.cos(-a*rad),y1=y+rx*Math.sin(-ry*rad),y2=y+rx*Math.sin(-a*rad),res=[["M",x1,y1],["A",rx,rx,0,+(a-ry>180),0,x2,y2]];else res=[["M",x,y],["m",0,-ry],["a",rx,ry,0,1,1,0,2*ry],["a",rx,ry,0,1,1,0,-2*ry],["z"]];return res.toString=toString,res}function pathToRelative(pathArray){var pth=paths(pathArray),lowerCase=String.prototype.toLowerCase;if(pth.rel)return pathClone(pth.rel);is(pathArray,"array")&&is(pathArray&&pathArray[0],"array")||(pathArray=parsePathString(pathArray));var res=[],x=0,y=0,mx=0,my=0,start=0;"M"==pathArray[0][0]&&(x=pathArray[0][1],y=pathArray[0][2],mx=x,my=y,start++,res.push(["M",x,y]));for(var i=start,ii=pathArray.length;i<ii;i++){var r=res[i]=[],pa=pathArray[i];if(pa[0]!=lowerCase.call(pa[0]))switch(r[0]=lowerCase.call(pa[0]),r[0]){case"a":r[1]=pa[1],r[2]=pa[2],r[3]=pa[3],r[4]=pa[4],r[5]=pa[5],r[6]=+(pa[6]-x).toFixed(3),r[7]=+(pa[7]-y).toFixed(3);break;case"v":r[1]=+(pa[1]-y).toFixed(3);break;case"m":mx=pa[1],my=pa[2];default:for(var j=1,jj=pa.length;j<jj;j++)r[j]=+(pa[j]-(j%2?x:y)).toFixed(3)}else{r=res[i]=[],"m"==pa[0]&&(mx=pa[1]+x,my=pa[2]+y);for(var k=0,kk=pa.length;k<kk;k++)res[i][k]=pa[k]}var len=res[i].length;switch(res[i][0]){case"z":x=mx,y=my;break;case"h":x+=+res[i][len-1];break;case"v":y+=+res[i][len-1];break;default:x+=+res[i][len-2],y+=+res[i][len-1]}}return res.toString=toString,pth.rel=pathClone(res),res}function pathToAbsolute(pathArray){var pth=paths(pathArray);if(pth.abs)return pathClone(pth.abs);if(is(pathArray,"array")&&is(pathArray&&pathArray[0],"array")||(pathArray=parsePathString(pathArray)),!pathArray||!pathArray.length)return[["M",0,0]];var pa0,res=[],x=0,y=0,mx=0,my=0,start=0;"M"==pathArray[0][0]&&(x=+pathArray[0][1],y=+pathArray[0][2],mx=x,my=y,start++,res[0]=["M",x,y]);for(var r,pa,crz=3==pathArray.length&&"M"==pathArray[0][0]&&"R"==pathArray[1][0].toUpperCase()&&"Z"==pathArray[2][0].toUpperCase(),i=start,ii=pathArray.length;i<ii;i++){if(res.push(r=[]),pa=pathArray[i],(pa0=pa[0])!=pa0.toUpperCase())switch(r[0]=pa0.toUpperCase(),r[0]){case"A":r[1]=pa[1],r[2]=pa[2],r[3]=pa[3],r[4]=pa[4],r[5]=pa[5],r[6]=+pa[6]+x,r[7]=+pa[7]+y;break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"R":for(var dots=[x,y].concat(pa.slice(1)),j=2,jj=dots.length;j<jj;j++)dots[j]=+dots[j]+x,dots[++j]=+dots[j]+y;res.pop(),res=res.concat(catmullRom2bezier(dots,crz));break;case"O":res.pop(),dots=ellipsePath(x,y,pa[1],pa[2]),dots.push(dots[0]),res=res.concat(dots);break;case"U":res.pop(),res=res.concat(ellipsePath(x,y,pa[1],pa[2],pa[3])),r=["U"].concat(res[res.length-1].slice(-2));break;case"M":mx=+pa[1]+x,my=+pa[2]+y;default:for(j=1,jj=pa.length;j<jj;j++)r[j]=+pa[j]+(j%2?x:y)}else if("R"==pa0)dots=[x,y].concat(pa.slice(1)),res.pop(),res=res.concat(catmullRom2bezier(dots,crz)),r=["R"].concat(pa.slice(-2));else if("O"==pa0)res.pop(),dots=ellipsePath(x,y,pa[1],pa[2]),dots.push(dots[0]),res=res.concat(dots);else if("U"==pa0)res.pop(),res=res.concat(ellipsePath(x,y,pa[1],pa[2],pa[3])),r=["U"].concat(res[res.length-1].slice(-2));else for(var k=0,kk=pa.length;k<kk;k++)r[k]=pa[k];if("O"!=(pa0=pa0.toUpperCase()))switch(r[0]){case"Z":x=+mx,y=+my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=r[r.length-2],my=r[r.length-1];default:x=r[r.length-2],y=r[r.length-1]}}return res.toString=toString,pth.abs=pathClone(res),res}function l2c(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2]}function q2c(x1,y1,ax,ay,x2,y2){return[1/3*x1+2/3*ax,1/3*y1+2/3*ay,1/3*x2+2/3*ax,1/3*y2+2/3*ay,x2,y2]}function a2c(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var xy,_120=120*PI/180,rad=PI/180*(+angle||0),res=[],rotate=cacher(function(x,y,rad){return{x:x*math.cos(rad)-y*math.sin(rad),y:x*math.sin(rad)+y*math.cos(rad)}});if(recursive)f1=recursive[0],f2=recursive[1],cx=recursive[2],cy=recursive[3];else{xy=rotate(x1,y1,-rad),x1=xy.x,y1=xy.y,xy=rotate(x2,y2,-rad),x2=xy.x,y2=xy.y;var x=(x1-x2)/2,y=(y1-y2)/2,h=x*x/(rx*rx)+y*y/(ry*ry);h>1&&(h=math.sqrt(h),rx*=h,ry*=h);var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*math.sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x))),cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=math.asin(((y1-cy)/ry).toFixed(9)),f2=math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1,f2=x2<cx?PI-f2:f2,f1<0&&(f1=2*PI+f1),f2<0&&(f2=2*PI+f2),sweep_flag&&f1>f2&&(f1-=2*PI),!sweep_flag&&f2>f1&&(f2-=2*PI)}var df=f2-f1;if(abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1),x2=cx+rx*math.cos(f2),y2=cy+ry*math.sin(f2),res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy])}df=f2-f1;var c1=math.cos(f1),s1=math.sin(f1),c2=math.cos(f2),s2=math.sin(f2),t=math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];if(m2[0]=2*m1[0]-m2[0],m2[1]=2*m1[1]-m2[1],recursive)return[m2,m3,m4].concat(res);res=[m2,m3,m4].concat(res).join().split(",");for(var newres=[],i=0,ii=res.length;i<ii;i++)newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x;return newres}function curveDim(x0,y0,x1,y1,x2,y2,x3,y3){for(var a,b,c,t,t1,t2,b2ac,sqrtb2ac,tvalues=[],bounds=[[],[]],i=0;i<2;++i)if(0==i?(b=6*x0-12*x1+6*x2,a=-3*x0+9*x1-9*x2+3*x3,c=3*x1-3*x0):(b=6*y0-12*y1+6*y2,a=-3*y0+9*y1-9*y2+3*y3,c=3*y1-3*y0),abs(a)<1e-12){if(abs(b)<1e-12)continue;0<(t=-c/b)&&t<1&&tvalues.push(t)}else b2ac=b*b-4*c*a,sqrtb2ac=math.sqrt(b2ac),b2ac<0||(t1=(-b+sqrtb2ac)/(2*a),0<t1&&t1<1&&tvalues.push(t1),0<(t2=(-b-sqrtb2ac)/(2*a))&&t2<1&&tvalues.push(t2));for(var mt,j=tvalues.length,jlen=j;j--;)t=tvalues[j],mt=1-t,bounds[0][j]=mt*mt*mt*x0+3*mt*mt*t*x1+3*mt*t*t*x2+t*t*t*x3,bounds[1][j]=mt*mt*mt*y0+3*mt*mt*t*y1+3*mt*t*t*y2+t*t*t*y3;return bounds[0][jlen]=x0,bounds[1][jlen]=y0,bounds[0][jlen+1]=x3,bounds[1][jlen+1]=y3,bounds[0].length=bounds[1].length=jlen+2,{min:{x:mmin.apply(0,bounds[0]),y:mmin.apply(0,bounds[1])},max:{x:mmax.apply(0,bounds[0]),y:mmax.apply(0,bounds[1])}}}function path2curve(path,path2){var pth=!path2&&paths(path);if(!path2&&pth.curve)return pathClone(pth.curve);for(var p=pathToAbsolute(path),p2=path2&&pathToAbsolute(path2),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},attrs2={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=(function(path,d,pcom){var nx,ny;if(!path)return["C",d.x,d.y,d.x,d.y,d.x,d.y];switch(!(path[0]in{T:1,Q:1})&&(d.qx=d.qy=null),path[0]){case"M":d.X=path[1],d.Y=path[2];break;case"A":path=["C"].concat(a2c.apply(0,[d.x,d.y].concat(path.slice(1))));break;case"S":"C"==pcom||"S"==pcom?(nx=2*d.x-d.bx,ny=2*d.y-d.by):(nx=d.x,ny=d.y),path=["C",nx,ny].concat(path.slice(1));break;case"T":"Q"==pcom||"T"==pcom?(d.qx=2*d.x-d.qx,d.qy=2*d.y-d.qy):(d.qx=d.x,d.qy=d.y),path=["C"].concat(q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1],d.qy=path[2],path=["C"].concat(q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"L":path=["C"].concat(l2c(d.x,d.y,path[1],path[2]));break;case"H":path=["C"].concat(l2c(d.x,d.y,path[1],d.y));break;case"V":path=["C"].concat(l2c(d.x,d.y,d.x,path[1]));break;case"Z":path=["C"].concat(l2c(d.x,d.y,d.X,d.Y))}return path}),fixArc=function(pp,i){if(pp[i].length>7){pp[i].shift();for(var pi=pp[i];pi.length;)pcoms1[i]="A",p2&&(pcoms2[i]="A"),pp.splice(i++,0,["C"].concat(pi.splice(0,6)));pp.splice(i,1),ii=mmax(p.length,p2&&p2.length||0)}},fixM=function(path1,path2,a1,a2,i){path1&&path2&&"M"==path1[i][0]&&"M"!=path2[i][0]&&(path2.splice(i,0,["M",a2.x,a2.y]),a1.bx=0,a1.by=0,a1.x=path1[i][1],a1.y=path1[i][2],ii=mmax(p.length,p2&&p2.length||0))},pcoms1=[],pcoms2=[],pfirst="",pcom="",i=0,ii=mmax(p.length,p2&&p2.length||0);i<ii;i++){p[i]&&(pfirst=p[i][0]),"C"!=pfirst&&(pcoms1[i]=pfirst,i&&(pcom=pcoms1[i-1])),p[i]=processPath(p[i],attrs,pcom),"A"!=pcoms1[i]&&"C"==pfirst&&(pcoms1[i]="C"),fixArc(p,i),p2&&(p2[i]&&(pfirst=p2[i][0]),"C"!=pfirst&&(pcoms2[i]=pfirst,i&&(pcom=pcoms2[i-1])),p2[i]=processPath(p2[i],attrs2,pcom),"A"!=pcoms2[i]&&"C"==pfirst&&(pcoms2[i]="C"),fixArc(p2,i)),fixM(p,p2,attrs,attrs2,i),fixM(p2,p,attrs2,attrs,i);var seg=p[i],seg2=p2&&p2[i],seglen=seg.length,seg2len=p2&&seg2.length;attrs.x=seg[seglen-2],attrs.y=seg[seglen-1],attrs.bx=toFloat(seg[seglen-4])||attrs.x,attrs.by=toFloat(seg[seglen-3])||attrs.y,attrs2.bx=p2&&(toFloat(seg2[seg2len-4])||attrs2.x),attrs2.by=p2&&(toFloat(seg2[seg2len-3])||attrs2.y),attrs2.x=p2&&seg2[seg2len-2],attrs2.y=p2&&seg2[seg2len-1]}return p2||(pth.curve=pathClone(p)),p2?[p,p2]:p}function mapPath(path,matrix){if(!matrix)return path;var x,y,i,j,ii,jj,pathi;for(path=path2curve(path),i=0,ii=path.length;i<ii;i++)for(pathi=path[i],j=1,jj=pathi.length;j<jj;j+=2)x=matrix.x(pathi[j],pathi[j+1]),y=matrix.y(pathi[j],pathi[j+1]),pathi[j]=x,pathi[j+1]=y;return path}function catmullRom2bezier(crp,z){for(var d=[],i=0,iLen=crp.length;iLen-2*!z>i;i+=2){var p=[{x:+crp[i-2],y:+crp[i-1]},{x:+crp[i],y:+crp[i+1]},{x:+crp[i+2],y:+crp[i+3]},{x:+crp[i+4],y:+crp[i+5]}];z?i?iLen-4==i?p[3]={x:+crp[0],y:+crp[1]}:iLen-2==i&&(p[2]={x:+crp[0],y:+crp[1]},p[3]={x:+crp[2],y:+crp[3]}):p[0]={x:+crp[iLen-2],y:+crp[iLen-1]}:iLen-4==i?p[3]=p[2]:i||(p[0]={x:+crp[i],y:+crp[i+1]}),d.push(["C",(-p[0].x+6*p[1].x+p[2].x)/6,(-p[0].y+6*p[1].y+p[2].y)/6,(p[1].x+6*p[2].x-p[3].x)/6,(p[1].y+6*p[2].y-p[3].y)/6,p[2].x,p[2].y])}return d}var has="hasOwnProperty",p2s=/,?([a-z]),?/gi,toFloat=parseFloat,math=Math,PI=math.PI,mmin=math.min,mmax=math.max,pow=math.pow,abs=math.abs,pathCommand=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,pathValues=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,getTotalLength=getLengthFactory(1),getPointAtLength=getLengthFactory();paths.getTotalLength=getTotalLength,paths.getPointAtLength=getPointAtLength,paths.findDotsAtSegment=findDotsAtSegment,paths.bezierBBox=bezierBBox,paths.isPointInsideBBox=isPointInsideBBox,paths.isBBoxIntersect=isBBoxIntersect,paths.intersection=pathIntersection,paths.intersectionNumber=pathIntersectionNumber,paths.isPointInside=isPointInsidePath,paths.getBBox=pathBBox,paths.toRelative=pathToRelative,paths.toAbsolute=pathToAbsolute,paths.toCubic=path2curve,paths.map=mapPath,paths.toString=toString,paths.clone=pathClone,module.exports.intersection=pathIntersection},{}],335:[function(require,module,exports){"use strict";function circlePath(center,r){return[["M",center.x,center.y],["m",0,-r],["a",r,r,0,1,1,0,2*r],["a",r,r,0,1,1,0,-2*r],["z"]]}function linePath(points){var segments=[];return points.forEach(function(p,idx){segments.push([0===idx?"M":"L",p.x,p.y])}),segments}function getBendpointIntersection(waypoints,reference){var i,w;for(i=0;w=waypoints[i];i++)if(pointDistance(w,reference)<=INTERSECTION_THRESHOLD)return{point:waypoints[i],bendpoint:!0,index:i};return null}function getPathIntersection(waypoints,reference){var idx,intersections=intersection(circlePath(reference,INTERSECTION_THRESHOLD),linePath(waypoints)),a=intersections[0],b=intersections[intersections.length-1];return a?a!==b?a.segment2!==b.segment2?(idx=max(a.segment2,b.segment2)-1,{point:waypoints[idx],bendpoint:!0,index:idx}):{point:{x:round(a.x+b.x)/2,y:round(a.y+b.y)/2},index:a.segment2}:{point:{x:round(a.x),y:round(a.y)},index:a.segment2}:null}var pointDistance=require("./Geometry").pointDistance,intersection=require("./Intersection").intersection,round=Math.round,max=Math.max,INTERSECTION_THRESHOLD=10;module.exports.getApproxIntersection=function(waypoints,reference){return getBendpointIntersection(waypoints,reference)||getPathIntersection(waypoints,reference)}},{"./Geometry":331,"./Intersection":334}],336:[function(require,module,exports){"use strict";function log10(x){return Math.log(x)/Math.log(10)}function substract(p1,p2){return{x:p1.x-p2.x,y:p1.y-p2.y}}module.exports.log10=log10,module.exports.substract=substract},{}],337:[function(require,module,exports){"use strict";function isPrimaryButton(event){return!(getOriginalEvent(event)||event).button}var getOriginalEvent=require("./Event").getOriginal,isMac=require("./Platform").isMac;module.exports.isPrimaryButton=isPrimaryButton,module.exports.isMac=isMac,module.exports.hasPrimaryModifier=function(event){var originalEvent=getOriginalEvent(event)||event;return!!isPrimaryButton(event)&&(isMac()?originalEvent.metaKey:originalEvent.ctrlKey)},module.exports.hasSecondaryModifier=function(event){var originalEvent=getOriginalEvent(event)||event;return isPrimaryButton(event)&&originalEvent.shiftKey}},{"./Event":330,"./Platform":338}],338:[function(require,module,exports){"use strict";module.exports.isMac=function(){return/mac/i.test(navigator.platform)}},{}],339:[function(require,module,exports){"use strict";function center(bounds){return{x:bounds.x+bounds.width/2,y:bounds.y+bounds.height/2}}function delta(a,b){return{x:a.x-b.x,y:a.y-b.y}}module.exports.center=center,module.exports.delta=delta},{}],340:[function(require,module,exports){"use strict";module.exports.saveClear=function(collection,removeFn){if("function"!=typeof removeFn)throw new Error("removeFn iterator must be a function");if(collection){for(var e;e=collection[0];)removeFn(e);return collection}}},{}],341:[function(require,module,exports){"use strict";function toSVGPoints(points){for(var p,result="",i=0;p=points[i];i++)result+=p.x+","+p.y+" ";return result}var svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create");module.exports.componentsToPath=function(elements){return elements.join(",").replace(/,?([A-z]),?/g,"$1")},module.exports.toSVGPoints=toSVGPoints,module.exports.createLine=function(points,attrs){var line=svgCreate("polyline");return svgAttr(line,{points:toSVGPoints(points)}),attrs&&svgAttr(line,attrs),line},module.exports.updateLine=function(gfx,points){return svgAttr(gfx,{points:toSVGPoints(points)}),gfx}},{"tiny-svg/lib/attr":548,"tiny-svg/lib/create":552}],342:[function(require,module,exports){"use strict";var svgTransform=require("tiny-svg/lib/transform"),createTransform=require("tiny-svg/lib/geometry").createTransform;module.exports.transform=function(gfx,x,y,angle,amount){var translate=createTransform();translate.setTranslate(x,y);var rotate=createTransform();rotate.setRotate(angle,0,0);var scale=createTransform();scale.setScale(amount||1,amount||1),svgTransform(gfx,[translate,rotate,scale])},module.exports.translate=function(gfx,x,y){var translate=createTransform();translate.setTranslate(x,y),svgTransform(gfx,translate)},module.exports.rotate=function(gfx,angle){var rotate=createTransform();rotate.setRotate(angle,0,0),svgTransform(gfx,rotate)},module.exports.scale=function(gfx,amount){var scale=createTransform();scale.setScale(amount,amount),svgTransform(gfx,scale)}},{"tiny-svg/lib/geometry":553,"tiny-svg/lib/transform":556}],343:[function(require,module,exports){"use strict";function parseAlign(align){var parts=align.split("-");return{horizontal:parts[0]||"center",vertical:parts[1]||"top"}}function parsePadding(padding){return isObject(padding)?assign({top:0,left:0,right:0,bottom:0},padding):{top:padding,left:padding,right:padding,bottom:padding}}function getTextBBox(text,fakeText){fakeText.textContent=text;try{var bbox,emptyLine=""===text;return fakeText.textContent=emptyLine?"dummy":text,bbox=pick(fakeText.getBBox(),["width","height"]),emptyLine&&(bbox.width=0),bbox}catch(e){return{width:0,height:0}}}function layoutNext(lines,maxWidth,fakeText){for(var textBBox,originalLine=lines.shift(),fitLine=originalLine;;){if(textBBox=getTextBBox(fitLine,fakeText),textBBox.width=fitLine?textBBox.width:0," "===fitLine||""===fitLine||textBBox.width<Math.round(maxWidth)||fitLine.length<4)return fit(lines,fitLine,originalLine,textBBox);fitLine=shortenLine(fitLine,textBBox.width,maxWidth)}}function fit(lines,fitLine,originalLine,textBBox){if(fitLine.length<originalLine.length){var nextLine=lines[0]||"",remainder=originalLine.slice(fitLine.length).trim();nextLine=/-\s*$/.test(remainder)?remainder+nextLine.replace(/^\s+/,""):remainder+" "+nextLine,lines[0]=nextLine}return{width:textBBox.width,height:textBBox.height,text:fitLine}}function semanticShorten(line,maxLength){var part,parts=line.split(/(\s|-)/g),shortenedParts=[],length=0;if(parts.length>1)for(;part=parts.shift();){if(!(part.length+length<maxLength)){"-"===part&&shortenedParts.pop();break}shortenedParts.push(part),length+=part.length}return shortenedParts.join("")}function shortenLine(line,width,maxWidth){var length=Math.max(line.length*(maxWidth/width),1),shortenedLine=semanticShorten(line,length);return shortenedLine||(shortenedLine=line.slice(0,Math.max(Math.round(length-1),1))),shortenedLine}function Text(config){this._config=assign({},{size:DEFAULT_LABEL_SIZE,padding:DEFAULT_BOX_PADDING,style:{},align:"center-top"},config||{})}var isObject=require("lodash/lang/isObject"),assign=require("lodash/object/assign"),pick=require("lodash/object/pick"),forEach=require("lodash/collection/forEach"),reduce=require("lodash/collection/reduce"),merge=require("lodash/object/merge"),svgAppend=require("tiny-svg/lib/append"),svgAttr=require("tiny-svg/lib/attr"),svgCreate=require("tiny-svg/lib/create"),svgRemove=require("tiny-svg/lib/remove"),DEFAULT_BOX_PADDING=0,DEFAULT_LABEL_SIZE={width:150,height:50};Text.prototype.createText=function(parent,text,options){var box=merge({},this._config.size,options.box||{}),style=merge({},this._config.style,options.style||{}),align=parseAlign(options.align||this._config.align),padding=parsePadding(void 0!==options.padding?options.padding:this._config.padding),lines=text.split(/\r?\n/g),layouted=[],maxWidth=box.width-padding.left-padding.right,fakeText=svgCreate("text");for(svgAttr(fakeText,{x:0,y:0}),svgAttr(fakeText,style),svgAppend(parent,fakeText);lines.length;)layouted.push(layoutNext(lines,maxWidth,fakeText));var y,x,totalHeight=reduce(layouted,function(sum,line,idx){return sum+line.height},0);switch(align.vertical){case"middle":y=(box.height-totalHeight)/2-layouted[0].height/4;break;default:y=padding.top}var textElement=svgCreate("text");return svgAttr(textElement,style),svgAppend(parent,textElement),forEach(layouted,function(line){switch(y+=line.height,align.horizontal){case"left":x=padding.left;break;case"right":x=maxWidth-padding.right-line.width;break;default:x=Math.max((maxWidth-line.width)/2+padding.left,0)}var tspan=svgCreate("tspan");svgAttr(tspan,{x:x,y:y}),tspan.textContent=line.text,svgAppend(textElement,tspan)}),svgRemove(fakeText),textElement},module.exports=Text},{"lodash/collection/forEach":369,"lodash/collection/reduce":374,"lodash/lang/isObject":497,"lodash/object/assign":502,"lodash/object/merge":508,"lodash/object/pick":511,"tiny-svg/lib/append":546,"tiny-svg/lib/attr":548,"tiny-svg/lib/create":552,"tiny-svg/lib/remove":555}],344:[function(require,module,exports){var isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},annotate=function(){var args=Array.prototype.slice.call(arguments);1===args.length&&isArray(args[0])&&(args=args[0]);var fn=args.pop();return fn.$inject=args,fn},FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,FN_ARG=/\/\*([^\*]*)\*\//m,parse=function(fn){if("function"!=typeof fn)throw new Error('Cannot annotate "'+fn+'". Expected a function!');var match=fn.toString().match(FN_ARGS);return match[1]&&match[1].split(",").map(function(arg){return match=arg.match(FN_ARG),match?match[1].trim():arg.trim()})||[]};exports.annotate=annotate,exports.parse=parse,exports.isArray=isArray},{}],345:[function(require,module,exports){module.exports={annotate:require("./annotation").annotate,Module:require("./module"),Injector:require("./injector")}},{"./annotation":344,"./injector":346,"./module":347}],346:[function(require,module,exports){var Module=require("./module"),autoAnnotate=require("./annotation").parse,annotate=require("./annotation").annotate,isArray=require("./annotation").isArray,Injector=function(modules,parent){parent=parent||{get:function(name,strict){if(currentlyResolving.push(name),!1===strict)return null;throw error('No provider for "'+name+'"!')}};var currentlyResolving=[],providers=this._providers=Object.create(parent._providers||null),instances=this._instances=Object.create(null),self=instances.injector=this,error=function(msg){var stack=currentlyResolving.join(" -> ");return currentlyResolving.length=0,new Error(stack?msg+" (Resolving: "+stack+")":msg)},get=function(name,strict){if(!providers[name]&&-1!==name.indexOf(".")){for(var parts=name.split("."),pivot=get(parts.shift());parts.length;)pivot=pivot[parts.shift()];return pivot}if(Object.hasOwnProperty.call(instances,name))return instances[name];if(Object.hasOwnProperty.call(providers,name)){if(-1!==currentlyResolving.indexOf(name))throw currentlyResolving.push(name),error("Cannot resolve circular dependency!");return currentlyResolving.push(name),instances[name]=providers[name][0](providers[name][1]),currentlyResolving.pop(),instances[name]}return parent.get(name,strict)},instantiate=function(Type){var instance=Object.create(Type.prototype),returned=invoke(Type,instance);return"object"==typeof returned?returned:instance},invoke=function(fn,context){if("function"!=typeof fn){if(!isArray(fn))throw new Error('Cannot invoke "'+fn+'". Expected a function!');fn=annotate(fn.slice())}var inject=fn.$inject&&fn.$inject||autoAnnotate(fn),dependencies=inject.map(function(dep){return get(dep)});return fn.apply(context,dependencies)},createPrivateInjectorFactory=function(privateChildInjector){return annotate(function(key){return privateChildInjector.get(key)})},createChild=function(modules,forceNewInstances){if(forceNewInstances&&forceNewInstances.length){var provider,cacheIdx,privateChildInjector,privateChildInjectorFactory,fromParentModule=Object.create(null),matchedScopes=Object.create(null),privateInjectorsCache=[],privateChildInjectors=[],privateChildFactories=[];for(var name in providers)provider=providers[name],-1!==forceNewInstances.indexOf(name)&&("private"===provider[2]?(cacheIdx=privateInjectorsCache.indexOf(provider[3]),-1===cacheIdx?(privateChildInjector=provider[3].createChild([],forceNewInstances),privateChildInjectorFactory=createPrivateInjectorFactory(privateChildInjector),privateInjectorsCache.push(provider[3]),privateChildInjectors.push(privateChildInjector),privateChildFactories.push(privateChildInjectorFactory),fromParentModule[name]=[privateChildInjectorFactory,name,"private",privateChildInjector]):fromParentModule[name]=[privateChildFactories[cacheIdx],name,"private",privateChildInjectors[cacheIdx]]):fromParentModule[name]=[provider[2],provider[1]],matchedScopes[name]=!0),"factory"!==provider[2]&&"type"!==provider[2]||!provider[1].$scope||forceNewInstances.forEach(function(scope){-1!==provider[1].$scope.indexOf(scope)&&(fromParentModule[name]=[provider[2],provider[1]],matchedScopes[scope]=!0)});forceNewInstances.forEach(function(scope){if(!matchedScopes[scope])throw new Error('No provider for "'+scope+'". Cannot use provider from the parent!')}),modules.unshift(fromParentModule)}return new Injector(modules,self)},factoryMap={factory:invoke,type:instantiate,value:function(value){return value}};modules.forEach(function(module){function arrayUnwrap(type,value){return"value"!==type&&isArray(value)&&(value=annotate(value.slice())),value}if(module instanceof Module)module.forEach(function(provider){var name=provider[0],type=provider[1],value=provider[2];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type]});else if("object"==typeof module)if(module.__exports__){var clonedModule=Object.keys(module).reduce(function(m,key){return"__"!==key.substring(0,2)&&(m[key]=module[key]),m},Object.create(null)),privateInjector=new Injector((module.__modules__||[]).concat([clonedModule]),self),getFromPrivateInjector=annotate(function(key){return privateInjector.get(key)});module.__exports__.forEach(function(key){providers[key]=[getFromPrivateInjector,key,"private",privateInjector]})}else Object.keys(module).forEach(function(name){if("private"===module[name][2])return void(providers[name]=module[name]);var type=module[name][0],value=module[name][1];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type]})}),this.get=get,this.invoke=invoke,this.instantiate=instantiate,this.createChild=createChild};module.exports=Injector},{"./annotation":344,"./module":347}],347:[function(require,module,exports){var Module=function(){var providers=[];this.factory=function(name,factory){return providers.push([name,"factory",factory]),this},this.value=function(name,value){return providers.push([name,"value",value]),this},this.type=function(name,type){return providers.push([name,"type",type]),this},this.forEach=function(iterator){providers.forEach(iterator)}};module.exports=Module},{}],348:[function(require,module,exports){function parse(html,doc){if("string"!=typeof html)throw new TypeError("String expected");doc||(doc=document);var m=/<([\w:]+)/.exec(html);if(!m)return doc.createTextNode(html);html=html.replace(/^\s+|\s+$/g,"");var tag=m[1];if("body"==tag){var el=doc.createElement("html");return el.innerHTML=html,el.removeChild(el.lastChild)}var wrap=map[tag]||map._default,depth=wrap[0],prefix=wrap[1],suffix=wrap[2],el=doc.createElement("div");for(el.innerHTML=prefix+html+suffix;depth--;)el=el.lastChild;if(el.firstChild==el.lastChild)return el.removeChild(el.firstChild);for(var fragment=doc.createDocumentFragment();el.firstChild;)fragment.appendChild(el.removeChild(el.firstChild));return fragment}module.exports=parse;var bugTestDiv,innerHTMLBug=!1;"undefined"!=typeof document&&(bugTestDiv=document.createElement("div"),bugTestDiv.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',innerHTMLBug=!bugTestDiv.getElementsByTagName("link").length,bugTestDiv=void 0);var map={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:innerHTMLBug?[1,"X<div>","</div>"]:[0,"",""]};map.td=map.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],map.option=map.optgroup=[1,'<select multiple="multiple">',"</select>"],map.thead=map.tbody=map.colgroup=map.caption=map.tfoot=[1,"<table>","</table>"],map.polyline=map.ellipse=map.polygon=map.circle=map.text=map.line=map.path=map.rect=map.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],349:[function(require,module,exports){!function(){function Parser(){}function extendDefaultOptions(options){if(options&&options._defaults)return options;var obj={_defaults:!0,types:Object.create(edn.types),converters:Object.create(edn.converters),values:Object.create(edn.values),equal:Object.create(edn.equal),printers:Object.create(edn.printers),tags:Object.create(edn.tags)};return options&&(extend(obj.types,options.types),extend(obj.converters,options.converters),extend(obj.values,options.values),extend(obj.equal,options.equal),extend(obj.printers,options.printers),extend(obj.tags,options.tags)),obj}function extend(target,source){var k;for(k in source)target[k]=source[k]}function compareValues(a,b){return a.valueOf()==b.valueOf()}function compareArrayValues(a,b,isEqual){var aLen=a.length;if(aLen!=b.length)return!1;for(var i=0;i<aLen;i++)if(!isEqual(a[i],b[i]))return!1;return!0}function valueOf(obj){return obj.valueOf()}var parser=function(){function Parser(){this.yy={}}var parser={trace:function(){},yy:{},symbols_:{error:2,edn:3,EdnValue:4,EOF:5,EdnNilLiteral:6,EdnBooleanLiteral:7,EdnString:8,EdnCharacter:9,EdnSymbol:10,EdnKeyword:11,EdnInteger:12,EdnFloat:13,EdnList:14,EdnVector:15,EdnMap:16,EdnSet:17,EdnTag:18,EdnValueList:19,DISCARD:20,NIL:21,TRUE:22,FALSE:23,STRING:24,NEWLINE:25,RETURN:26,SPACE:27,TAB:28,CHAR:29,SYMBOL:30,KEYWORD:31,INTEGER:32,FLOAT:33,"(":34,")":35,"[":36,"]":37,"{":38,"}":39,"#{":40,TAG:41,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",20:"DISCARD",21:"NIL",22:"TRUE",23:"FALSE",24:"STRING",25:"NEWLINE",26:"RETURN",27:"SPACE",28:"TAB",29:"CHAR",30:"SYMBOL",31:"KEYWORD",32:"INTEGER",33:"FLOAT",34:"(",35:")",36:"[",37:"]",38:"{",39:"}",40:"#{",41:"TAG"},productions_:[0,[3,2],[4,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,1],[19,2],[19,1],[19,3],[19,2],[6,1],[7,1],[7,1],[8,1],[9,1],[9,1],[9,1],[9,1],[9,1],[10,1],[11,1],[12,1],[13,1],[14,2],[14,3],[15,2],[15,3],[16,2],[16,3],[17,2],[17,3],[18,2]],performAction:function(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return this.$=$$[$0-1];case 15:this.$=[];break;case 16:this.$=[$$[$0]];break;case 17:this.$=$$[$0-2];break;case 18:this.$=$$[$0-1],
$$[$0-1].push($$[$0]);break;case 19:this.$=null;break;case 20:this.$=!0;break;case 21:this.$=!1;break;case 22:this.$=yytext.substr(1,yyleng-2).replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 23:this.$=yy.Character("\n");break;case 24:this.$=yy.Character("\r");break;case 25:this.$=yy.Character(" ");break;case 26:this.$=yy.Character("\t");break;case 27:this.$=yy.Character(yytext[1]);break;case 28:this.$=yy.Symbol(yytext);break;case 29:this.$=yy.Keyword(yytext.slice(1));break;case 30:this.$=yy.Integer(parseInt(yytext));break;case 31:this.$=yy.Float(parseFloat(yytext));break;case 32:this.$=yy.List([]);break;case 33:this.$=yy.List($$[$0-1]);break;case 34:this.$=yy.Vector([]);break;case 35:this.$=yy.Vector($$[$0-1]);break;case 36:this.$=yy.Map([]);break;case 37:this.$=yy.Map($$[$0-1]);break;case 38:this.$=yy.Set([]);break;case 39:this.$=yy.Set($$[$0-1]);break;case 40:this.$=yy.Tag($$[$0-1].substr(1),$$[$0],yy.options)}},table:[{3:1,4:2,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],38:[1,31],40:[1,32],41:[1,33]},{1:[3]},{5:[1,34]},{5:[2,2],20:[2,2],21:[2,2],22:[2,2],23:[2,2],24:[2,2],25:[2,2],26:[2,2],27:[2,2],28:[2,2],29:[2,2],30:[2,2],31:[2,2],32:[2,2],33:[2,2],34:[2,2],35:[2,2],36:[2,2],37:[2,2],38:[2,2],39:[2,2],40:[2,2],41:[2,2]},{5:[2,3],20:[2,3],21:[2,3],22:[2,3],23:[2,3],24:[2,3],25:[2,3],26:[2,3],27:[2,3],28:[2,3],29:[2,3],30:[2,3],31:[2,3],32:[2,3],33:[2,3],34:[2,3],35:[2,3],36:[2,3],37:[2,3],38:[2,3],39:[2,3],40:[2,3],41:[2,3]},{5:[2,4],20:[2,4],21:[2,4],22:[2,4],23:[2,4],24:[2,4],25:[2,4],26:[2,4],27:[2,4],28:[2,4],29:[2,4],30:[2,4],31:[2,4],32:[2,4],33:[2,4],34:[2,4],35:[2,4],36:[2,4],37:[2,4],38:[2,4],39:[2,4],40:[2,4],41:[2,4]},{5:[2,5],20:[2,5],21:[2,5],22:[2,5],23:[2,5],24:[2,5],25:[2,5],26:[2,5],27:[2,5],28:[2,5],29:[2,5],30:[2,5],31:[2,5],32:[2,5],33:[2,5],34:[2,5],35:[2,5],36:[2,5],37:[2,5],38:[2,5],39:[2,5],40:[2,5],41:[2,5]},{5:[2,6],20:[2,6],21:[2,6],22:[2,6],23:[2,6],24:[2,6],25:[2,6],26:[2,6],27:[2,6],28:[2,6],29:[2,6],30:[2,6],31:[2,6],32:[2,6],33:[2,6],34:[2,6],35:[2,6],36:[2,6],37:[2,6],38:[2,6],39:[2,6],40:[2,6],41:[2,6]},{5:[2,7],20:[2,7],21:[2,7],22:[2,7],23:[2,7],24:[2,7],25:[2,7],26:[2,7],27:[2,7],28:[2,7],29:[2,7],30:[2,7],31:[2,7],32:[2,7],33:[2,7],34:[2,7],35:[2,7],36:[2,7],37:[2,7],38:[2,7],39:[2,7],40:[2,7],41:[2,7]},{5:[2,8],20:[2,8],21:[2,8],22:[2,8],23:[2,8],24:[2,8],25:[2,8],26:[2,8],27:[2,8],28:[2,8],29:[2,8],30:[2,8],31:[2,8],32:[2,8],33:[2,8],34:[2,8],35:[2,8],36:[2,8],37:[2,8],38:[2,8],39:[2,8],40:[2,8],41:[2,8]},{5:[2,9],20:[2,9],21:[2,9],22:[2,9],23:[2,9],24:[2,9],25:[2,9],26:[2,9],27:[2,9],28:[2,9],29:[2,9],30:[2,9],31:[2,9],32:[2,9],33:[2,9],34:[2,9],35:[2,9],36:[2,9],37:[2,9],38:[2,9],39:[2,9],40:[2,9],41:[2,9]},{5:[2,10],20:[2,10],21:[2,10],22:[2,10],23:[2,10],24:[2,10],25:[2,10],26:[2,10],27:[2,10],28:[2,10],29:[2,10],30:[2,10],31:[2,10],32:[2,10],33:[2,10],34:[2,10],35:[2,10],36:[2,10],37:[2,10],38:[2,10],39:[2,10],40:[2,10],41:[2,10]},{5:[2,11],20:[2,11],21:[2,11],22:[2,11],23:[2,11],24:[2,11],25:[2,11],26:[2,11],27:[2,11],28:[2,11],29:[2,11],30:[2,11],31:[2,11],32:[2,11],33:[2,11],34:[2,11],35:[2,11],36:[2,11],37:[2,11],38:[2,11],39:[2,11],40:[2,11],41:[2,11]},{5:[2,12],20:[2,12],21:[2,12],22:[2,12],23:[2,12],24:[2,12],25:[2,12],26:[2,12],27:[2,12],28:[2,12],29:[2,12],30:[2,12],31:[2,12],32:[2,12],33:[2,12],34:[2,12],35:[2,12],36:[2,12],37:[2,12],38:[2,12],39:[2,12],40:[2,12],41:[2,12]},{5:[2,13],20:[2,13],21:[2,13],22:[2,13],23:[2,13],24:[2,13],25:[2,13],26:[2,13],27:[2,13],28:[2,13],29:[2,13],30:[2,13],31:[2,13],32:[2,13],33:[2,13],34:[2,13],35:[2,13],36:[2,13],37:[2,13],38:[2,13],39:[2,13],40:[2,13],41:[2,13]},{5:[2,14],20:[2,14],21:[2,14],22:[2,14],23:[2,14],24:[2,14],25:[2,14],26:[2,14],27:[2,14],28:[2,14],29:[2,14],30:[2,14],31:[2,14],32:[2,14],33:[2,14],34:[2,14],35:[2,14],36:[2,14],37:[2,14],38:[2,14],39:[2,14],40:[2,14],41:[2,14]},{5:[2,19],20:[2,19],21:[2,19],22:[2,19],23:[2,19],24:[2,19],25:[2,19],26:[2,19],27:[2,19],28:[2,19],29:[2,19],30:[2,19],31:[2,19],32:[2,19],33:[2,19],34:[2,19],35:[2,19],36:[2,19],37:[2,19],38:[2,19],39:[2,19],40:[2,19],41:[2,19]},{5:[2,20],20:[2,20],21:[2,20],22:[2,20],23:[2,20],24:[2,20],25:[2,20],26:[2,20],27:[2,20],28:[2,20],29:[2,20],30:[2,20],31:[2,20],32:[2,20],33:[2,20],34:[2,20],35:[2,20],36:[2,20],37:[2,20],38:[2,20],39:[2,20],40:[2,20],41:[2,20]},{5:[2,21],20:[2,21],21:[2,21],22:[2,21],23:[2,21],24:[2,21],25:[2,21],26:[2,21],27:[2,21],28:[2,21],29:[2,21],30:[2,21],31:[2,21],32:[2,21],33:[2,21],34:[2,21],35:[2,21],36:[2,21],37:[2,21],38:[2,21],39:[2,21],40:[2,21],41:[2,21]},{5:[2,22],20:[2,22],21:[2,22],22:[2,22],23:[2,22],24:[2,22],25:[2,22],26:[2,22],27:[2,22],28:[2,22],29:[2,22],30:[2,22],31:[2,22],32:[2,22],33:[2,22],34:[2,22],35:[2,22],36:[2,22],37:[2,22],38:[2,22],39:[2,22],40:[2,22],41:[2,22]},{5:[2,23],20:[2,23],21:[2,23],22:[2,23],23:[2,23],24:[2,23],25:[2,23],26:[2,23],27:[2,23],28:[2,23],29:[2,23],30:[2,23],31:[2,23],32:[2,23],33:[2,23],34:[2,23],35:[2,23],36:[2,23],37:[2,23],38:[2,23],39:[2,23],40:[2,23],41:[2,23]},{5:[2,24],20:[2,24],21:[2,24],22:[2,24],23:[2,24],24:[2,24],25:[2,24],26:[2,24],27:[2,24],28:[2,24],29:[2,24],30:[2,24],31:[2,24],32:[2,24],33:[2,24],34:[2,24],35:[2,24],36:[2,24],37:[2,24],38:[2,24],39:[2,24],40:[2,24],41:[2,24]},{5:[2,25],20:[2,25],21:[2,25],22:[2,25],23:[2,25],24:[2,25],25:[2,25],26:[2,25],27:[2,25],28:[2,25],29:[2,25],30:[2,25],31:[2,25],32:[2,25],33:[2,25],34:[2,25],35:[2,25],36:[2,25],37:[2,25],38:[2,25],39:[2,25],40:[2,25],41:[2,25]},{5:[2,26],20:[2,26],21:[2,26],22:[2,26],23:[2,26],24:[2,26],25:[2,26],26:[2,26],27:[2,26],28:[2,26],29:[2,26],30:[2,26],31:[2,26],32:[2,26],33:[2,26],34:[2,26],35:[2,26],36:[2,26],37:[2,26],38:[2,26],39:[2,26],40:[2,26],41:[2,26]},{5:[2,27],20:[2,27],21:[2,27],22:[2,27],23:[2,27],24:[2,27],25:[2,27],26:[2,27],27:[2,27],28:[2,27],29:[2,27],30:[2,27],31:[2,27],32:[2,27],33:[2,27],34:[2,27],35:[2,27],36:[2,27],37:[2,27],38:[2,27],39:[2,27],40:[2,27],41:[2,27]},{5:[2,28],20:[2,28],21:[2,28],22:[2,28],23:[2,28],24:[2,28],25:[2,28],26:[2,28],27:[2,28],28:[2,28],29:[2,28],30:[2,28],31:[2,28],32:[2,28],33:[2,28],34:[2,28],35:[2,28],36:[2,28],37:[2,28],38:[2,28],39:[2,28],40:[2,28],41:[2,28]},{5:[2,29],20:[2,29],21:[2,29],22:[2,29],23:[2,29],24:[2,29],25:[2,29],26:[2,29],27:[2,29],28:[2,29],29:[2,29],30:[2,29],31:[2,29],32:[2,29],33:[2,29],34:[2,29],35:[2,29],36:[2,29],37:[2,29],38:[2,29],39:[2,29],40:[2,29],41:[2,29]},{5:[2,30],20:[2,30],21:[2,30],22:[2,30],23:[2,30],24:[2,30],25:[2,30],26:[2,30],27:[2,30],28:[2,30],29:[2,30],30:[2,30],31:[2,30],32:[2,30],33:[2,30],34:[2,30],35:[2,30],36:[2,30],37:[2,30],38:[2,30],39:[2,30],40:[2,30],41:[2,30]},{5:[2,31],20:[2,31],21:[2,31],22:[2,31],23:[2,31],24:[2,31],25:[2,31],26:[2,31],27:[2,31],28:[2,31],29:[2,31],30:[2,31],31:[2,31],32:[2,31],33:[2,31],34:[2,31],35:[2,31],36:[2,31],37:[2,31],38:[2,31],39:[2,31],40:[2,31],41:[2,31]},{4:38,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,19:36,20:[1,37],21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],35:[1,35],36:[1,30],38:[1,31],40:[1,32],41:[1,33]},{4:38,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,19:40,20:[1,37],21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],37:[1,39],38:[1,31],40:[1,32],41:[1,33]},{4:38,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,19:42,20:[1,37],21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],38:[1,31],39:[1,41],40:[1,32],41:[1,33]},{4:38,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,19:44,20:[1,37],21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],38:[1,31],39:[1,43],40:[1,32],41:[1,33]},{4:45,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],38:[1,31],40:[1,32],41:[1,33]},{1:[2,1]},{5:[2,32],20:[2,32],21:[2,32],22:[2,32],23:[2,32],24:[2,32],25:[2,32],26:[2,32],27:[2,32],28:[2,32],29:[2,32],30:[2,32],31:[2,32],32:[2,32],33:[2,32],34:[2,32],35:[2,32],36:[2,32],37:[2,32],38:[2,32],39:[2,32],40:[2,32],41:[2,32]},{4:48,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,20:[1,47],21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],35:[1,46],36:[1,30],38:[1,31],40:[1,32],41:[1,33]},{4:49,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],38:[1,31],40:[1,32],41:[1,33]},{20:[2,16],21:[2,16],22:[2,16],23:[2,16],24:[2,16],25:[2,16],26:[2,16],27:[2,16],28:[2,16],29:[2,16],30:[2,16],31:[2,16],32:[2,16],33:[2,16],34:[2,16],35:[2,16],36:[2,16],37:[2,16],38:[2,16],39:[2,16],40:[2,16],41:[2,16]},{5:[2,34],20:[2,34],21:[2,34],22:[2,34],23:[2,34],24:[2,34],25:[2,34],26:[2,34],27:[2,34],28:[2,34],29:[2,34],30:[2,34],31:[2,34],32:[2,34],33:[2,34],34:[2,34],35:[2,34],36:[2,34],37:[2,34],38:[2,34],39:[2,34],40:[2,34],41:[2,34]},{4:48,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,20:[1,47],21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],37:[1,50],38:[1,31],40:[1,32],41:[1,33]},{5:[2,36],20:[2,36],21:[2,36],22:[2,36],23:[2,36],24:[2,36],25:[2,36],26:[2,36],27:[2,36],28:[2,36],29:[2,36],30:[2,36],31:[2,36],32:[2,36],33:[2,36],34:[2,36],35:[2,36],36:[2,36],37:[2,36],38:[2,36],39:[2,36],40:[2,36],41:[2,36]},{4:48,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,20:[1,47],21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],38:[1,31],39:[1,51],40:[1,32],41:[1,33]},{5:[2,38],20:[2,38],21:[2,38],22:[2,38],23:[2,38],24:[2,38],25:[2,38],26:[2,38],27:[2,38],28:[2,38],29:[2,38],30:[2,38],31:[2,38],32:[2,38],33:[2,38],34:[2,38],35:[2,38],36:[2,38],37:[2,38],38:[2,38],39:[2,38],40:[2,38],41:[2,38]},{4:48,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,20:[1,47],21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],38:[1,31],39:[1,52],40:[1,32],41:[1,33]},{5:[2,40],20:[2,40],21:[2,40],22:[2,40],23:[2,40],24:[2,40],25:[2,40],26:[2,40],27:[2,40],28:[2,40],29:[2,40],30:[2,40],31:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],37:[2,40],38:[2,40],39:[2,40],40:[2,40],41:[2,40]},{5:[2,33],20:[2,33],21:[2,33],22:[2,33],23:[2,33],24:[2,33],25:[2,33],26:[2,33],27:[2,33],28:[2,33],29:[2,33],30:[2,33],31:[2,33],32:[2,33],33:[2,33],34:[2,33],35:[2,33],36:[2,33],37:[2,33],38:[2,33],39:[2,33],40:[2,33],41:[2,33]},{4:53,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11,15:12,16:13,17:14,18:15,21:[1,16],22:[1,17],23:[1,18],24:[1,19],25:[1,20],26:[1,21],27:[1,22],28:[1,23],29:[1,24],30:[1,25],31:[1,26],32:[1,27],33:[1,28],34:[1,29],36:[1,30],38:[1,31],40:[1,32],41:[1,33]},{20:[2,18],21:[2,18],22:[2,18],23:[2,18],24:[2,18],25:[2,18],26:[2,18],27:[2,18],28:[2,18],29:[2,18],30:[2,18],31:[2,18],32:[2,18],33:[2,18],34:[2,18],35:[2,18],36:[2,18],37:[2,18],38:[2,18],39:[2,18],40:[2,18],41:[2,18]},{20:[2,15],21:[2,15],22:[2,15],23:[2,15],24:[2,15],25:[2,15],26:[2,15],27:[2,15],28:[2,15],29:[2,15],30:[2,15],31:[2,15],32:[2,15],33:[2,15],34:[2,15],35:[2,15],36:[2,15],37:[2,15],38:[2,15],39:[2,15],40:[2,15],41:[2,15]},{5:[2,35],20:[2,35],21:[2,35],22:[2,35],23:[2,35],24:[2,35],25:[2,35],26:[2,35],27:[2,35],28:[2,35],29:[2,35],30:[2,35],31:[2,35],32:[2,35],33:[2,35],34:[2,35],35:[2,35],36:[2,35],37:[2,35],38:[2,35],39:[2,35],40:[2,35],41:[2,35]},{5:[2,37],20:[2,37],21:[2,37],22:[2,37],23:[2,37],24:[2,37],25:[2,37],26:[2,37],27:[2,37],28:[2,37],29:[2,37],30:[2,37],31:[2,37],32:[2,37],33:[2,37],34:[2,37],35:[2,37],36:[2,37],37:[2,37],38:[2,37],39:[2,37],40:[2,37],41:[2,37]},{5:[2,39],20:[2,39],21:[2,39],22:[2,39],23:[2,39],24:[2,39],25:[2,39],26:[2,39],27:[2,39],28:[2,39],29:[2,39],30:[2,39],31:[2,39],32:[2,39],33:[2,39],34:[2,39],35:[2,39],36:[2,39],37:[2,39],38:[2,39],39:[2,39],40:[2,39],41:[2,39]},{20:[2,17],21:[2,17],22:[2,17],23:[2,17],24:[2,17],25:[2,17],26:[2,17],27:[2,17],28:[2,17],29:[2,17],30:[2,17],31:[2,17],32:[2,17],33:[2,17],34:[2,17],35:[2,17],36:[2,17],37:[2,17],38:[2,17],39:[2,17],40:[2,17],41:[2,17]}],defaultActions:{34:[2,1]},parseError:function(str,hash){throw new Error(str)},parse:function(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0;this.lexer.setInput(input),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var symbol,preErrorSymbol,state,action,r,p,len,newState,expected,yyval={};;){if(state=stack[stack.length-1],this.defaultActions[state]?action=this.defaultActions[state]:(null!==symbol&&void 0!==symbol||(symbol=function(){var token;return token=self.lexer.lex()||1,"number"!=typeof token&&(token=self.symbols_[token]||token),token}()),action=table[state]&&table[state][symbol]),void 0===action||!action.length||!action[0]){var errStr="";if(!recovering){expected=[];for(p in table[state])this.terminals_[p]&&p>2&&expected.push("'"+this.terminals_[p]+"'");errStr=this.lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(1==symbol?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'"),this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol),vstack.push(this.lexer.yytext),lstack.push(this.lexer.yylloc),stack.push(action[1]),symbol=null,preErrorSymbol?(symbol=preErrorSymbol,preErrorSymbol=null):(yyleng=this.lexer.yyleng,yytext=this.lexer.yytext,yylineno=this.lexer.yylineno,yyloc=this.lexer.yylloc,recovering>0&&recovering--);break;case 2:if(len=this.productions_[action[1]][1],yyval.$=vstack[vstack.length-len],yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column},ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]),void 0!==(r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack)))return r;len&&(stack=stack.slice(0,-1*len*2),vstack=vstack.slice(0,-1*len),lstack=lstack.slice(0,-1*len)),stack.push(this.productions_[action[1]][0]),vstack.push(yyval.$),lstack.push(yyval._$),newState=table[stack[stack.length-2]][stack[stack.length-1]],stack.push(newState);break;case 3:return!0}}return!0}},lexer=function(){var lexer={EOF:1,parseError:function(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input){return this._input=input,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var ch=this._input[0];return this.yytext+=ch,this.yyleng++,this.offset++,this.match+=ch,this.matched+=ch,ch.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-len-1),this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),lines.length-1&&(this.yylineno-=lines.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]),this},more:function(){return this._more=!0,this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;return next.length<20&&(next+=this._input.substr(0,20-next.length)),(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var token,match,tempMatch,index,lines;this._more||(this.yytext="",this.match="");for(var rules=this._currentRules(),i=0;i<rules.length&&(!(tempMatch=this._input.match(this.rules[rules[i]]))||match&&!(tempMatch[0].length>match[0].length)||(match=tempMatch,index=i,this.options.flex));i++);return match?(lines=match[0].match(/(?:\r\n?|\n).*/g),lines&&(this.yylineno+=lines.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length},this.yytext+=match[0],this.match+=match[0],this.matches=match,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(match[0].length),this.matched+=match[0],token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),token||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var r=this.next();return void 0!==r?r:this.lex()},begin:function(condition){this.conditionStack.push(condition)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(condition){this.begin(condition)}};return lexer.options={},lexer.performAction=function(yy,yy_,$avoiding_name_collisions,YY_START){switch($avoiding_name_collisions){case 0:case 1:case 2:break;case 3:return 20;case 4:return 25;case 5:return 26;case 6:return 27;case 7:return 28;case 8:return 29;case 9:return 33;case 10:return 32;case 11:return 24;case 12:return 22;case 13:return 23;case 14:return 21;case 15:return 5;case 16:return 34;case 17:return 35;case 18:return 40;case 19:return 38;case 20:return 39;case 21:return 36;case 22:return 37;case 23:return 41;case 24:return 31;case 25:return 30}},lexer.rules=[/^(?:\s+)/,/^(?:,)/,/^(?:;[^\n]+)/,/^(?:#[_])/,/^(?:\\newline\b)/,/^(?:\\return\b)/,/^(?:\\space\b)/,/^(?:\\tab\b)/,/^(?:\\[a-z]\b)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)\b)/,/^(?:(-?([0-9]|[1-9][0-9]+))\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:true\b)/,/^(?:false\b)/,/^(?:nil\b)/,/^(?:$)/,/^(?:\()/,/^(?:\))/,/^(?:#\{)/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:#[a-zA-Z0-9\/]+)/,/^(?::[a-zA-Z0-9\/\.\*\+\!\:\-\_\?\$\=\#]+)/,/^(?:[a-zA-Z\.\*\+\!\-\_\?\$\%\&\=\/][a-zA-Z0-9\#\.\*\+\!\-\_\?\$\%\&\=\/]*)/],lexer.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:!0}},lexer}();return parser.lexer=lexer,Parser.prototype=parser,parser.Parser=Parser,new Parser}();if(void 0!==exports)var edn=exports;else var edn=window.edn={};Parser.prototype=parser,edn.parse=function(str,options){var parser=new Parser;return parser.yy.options=extendDefaultOptions(options),parser.parse(str)},edn.printers={},edn.stringify=function(obj,options){if(options=extendDefaultOptions(options),obj&&obj.toEDN)return obj.toEDN();obj=edn.convert(obj,options);var type=edn.typeOf(obj,options);if(type){var printer=options.printers[type];if(printer)return printer(obj);throw new Error("No printer function for type "+type)}throw new Error("No printer function for object "+obj)},edn.values={},edn.valueOf=function(obj,deep,options){function valueOf(obj){var type=edn.typeOf(obj,options);if(type){var f=options.values[type];return f?f(obj,deep,valueOf):obj}return obj}return void 0==deep&&(deep=!0),options=extendDefaultOptions(options),valueOf(obj)},edn.equal={},edn.isEqual=function(a,b,options){function isEqual(a,b){a=edn.convert(a,options),b=edn.convert(b,options);var aType=edn.typeOf(a,options),bType=edn.typeOf(b,options),eq=options.equal[aType];if(a===b)return!0;if(aType!==bType)return!1;if(eq)return eq(a,b,isEqual);throw new Error("No equal function for type "+aType)}return options=extendDefaultOptions(options),isEqual(a,b)},edn.converters={},edn.convert=function(obj,options){if(options=extendDefaultOptions(options),obj&&obj.asEDN)return obj.asEDN();var type=edn.typeOf(obj,options);if(type){var f=options.converters[type];return f?f(obj):obj}throw new Error("No type for object "+obj)},edn.types={},edn.typeOf=function(obj,options){options=extendDefaultOptions(options);var matchedTypes=[];for(var type in options.types)options.types[type](obj)&&matchedTypes.push(type);if(1==matchedTypes.length)return matchedTypes[0];if(matchedTypes.length>1)throw new Error("Conflicted types "+matchedTypes.join(", ")+" for object "+obj);return null};var toString=Object.prototype.toString;!function(){edn.types.nil=function(obj){return null===obj},edn.printers.nil=function(){return"nil"},edn.equal.nil=function(a,b){return!0},edn.types.undefined=function(obj){return void 0===obj},edn.converters.undefined=function(){return null}}(),function(){edn.types.boolean=function(obj){return"[object Boolean]"===toString.call(obj)},edn.printers.boolean=function(bool){return bool.valueOf()?"true":"false"},edn.equal.boolean=compareValues}(),function(){edn.types.string=function(obj){return"[object String]"===toString.call(obj)},edn.printers.string=function(str){return JSON.stringify(str)},edn.equal.string=compareValues}(),edn.Character=function(){function Character(c){if(!(this instanceof Character)){var char=pool[c];return char||(char=new Character(c),Object.freeze(char),pool[c]=char),char}this.char=c}var pool={};return Character.prototype.valueOf=function(){return this.char},Character.prototype.toString=function(){return this.char},Character.prototype.inspect=function(){return"[edn.Character "+require("util").inspect(this.char)+"]"},edn.types.character=function(obj){return obj instanceof Character},edn.printers.character=function(char){switch(char=char.valueOf()){case"\n":return"\\newline";case"\r":return"\\return";case" ":return"\\space";case"\t":return"\\tab";default:return"\\"+char[0]}},edn.values.character=valueOf,edn.equal.character=compareValues,edn.character=Character,parser.yy.Character=Character,Character}(),edn.Symbol=function(){function Symbol(namespace,name){if(!(this instanceof Symbol)){var nsname=joinNamespace(namespace,name),sym=pool[nsname];return sym||(sym=new Symbol(namespace,name),Object.freeze(sym),pool[sym.valueOf()]=sym),sym}var parts=splitNamespacedName(namespace,name);this.namespace=parts[0],this.name=parts[1]}function splitNamespacedName(namespace,name){if(namespace&&name)return[namespace,name];var parts=namespace.split("/",2);return"/"==namespace?[null,"/"]:2==parts.length?parts:[null,parts[0]]}function joinNamespace(namespace,name){return namespace&&name?[namespace,name].join("/"):namespace}var pool={};return Symbol.prototype.valueOf=function(){return this.namespace?[this.namespace,this.name].join("/"):this.name},Symbol.prototype.toString=function(){return this.valueOf()},Symbol.prototype.inspect=function(){return"[edn.Symbol "+this.toString()+"]"},edn.types.symbol=function(obj){return obj instanceof Symbol},edn.printers.symbol=function(symbol){return symbol.toString()},edn.values.symbol=valueOf,edn.equal.symbol=compareValues,edn.symbol=Symbol,parser.yy.Symbol=Symbol,Symbol}(),edn.Keyword=function(){function Keyword(namespace,name){var sym;if(sym=namespace instanceof edn.Symbol?namespace:edn.Symbol(namespace,name),!(this instanceof Keyword)){var key=pool[sym.valueOf()];return key||(key=new Keyword(namespace,name),Object.freeze(key),pool[sym.valueOf()]=key),key}this.symbol=sym,this.namespace=sym.namespace,this.name=sym.name}var pool={};return Keyword.prototype.valueOf=function(){return this.symbol.valueOf()},Keyword.prototype.toString=function(){return":"+this.symbol.toString()},Keyword.prototype.inspect=function(){return"[edn.Keyword "+this.toString()+"]"},edn.types.keyword=function(obj){return obj instanceof Keyword},edn.printers.keyword=function(keyword){return keyword.toString()},edn.values.keyword=valueOf,edn.equal.keyword=compareValues,edn.keyword=Keyword,parser.yy.Keyword=Keyword,Keyword}(),function(){edn.integer=function(n){return n},parser.yy.Integer=edn.integer,edn.types.integer=function(obj){return obj&&obj.type?"integer"==obj.type:"[object Number]"===toString.call(obj)&&Math.floor(obj)==obj},edn.printers.integer=function(n){return n.toString()},edn.values.integer=valueOf,edn.equal.integer=compareValues}(),function(){edn.float=function(n){return n=Object(n),n.type="float",n},parser.yy.Float=edn.float,edn.types.float=function(obj){return obj&&obj.type?"float"==obj.type:"[object Number]"===toString.call(obj)&&Math.floor(obj)!=obj},edn.printers.float=function(n){var s=n.toString();return/\./.test(s)||(s+=".0"),s},edn.values.float=valueOf,edn.equal.float=compareValues}(),function(){edn.list=function(ary){return ary=ary.slice(0),ary.type="list",ary},parser.yy.List=edn.list,edn.types.list=function(obj){return"[object Array]"===toString.call(obj)&&"list"===obj.type},edn.printers.list=function(ary){return"("+ary.map(edn.stringify).join(" ")+")"},edn.values.list=function(ary,deep,valueOf){return deep?ary.map(valueOf):ary.slice(0)},edn.equal.list=compareArrayValues}(),function(){edn.vector=function(ary){return ary=ary.slice(0),ary.type="vector",ary},parser.yy.Vector=edn.vector,edn.types.vector=function(obj){return"[object Array]"===toString.call(obj)&&"vector"===obj.type},edn.printers.vector=function(ary){return"["+ary.map(edn.stringify).join(" ")+"]"},edn.values.vector=function(ary,deep,valueOf){return deep?ary.map(valueOf):ary.slice(0)},edn.equal.vector=compareArrayValues,edn.types.array=function(obj){return"[object Array]"===toString.call(obj)&&void 0===obj.type},edn.converters.array=function(ary){return edn.vector(ary)}}(),edn.Map=function(){function Map(){if(!(this instanceof Map))return new Map;Object.defineProperty(this,"keys",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(this,"values",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(this,"items",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(this,"_map",{enumerable:!0,get:function(){var obj={};return this.items.forEach(function(item){obj[edn.stringify(item[0])]=item[1]}),obj}})}function indexOfIdentical(keys,key){for(var i=0,length=keys.length;i<length;i++)if(objectIs(keys[i],key))return i;return-1}var objectIs;return objectIs=Object.is?Object.is:function(x,y){return x===y?0!==x||1/x==1/y:x!==x&&y!==y},Map.prototype.get=function(key){var index=indexOfIdentical(this.keys,key);return index<0?void 0:this.values[index]},Map.prototype.has=function(key){return indexOfIdentical(this.keys,key)>=0},Map.prototype.set=function(key,value){var keys=this.keys,values=this.values,items=this.items,index=(this._map,indexOfIdentical(keys,key));return index<0&&(index=keys.length),keys[index]=key,values[index]=value,items[index]=[key,value],value},Map.prototype.delete=function(key){var keys=this.keys,values=this.values,items=this.items,index=(this._map,indexOfIdentical(keys,key));return!(index<0)&&(keys.splice(index,1),values.splice(index,1),items.splice(index,1),!0)},Map.prototype.toString=function(){return"[object Map]"},Map.prototype.inspect=function(){return"[edn.Map "+require("util").inspect(this.items)+"]"},Map}(),function(){edn.map=function(values){for(var map=new edn.Map,i=0;i<values.length;i+=2)map.set(values[i],values[i+1]);return map},parser.yy.Map=edn.map,edn.types.map=function(obj){return obj instanceof edn.Map},edn.printers.map=function(map){return"{"+map.items.map(function(item){return edn.stringify(item[0])+" "+edn.stringify(item[1])}).join(", ")+"}"},edn.values.map=function(map,deep,valueOf){if(map.keys.every(function(key){return"object"!=typeof valueOf(key)})){var obj={};return map.items.forEach(function(item){var value=item[1];deep&&(value=valueOf(value)),obj[valueOf(item[0])]=value}),obj}return map},edn.equal.map=function(a,b,isEqual){var aItems=a.items,bItems=b.items;return aItems.length==bItems.length&&aItems.every(function(aItem){var bItem=bItems.filter(function(bItem){return isEqual(aItem[0],bItem[0])})[0];return!!bItem&&isEqual(aItem[1],bItem[1])})},edn.types.object=function(obj){return obj&&"object"==typeof obj&&Object.getPrototypeOf(obj)===Object.prototype},edn.converters.object=function(obj){var map=new edn.Map;return Object.keys(obj).forEach(function(key){map.set(edn.keyword(key),obj[key])}),map}}(),edn.Set=function(){function Set(){if(!(this instanceof Set))return new Set;Object.defineProperty(this,"_map",{configurable:!1,enumerable:!0,writable:!1,value:new edn.Map}),Object.defineProperty(this,"values",{configurable:!1,enumerable:!1,get:function(){return this._map.keys}})}return Set.prototype.has=function(value){return this._map.has(value)},Set.prototype.add=function(value){return this._map.set(value,!0),"undefined"},Set.prototype.delete=function(value){return this._map.delete(value),"undefined"},Set.prototype.toString=function(){return"[object Set]"},Set.prototype.inspect=function(){return"[edn.Set "+require("util").inspect(this.values)+"]"},Set}(),function(){edn.set=function(values){var set=new edn.Set;return values&&values.forEach(function(v){set.add(v)}),set},parser.yy.Set=edn.set,edn.types.set=function(obj){return obj instanceof edn.Set},edn.printers.set=function(set){return"#{"+set.values.map(edn.stringify).join(" ")+"}"},edn.values.set=function(set,deep,valueOf){return deep?set.values.map(valueOf):set.values.slice(0)},edn.equal.set=function(a,b,isEqual){var aValues=a.values,bValues=b.values;return aValues.length==bValues.length&&aValues.every(function(aValue){return bValues.some(function(bValue){return isEqual(aValue,bValue)})})}}(),edn.tags={},edn.dispatchTag=function(tag,element,options){
options=extendDefaultOptions(options);var f=options.tags[tag];if(f)return f(element);if(options.tags.default)return options.tags.default(tag,element);throw new Error("No reader function for tag "+tag)},parser.yy.Tag=edn.dispatchTag,edn.Generic=function(){function Generic(tag,element){if(!(this instanceof Generic))return new Generic(tag,element);tag instanceof edn.Symbol||(tag=edn.Symbol(tag)),this.tag=tag,this.element=element,Object.freeze(this)}return Generic.prototype.valueOf=function(){return this.element},Generic.prototype.toString=function(){return"[object Generic]"},Generic.prototype.inspect=function(){return"[edn.Generic "+this.tag+" "+require("util").inspect(this.element)+"]"},edn.types.generic=function(obj){return obj instanceof Generic},edn.printers.generic=function(obj){return"#"+obj.tag+" "+edn.stringify(obj.element)},edn.values.generic=function(obj,deep,valueOf){return valueOf(obj.element)},edn.equal.generic=function(a,b,isEqual){return isEqual(a.tag,b.tag)&&isEqual(a.element,b.element)},edn.tags.default=Generic,edn.generic=Generic,Generic}(),function(){edn.tags.inst=function(str){return new Date(Date.parse(str))},edn.types.inst=function(obj){return obj instanceof Date},edn.converters.inst=function(date){return edn.generic("inst",date.toISOString())}}(),edn.UUID=function(){function UUID(value){if(!(this instanceof UUID))return new UUID(value);this.value=value,Object.defineProperty(this,"length",{enumerable:!1,value:value.length}),Object.freeze(this)}return UUID.prototype.valueOf=function(){return this.value},UUID.prototype.toString=function(){return this.value},UUID.prototype.inspect=function(){return"[edn.UUID "+this.value+"]"},edn.tags.uuid=function(str){return new UUID(str)},edn.types.uuid=function(obj){return obj instanceof UUID},edn.converters.uuid=function(uuid){return edn.generic("uuid",uuid.value)},edn.uuid=UUID,UUID}()}()},{util:void 0}],350:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){return this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}],351:[function(require,module,exports){!function(window,document,exportName,undefined){"use strict";function setTimeoutContext(fn,timeout,context){return setTimeout(bindFn(fn,context),timeout)}function invokeArrayArg(arg,fn,context){return!!Array.isArray(arg)&&(each(arg,context[fn],context),!0)}function each(obj,iterator,context){var i;if(obj)if(obj.forEach)obj.forEach(iterator,context);else if(obj.length!==undefined)for(i=0;i<obj.length;)iterator.call(context,obj[i],i,obj),i++;else for(i in obj)obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj)}function deprecate(method,name,message){var deprecationMessage="DEPRECATED METHOD: "+name+"\n"+message+" AT \n";return function(){var e=new Error("get-stack-trace"),stack=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",log=window.console&&(window.console.warn||window.console.log);return log&&log.call(window.console,deprecationMessage,stack),method.apply(this,arguments)}}function inherit(child,base,properties){var childP,baseP=base.prototype;childP=child.prototype=Object.create(baseP),childP.constructor=child,childP._super=baseP,properties&&assign(childP,properties)}function bindFn(fn,context){return function(){return fn.apply(context,arguments)}}function boolOrFn(val,args){return typeof val==TYPE_FUNCTION?val.apply(args?args[0]||undefined:undefined,args):val}function ifUndefined(val1,val2){return val1===undefined?val2:val1}function addEventListeners(target,types,handler){each(splitStr(types),function(type){target.addEventListener(type,handler,!1)})}function removeEventListeners(target,types,handler){each(splitStr(types),function(type){target.removeEventListener(type,handler,!1)})}function hasParent(node,parent){for(;node;){if(node==parent)return!0;node=node.parentNode}return!1}function inStr(str,find){return str.indexOf(find)>-1}function splitStr(str){return str.trim().split(/\s+/g)}function inArray(src,find,findByKey){if(src.indexOf&&!findByKey)return src.indexOf(find);for(var i=0;i<src.length;){if(findByKey&&src[i][findByKey]==find||!findByKey&&src[i]===find)return i;i++}return-1}function toArray(obj){return Array.prototype.slice.call(obj,0)}function uniqueArray(src,key,sort){for(var results=[],values=[],i=0;i<src.length;){var val=key?src[i][key]:src[i];inArray(values,val)<0&&results.push(src[i]),values[i]=val,i++}return sort&&(results=key?results.sort(function(a,b){return a[key]>b[key]}):results.sort()),results}function prefixed(obj,property){for(var prefix,prop,camelProp=property[0].toUpperCase()+property.slice(1),i=0;i<VENDOR_PREFIXES.length;){if(prefix=VENDOR_PREFIXES[i],(prop=prefix?prefix+camelProp:property)in obj)return prop;i++}return undefined}function uniqueId(){return _uniqueId++}function getWindowForElement(element){var doc=element.ownerDocument||element;return doc.defaultView||doc.parentWindow||window}function Input(manager,callback){var self=this;this.manager=manager,this.callback=callback,this.element=manager.element,this.target=manager.options.inputTarget,this.domHandler=function(ev){boolOrFn(manager.options.enable,[manager])&&self.handler(ev)},this.init()}function createInputInstance(manager){var inputClass=manager.options.inputClass;return new(inputClass||(SUPPORT_POINTER_EVENTS?PointerEventInput:SUPPORT_ONLY_TOUCH?TouchInput:SUPPORT_TOUCH?TouchMouseInput:MouseInput))(manager,inputHandler)}function inputHandler(manager,eventType,input){var pointersLen=input.pointers.length,changedPointersLen=input.changedPointers.length,isFirst=eventType&INPUT_START&&pointersLen-changedPointersLen==0,isFinal=eventType&(INPUT_END|INPUT_CANCEL)&&pointersLen-changedPointersLen==0;input.isFirst=!!isFirst,input.isFinal=!!isFinal,isFirst&&(manager.session={}),input.eventType=eventType,computeInputData(manager,input),manager.emit("hammer.input",input),manager.recognize(input),manager.session.prevInput=input}function computeInputData(manager,input){var session=manager.session,pointers=input.pointers,pointersLength=pointers.length;session.firstInput||(session.firstInput=simpleCloneInputData(input)),pointersLength>1&&!session.firstMultiple?session.firstMultiple=simpleCloneInputData(input):1===pointersLength&&(session.firstMultiple=!1);var firstInput=session.firstInput,firstMultiple=session.firstMultiple,offsetCenter=firstMultiple?firstMultiple.center:firstInput.center,center=input.center=getCenter(pointers);input.timeStamp=now(),input.deltaTime=input.timeStamp-firstInput.timeStamp,input.angle=getAngle(offsetCenter,center),input.distance=getDistance(offsetCenter,center),computeDeltaXY(session,input),input.offsetDirection=getDirection(input.deltaX,input.deltaY);var overallVelocity=getVelocity(input.deltaTime,input.deltaX,input.deltaY);input.overallVelocityX=overallVelocity.x,input.overallVelocityY=overallVelocity.y,input.overallVelocity=abs(overallVelocity.x)>abs(overallVelocity.y)?overallVelocity.x:overallVelocity.y,input.scale=firstMultiple?getScale(firstMultiple.pointers,pointers):1,input.rotation=firstMultiple?getRotation(firstMultiple.pointers,pointers):0,input.maxPointers=session.prevInput?input.pointers.length>session.prevInput.maxPointers?input.pointers.length:session.prevInput.maxPointers:input.pointers.length,computeIntervalInputData(session,input);var target=manager.element;hasParent(input.srcEvent.target,target)&&(target=input.srcEvent.target),input.target=target}function computeDeltaXY(session,input){var center=input.center,offset=session.offsetDelta||{},prevDelta=session.prevDelta||{},prevInput=session.prevInput||{};input.eventType!==INPUT_START&&prevInput.eventType!==INPUT_END||(prevDelta=session.prevDelta={x:prevInput.deltaX||0,y:prevInput.deltaY||0},offset=session.offsetDelta={x:center.x,y:center.y}),input.deltaX=prevDelta.x+(center.x-offset.x),input.deltaY=prevDelta.y+(center.y-offset.y)}function computeIntervalInputData(session,input){var velocity,velocityX,velocityY,direction,last=session.lastInterval||input,deltaTime=input.timeStamp-last.timeStamp;if(input.eventType!=INPUT_CANCEL&&(deltaTime>COMPUTE_INTERVAL||last.velocity===undefined)){var deltaX=input.deltaX-last.deltaX,deltaY=input.deltaY-last.deltaY,v=getVelocity(deltaTime,deltaX,deltaY);velocityX=v.x,velocityY=v.y,velocity=abs(v.x)>abs(v.y)?v.x:v.y,direction=getDirection(deltaX,deltaY),session.lastInterval=input}else velocity=last.velocity,velocityX=last.velocityX,velocityY=last.velocityY,direction=last.direction;input.velocity=velocity,input.velocityX=velocityX,input.velocityY=velocityY,input.direction=direction}function simpleCloneInputData(input){for(var pointers=[],i=0;i<input.pointers.length;)pointers[i]={clientX:round(input.pointers[i].clientX),clientY:round(input.pointers[i].clientY)},i++;return{timeStamp:now(),pointers:pointers,center:getCenter(pointers),deltaX:input.deltaX,deltaY:input.deltaY}}function getCenter(pointers){var pointersLength=pointers.length;if(1===pointersLength)return{x:round(pointers[0].clientX),y:round(pointers[0].clientY)};for(var x=0,y=0,i=0;i<pointersLength;)x+=pointers[i].clientX,y+=pointers[i].clientY,i++;return{x:round(x/pointersLength),y:round(y/pointersLength)}}function getVelocity(deltaTime,x,y){return{x:x/deltaTime||0,y:y/deltaTime||0}}function getDirection(x,y){return x===y?DIRECTION_NONE:abs(x)>=abs(y)?x<0?DIRECTION_LEFT:DIRECTION_RIGHT:y<0?DIRECTION_UP:DIRECTION_DOWN}function getDistance(p1,p2,props){props||(props=PROPS_XY);var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.sqrt(x*x+y*y)}function getAngle(p1,p2,props){props||(props=PROPS_XY);var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return 180*Math.atan2(y,x)/Math.PI}function getRotation(start,end){return getAngle(end[1],end[0],PROPS_CLIENT_XY)+getAngle(start[1],start[0],PROPS_CLIENT_XY)}function getScale(start,end){return getDistance(end[0],end[1],PROPS_CLIENT_XY)/getDistance(start[0],start[1],PROPS_CLIENT_XY)}function MouseInput(){this.evEl=MOUSE_ELEMENT_EVENTS,this.evWin=MOUSE_WINDOW_EVENTS,this.pressed=!1,Input.apply(this,arguments)}function PointerEventInput(){this.evEl=POINTER_ELEMENT_EVENTS,this.evWin=POINTER_WINDOW_EVENTS,Input.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function SingleTouchInput(){this.evTarget=SINGLE_TOUCH_TARGET_EVENTS,this.evWin=SINGLE_TOUCH_WINDOW_EVENTS,this.started=!1,Input.apply(this,arguments)}function normalizeSingleTouches(ev,type){var all=toArray(ev.touches),changed=toArray(ev.changedTouches);return type&(INPUT_END|INPUT_CANCEL)&&(all=uniqueArray(all.concat(changed),"identifier",!0)),[all,changed]}function TouchInput(){this.evTarget=TOUCH_TARGET_EVENTS,this.targetIds={},Input.apply(this,arguments)}function getTouches(ev,type){var allTouches=toArray(ev.touches),targetIds=this.targetIds;if(type&(INPUT_START|INPUT_MOVE)&&1===allTouches.length)return targetIds[allTouches[0].identifier]=!0,[allTouches,allTouches];var i,targetTouches,changedTouches=toArray(ev.changedTouches),changedTargetTouches=[],target=this.target;if(targetTouches=allTouches.filter(function(touch){return hasParent(touch.target,target)}),type===INPUT_START)for(i=0;i<targetTouches.length;)targetIds[targetTouches[i].identifier]=!0,i++;for(i=0;i<changedTouches.length;)targetIds[changedTouches[i].identifier]&&changedTargetTouches.push(changedTouches[i]),type&(INPUT_END|INPUT_CANCEL)&&delete targetIds[changedTouches[i].identifier],i++;return changedTargetTouches.length?[uniqueArray(targetTouches.concat(changedTargetTouches),"identifier",!0),changedTargetTouches]:void 0}function TouchMouseInput(){Input.apply(this,arguments);var handler=bindFn(this.handler,this);this.touch=new TouchInput(this.manager,handler),this.mouse=new MouseInput(this.manager,handler),this.primaryTouch=null,this.lastTouches=[]}function recordTouches(eventType,eventData){eventType&INPUT_START?(this.primaryTouch=eventData.changedPointers[0].identifier,setLastTouch.call(this,eventData)):eventType&(INPUT_END|INPUT_CANCEL)&&setLastTouch.call(this,eventData)}function setLastTouch(eventData){var touch=eventData.changedPointers[0];if(touch.identifier===this.primaryTouch){var lastTouch={x:touch.clientX,y:touch.clientY};this.lastTouches.push(lastTouch);var lts=this.lastTouches,removeLastTouch=function(){var i=lts.indexOf(lastTouch);i>-1&&lts.splice(i,1)};setTimeout(removeLastTouch,DEDUP_TIMEOUT)}}function isSyntheticEvent(eventData){for(var x=eventData.srcEvent.clientX,y=eventData.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var t=this.lastTouches[i],dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=DEDUP_DISTANCE&&dy<=DEDUP_DISTANCE)return!0}return!1}function TouchAction(manager,value){this.manager=manager,this.set(value)}function cleanTouchActions(actions){if(inStr(actions,TOUCH_ACTION_NONE))return TOUCH_ACTION_NONE;var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X),hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y);return hasPanX&&hasPanY?TOUCH_ACTION_NONE:hasPanX||hasPanY?hasPanX?TOUCH_ACTION_PAN_X:TOUCH_ACTION_PAN_Y:inStr(actions,TOUCH_ACTION_MANIPULATION)?TOUCH_ACTION_MANIPULATION:TOUCH_ACTION_AUTO}function Recognizer(options){this.options=assign({},this.defaults,options||{}),this.id=uniqueId(),this.manager=null,this.options.enable=ifUndefined(this.options.enable,!0),this.state=STATE_POSSIBLE,this.simultaneous={},this.requireFail=[]}function stateStr(state){return state&STATE_CANCELLED?"cancel":state&STATE_ENDED?"end":state&STATE_CHANGED?"move":state&STATE_BEGAN?"start":""}function directionStr(direction){return direction==DIRECTION_DOWN?"down":direction==DIRECTION_UP?"up":direction==DIRECTION_LEFT?"left":direction==DIRECTION_RIGHT?"right":""}function getRecognizerByNameIfManager(otherRecognizer,recognizer){var manager=recognizer.manager;return manager?manager.get(otherRecognizer):otherRecognizer}function AttrRecognizer(){Recognizer.apply(this,arguments)}function PanRecognizer(){AttrRecognizer.apply(this,arguments),this.pX=null,this.pY=null}function PinchRecognizer(){AttrRecognizer.apply(this,arguments)}function PressRecognizer(){Recognizer.apply(this,arguments),this._timer=null,this._input=null}function RotateRecognizer(){AttrRecognizer.apply(this,arguments)}function SwipeRecognizer(){AttrRecognizer.apply(this,arguments)}function TapRecognizer(){Recognizer.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Hammer(element,options){return options=options||{},options.recognizers=ifUndefined(options.recognizers,Hammer.defaults.preset),new Manager(element,options)}function Manager(element,options){this.options=assign({},Hammer.defaults,options||{}),this.options.inputTarget=this.options.inputTarget||element,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=element,this.input=createInputInstance(this),this.touchAction=new TouchAction(this,this.options.touchAction),toggleCssProps(this,!0),each(this.options.recognizers,function(item){var recognizer=this.add(new item[0](item[1]));item[2]&&recognizer.recognizeWith(item[2]),item[3]&&recognizer.requireFailure(item[3])},this)}function toggleCssProps(manager,add){var element=manager.element;if(element.style){var prop;each(manager.options.cssProps,function(value,name){prop=prefixed(element.style,name),add?(manager.oldCssProps[prop]=element.style[prop],element.style[prop]=value):element.style[prop]=manager.oldCssProps[prop]||""}),add||(manager.oldCssProps={})}}function triggerDomEvent(event,data){var gestureEvent=document.createEvent("Event");gestureEvent.initEvent(event,!0,!0),gestureEvent.gesture=data,data.target.dispatchEvent(gestureEvent)}var assign,VENDOR_PREFIXES=["","webkit","Moz","MS","ms","o"],TEST_ELEMENT=document.createElement("div"),TYPE_FUNCTION="function",round=Math.round,abs=Math.abs,now=Date.now;assign="function"!=typeof Object.assign?function(target){if(target===undefined||null===target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&null!==source)for(var nextKey in source)source.hasOwnProperty(nextKey)&&(output[nextKey]=source[nextKey])}return output}:Object.assign;var extend=deprecate(function(dest,src,merge){for(var keys=Object.keys(src),i=0;i<keys.length;)(!merge||merge&&dest[keys[i]]===undefined)&&(dest[keys[i]]=src[keys[i]]),i++;return dest},"extend","Use `assign`."),merge=deprecate(function(dest,src){return extend(dest,src,!0)},"merge","Use `assign`."),_uniqueId=1,MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,SUPPORT_TOUCH="ontouchstart"in window,SUPPORT_POINTER_EVENTS=prefixed(window,"PointerEvent")!==undefined,SUPPORT_ONLY_TOUCH=SUPPORT_TOUCH&&MOBILE_REGEX.test(navigator.userAgent),COMPUTE_INTERVAL=25,INPUT_START=1,INPUT_MOVE=2,INPUT_END=4,INPUT_CANCEL=8,DIRECTION_NONE=1,DIRECTION_LEFT=2,DIRECTION_RIGHT=4,DIRECTION_UP=8,DIRECTION_DOWN=16,DIRECTION_HORIZONTAL=DIRECTION_LEFT|DIRECTION_RIGHT,DIRECTION_VERTICAL=DIRECTION_UP|DIRECTION_DOWN,DIRECTION_ALL=DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,PROPS_XY=["x","y"],PROPS_CLIENT_XY=["clientX","clientY"];Input.prototype={handler:function(){},init:function(){this.evEl&&addEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&addEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&removeEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&removeEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&removeEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)}};var MOUSE_INPUT_MAP={mousedown:INPUT_START,mousemove:INPUT_MOVE,mouseup:INPUT_END},MOUSE_ELEMENT_EVENTS="mousedown",MOUSE_WINDOW_EVENTS="mousemove mouseup";inherit(MouseInput,Input,{handler:function(ev){var eventType=MOUSE_INPUT_MAP[ev.type];eventType&INPUT_START&&0===ev.button&&(this.pressed=!0),eventType&INPUT_MOVE&&1!==ev.which&&(eventType=INPUT_END),this.pressed&&(eventType&INPUT_END&&(this.pressed=!1),this.callback(this.manager,eventType,{pointers:[ev],changedPointers:[ev],pointerType:"mouse",srcEvent:ev}))}});var POINTER_INPUT_MAP={pointerdown:INPUT_START,pointermove:INPUT_MOVE,pointerup:INPUT_END,pointercancel:INPUT_CANCEL,pointerout:INPUT_CANCEL},IE10_POINTER_TYPE_ENUM={2:"touch",3:"pen",4:"mouse",5:"kinect"},POINTER_ELEMENT_EVENTS="pointerdown",POINTER_WINDOW_EVENTS="pointermove pointerup pointercancel";window.MSPointerEvent&&!window.PointerEvent&&(POINTER_ELEMENT_EVENTS="MSPointerDown",POINTER_WINDOW_EVENTS="MSPointerMove MSPointerUp MSPointerCancel"),inherit(PointerEventInput,Input,{handler:function(ev){var store=this.store,removePointer=!1,eventTypeNormalized=ev.type.toLowerCase().replace("ms",""),eventType=POINTER_INPUT_MAP[eventTypeNormalized],pointerType=IE10_POINTER_TYPE_ENUM[ev.pointerType]||ev.pointerType,isTouch="touch"==pointerType,storeIndex=inArray(store,ev.pointerId,"pointerId");eventType&INPUT_START&&(0===ev.button||isTouch)?storeIndex<0&&(store.push(ev),storeIndex=store.length-1):eventType&(INPUT_END|INPUT_CANCEL)&&(removePointer=!0),storeIndex<0||(store[storeIndex]=ev,this.callback(this.manager,eventType,{pointers:store,changedPointers:[ev],pointerType:pointerType,srcEvent:ev}),removePointer&&store.splice(storeIndex,1))}});var SINGLE_TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL},SINGLE_TOUCH_TARGET_EVENTS="touchstart",SINGLE_TOUCH_WINDOW_EVENTS="touchstart touchmove touchend touchcancel";inherit(SingleTouchInput,Input,{handler:function(ev){var type=SINGLE_TOUCH_INPUT_MAP[ev.type];if(type===INPUT_START&&(this.started=!0),this.started){var touches=normalizeSingleTouches.call(this,ev,type);type&(INPUT_END|INPUT_CANCEL)&&touches[0].length-touches[1].length==0&&(this.started=!1),this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:"touch",srcEvent:ev})}}});var TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL},TOUCH_TARGET_EVENTS="touchstart touchmove touchend touchcancel";inherit(TouchInput,Input,{handler:function(ev){var type=TOUCH_INPUT_MAP[ev.type],touches=getTouches.call(this,ev,type);touches&&this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:"touch",srcEvent:ev})}});var DEDUP_TIMEOUT=2500,DEDUP_DISTANCE=25;inherit(TouchMouseInput,Input,{handler:function(manager,inputEvent,inputData){var isTouch="touch"==inputData.pointerType,isMouse="mouse"==inputData.pointerType;if(!(isMouse&&inputData.sourceCapabilities&&inputData.sourceCapabilities.firesTouchEvents)){if(isTouch)recordTouches.call(this,inputEvent,inputData);else if(isMouse&&isSyntheticEvent.call(this,inputData))return;this.callback(manager,inputEvent,inputData)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var PREFIXED_TOUCH_ACTION=prefixed(TEST_ELEMENT.style,"touchAction"),NATIVE_TOUCH_ACTION=PREFIXED_TOUCH_ACTION!==undefined,TOUCH_ACTION_AUTO="auto",TOUCH_ACTION_MANIPULATION="manipulation",TOUCH_ACTION_NONE="none",TOUCH_ACTION_PAN_X="pan-x",TOUCH_ACTION_PAN_Y="pan-y",TOUCH_ACTION_MAP=function(){if(!NATIVE_TOUCH_ACTION)return!1;var touchMap={},cssSupports=window.CSS&&window.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(val){touchMap[val]=!cssSupports||window.CSS.supports("touch-action",val)}),touchMap}();TouchAction.prototype={set:function(value){"compute"==value&&(value=this.compute()),NATIVE_TOUCH_ACTION&&this.manager.element.style&&TOUCH_ACTION_MAP[value]&&(this.manager.element.style[PREFIXED_TOUCH_ACTION]=value),this.actions=value.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var actions=[];return each(this.manager.recognizers,function(recognizer){boolOrFn(recognizer.options.enable,[recognizer])&&(actions=actions.concat(recognizer.getTouchAction()))}),cleanTouchActions(actions.join(" "))},preventDefaults:function(input){var srcEvent=input.srcEvent,direction=input.offsetDirection;if(this.manager.session.prevented)return void srcEvent.preventDefault();var actions=this.actions,hasNone=inStr(actions,TOUCH_ACTION_NONE)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_NONE],hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y],hasPanX=inStr(actions,TOUCH_ACTION_PAN_X)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];if(hasNone){var isTapPointer=1===input.pointers.length,isTapMovement=input.distance<2,isTapTouchTime=input.deltaTime<250;if(isTapPointer&&isTapMovement&&isTapTouchTime)return}return hasPanX&&hasPanY?void 0:hasNone||hasPanY&&direction&DIRECTION_HORIZONTAL||hasPanX&&direction&DIRECTION_VERTICAL?this.preventSrc(srcEvent):void 0},preventSrc:function(srcEvent){this.manager.session.prevented=!0,srcEvent.preventDefault()}};var STATE_POSSIBLE=1,STATE_BEGAN=2,STATE_CHANGED=4,STATE_ENDED=8,STATE_RECOGNIZED=STATE_ENDED,STATE_CANCELLED=16;Recognizer.prototype={defaults:{},set:function(options){return assign(this.options,options),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"recognizeWith",this))return this;var simultaneous=this.simultaneous;return otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),simultaneous[otherRecognizer.id]||(simultaneous[otherRecognizer.id]=otherRecognizer,otherRecognizer.recognizeWith(this)),this},dropRecognizeWith:function(otherRecognizer){return invokeArrayArg(otherRecognizer,"dropRecognizeWith",this)?this:(otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),delete this.simultaneous[otherRecognizer.id],this)},requireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"requireFailure",this))return this;var requireFail=this.requireFail;return otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),-1===inArray(requireFail,otherRecognizer)&&(requireFail.push(otherRecognizer),otherRecognizer.requireFailure(this)),this},dropRequireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"dropRequireFailure",this))return this;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);var index=inArray(this.requireFail,otherRecognizer);return index>-1&&this.requireFail.splice(index,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(otherRecognizer){return!!this.simultaneous[otherRecognizer.id]},emit:function(input){function emit(event){self.manager.emit(event,input)}var self=this,state=this.state;state<STATE_ENDED&&emit(self.options.event+stateStr(state)),emit(self.options.event),input.additionalEvent&&emit(input.additionalEvent),state>=STATE_ENDED&&emit(self.options.event+stateStr(state))},tryEmit:function(input){if(this.canEmit())return this.emit(input);this.state=32},canEmit:function(){for(var i=0;i<this.requireFail.length;){if(!(this.requireFail[i].state&(32|STATE_POSSIBLE)))return!1;i++}return!0},recognize:function(inputData){var inputDataClone=assign({},inputData);if(!boolOrFn(this.options.enable,[this,inputDataClone]))return this.reset(),void(this.state=32);this.state&(STATE_RECOGNIZED|STATE_CANCELLED|32)&&(this.state=STATE_POSSIBLE),this.state=this.process(inputDataClone),this.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED|STATE_CANCELLED)&&this.tryEmit(inputDataClone)},process:function(inputData){},getTouchAction:function(){},reset:function(){}},inherit(AttrRecognizer,Recognizer,{defaults:{pointers:1},attrTest:function(input){var optionPointers=this.options.pointers;return 0===optionPointers||input.pointers.length===optionPointers},process:function(input){var state=this.state,eventType=input.eventType,isRecognized=state&(STATE_BEGAN|STATE_CHANGED),isValid=this.attrTest(input);return isRecognized&&(eventType&INPUT_CANCEL||!isValid)?state|STATE_CANCELLED:isRecognized||isValid?eventType&INPUT_END?state|STATE_ENDED:state&STATE_BEGAN?state|STATE_CHANGED:STATE_BEGAN:32}}),inherit(PanRecognizer,AttrRecognizer,{defaults:{event:"pan",threshold:10,pointers:1,direction:DIRECTION_ALL},getTouchAction:function(){var direction=this.options.direction,actions=[];return direction&DIRECTION_HORIZONTAL&&actions.push(TOUCH_ACTION_PAN_Y),direction&DIRECTION_VERTICAL&&actions.push(TOUCH_ACTION_PAN_X),actions},directionTest:function(input){var options=this.options,hasMoved=!0,distance=input.distance,direction=input.direction,x=input.deltaX,y=input.deltaY;return direction&options.direction||(options.direction&DIRECTION_HORIZONTAL?(direction=0===x?DIRECTION_NONE:x<0?DIRECTION_LEFT:DIRECTION_RIGHT,hasMoved=x!=this.pX,distance=Math.abs(input.deltaX)):(direction=0===y?DIRECTION_NONE:y<0?DIRECTION_UP:DIRECTION_DOWN,hasMoved=y!=this.pY,distance=Math.abs(input.deltaY))),input.direction=direction,hasMoved&&distance>options.threshold&&direction&options.direction},attrTest:function(input){return AttrRecognizer.prototype.attrTest.call(this,input)&&(this.state&STATE_BEGAN||!(this.state&STATE_BEGAN)&&this.directionTest(input))},emit:function(input){this.pX=input.deltaX,this.pY=input.deltaY;var direction=directionStr(input.direction);direction&&(input.additionalEvent=this.options.event+direction),this._super.emit.call(this,input)}}),inherit(PinchRecognizer,AttrRecognizer,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.scale-1)>this.options.threshold||this.state&STATE_BEGAN)},
emit:function(input){if(1!==input.scale){var inOut=input.scale<1?"in":"out";input.additionalEvent=this.options.event+inOut}this._super.emit.call(this,input)}}),inherit(PressRecognizer,Recognizer,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[TOUCH_ACTION_AUTO]},process:function(input){var options=this.options,validPointers=input.pointers.length===options.pointers,validMovement=input.distance<options.threshold,validTime=input.deltaTime>options.time;if(this._input=input,!validMovement||!validPointers||input.eventType&(INPUT_END|INPUT_CANCEL)&&!validTime)this.reset();else if(input.eventType&INPUT_START)this.reset(),this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED,this.tryEmit()},options.time,this);else if(input.eventType&INPUT_END)return STATE_RECOGNIZED;return 32},reset:function(){clearTimeout(this._timer)},emit:function(input){this.state===STATE_RECOGNIZED&&(input&&input.eventType&INPUT_END?this.manager.emit(this.options.event+"up",input):(this._input.timeStamp=now(),this.manager.emit(this.options.event,this._input)))}}),inherit(RotateRecognizer,AttrRecognizer,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.rotation)>this.options.threshold||this.state&STATE_BEGAN)}}),inherit(SwipeRecognizer,AttrRecognizer,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,pointers:1},getTouchAction:function(){return PanRecognizer.prototype.getTouchAction.call(this)},attrTest:function(input){var velocity,direction=this.options.direction;return direction&(DIRECTION_HORIZONTAL|DIRECTION_VERTICAL)?velocity=input.overallVelocity:direction&DIRECTION_HORIZONTAL?velocity=input.overallVelocityX:direction&DIRECTION_VERTICAL&&(velocity=input.overallVelocityY),this._super.attrTest.call(this,input)&&direction&input.offsetDirection&&input.distance>this.options.threshold&&input.maxPointers==this.options.pointers&&abs(velocity)>this.options.velocity&&input.eventType&INPUT_END},emit:function(input){var direction=directionStr(input.offsetDirection);direction&&this.manager.emit(this.options.event+direction,input),this.manager.emit(this.options.event,input)}}),inherit(TapRecognizer,Recognizer,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[TOUCH_ACTION_MANIPULATION]},process:function(input){var options=this.options,validPointers=input.pointers.length===options.pointers,validMovement=input.distance<options.threshold,validTouchTime=input.deltaTime<options.time;if(this.reset(),input.eventType&INPUT_START&&0===this.count)return this.failTimeout();if(validMovement&&validTouchTime&&validPointers){if(input.eventType!=INPUT_END)return this.failTimeout();var validInterval=!this.pTime||input.timeStamp-this.pTime<options.interval,validMultiTap=!this.pCenter||getDistance(this.pCenter,input.center)<options.posThreshold;this.pTime=input.timeStamp,this.pCenter=input.center,validMultiTap&&validInterval?this.count+=1:this.count=1,this._input=input;if(0===this.count%options.taps)return this.hasRequireFailures()?(this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED,this.tryEmit()},options.interval,this),STATE_BEGAN):STATE_RECOGNIZED}return 32},failTimeout:function(){return this._timer=setTimeoutContext(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==STATE_RECOGNIZED&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Hammer.VERSION="2.0.7",Hammer.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[RotateRecognizer,{enable:!1}],[PinchRecognizer,{enable:!1},["rotate"]],[SwipeRecognizer,{direction:DIRECTION_HORIZONTAL}],[PanRecognizer,{direction:DIRECTION_HORIZONTAL},["swipe"]],[TapRecognizer],[TapRecognizer,{event:"doubletap",taps:2},["tap"]],[PressRecognizer]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};Manager.prototype={set:function(options){return assign(this.options,options),options.touchAction&&this.touchAction.update(),options.inputTarget&&(this.input.destroy(),this.input.target=options.inputTarget,this.input.init()),this},stop:function(force){this.session.stopped=force?2:1},recognize:function(inputData){var session=this.session;if(!session.stopped){this.touchAction.preventDefaults(inputData);var recognizer,recognizers=this.recognizers,curRecognizer=session.curRecognizer;(!curRecognizer||curRecognizer&&curRecognizer.state&STATE_RECOGNIZED)&&(curRecognizer=session.curRecognizer=null);for(var i=0;i<recognizers.length;)recognizer=recognizers[i],2===session.stopped||curRecognizer&&recognizer!=curRecognizer&&!recognizer.canRecognizeWith(curRecognizer)?recognizer.reset():recognizer.recognize(inputData),!curRecognizer&&recognizer.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED)&&(curRecognizer=session.curRecognizer=recognizer),i++}},get:function(recognizer){if(recognizer instanceof Recognizer)return recognizer;for(var recognizers=this.recognizers,i=0;i<recognizers.length;i++)if(recognizers[i].options.event==recognizer)return recognizers[i];return null},add:function(recognizer){if(invokeArrayArg(recognizer,"add",this))return this;var existing=this.get(recognizer.options.event);return existing&&this.remove(existing),this.recognizers.push(recognizer),recognizer.manager=this,this.touchAction.update(),recognizer},remove:function(recognizer){if(invokeArrayArg(recognizer,"remove",this))return this;if(recognizer=this.get(recognizer)){var recognizers=this.recognizers,index=inArray(recognizers,recognizer);-1!==index&&(recognizers.splice(index,1),this.touchAction.update())}return this},on:function(events,handler){if(events!==undefined&&handler!==undefined){var handlers=this.handlers;return each(splitStr(events),function(event){handlers[event]=handlers[event]||[],handlers[event].push(handler)}),this}},off:function(events,handler){if(events!==undefined){var handlers=this.handlers;return each(splitStr(events),function(event){handler?handlers[event]&&handlers[event].splice(inArray(handlers[event],handler),1):delete handlers[event]}),this}},emit:function(event,data){this.options.domEvents&&triggerDomEvent(event,data);var handlers=this.handlers[event]&&this.handlers[event].slice();if(handlers&&handlers.length){data.type=event,data.preventDefault=function(){data.srcEvent.preventDefault()};for(var i=0;i<handlers.length;)handlers[i](data),i++}},destroy:function(){this.element&&toggleCssProps(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},assign(Hammer,{INPUT_START:INPUT_START,INPUT_MOVE:INPUT_MOVE,INPUT_END:INPUT_END,INPUT_CANCEL:INPUT_CANCEL,STATE_POSSIBLE:STATE_POSSIBLE,STATE_BEGAN:STATE_BEGAN,STATE_CHANGED:STATE_CHANGED,STATE_ENDED:STATE_ENDED,STATE_RECOGNIZED:STATE_RECOGNIZED,STATE_CANCELLED:STATE_CANCELLED,STATE_FAILED:32,DIRECTION_NONE:DIRECTION_NONE,DIRECTION_LEFT:DIRECTION_LEFT,DIRECTION_RIGHT:DIRECTION_RIGHT,DIRECTION_UP:DIRECTION_UP,DIRECTION_DOWN:DIRECTION_DOWN,DIRECTION_HORIZONTAL:DIRECTION_HORIZONTAL,DIRECTION_VERTICAL:DIRECTION_VERTICAL,DIRECTION_ALL:DIRECTION_ALL,Manager:Manager,Input:Input,TouchAction:TouchAction,TouchInput:TouchInput,MouseInput:MouseInput,PointerEventInput:PointerEventInput,TouchMouseInput:TouchMouseInput,SingleTouchInput:SingleTouchInput,Recognizer:Recognizer,AttrRecognizer:AttrRecognizer,Tap:TapRecognizer,Pan:PanRecognizer,Swipe:SwipeRecognizer,Pinch:PinchRecognizer,Rotate:RotateRecognizer,Press:PressRecognizer,on:addEventListeners,off:removeEventListeners,each:each,merge:merge,extend:extend,assign:assign,inherit:inherit,bindFn:bindFn,prefixed:prefixed}),(void 0!==window?window:"undefined"!=typeof self?self:{}).Hammer=Hammer,"function"==typeof define&&define.amd?define(function(){return Hammer}):void 0!==module&&module.exports?module.exports=Hammer:window.Hammer=Hammer}(window,document)},{}],352:[function(require,module,exports){var hat=module.exports=function(bits,base){if(base||(base=16),void 0===bits&&(bits=128),bits<=0)return"0";for(var digits=Math.log(Math.pow(2,bits))/Math.log(base),i=2;digits===1/0;i*=2)digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i;for(var rem=digits-Math.floor(digits),res="",i=0;i<Math.floor(digits);i++){var x=Math.floor(Math.random()*base).toString(base);res=x+res}if(rem){var b=Math.pow(base,rem),x=Math.floor(Math.random()*b).toString(base);res=x+res}var parsed=parseInt(res,base);return parsed!==1/0&&parsed>=Math.pow(2,bits)?hat(bits,base):res};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters++>10){if(!expandBy)throw new Error("too many ID collisions, use more bits");bits+=expandBy}var id=hat(bits,base)}while(Object.hasOwnProperty.call(hats,id));return hats[id]=data,id},hats=fn.hats={};return fn.get=function(id){return fn.hats[id]},fn.set=function(id,value){return fn.hats[id]=value,fn},fn.bits=bits||128,fn.base=base||16,fn}},{}],353:[function(require,module,exports){"use strict";function Ids(seed){if(!(this instanceof Ids))return new Ids(seed);seed=seed||[128,36,1],this._seed=seed.length?hat.rack(seed[0],seed[1],seed[2]):seed}var hat=require("hat");module.exports=Ids,Ids.prototype.next=function(element){return this._seed(element||!0)},Ids.prototype.nextPrefixed=function(prefix,element){var id;do{id=prefix+this.next(!0)}while(this.assigned(id));return this.claim(id,element),id},Ids.prototype.claim=function(id,element){this._seed.set(id,element||!0)},Ids.prototype.assigned=function(id){return this._seed.get(id)||!1},Ids.prototype.unclaim=function(id){delete this._seed.hats[id]},Ids.prototype.clear=function(){var id,hats=this._seed.hats;for(id in hats)this.unclaim(id)}},{hat:352}],354:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],355:[function(require,module,exports){var createFindIndex=require("../internal/createFindIndex"),findIndex=createFindIndex();module.exports=findIndex},{"../internal/createFindIndex":451}],356:[function(require,module,exports){function flatten(array,isDeep,guard){var length=array?array.length:0;return guard&&isIterateeCall(array,isDeep,guard)&&(isDeep=!1),length?baseFlatten(array,isDeep):[]}var baseFlatten=require("../internal/baseFlatten"),isIterateeCall=require("../internal/isIterateeCall");module.exports=flatten},{"../internal/baseFlatten":410,"../internal/isIterateeCall":471}],357:[function(require,module,exports){function flattenDeep(array){return(array?array.length:0)?baseFlatten(array,!0):[]}var baseFlatten=require("../internal/baseFlatten");module.exports=flattenDeep},{"../internal/baseFlatten":410}],358:[function(require,module,exports){function last(array){var length=array?array.length:0;return length?array[length-1]:void 0}module.exports=last},{}],359:[function(require,module,exports){var baseFlatten=require("../internal/baseFlatten"),baseUniq=require("../internal/baseUniq"),restParam=require("../function/restParam"),union=restParam(function(arrays){return baseUniq(baseFlatten(arrays,!1,!0))});module.exports=union},{"../function/restParam":383,"../internal/baseFlatten":410,"../internal/baseUniq":433}],360:[function(require,module,exports){function uniq(array,isSorted,iteratee,thisArg){return(array?array.length:0)?(null!=isSorted&&"boolean"!=typeof isSorted&&(thisArg=iteratee,iteratee=isIterateeCall(array,isSorted,thisArg)?void 0:isSorted,isSorted=!1),iteratee=null==iteratee?iteratee:baseCallback(iteratee,thisArg,3),isSorted?sortedUniq(array,iteratee):baseUniq(array,iteratee)):[]}var baseCallback=require("../internal/baseCallback"),baseUniq=require("../internal/baseUniq"),isIterateeCall=require("../internal/isIterateeCall"),sortedUniq=require("../internal/sortedUniq");module.exports=uniq},{"../internal/baseCallback":398,"../internal/baseUniq":433,"../internal/isIterateeCall":471,"../internal/sortedUniq":486}],361:[function(require,module,exports){module.exports=require("./uniq")},{"./uniq":360}],362:[function(require,module,exports){var baseDifference=require("../internal/baseDifference"),isArrayLike=require("../internal/isArrayLike"),restParam=require("../function/restParam"),without=restParam(function(array,values){return isArrayLike(array)?baseDifference(array,values):[]});module.exports=without},{"../function/restParam":383,"../internal/baseDifference":404,"../internal/isArrayLike":469}],363:[function(require,module,exports){function xor(){for(var index=-1,length=arguments.length;++index<length;){var array=arguments[index];if(isArrayLike(array))var result=result?arrayPush(baseDifference(result,array),baseDifference(array,result)):array}return result?baseUniq(result):[]}var arrayPush=require("../internal/arrayPush"),baseDifference=require("../internal/baseDifference"),baseUniq=require("../internal/baseUniq"),isArrayLike=require("../internal/isArrayLike");module.exports=xor},{"../internal/arrayPush":392,"../internal/baseDifference":404,"../internal/baseUniq":433,"../internal/isArrayLike":469}],364:[function(require,module,exports){function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__chain__")&&hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}var LazyWrapper=require("../internal/LazyWrapper"),LodashWrapper=require("../internal/LodashWrapper"),baseLodash=require("../internal/baseLodash"),isArray=require("../lang/isArray"),isObjectLike=require("../internal/isObjectLike"),wrapperClone=require("../internal/wrapperClone"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;lodash.prototype=baseLodash.prototype,module.exports=lodash},{"../internal/LazyWrapper":384,"../internal/LodashWrapper":385,"../internal/baseLodash":419,"../internal/isObjectLike":475,"../internal/wrapperClone":489,"../lang/isArray":492}],365:[function(require,module,exports){module.exports=require("./some")},{"./some":377}],366:[function(require,module,exports){function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=void 0),"function"==typeof predicate&&void 0===thisArg||(predicate=baseCallback(predicate,thisArg,3)),func(collection,predicate)}var arrayEvery=require("../internal/arrayEvery"),baseCallback=require("../internal/baseCallback"),baseEvery=require("../internal/baseEvery"),isArray=require("../lang/isArray"),isIterateeCall=require("../internal/isIterateeCall");module.exports=every},{"../internal/arrayEvery":389,"../internal/baseCallback":398,"../internal/baseEvery":406,"../internal/isIterateeCall":471,"../lang/isArray":492}],367:[function(require,module,exports){function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;return predicate=baseCallback(predicate,thisArg,3),func(collection,predicate)}var arrayFilter=require("../internal/arrayFilter"),baseCallback=require("../internal/baseCallback"),baseFilter=require("../internal/baseFilter"),isArray=require("../lang/isArray");module.exports=filter},{"../internal/arrayFilter":390,"../internal/baseCallback":398,"../internal/baseFilter":407,"../lang/isArray":492}],368:[function(require,module,exports){var baseEach=require("../internal/baseEach"),createFind=require("../internal/createFind"),find=createFind(baseEach);module.exports=find},{"../internal/baseEach":405,"../internal/createFind":450}],369:[function(require,module,exports){var arrayEach=require("../internal/arrayEach"),baseEach=require("../internal/baseEach"),createForEach=require("../internal/createForEach"),forEach=createForEach(arrayEach,baseEach);module.exports=forEach},{"../internal/arrayEach":388,"../internal/baseEach":405,"../internal/createForEach":452}],370:[function(require,module,exports){var createAggregator=require("../internal/createAggregator"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):result[key]=[value]});module.exports=groupBy},{"../internal/createAggregator":442}],371:[function(require,module,exports){function includes(collection,target,fromIndex,guard){var length=collection?getLength(collection):0;return isLength(length)||(collection=values(collection),length=collection.length),fromIndex="number"!=typeof fromIndex||guard&&isIterateeCall(target,fromIndex,guard)?0:fromIndex<0?nativeMax(length+fromIndex,0):fromIndex||0,"string"==typeof collection||!isArray(collection)&&isString(collection)?fromIndex<=length&&collection.indexOf(target,fromIndex)>-1:!!length&&baseIndexOf(collection,target,fromIndex)>-1}var baseIndexOf=require("../internal/baseIndexOf"),getLength=require("../internal/getLength"),isArray=require("../lang/isArray"),isIterateeCall=require("../internal/isIterateeCall"),isLength=require("../internal/isLength"),isString=require("../lang/isString"),values=require("../object/values"),nativeMax=Math.max;module.exports=includes},{"../internal/baseIndexOf":415,"../internal/getLength":462,"../internal/isIterateeCall":471,"../internal/isLength":474,"../lang/isArray":492,"../lang/isString":499,"../object/values":513}],372:[function(require,module,exports){var createAggregator=require("../internal/createAggregator"),indexBy=createAggregator(function(result,value,key){result[key]=value});module.exports=indexBy},{"../internal/createAggregator":442}],373:[function(require,module,exports){function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;return iteratee=baseCallback(iteratee,thisArg,3),func(collection,iteratee)}var arrayMap=require("../internal/arrayMap"),baseCallback=require("../internal/baseCallback"),baseMap=require("../internal/baseMap"),isArray=require("../lang/isArray");module.exports=map},{"../internal/arrayMap":391,"../internal/baseCallback":398,"../internal/baseMap":420,"../lang/isArray":492}],374:[function(require,module,exports){var arrayReduce=require("../internal/arrayReduce"),baseEach=require("../internal/baseEach"),createReduce=require("../internal/createReduce"),reduce=createReduce(arrayReduce,baseEach);module.exports=reduce},{"../internal/arrayReduce":393,"../internal/baseEach":405,"../internal/createReduce":455}],375:[function(require,module,exports){function reject(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;return predicate=baseCallback(predicate,thisArg,3),func(collection,function(value,index,collection){return!predicate(value,index,collection)})}var arrayFilter=require("../internal/arrayFilter"),baseCallback=require("../internal/baseCallback"),baseFilter=require("../internal/baseFilter"),isArray=require("../lang/isArray");module.exports=reject},{"../internal/arrayFilter":390,"../internal/baseCallback":398,"../internal/baseFilter":407,"../lang/isArray":492}],376:[function(require,module,exports){function size(collection){var length=collection?getLength(collection):0;return isLength(length)?length:keys(collection).length}var getLength=require("../internal/getLength"),isLength=require("../internal/isLength"),keys=require("../object/keys");module.exports=size},{"../internal/getLength":462,"../internal/isLength":474,"../object/keys":506}],377:[function(require,module,exports){function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=void 0),"function"==typeof predicate&&void 0===thisArg||(predicate=baseCallback(predicate,thisArg,3)),func(collection,predicate)}var arraySome=require("../internal/arraySome"),baseCallback=require("../internal/baseCallback"),baseSome=require("../internal/baseSome"),isArray=require("../lang/isArray"),isIterateeCall=require("../internal/isIterateeCall");module.exports=some},{"../internal/arraySome":394,"../internal/baseCallback":398,"../internal/baseSome":430,"../internal/isIterateeCall":471,"../lang/isArray":492}],378:[function(require,module,exports){function sortBy(collection,iteratee,thisArg){if(null==collection)return[];thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=void 0);var index=-1;iteratee=baseCallback(iteratee,thisArg,3);var result=baseMap(collection,function(value,key,collection){return{criteria:iteratee(value,key,collection),index:++index,value:value}});return baseSortBy(result,compareAscending)}var baseCallback=require("../internal/baseCallback"),baseMap=require("../internal/baseMap"),baseSortBy=require("../internal/baseSortBy"),compareAscending=require("../internal/compareAscending"),isIterateeCall=require("../internal/isIterateeCall");module.exports=sortBy},{"../internal/baseCallback":398,"../internal/baseMap":420,"../internal/baseSortBy":431,"../internal/compareAscending":439,"../internal/isIterateeCall":471}],379:[function(require,module,exports){var getNative=require("../internal/getNative"),nativeNow=getNative(Date,"now"),now=nativeNow||function(){return(new Date).getTime()};module.exports=now},{"../internal/getNative":464}],380:[function(require,module,exports){var createWrapper=require("../internal/createWrapper"),replaceHolders=require("../internal/replaceHolders"),restParam=require("./restParam"),bind=restParam(function(func,thisArg,partials){var bitmask=1;if(partials.length){var holders=replaceHolders(partials,bind.placeholder);bitmask|=32}return createWrapper(func,bitmask,thisArg,partials,holders)});bind.placeholder={},module.exports=bind},{"../internal/createWrapper":456,"../internal/replaceHolders":483,"./restParam":383}],381:[function(require,module,exports){function debounce(func,wait,options){function cancel(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId&&clearTimeout(maxTimeoutId),lastCalled=0,maxTimeoutId=timeoutId=trailingCall=void 0}function complete(isCalled,id){id&&clearTimeout(id),maxTimeoutId=timeoutId=trailingCall=void 0,isCalled&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=void 0))}function delayed(){var remaining=wait-(now()-stamp);remaining<=0||remaining>wait?complete(trailingCall,maxTimeoutId):timeoutId=setTimeout(delayed,remaining)}function maxDelayed(){complete(trailing,timeoutId)}function debounced(){if(args=arguments,stamp=now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),!1===maxWait)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=void 0),result}var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(wait=wait<0?0:+wait||0,!0===options){var leading=!0;trailing=!1}else isObject(options)&&(leading=!!options.leading,maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait),trailing="trailing"in options?!!options.trailing:trailing);return debounced.cancel=cancel,debounced}var isObject=require("../lang/isObject"),now=require("../date/now"),FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max;module.exports=debounce},{"../date/now":379,"../lang/isObject":497}],382:[function(require,module,exports){var baseDelay=require("../internal/baseDelay"),restParam=require("./restParam"),defer=restParam(function(func,args){return baseDelay(func,1,args)});module.exports=defer},{"../internal/baseDelay":403,"./restParam":383}],383:[function(require,module,exports){function restParam(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=nativeMax(void 0===start?func.length-1:+start||0,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);++index<length;)rest[index]=args[start+index];switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest)}var otherArgs=Array(start+1);for(index=-1;++index<start;)otherArgs[index]=args[index];return otherArgs[start]=rest,func.apply(this,otherArgs)}}var FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max;module.exports=restParam},{}],384:[function(require,module,exports){function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=POSITIVE_INFINITY,this.__views__=[]}var baseCreate=require("./baseCreate"),baseLodash=require("./baseLodash"),POSITIVE_INFINITY=Number.POSITIVE_INFINITY;LazyWrapper.prototype=baseCreate(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,module.exports=LazyWrapper},{"./baseCreate":402,"./baseLodash":419}],385:[function(require,module,exports){function LodashWrapper(value,chainAll,actions){this.__wrapped__=value,this.__actions__=actions||[],this.__chain__=!!chainAll}var baseCreate=require("./baseCreate"),baseLodash=require("./baseLodash");LodashWrapper.prototype=baseCreate(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,module.exports=LodashWrapper},{"./baseCreate":402,"./baseLodash":419}],386:[function(require,module,exports){(function(global){function SetCache(values){var length=values?values.length:0;for(this.data={hash:nativeCreate(null),set:new Set};length--;)this.push(values[length])}var cachePush=require("./cachePush"),getNative=require("./getNative"),Set=getNative(global,"Set"),nativeCreate=getNative(Object,"create");SetCache.prototype.push=cachePush,module.exports=SetCache}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./cachePush":438,"./getNative":464}],387:[function(require,module,exports){function arrayCopy(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}module.exports=arrayCopy},{}],388:[function(require,module,exports){function arrayEach(array,iteratee){for(var index=-1,length=array.length;++index<length&&!1!==iteratee(array[index],index,array););return array}module.exports=arrayEach},{}],389:[function(require,module,exports){function arrayEvery(array,predicate){for(var index=-1,length=array.length;++index<length;)if(!predicate(array[index],index,array))return!1;return!0}module.exports=arrayEvery},{}],390:[function(require,module,exports){function arrayFilter(array,predicate){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[++resIndex]=value)}return result}module.exports=arrayFilter},{}],391:[function(require,module,exports){function arrayMap(array,iteratee){for(var index=-1,length=array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}module.exports=arrayMap},{}],392:[function(require,module,exports){function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}module.exports=arrayPush},{}],393:[function(require,module,exports){function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;for(initFromArray&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}module.exports=arrayReduce},{}],394:[function(require,module,exports){function arraySome(array,predicate){for(var index=-1,length=array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}module.exports=arraySome},{}],395:[function(require,module,exports){function assignDefaults(objectValue,sourceValue){return void 0===objectValue?sourceValue:objectValue}module.exports=assignDefaults},{}],396:[function(require,module,exports){function assignWith(object,source,customizer){for(var index=-1,props=keys(source),length=props.length;++index<length;){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);(result===result?result===value:value!==value)&&(void 0!==value||key in object)||(object[key]=result)}return object}var keys=require("../object/keys");module.exports=assignWith},{"../object/keys":506}],397:[function(require,module,exports){function baseAssign(object,source){return null==source?object:baseCopy(source,keys(source),object)}var baseCopy=require("./baseCopy"),keys=require("../object/keys");module.exports=baseAssign},{"../object/keys":506,"./baseCopy":401}],398:[function(require,module,exports){function baseCallback(func,thisArg,argCount){var type=typeof func;return"function"==type?void 0===thisArg?func:bindCallback(func,thisArg,argCount):null==func?identity:"object"==type?baseMatches(func):void 0===thisArg?property(func):baseMatchesProperty(func,thisArg)}var baseMatches=require("./baseMatches"),baseMatchesProperty=require("./baseMatchesProperty"),bindCallback=require("./bindCallback"),identity=require("../utility/identity"),property=require("../utility/property");module.exports=baseCallback},{"../utility/identity":514,"../utility/property":516,"./baseMatches":421,"./baseMatchesProperty":422,"./bindCallback":435}],399:[function(require,module,exports){function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer&&(result=object?customizer(value,key,object):customizer(value)),void 0!==result)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=initCloneArray(value),!isDeep)return arrayCopy(value,result)}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag!=objectTag&&tag!=argsTag&&(!isFunc||object))return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):object?value:{};if(result=initCloneObject(isFunc?{}:value),!isDeep)return baseAssign(result,value)}stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==value)return stackB[length];return stackA.push(value),stackB.push(result),(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB)}),result}var arrayCopy=require("./arrayCopy"),arrayEach=require("./arrayEach"),baseAssign=require("./baseAssign"),baseForOwn=require("./baseForOwn"),initCloneArray=require("./initCloneArray"),initCloneByTag=require("./initCloneByTag"),initCloneObject=require("./initCloneObject"),isArray=require("../lang/isArray"),isObject=require("../lang/isObject"),argsTag="[object Arguments]",funcTag="[object Function]",objectTag="[object Object]",cloneableTags={}
;cloneableTags[argsTag]=cloneableTags["[object Array]"]=cloneableTags["[object ArrayBuffer]"]=cloneableTags["[object Boolean]"]=cloneableTags["[object Date]"]=cloneableTags["[object Float32Array]"]=cloneableTags["[object Float64Array]"]=cloneableTags["[object Int8Array]"]=cloneableTags["[object Int16Array]"]=cloneableTags["[object Int32Array]"]=cloneableTags["[object Number]"]=cloneableTags[objectTag]=cloneableTags["[object RegExp]"]=cloneableTags["[object String]"]=cloneableTags["[object Uint8Array]"]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags["[object Uint16Array]"]=cloneableTags["[object Uint32Array]"]=!0,cloneableTags["[object Error]"]=cloneableTags[funcTag]=cloneableTags["[object Map]"]=cloneableTags["[object Set]"]=cloneableTags["[object WeakMap]"]=!1;var objectProto=Object.prototype,objToString=objectProto.toString;module.exports=baseClone},{"../lang/isArray":492,"../lang/isObject":497,"./arrayCopy":387,"./arrayEach":388,"./baseAssign":397,"./baseForOwn":413,"./initCloneArray":466,"./initCloneByTag":467,"./initCloneObject":468}],400:[function(require,module,exports){function baseCompareAscending(value,other){if(value!==other){var valIsNull=null===value,valIsUndef=void 0===value,valIsReflexive=value===value,othIsNull=null===other,othIsUndef=void 0===other,othIsReflexive=other===other;if(value>other&&!othIsNull||!valIsReflexive||valIsNull&&!othIsUndef&&othIsReflexive||valIsUndef&&othIsReflexive)return 1;if(value<other&&!valIsNull||!othIsReflexive||othIsNull&&!valIsUndef&&valIsReflexive||othIsUndef&&valIsReflexive)return-1}return 0}module.exports=baseCompareAscending},{}],401:[function(require,module,exports){function baseCopy(source,props,object){object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index];object[key]=source[key]}return object}module.exports=baseCopy},{}],402:[function(require,module,exports){var isObject=require("../lang/isObject"),baseCreate=function(){function object(){}return function(prototype){if(isObject(prototype)){object.prototype=prototype;var result=new object;object.prototype=void 0}return result||{}}}();module.exports=baseCreate},{"../lang/isObject":497}],403:[function(require,module,exports){function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout(function(){func.apply(void 0,args)},wait)}var FUNC_ERROR_TEXT="Expected a function";module.exports=baseDelay},{}],404:[function(require,module,exports){function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length)return result;var index=-1,indexOf=baseIndexOf,isCommon=!0,cache=isCommon&&values.length>=LARGE_ARRAY_SIZE?createCache(values):null,valuesLength=values.length;cache&&(indexOf=cacheIndexOf,isCommon=!1,values=cache);outer:for(;++index<length;){var value=array[index];if(isCommon&&value===value){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===value)continue outer;result.push(value)}else indexOf(values,value,0)<0&&result.push(value)}return result}var baseIndexOf=require("./baseIndexOf"),cacheIndexOf=require("./cacheIndexOf"),createCache=require("./createCache"),LARGE_ARRAY_SIZE=200;module.exports=baseDifference},{"./baseIndexOf":415,"./cacheIndexOf":437,"./createCache":447}],405:[function(require,module,exports){var baseForOwn=require("./baseForOwn"),createBaseEach=require("./createBaseEach"),baseEach=createBaseEach(baseForOwn);module.exports=baseEach},{"./baseForOwn":413,"./createBaseEach":444}],406:[function(require,module,exports){function baseEvery(collection,predicate){var result=!0;return baseEach(collection,function(value,index,collection){return result=!!predicate(value,index,collection)}),result}var baseEach=require("./baseEach");module.exports=baseEvery},{"./baseEach":405}],407:[function(require,module,exports){function baseFilter(collection,predicate){var result=[];return baseEach(collection,function(value,index,collection){predicate(value,index,collection)&&result.push(value)}),result}var baseEach=require("./baseEach");module.exports=baseFilter},{"./baseEach":405}],408:[function(require,module,exports){function baseFind(collection,predicate,eachFunc,retKey){var result;return eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection))return result=retKey?key:value,!1}),result}module.exports=baseFind},{}],409:[function(require,module,exports){function baseFindIndex(array,predicate,fromRight){for(var length=array.length,index=fromRight?length:-1;fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}module.exports=baseFindIndex},{}],410:[function(require,module,exports){function baseFlatten(array,isDeep,isStrict,result){result||(result=[]);for(var index=-1,length=array.length;++index<length;){var value=array[index];isObjectLike(value)&&isArrayLike(value)&&(isStrict||isArray(value)||isArguments(value))?isDeep?baseFlatten(value,isDeep,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}var arrayPush=require("./arrayPush"),isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isArrayLike=require("./isArrayLike"),isObjectLike=require("./isObjectLike");module.exports=baseFlatten},{"../lang/isArguments":491,"../lang/isArray":492,"./arrayPush":392,"./isArrayLike":469,"./isObjectLike":475}],411:[function(require,module,exports){var createBaseFor=require("./createBaseFor"),baseFor=createBaseFor();module.exports=baseFor},{"./createBaseFor":445}],412:[function(require,module,exports){function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}var baseFor=require("./baseFor"),keysIn=require("../object/keysIn");module.exports=baseForIn},{"../object/keysIn":507,"./baseFor":411}],413:[function(require,module,exports){function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}var baseFor=require("./baseFor"),keys=require("../object/keys");module.exports=baseForOwn},{"../object/keys":506,"./baseFor":411}],414:[function(require,module,exports){function baseGet(object,path,pathKey){if(null!=object){void 0!==pathKey&&pathKey in toObject(object)&&(path=[pathKey]);for(var index=0,length=path.length;null!=object&&index<length;)object=object[path[index++]];return index&&index==length?object:void 0}}var toObject=require("./toObject");module.exports=baseGet},{"./toObject":487}],415:[function(require,module,exports){function baseIndexOf(array,value,fromIndex){if(value!==value)return indexOfNaN(array,fromIndex);for(var index=fromIndex-1,length=array.length;++index<length;)if(array[index]===value)return index;return-1}var indexOfNaN=require("./indexOfNaN");module.exports=baseIndexOf},{"./indexOfNaN":465}],416:[function(require,module,exports){function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){return value===other||(null==value||null==other||!isObject(value)&&!isObjectLike(other)?value!==value&&other!==other:baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB))}var baseIsEqualDeep=require("./baseIsEqualDeep"),isObject=require("../lang/isObject"),isObjectLike=require("./isObjectLike");module.exports=baseIsEqual},{"../lang/isObject":497,"./baseIsEqualDeep":417,"./isObjectLike":475}],417:[function(require,module,exports){function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;objIsArr||(objTag=objToString.call(object),objTag==argsTag?objTag=objectTag:objTag!=objectTag&&(objIsArr=isTypedArray(object))),othIsArr||(othTag=objToString.call(other),othTag==argsTag?othTag=objectTag:othTag!=objectTag&&(othIsArr=isTypedArray(other)));var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!objIsArr&&!objIsObj)return equalByTag(object,other,objTag);if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped)return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB)}if(!isSameTag)return!1;stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==object)return stackB[length]==other;stackA.push(object),stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);return stackA.pop(),stackB.pop(),result}var equalArrays=require("./equalArrays"),equalByTag=require("./equalByTag"),equalObjects=require("./equalObjects"),isArray=require("../lang/isArray"),isTypedArray=require("../lang/isTypedArray"),argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString;module.exports=baseIsEqualDeep},{"../lang/isArray":492,"../lang/isTypedArray":500,"./equalArrays":457,"./equalByTag":458,"./equalObjects":459}],418:[function(require,module,exports){function baseIsMatch(object,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=toObject(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(void 0===objValue&&!(key in object))return!1}else{var result=customizer?customizer(objValue,srcValue,key):void 0;if(!(void 0===result?baseIsEqual(srcValue,objValue,customizer,!0):result))return!1}}return!0}var baseIsEqual=require("./baseIsEqual"),toObject=require("./toObject");module.exports=baseIsMatch},{"./baseIsEqual":416,"./toObject":487}],419:[function(require,module,exports){function baseLodash(){}module.exports=baseLodash},{}],420:[function(require,module,exports){function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}var baseEach=require("./baseEach"),isArrayLike=require("./isArrayLike");module.exports=baseMap},{"./baseEach":405,"./isArrayLike":469}],421:[function(require,module,exports){function baseMatches(source){var matchData=getMatchData(source);if(1==matchData.length&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){return null!=object&&(object[key]===value&&(void 0!==value||key in toObject(object)))}}return function(object){return baseIsMatch(object,matchData)}}var baseIsMatch=require("./baseIsMatch"),getMatchData=require("./getMatchData"),toObject=require("./toObject");module.exports=baseMatches},{"./baseIsMatch":418,"./getMatchData":463,"./toObject":487}],422:[function(require,module,exports){function baseMatchesProperty(path,srcValue){var isArr=isArray(path),isCommon=isKey(path)&&isStrictComparable(srcValue),pathKey=path+"";return path=toPath(path),function(object){if(null==object)return!1;var key=pathKey;if(object=toObject(object),(isArr||!isCommon)&&!(key in object)){if(null==(object=1==path.length?object:baseGet(object,baseSlice(path,0,-1))))return!1;key=last(path),object=toObject(object)}return object[key]===srcValue?void 0!==srcValue||key in object:baseIsEqual(srcValue,object[key],void 0,!0)}}var baseGet=require("./baseGet"),baseIsEqual=require("./baseIsEqual"),baseSlice=require("./baseSlice"),isArray=require("../lang/isArray"),isKey=require("./isKey"),isStrictComparable=require("./isStrictComparable"),last=require("../array/last"),toObject=require("./toObject"),toPath=require("./toPath");module.exports=baseMatchesProperty},{"../array/last":358,"../lang/isArray":492,"./baseGet":414,"./baseIsEqual":416,"./baseSlice":429,"./isKey":472,"./isStrictComparable":476,"./toObject":487,"./toPath":488}],423:[function(require,module,exports){function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object))return object;var isSrcArr=isArrayLike(source)&&(isArray(source)||isTypedArray(source)),props=isSrcArr?void 0:keys(source);return arrayEach(props||source,function(srcValue,key){if(props&&(key=srcValue,srcValue=source[key]),isObjectLike(srcValue))stackA||(stackA=[]),stackB||(stackB=[]),baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB);else{var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):void 0,isCommon=void 0===result;isCommon&&(result=srcValue),void 0===result&&(!isSrcArr||key in object)||!isCommon&&(result===result?result===value:value!==value)||(object[key]=result)}}),object}var arrayEach=require("./arrayEach"),baseMergeDeep=require("./baseMergeDeep"),isArray=require("../lang/isArray"),isArrayLike=require("./isArrayLike"),isObject=require("../lang/isObject"),isObjectLike=require("./isObjectLike"),isTypedArray=require("../lang/isTypedArray"),keys=require("../object/keys");module.exports=baseMerge},{"../lang/isArray":492,"../lang/isObject":497,"../lang/isTypedArray":500,"../object/keys":506,"./arrayEach":388,"./baseMergeDeep":424,"./isArrayLike":469,"./isObjectLike":475}],424:[function(require,module,exports){function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){for(var length=stackA.length,srcValue=source[key];length--;)if(stackA[length]==srcValue)return void(object[key]=stackB[length]);var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):void 0,isCommon=void 0===result;isCommon&&(result=srcValue,isArrayLike(srcValue)&&(isArray(srcValue)||isTypedArray(srcValue))?result=isArray(value)?value:isArrayLike(value)?arrayCopy(value):[]:isPlainObject(srcValue)||isArguments(srcValue)?result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}:isCommon=!1),stackA.push(srcValue),stackB.push(result),isCommon?object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB):(result===result?result!==value:value===value)&&(object[key]=result)}var arrayCopy=require("./arrayCopy"),isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isArrayLike=require("./isArrayLike"),isPlainObject=require("../lang/isPlainObject"),isTypedArray=require("../lang/isTypedArray"),toPlainObject=require("../lang/toPlainObject");module.exports=baseMergeDeep},{"../lang/isArguments":491,"../lang/isArray":492,"../lang/isPlainObject":498,"../lang/isTypedArray":500,"../lang/toPlainObject":501,"./arrayCopy":387,"./isArrayLike":469}],425:[function(require,module,exports){function baseProperty(key){return function(object){return null==object?void 0:object[key]}}module.exports=baseProperty},{}],426:[function(require,module,exports){function basePropertyDeep(path){var pathKey=path+"";return path=toPath(path),function(object){return baseGet(object,path,pathKey)}}var baseGet=require("./baseGet"),toPath=require("./toPath");module.exports=basePropertyDeep},{"./baseGet":414,"./toPath":488}],427:[function(require,module,exports){function baseReduce(collection,iteratee,accumulator,initFromCollection,eachFunc){return eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=!1,value):iteratee(accumulator,value,index,collection)}),accumulator}module.exports=baseReduce},{}],428:[function(require,module,exports){var identity=require("../utility/identity"),metaMap=require("./metaMap"),baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity;module.exports=baseSetData},{"../utility/identity":514,"./metaMap":478}],429:[function(require,module,exports){function baseSlice(array,start,end){var index=-1,length=array.length;start=null==start?0:+start||0,start<0&&(start=-start>length?0:length+start),end=void 0===end||end>length?length:+end||0,end<0&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}module.exports=baseSlice},{}],430:[function(require,module,exports){function baseSome(collection,predicate){var result;return baseEach(collection,function(value,index,collection){return!(result=predicate(value,index,collection))}),!!result}var baseEach=require("./baseEach");module.exports=baseSome},{"./baseEach":405}],431:[function(require,module,exports){function baseSortBy(array,comparer){var length=array.length;for(array.sort(comparer);length--;)array[length]=array[length].value;return array}module.exports=baseSortBy},{}],432:[function(require,module,exports){function baseToString(value){return null==value?"":value+""}module.exports=baseToString},{}],433:[function(require,module,exports){function baseUniq(array,iteratee){var index=-1,indexOf=baseIndexOf,length=array.length,isCommon=!0,isLarge=isCommon&&length>=LARGE_ARRAY_SIZE,seen=isLarge?createCache():null,result=[];seen?(indexOf=cacheIndexOf,isCommon=!1):(isLarge=!1,seen=iteratee?[]:result);outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else indexOf(seen,computed,0)<0&&((iteratee||isLarge)&&seen.push(computed),result.push(value))}return result}var baseIndexOf=require("./baseIndexOf"),cacheIndexOf=require("./cacheIndexOf"),createCache=require("./createCache"),LARGE_ARRAY_SIZE=200;module.exports=baseUniq},{"./baseIndexOf":415,"./cacheIndexOf":437,"./createCache":447}],434:[function(require,module,exports){function baseValues(object,props){for(var index=-1,length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}module.exports=baseValues},{}],435:[function(require,module,exports){function bindCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if(void 0===thisArg)return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}var identity=require("../utility/identity");module.exports=bindCallback},{"../utility/identity":514}],436:[function(require,module,exports){(function(global){function bufferClone(buffer){var result=new ArrayBuffer(buffer.byteLength);return new Uint8Array(result).set(new Uint8Array(buffer)),result}var ArrayBuffer=global.ArrayBuffer,Uint8Array=global.Uint8Array;module.exports=bufferClone}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],437:[function(require,module,exports){function cacheIndexOf(cache,value){var data=cache.data;return("string"==typeof value||isObject(value)?data.set.has(value):data.hash[value])?0:-1}var isObject=require("../lang/isObject");module.exports=cacheIndexOf},{"../lang/isObject":497}],438:[function(require,module,exports){function cachePush(value){var data=this.data;"string"==typeof value||isObject(value)?data.set.add(value):data.hash[value]=!0}var isObject=require("../lang/isObject");module.exports=cachePush},{"../lang/isObject":497}],439:[function(require,module,exports){function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||object.index-other.index}var baseCompareAscending=require("./baseCompareAscending");module.exports=compareAscending},{"./baseCompareAscending":400}],440:[function(require,module,exports){function composeArgs(args,partials,holders){for(var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(leftLength+argsLength);++leftIndex<leftLength;)result[leftIndex]=partials[leftIndex];for(;++argsIndex<holdersLength;)result[holders[argsIndex]]=args[argsIndex];for(;argsLength--;)result[leftIndex++]=args[argsIndex++];return result}var nativeMax=Math.max;module.exports=composeArgs},{}],441:[function(require,module,exports){function composeArgsRight(args,partials,holders){for(var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);++argsIndex<argsLength;)result[argsIndex]=args[argsIndex];for(var offset=argsIndex;++rightIndex<rightLength;)result[offset+rightIndex]=partials[rightIndex];for(;++holdersIndex<holdersLength;)result[offset+holders[holdersIndex]]=args[argsIndex++];return result}var nativeMax=Math.max;module.exports=composeArgsRight},{}],442:[function(require,module,exports){function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};if(iteratee=baseCallback(iteratee,thisArg,3),isArray(collection))for(var index=-1,length=collection.length;++index<length;){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection)}else baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection)});return result}}var baseCallback=require("./baseCallback"),baseEach=require("./baseEach"),isArray=require("../lang/isArray");module.exports=createAggregator},{"../lang/isArray":492,"./baseCallback":398,"./baseEach":405}],443:[function(require,module,exports){function createAssigner(assigner){return restParam(function(object,sources){var index=-1,length=null==object?0:sources.length,customizer=length>2?sources[length-2]:void 0,guard=length>2?sources[2]:void 0,thisArg=length>1?sources[length-1]:void 0;for("function"==typeof customizer?(customizer=bindCallback(customizer,thisArg,5),length-=2):(customizer="function"==typeof thisArg?thisArg:void 0,length-=customizer?1:0),guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?void 0:customizer,length=1);++index<length;){var source=sources[index];source&&assigner(object,source,customizer)}return object})}var bindCallback=require("./bindCallback"),isIterateeCall=require("./isIterateeCall"),restParam=require("../function/restParam");module.exports=createAssigner},{"../function/restParam":383,"./bindCallback":435,"./isIterateeCall":471}],444:[function(require,module,exports){function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){var length=collection?getLength(collection):0;if(!isLength(length))return eachFunc(collection,iteratee);for(var index=fromRight?length:-1,iterable=toObject(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}var getLength=require("./getLength"),isLength=require("./isLength"),toObject=require("./toObject");module.exports=createBaseEach},{"./getLength":462,"./isLength":474,"./toObject":487}],445:[function(require,module,exports){function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;fromRight?index--:++index<length;){var key=props[index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}var toObject=require("./toObject");module.exports=createBaseFor},{"./toObject":487}],446:[function(require,module,exports){(function(global){function createBindWrapper(func,thisArg){function wrapper(){return(this&&this!==global&&this instanceof wrapper?Ctor:func).apply(thisArg,arguments)}var Ctor=createCtorWrapper(func);return wrapper}var createCtorWrapper=require("./createCtorWrapper");module.exports=createBindWrapper}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./createCtorWrapper":448}],447:[function(require,module,exports){(function(global){function createCache(values){return nativeCreate&&Set?new SetCache(values):null}var SetCache=require("./SetCache"),getNative=require("./getNative"),Set=getNative(global,"Set"),nativeCreate=getNative(Object,"create");module.exports=createCache}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./SetCache":386,"./getNative":464}],448:[function(require,module,exports){function createCtorWrapper(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}var baseCreate=require("./baseCreate"),isObject=require("../lang/isObject");module.exports=createCtorWrapper},{"../lang/isObject":497,"./baseCreate":402}],449:[function(require,module,exports){function createDefaults(assigner,customizer){return restParam(function(args){var object=args[0];return null==object?object:(args.push(customizer),assigner.apply(void 0,args))})}var restParam=require("../function/restParam");module.exports=createDefaults},{"../function/restParam":383}],450:[function(require,module,exports){function createFind(eachFunc,fromRight){return function(collection,predicate,thisArg){if(predicate=baseCallback(predicate,thisArg,3),isArray(collection)){var index=baseFindIndex(collection,predicate,fromRight);return index>-1?collection[index]:void 0}return baseFind(collection,predicate,eachFunc)}}var baseCallback=require("./baseCallback"),baseFind=require("./baseFind"),baseFindIndex=require("./baseFindIndex"),isArray=require("../lang/isArray");module.exports=createFind},{"../lang/isArray":492,"./baseCallback":398,"./baseFind":408,"./baseFindIndex":409}],451:[function(require,module,exports){function createFindIndex(fromRight){return function(array,predicate,thisArg){return array&&array.length?(predicate=baseCallback(predicate,thisArg,3),baseFindIndex(array,predicate,fromRight)):-1}}var baseCallback=require("./baseCallback"),baseFindIndex=require("./baseFindIndex");module.exports=createFindIndex},{"./baseCallback":398,"./baseFindIndex":409}],452:[function(require,module,exports){function createForEach(arrayFunc,eachFunc){return function(collection,iteratee,thisArg){return"function"==typeof iteratee&&void 0===thisArg&&isArray(collection)?arrayFunc(collection,iteratee):eachFunc(collection,bindCallback(iteratee,thisArg,3))}}var bindCallback=require("./bindCallback"),isArray=require("../lang/isArray");module.exports=createForEach},{"../lang/isArray":492,"./bindCallback":435}],453:[function(require,module,exports){(function(global){function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){function wrapper(){for(var length=arguments.length,index=length,args=Array(length);index--;)args[index]=arguments[index];if(partials&&(args=composeArgs(args,partials,holders)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight)),isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);if((length-=argsHolders.length)<arity){var newArgPos=argPos?arrayCopy(argPos):void 0,newArity=nativeMax(arity-length,0),newsHolders=isCurry?argsHolders:void 0,newHoldersRight=isCurry?void 0:argsHolders,newPartials=isCurry?args:void 0,newPartialsRight=isCurry?void 0:args;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG,bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG),isCurryBound||(bitmask&=~(BIND_FLAG|BIND_KEY_FLAG));var newData=[func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,newArity],result=createHybridWrapper.apply(void 0,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,result}}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;return argPos&&(args=reorder(args,argPos)),isAry&&ary<args.length&&(args.length=ary),this&&this!==global&&this instanceof wrapper&&(fn=Ctor||createCtorWrapper(func)),fn.apply(thisBinding,args)}var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG,Ctor=isBindKey?void 0:createCtorWrapper(func);return wrapper}var arrayCopy=require("./arrayCopy"),composeArgs=require("./composeArgs"),composeArgsRight=require("./composeArgsRight"),createCtorWrapper=require("./createCtorWrapper"),isLaziable=require("./isLaziable"),reorder=require("./reorder"),replaceHolders=require("./replaceHolders"),setData=require("./setData"),BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,nativeMax=Math.max;module.exports=createHybridWrapper}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./arrayCopy":387,"./composeArgs":440,"./composeArgsRight":441,"./createCtorWrapper":448,"./isLaziable":473,"./reorder":482,"./replaceHolders":483,"./setData":484}],454:[function(require,module,exports){(function(global){function createPartialWrapper(func,bitmask,thisArg,partials){function wrapper(){for(var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength);++leftIndex<leftLength;)args[leftIndex]=partials[leftIndex];for(;argsLength--;)args[leftIndex++]=arguments[++argsIndex];return(this&&this!==global&&this instanceof wrapper?Ctor:func).apply(isBind?thisArg:this,args)}var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);return wrapper}var createCtorWrapper=require("./createCtorWrapper"),BIND_FLAG=1;module.exports=createPartialWrapper}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./createCtorWrapper":448}],455:[function(require,module,exports){function createReduce(arrayFunc,eachFunc){return function(collection,iteratee,accumulator,thisArg){var initFromArray=arguments.length<3;return"function"==typeof iteratee&&void 0===thisArg&&isArray(collection)?arrayFunc(collection,iteratee,accumulator,initFromArray):baseReduce(collection,baseCallback(iteratee,thisArg,4),accumulator,initFromArray,eachFunc)}}var baseCallback=require("./baseCallback"),baseReduce=require("./baseReduce"),isArray=require("../lang/isArray");module.exports=createReduce},{"../lang/isArray":492,"./baseCallback":398,"./baseReduce":427}],456:[function(require,module,exports){function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG),partials=holders=void 0),length-=holders?holders.length:0,bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=void 0}var data=isBindKey?void 0:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&(mergeData(newData,data),bitmask=newData[1],arity=newData[9]),newData[9]=null==arity?isBindKey?0:func.length:nativeMax(arity-length,0)||0,bitmask==BIND_FLAG)var result=createBindWrapper(newData[0],newData[2]);else result=bitmask!=PARTIAL_FLAG&&bitmask!=(BIND_FLAG|PARTIAL_FLAG)||newData[4].length?createHybridWrapper.apply(void 0,newData):createPartialWrapper.apply(void 0,newData);return(data?baseSetData:setData)(result,newData)}
var baseSetData=require("./baseSetData"),createBindWrapper=require("./createBindWrapper"),createHybridWrapper=require("./createHybridWrapper"),createPartialWrapper=require("./createPartialWrapper"),getData=require("./getData"),mergeData=require("./mergeData"),setData=require("./setData"),BIND_FLAG=1,BIND_KEY_FLAG=2,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max;module.exports=createWrapper},{"./baseSetData":428,"./createBindWrapper":446,"./createHybridWrapper":453,"./createPartialWrapper":454,"./getData":460,"./mergeData":477,"./setData":484}],457:[function(require,module,exports){function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isLoose&&othLength>arrLength))return!1;for(;++index<arrLength;){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):void 0;if(void 0!==result){if(result)continue;return!1}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)}))return!1}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))return!1}return!0}var arraySome=require("./arraySome");module.exports=equalArrays},{"./arraySome":394}],458:[function(require,module,exports){function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return!1}var boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",regexpTag="[object RegExp]",stringTag="[object String]";module.exports=equalByTag},{}],459:[function(require,module,exports){function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length;if(objLength!=keys(other).length&&!isLoose)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key)))return!1}for(var skipCtor=isLoose;++index<objLength;){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):void 0;if(!(void 0===result?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result))return!1;skipCtor||(skipCtor="constructor"==key)}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor))return!1}return!0}var keys=require("../object/keys"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=equalObjects},{"../object/keys":506}],460:[function(require,module,exports){var metaMap=require("./metaMap"),noop=require("../utility/noop"),getData=metaMap?function(func){return metaMap.get(func)}:noop;module.exports=getData},{"../utility/noop":515,"./metaMap":478}],461:[function(require,module,exports){function getFuncName(func){for(var result=func.name+"",array=realNames[result],length=array?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}var realNames=require("./realNames");module.exports=getFuncName},{"./realNames":481}],462:[function(require,module,exports){var baseProperty=require("./baseProperty"),getLength=baseProperty("length");module.exports=getLength},{"./baseProperty":425}],463:[function(require,module,exports){function getMatchData(object){for(var result=pairs(object),length=result.length;length--;)result[length][2]=isStrictComparable(result[length][1]);return result}var isStrictComparable=require("./isStrictComparable"),pairs=require("../object/pairs");module.exports=getMatchData},{"../object/pairs":510,"./isStrictComparable":476}],464:[function(require,module,exports){function getNative(object,key){var value=null==object?void 0:object[key];return isNative(value)?value:void 0}var isNative=require("../lang/isNative");module.exports=getNative},{"../lang/isNative":495}],465:[function(require,module,exports){function indexOfNaN(array,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?0:-1);fromRight?index--:++index<length;){var other=array[index];if(other!==other)return index}return-1}module.exports=indexOfNaN},{}],466:[function(require,module,exports){function initCloneArray(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result}var objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=initCloneArray},{}],467:[function(require,module,exports){function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex}return result}var bufferClone=require("./bufferClone"),boolTag="[object Boolean]",dateTag="[object Date]",numberTag="[object Number]",regexpTag="[object RegExp]",stringTag="[object String]",arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reFlags=/\w*$/;module.exports=initCloneByTag},{"./bufferClone":436}],468:[function(require,module,exports){function initCloneObject(object){var Ctor=object.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor||(Ctor=Object),new Ctor}module.exports=initCloneObject},{}],469:[function(require,module,exports){function isArrayLike(value){return null!=value&&isLength(getLength(value))}var getLength=require("./getLength"),isLength=require("./isLength");module.exports=isArrayLike},{"./getLength":462,"./isLength":474}],470:[function(require,module,exports){function isIndex(value,length){return value="number"==typeof value||reIsUint.test(value)?+value:-1,length=null==length?MAX_SAFE_INTEGER:length,value>-1&&value%1==0&&value<length}var reIsUint=/^\d+$/,MAX_SAFE_INTEGER=9007199254740991;module.exports=isIndex},{}],471:[function(require,module,exports){function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;if("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object){var other=object[index];return value===value?value===other:other!==other}return!1}var isArrayLike=require("./isArrayLike"),isIndex=require("./isIndex"),isObject=require("../lang/isObject");module.exports=isIterateeCall},{"../lang/isObject":497,"./isArrayLike":469,"./isIndex":470}],472:[function(require,module,exports){function isKey(value,object){var type=typeof value;return!!("string"==type&&reIsPlainProp.test(value)||"number"==type)||!isArray(value)&&(!reIsDeepProp.test(value)||null!=object&&value in toObject(object))}var isArray=require("../lang/isArray"),toObject=require("./toObject"),reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;module.exports=isKey},{"../lang/isArray":492,"./toObject":487}],473:[function(require,module,exports){function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if("function"!=typeof other||!(funcName in LazyWrapper.prototype))return!1;if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}var LazyWrapper=require("./LazyWrapper"),getData=require("./getData"),getFuncName=require("./getFuncName"),lodash=require("../chain/lodash");module.exports=isLaziable},{"../chain/lodash":364,"./LazyWrapper":384,"./getData":460,"./getFuncName":461}],474:[function(require,module,exports){function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var MAX_SAFE_INTEGER=9007199254740991;module.exports=isLength},{}],475:[function(require,module,exports){function isObjectLike(value){return!!value&&"object"==typeof value}module.exports=isObjectLike},{}],476:[function(require,module,exports){function isStrictComparable(value){return value===value&&!isObject(value)}var isObject=require("../lang/isObject");module.exports=isStrictComparable},{"../lang/isObject":497}],477:[function(require,module,exports){function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<ARY_FLAG,isCombo=srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG||srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(ARY_FLAG|REARG_FLAG)&&bitmask==CURRY_FLAG;if(!isCommon&&!isCombo)return data;srcBitmask&BIND_FLAG&&(data[2]=source[2],newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value),data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4])}return value=source[5],value&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value),data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6])),value=source[7],value&&(data[7]=arrayCopy(value)),srcBitmask&ARY_FLAG&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8])),null==data[9]&&(data[9]=source[9]),data[0]=source[0],data[1]=newBitmask,data}var arrayCopy=require("./arrayCopy"),composeArgs=require("./composeArgs"),composeArgsRight=require("./composeArgsRight"),replaceHolders=require("./replaceHolders"),BIND_FLAG=1,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,ARY_FLAG=128,REARG_FLAG=256,PLACEHOLDER="__lodash_placeholder__",nativeMin=Math.min;module.exports=mergeData},{"./arrayCopy":387,"./composeArgs":440,"./composeArgsRight":441,"./replaceHolders":483}],478:[function(require,module,exports){(function(global){var getNative=require("./getNative"),WeakMap=getNative(global,"WeakMap"),metaMap=WeakMap&&new WeakMap;module.exports=metaMap}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./getNative":464}],479:[function(require,module,exports){function pickByArray(object,props){object=toObject(object);for(var index=-1,length=props.length,result={};++index<length;){var key=props[index];key in object&&(result[key]=object[key])}return result}var toObject=require("./toObject");module.exports=pickByArray},{"./toObject":487}],480:[function(require,module,exports){function pickByCallback(object,predicate){var result={};return baseForIn(object,function(value,key,object){predicate(value,key,object)&&(result[key]=value)}),result}var baseForIn=require("./baseForIn");module.exports=pickByCallback},{"./baseForIn":412}],481:[function(require,module,exports){var realNames={};module.exports=realNames},{}],482:[function(require,module,exports){function reorder(array,indexes){for(var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);length--;){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:void 0}return array}var arrayCopy=require("./arrayCopy"),isIndex=require("./isIndex"),nativeMin=Math.min;module.exports=reorder},{"./arrayCopy":387,"./isIndex":470}],483:[function(require,module,exports){function replaceHolders(array,placeholder){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;)array[index]===placeholder&&(array[index]=PLACEHOLDER,result[++resIndex]=index);return result}var PLACEHOLDER="__lodash_placeholder__";module.exports=replaceHolders},{}],484:[function(require,module,exports){var baseSetData=require("./baseSetData"),now=require("../date/now"),setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=16-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=150)return key}else count=0;return baseSetData(key,value)}}();module.exports=setData},{"../date/now":379,"./baseSetData":428}],485:[function(require,module,exports){function shimKeys(object){for(var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object)),index=-1,result=[];++index<propsLength;){var key=props[index];(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key))&&result.push(key)}return result}var isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isIndex=require("./isIndex"),isLength=require("./isLength"),keysIn=require("../object/keysIn"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=shimKeys},{"../lang/isArguments":491,"../lang/isArray":492,"../object/keysIn":507,"./isIndex":470,"./isLength":474}],486:[function(require,module,exports){function sortedUniq(array,iteratee){for(var seen,index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;index&&seen===computed||(seen=computed,result[++resIndex]=value)}return result}module.exports=sortedUniq},{}],487:[function(require,module,exports){function toObject(value){return isObject(value)?value:Object(value)}var isObject=require("../lang/isObject");module.exports=toObject},{"../lang/isObject":497}],488:[function(require,module,exports){function toPath(value){if(isArray(value))return value;var result=[];return baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)}),result}var baseToString=require("./baseToString"),isArray=require("../lang/isArray"),rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,reEscapeChar=/\\(\\)?/g;module.exports=toPath},{"../lang/isArray":492,"./baseToString":432}],489:[function(require,module,exports){function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__))}var LazyWrapper=require("./LazyWrapper"),LodashWrapper=require("./LodashWrapper"),arrayCopy=require("./arrayCopy");module.exports=wrapperClone},{"./LazyWrapper":384,"./LodashWrapper":385,"./arrayCopy":387}],490:[function(require,module,exports){function clone(value,isDeep,customizer,thisArg){return isDeep&&"boolean"!=typeof isDeep&&isIterateeCall(value,isDeep,customizer)?isDeep=!1:"function"==typeof isDeep&&(thisArg=customizer,customizer=isDeep,isDeep=!1),"function"==typeof customizer?baseClone(value,isDeep,bindCallback(customizer,thisArg,3)):baseClone(value,isDeep)}var baseClone=require("../internal/baseClone"),bindCallback=require("../internal/bindCallback"),isIterateeCall=require("../internal/isIterateeCall");module.exports=clone},{"../internal/baseClone":399,"../internal/bindCallback":435,"../internal/isIterateeCall":471}],491:[function(require,module,exports){function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")}var isArrayLike=require("../internal/isArrayLike"),isObjectLike=require("../internal/isObjectLike"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,propertyIsEnumerable=objectProto.propertyIsEnumerable;module.exports=isArguments},{"../internal/isArrayLike":469,"../internal/isObjectLike":475}],492:[function(require,module,exports){var getNative=require("../internal/getNative"),isLength=require("../internal/isLength"),isObjectLike=require("../internal/isObjectLike"),objectProto=Object.prototype,objToString=objectProto.toString,nativeIsArray=getNative(Array,"isArray"),isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&"[object Array]"==objToString.call(value)};module.exports=isArray},{"../internal/getNative":464,"../internal/isLength":474,"../internal/isObjectLike":475}],493:[function(require,module,exports){function isEmpty(value){return null==value||(isArrayLike(value)&&(isArray(value)||isString(value)||isArguments(value)||isObjectLike(value)&&isFunction(value.splice))?!value.length:!keys(value).length)}var isArguments=require("./isArguments"),isArray=require("./isArray"),isArrayLike=require("../internal/isArrayLike"),isFunction=require("./isFunction"),isObjectLike=require("../internal/isObjectLike"),isString=require("./isString"),keys=require("../object/keys");module.exports=isEmpty},{"../internal/isArrayLike":469,"../internal/isObjectLike":475,"../object/keys":506,"./isArguments":491,"./isArray":492,"./isFunction":494,"./isString":499}],494:[function(require,module,exports){function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}var isObject=require("./isObject"),funcTag="[object Function]",objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isFunction},{"./isObject":497}],495:[function(require,module,exports){function isNative(value){return null!=value&&(isFunction(value)?reIsNative.test(fnToString.call(value)):isObjectLike(value)&&reIsHostCtor.test(value))}var isFunction=require("./isFunction"),isObjectLike=require("../internal/isObjectLike"),reIsHostCtor=/^\[object .+?Constructor\]$/,objectProto=Object.prototype,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");module.exports=isNative},{"../internal/isObjectLike":475,"./isFunction":494}],496:[function(require,module,exports){function isNumber(value){return"number"==typeof value||isObjectLike(value)&&objToString.call(value)==numberTag}var isObjectLike=require("../internal/isObjectLike"),numberTag="[object Number]",objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isNumber},{"../internal/isObjectLike":475}],497:[function(require,module,exports){function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}module.exports=isObject},{}],498:[function(require,module,exports){function isPlainObject(value){var Ctor;if(!isObjectLike(value)||objToString.call(value)!=objectTag||isArguments(value)||!hasOwnProperty.call(value,"constructor")&&"function"==typeof(Ctor=value.constructor)&&!(Ctor instanceof Ctor))return!1;var result;return baseForIn(value,function(subValue,key){result=key}),void 0===result||hasOwnProperty.call(value,result)}var baseForIn=require("../internal/baseForIn"),isArguments=require("./isArguments"),isObjectLike=require("../internal/isObjectLike"),objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString;module.exports=isPlainObject},{"../internal/baseForIn":412,"../internal/isObjectLike":475,"./isArguments":491}],499:[function(require,module,exports){function isString(value){return"string"==typeof value||isObjectLike(value)&&objToString.call(value)==stringTag}var isObjectLike=require("../internal/isObjectLike"),stringTag="[object String]",objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isString},{"../internal/isObjectLike":475}],500:[function(require,module,exports){function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}var isLength=require("../internal/isLength"),isObjectLike=require("../internal/isObjectLike"),typedArrayTags={};typedArrayTags["[object Float32Array]"]=typedArrayTags["[object Float64Array]"]=typedArrayTags["[object Int8Array]"]=typedArrayTags["[object Int16Array]"]=typedArrayTags["[object Int32Array]"]=typedArrayTags["[object Uint8Array]"]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags["[object Uint16Array]"]=typedArrayTags["[object Uint32Array]"]=!0,typedArrayTags["[object Arguments]"]=typedArrayTags["[object Array]"]=typedArrayTags["[object ArrayBuffer]"]=typedArrayTags["[object Boolean]"]=typedArrayTags["[object Date]"]=typedArrayTags["[object Error]"]=typedArrayTags["[object Function]"]=typedArrayTags["[object Map]"]=typedArrayTags["[object Number]"]=typedArrayTags["[object Object]"]=typedArrayTags["[object RegExp]"]=typedArrayTags["[object Set]"]=typedArrayTags["[object String]"]=typedArrayTags["[object WeakMap]"]=!1;var objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isTypedArray},{"../internal/isLength":474,"../internal/isObjectLike":475}],501:[function(require,module,exports){function toPlainObject(value){return baseCopy(value,keysIn(value))}var baseCopy=require("../internal/baseCopy"),keysIn=require("../object/keysIn");module.exports=toPlainObject},{"../internal/baseCopy":401,"../object/keysIn":507}],502:[function(require,module,exports){var assignWith=require("../internal/assignWith"),baseAssign=require("../internal/baseAssign"),createAssigner=require("../internal/createAssigner"),assign=createAssigner(function(object,source,customizer){return customizer?assignWith(object,source,customizer):baseAssign(object,source)});module.exports=assign},{"../internal/assignWith":396,"../internal/baseAssign":397,"../internal/createAssigner":443}],503:[function(require,module,exports){var assign=require("./assign"),assignDefaults=require("../internal/assignDefaults"),createDefaults=require("../internal/createDefaults"),defaults=createDefaults(assign,assignDefaults);module.exports=defaults},{"../internal/assignDefaults":395,"../internal/createDefaults":449,"./assign":502}],504:[function(require,module,exports){function get(object,path,defaultValue){var result=null==object?void 0:baseGet(object,toPath(path),path+"");return void 0===result?defaultValue:result}var baseGet=require("../internal/baseGet"),toPath=require("../internal/toPath");module.exports=get},{"../internal/baseGet":414,"../internal/toPath":488}],505:[function(require,module,exports){function has(object,path){if(null==object)return!1;var result=hasOwnProperty.call(object,path);if(!result&&!isKey(path)){if(path=toPath(path),null==(object=1==path.length?object:baseGet(object,baseSlice(path,0,-1))))return!1;path=last(path),result=hasOwnProperty.call(object,path)}return result||isLength(object.length)&&isIndex(path,object.length)&&(isArray(object)||isArguments(object))}var baseGet=require("../internal/baseGet"),baseSlice=require("../internal/baseSlice"),isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isIndex=require("../internal/isIndex"),isKey=require("../internal/isKey"),isLength=require("../internal/isLength"),last=require("../array/last"),toPath=require("../internal/toPath"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=has},{"../array/last":358,"../internal/baseGet":414,"../internal/baseSlice":429,"../internal/isIndex":470,"../internal/isKey":472,"../internal/isLength":474,"../internal/toPath":488,"../lang/isArguments":491,"../lang/isArray":492}],506:[function(require,module,exports){var getNative=require("../internal/getNative"),isArrayLike=require("../internal/isArrayLike"),isObject=require("../lang/isObject"),shimKeys=require("../internal/shimKeys"),nativeKeys=getNative(Object,"keys"),keys=nativeKeys?function(object){var Ctor=null==object?void 0:object.constructor;return"function"==typeof Ctor&&Ctor.prototype===object||"function"!=typeof object&&isArrayLike(object)?shimKeys(object):isObject(object)?nativeKeys(object):[]}:shimKeys;module.exports=keys},{"../internal/getNative":464,"../internal/isArrayLike":469,"../internal/shimKeys":485,"../lang/isObject":497}],507:[function(require,module,exports){function keysIn(object){if(null==object)return[];isObject(object)||(object=Object(object));var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;for(var Ctor=object.constructor,index=-1,isProto="function"==typeof Ctor&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;++index<length;)result[index]=index+"";for(var key in object)skipIndexes&&isIndex(key,length)||"constructor"==key&&(isProto||!hasOwnProperty.call(object,key))||result.push(key);return result}var isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isIndex=require("../internal/isIndex"),isLength=require("../internal/isLength"),isObject=require("../lang/isObject"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=keysIn},{"../internal/isIndex":470,"../internal/isLength":474,"../lang/isArguments":491,"../lang/isArray":492,"../lang/isObject":497}],508:[function(require,module,exports){var baseMerge=require("../internal/baseMerge"),createAssigner=require("../internal/createAssigner"),merge=createAssigner(baseMerge);module.exports=merge},{"../internal/baseMerge":423,"../internal/createAssigner":443}],509:[function(require,module,exports){var arrayMap=require("../internal/arrayMap"),baseDifference=require("../internal/baseDifference"),baseFlatten=require("../internal/baseFlatten"),bindCallback=require("../internal/bindCallback"),keysIn=require("./keysIn"),pickByArray=require("../internal/pickByArray"),pickByCallback=require("../internal/pickByCallback"),restParam=require("../function/restParam"),omit=restParam(function(object,props){if(null==object)return{};if("function"!=typeof props[0]){var props=arrayMap(baseFlatten(props),String);return pickByArray(object,baseDifference(keysIn(object),props))}var predicate=bindCallback(props[0],props[1],3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object)})});module.exports=omit},{"../function/restParam":383,"../internal/arrayMap":391,"../internal/baseDifference":404,"../internal/baseFlatten":410,"../internal/bindCallback":435,"../internal/pickByArray":479,"../internal/pickByCallback":480,"./keysIn":507}],510:[function(require,module,exports){function pairs(object){object=toObject(object);for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;){var key=props[index];result[index]=[key,object[key]]}return result}var keys=require("./keys"),toObject=require("../internal/toObject");module.exports=pairs},{"../internal/toObject":487,"./keys":506}],511:[function(require,module,exports){var baseFlatten=require("../internal/baseFlatten"),bindCallback=require("../internal/bindCallback"),pickByArray=require("../internal/pickByArray"),pickByCallback=require("../internal/pickByCallback"),restParam=require("../function/restParam"),pick=restParam(function(object,props){return null==object?{}:"function"==typeof props[0]?pickByCallback(object,bindCallback(props[0],props[1],3)):pickByArray(object,baseFlatten(props))});module.exports=pick},{"../function/restParam":383,"../internal/baseFlatten":410,"../internal/bindCallback":435,"../internal/pickByArray":479,"../internal/pickByCallback":480}],512:[function(require,module,exports){function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);if(iteratee=baseCallback(iteratee,thisArg,4),null==accumulator)if(isArr||isObject(object)){var Ctor=object.constructor;accumulator=isArr?isArray(object)?new Ctor:[]:baseCreate(isFunction(Ctor)?Ctor.prototype:void 0)}else accumulator={};return(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)}),accumulator}var arrayEach=require("../internal/arrayEach"),baseCallback=require("../internal/baseCallback"),baseCreate=require("../internal/baseCreate"),baseForOwn=require("../internal/baseForOwn"),isArray=require("../lang/isArray"),isFunction=require("../lang/isFunction"),isObject=require("../lang/isObject"),isTypedArray=require("../lang/isTypedArray");module.exports=transform},{"../internal/arrayEach":388,"../internal/baseCallback":398,"../internal/baseCreate":402,"../internal/baseForOwn":413,"../lang/isArray":492,"../lang/isFunction":494,"../lang/isObject":497,"../lang/isTypedArray":500}],513:[function(require,module,exports){function values(object){return baseValues(object,keys(object))}var baseValues=require("../internal/baseValues"),keys=require("./keys");module.exports=values},{"../internal/baseValues":434,"./keys":506}],514:[function(require,module,exports){function identity(value){return value}module.exports=identity},{}],515:[function(require,module,exports){function noop(){}module.exports=noop},{}],516:[function(require,module,exports){function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}var baseProperty=require("../internal/baseProperty"),basePropertyDeep=require("../internal/basePropertyDeep"),isKey=require("../internal/isKey");module.exports=property},{"../internal/baseProperty":425,"../internal/basePropertyDeep":426,"../internal/isKey":472}],517:[function(require,module,exports){module.exports=function(el,name,val){return 2==arguments.length?el.getAttribute(name):null===val?el.removeAttribute(name):(el.setAttribute(name,val),el)}},{}],518:[function(require,module,exports){module.exports=require("component-classes")},{"component-classes":170}],519:[function(require,module,exports){module.exports=function(el){for(var c;el.childNodes.length;)c=el.childNodes[0],el.removeChild(c);return el}},{}],520:[function(require,module,exports){module.exports=require("component-closest")},{"component-closest":171}],521:[function(require,module,exports){module.exports=require("component-delegate")},{"component-delegate":172}],522:[function(require,module,exports){module.exports=require("domify")},{domify:348}],523:[function(require,module,exports){module.exports=require("component-event")},{"component-event":173}],524:[function(require,module,exports){module.exports=require("component-matches-selector")},{"component-matches-selector":175}],525:[function(require,module,exports){module.exports=require("component-query")},{"component-query":176}],526:[function(require,module,exports){module.exports=function(el){el.parentNode&&el.parentNode.removeChild(el)}},{}],527:[function(require,module,exports){"use strict";function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1)}function lower(string){return string.charAt(0).toLowerCase()+string.slice(1)}function hasLowerCaseAlias(pkg){return pkg.xml&&"lowerCase"===pkg.xml.tagAlias}function serializeFormat(element){return element.xml&&element.xml.serialize}module.exports.aliasToName=function(alias,pkg){return hasLowerCaseAlias(pkg)?capitalize(alias):alias},module.exports.nameToAlias=function(name,pkg){return hasLowerCaseAlias(pkg)?lower(name):name},module.exports.DEFAULT_NS_MAP={xsi:"http://www.w3.org/2001/XMLSchema-instance"};var XSI_TYPE=module.exports.XSI_TYPE="xsi:type";module.exports.serializeAsType=function(element){return serializeFormat(element)===XSI_TYPE},module.exports.serializeAsProperty=function(element){return"property"===serializeFormat(element)}},{}],528:[function(require,module,exports){"use strict";function parseNodeAttributes(node){var nodeAttrs=node.attributes;return reduce(nodeAttrs,function(result,v,k){var name,ns;return v.local?(ns=parseNameNs(v.name,v.prefix),name=ns.name):name=v.prefix,result[name]=v.value,result},{})}function normalizeType(node,attr,model){
var typePrefix,nameNs=parseNameNs(attr.value),uri=node.ns[nameNs.prefix||""],localName=nameNs.localName,pkg=uri&&model.getPackage(uri);pkg&&(typePrefix=pkg.xml&&pkg.xml.typePrefix,typePrefix&&0===localName.indexOf(typePrefix)&&(localName=localName.slice(typePrefix.length)),attr.value=pkg.prefix+":"+localName)}function normalizeNamespaces(node,model,defaultNsUri){var uri,prefix;if(uri=node.uri||defaultNsUri){var pkg=model.getPackage(uri);prefix=pkg?pkg.prefix:node.prefix,node.prefix=prefix,node.uri=uri}forEach(node.attributes,function(attr){attr.uri===XSI_URI&&"type"===attr.local&&normalizeType(node,attr,model),normalizeNamespaces(attr,model,null)})}function error(message){return new Error(message)}function getModdleDescriptor(element){return element.$descriptor}function Context(options){assign(this,options),this.elementsById={},this.references=[],this.warnings=[],this.addReference=function(reference){this.references.push(reference)},this.addElement=function(element){if(!element)throw error("expected element");var id,elementsById=this.elementsById,descriptor=getModdleDescriptor(element),idProperty=descriptor.idProperty;if(idProperty&&(id=element.get(idProperty.name))){if(elementsById[id])throw error("duplicate ID <"+id+">");elementsById[id]=element}},this.addWarning=function(warning){this.warnings.push(warning)}}function BaseHandler(){}function NoopHandler(){}function BodyHandler(){}function ReferenceHandler(property,context){this.property=property,this.context=context}function ValueHandler(propertyDesc,element){this.element=element,this.propertyDesc=propertyDesc}function BaseElementHandler(){}function ElementHandler(model,type,context){this.model=model,this.type=model.getType(type),this.context=context}function GenericElementHandler(model,type,context){this.model=model,this.context=context}function XMLReader(options){options instanceof Moddle&&(options={model:options}),assign(this,{lax:!1},options)}var reduce=require("lodash/collection/reduce"),forEach=require("lodash/collection/forEach"),find=require("lodash/collection/find"),assign=require("lodash/object/assign"),defer=require("lodash/function/defer"),Stack=require("tiny-stack"),SaxParser=require("sax").parser,Moddle=require("moddle"),parseNameNs=require("moddle/lib/ns").parseName,Types=require("moddle/lib/types"),coerceType=Types.coerceType,isSimpleType=Types.isSimple,common=require("./common"),XSI_TYPE=common.XSI_TYPE,XSI_URI=common.DEFAULT_NS_MAP.xsi,serializeAsType=common.serializeAsType,aliasToName=common.aliasToName;BaseHandler.prototype.handleEnd=function(){},BaseHandler.prototype.handleText=function(){},BaseHandler.prototype.handleNode=function(){},NoopHandler.prototype=new BaseHandler,NoopHandler.prototype.handleNode=function(){return this},BodyHandler.prototype=new BaseHandler,BodyHandler.prototype.handleText=function(text){this.body=(this.body||"")+text},ReferenceHandler.prototype=new BodyHandler,ReferenceHandler.prototype.handleNode=function(node){if(this.element)throw error("expected no sub nodes");return this.element=this.createReference(node),this},ReferenceHandler.prototype.handleEnd=function(){this.element.id=this.body},ReferenceHandler.prototype.createReference=function(node){return{property:this.property.ns.name,id:""}},ValueHandler.prototype=new BodyHandler,ValueHandler.prototype.handleEnd=function(){var value=this.body,element=this.element,propertyDesc=this.propertyDesc;value=coerceType(propertyDesc.type,value),propertyDesc.isMany?element.get(propertyDesc.name).push(value):element.set(propertyDesc.name,value)},BaseElementHandler.prototype=Object.create(BodyHandler.prototype),BaseElementHandler.prototype.handleNode=function(node){var parser=this,element=this.element;return element?parser=this.handleChild(node):(element=this.element=this.createElement(node),this.context.addElement(element)),parser},ElementHandler.prototype=new BaseElementHandler,ElementHandler.prototype.addReference=function(reference){this.context.addReference(reference)},ElementHandler.prototype.handleEnd=function(){var value=this.body,element=this.element,descriptor=getModdleDescriptor(element),bodyProperty=descriptor.bodyProperty;bodyProperty&&void 0!==value&&(value=coerceType(bodyProperty.type,value),element.set(bodyProperty.name,value))},ElementHandler.prototype.createElement=function(node){var attributes=parseNodeAttributes(node),Type=this.type,descriptor=getModdleDescriptor(Type),context=this.context,instance=new Type({});return forEach(attributes,function(value,name){var values,prop=descriptor.propertiesByName[name];prop&&prop.isReference?prop.isMany?(values=value.split(" "),forEach(values,function(v){context.addReference({element:instance,property:prop.ns.name,id:v})})):context.addReference({element:instance,property:prop.ns.name,id:value}):(prop&&(value=coerceType(prop.type,value)),instance.set(name,value))}),instance},ElementHandler.prototype.getPropertyForNode=function(node){var elementTypeName,elementType,typeAnnotation,nameNs=parseNameNs(node.local,node.prefix),type=this.type,model=this.model,descriptor=getModdleDescriptor(type),propertyName=nameNs.name,property=descriptor.propertiesByName[propertyName];if(property)return serializeAsType(property)&&(typeAnnotation=node.attributes[XSI_TYPE])?(elementTypeName=typeAnnotation.value,elementType=model.getType(elementTypeName),assign({},property,{effectiveType:getModdleDescriptor(elementType).name})):property;if(model.getPackage(nameNs.prefix)){if(elementTypeName=nameNs.prefix+":"+aliasToName(nameNs.localName,descriptor.$pkg),elementType=model.getType(elementTypeName),property=find(descriptor.properties,function(p){return!p.isVirtual&&!p.isReference&&!p.isAttribute&&elementType.hasType(p.type)}))return assign({},property,{effectiveType:getModdleDescriptor(elementType).name})}else if(property=find(descriptor.properties,function(p){return!p.isReference&&!p.isAttribute&&"Element"===p.type}))return property;throw error("unrecognized element <"+nameNs.name+">")},ElementHandler.prototype.toString=function(){return"ElementDescriptor["+getModdleDescriptor(this.type).name+"]"},ElementHandler.prototype.valueHandler=function(propertyDesc,element){return new ValueHandler(propertyDesc,element)},ElementHandler.prototype.referenceHandler=function(propertyDesc){return new ReferenceHandler(propertyDesc,this.context)},ElementHandler.prototype.handler=function(type){return"Element"===type?new GenericElementHandler(this.model,type,this.context):new ElementHandler(this.model,type,this.context)},ElementHandler.prototype.handleChild=function(node){var propertyDesc,type,element,childHandler;if(propertyDesc=this.getPropertyForNode(node),element=this.element,type=propertyDesc.effectiveType||propertyDesc.type,isSimpleType(type))return this.valueHandler(propertyDesc,element);childHandler=propertyDesc.isReference?this.referenceHandler(propertyDesc).handleNode(node):this.handler(type).handleNode(node);var newElement=childHandler.element;return void 0!==newElement&&(propertyDesc.isMany?element.get(propertyDesc.name).push(newElement):element.set(propertyDesc.name,newElement),propertyDesc.isReference?(assign(newElement,{element:element}),this.context.addReference(newElement)):newElement.$parent=element),childHandler},GenericElementHandler.prototype=Object.create(BaseElementHandler.prototype),GenericElementHandler.prototype.createElement=function(node){var name=node.name,prefix=node.prefix,uri=node.ns[prefix],attributes=node.attributes;return this.model.createAny(name,uri,attributes)},GenericElementHandler.prototype.handleChild=function(node){var children,handler=new GenericElementHandler(this.model,"Element",this.context).handleNode(node),element=this.element,newElement=handler.element;return void 0!==newElement&&(children=element.$children=element.$children||[],children.push(newElement),newElement.$parent=element),handler},GenericElementHandler.prototype.handleText=function(text){this.body=this.body||""+text},GenericElementHandler.prototype.handleEnd=function(){this.body&&(this.element.$body=this.body)},XMLReader.prototype.fromXML=function(xml,options,done){function resolveReferences(){var i,r,elementsById=context.elementsById,references=context.references;for(i=0;r=references[i];i++){var element=r.element,reference=elementsById[r.id],property=getModdleDescriptor(element).propertiesByName[r.property];if(reference||context.addWarning({message:"unresolved reference <"+r.id+">",element:r.element,property:r.property,value:r.id}),property.isMany){var collection=element.get(property.name),idx=collection.indexOf(r);-1===idx&&(idx=collection.length),reference?collection[idx]=reference:collection.splice(idx,1)}else element.set(property.name,reference)}}function handleClose(tagName){stack.pop().handleEnd()}function handleOpen(node){var handler=stack.peek();normalizeNamespaces(node,model);try{stack.push(handler.handleNode(node))}catch(e){var line=this.line,column=this.column,message="unparsable content <"+node.name+"> detected\n\tline: "+line+"\n\tcolumn: "+column+"\n\tnested error: "+e.message;if(!lax)throw console.error("could not parse document"),console.error(e),error(message);context.addWarning({message:message,error:e}),console.warn("could not parse node"),console.warn(e),stack.push(new NoopHandler)}}function handleText(text){stack.peek().handleText(text)}var rootHandler=options.rootHandler;options instanceof ElementHandler?(rootHandler=options,options={}):"string"==typeof options?(rootHandler=this.handler(options),options={}):"string"==typeof rootHandler&&(rootHandler=this.handler(rootHandler));var model=this.model,lax=this.lax,context=new Context(assign({},options,{rootHandler:rootHandler})),parser=new SaxParser(!0,{xmlns:!0,trim:!0}),stack=new Stack;rootHandler.context=context,stack.push(rootHandler),parser.onopentag=handleOpen,parser.oncdata=parser.ontext=handleText,parser.onclosetag=handleClose,parser.onend=resolveReferences,defer(function(){var error;try{parser.write(xml).close()}catch(e){error=e}done(error,error?void 0:rootHandler.element,context)})},XMLReader.prototype.handler=function(name){return new ElementHandler(this.model,name)},module.exports=XMLReader,module.exports.ElementHandler=ElementHandler},{"./common":527,"lodash/collection/find":368,"lodash/collection/forEach":369,"lodash/collection/reduce":374,"lodash/function/defer":382,"lodash/object/assign":502,moddle:530,"moddle/lib/ns":535,"moddle/lib/types":538,sax:542,"tiny-stack":545}],529:[function(require,module,exports){"use strict";function nsName(ns){return isString(ns)?ns:(ns.prefix?ns.prefix+":":"")+ns.localName}function getNsAttrs(namespaces){function isUsed(ns){return namespaces.used[ns.uri]}function toAttr(ns){return{name:"xmlns"+(ns.prefix?":"+ns.prefix:""),value:ns.uri}}var allNs=[].concat(namespaces.wellknown,namespaces.custom);return map(filter(allNs,isUsed),toAttr)}function getElementNs(ns,descriptor){return descriptor.isGeneric?descriptor.name:assign({localName:nameToAlias(descriptor.ns.localName,descriptor.$pkg)},ns)}function getPropertyNs(ns,descriptor){return assign({localName:descriptor.ns.localName},ns)}function getSerializableProperties(element){var descriptor=element.$descriptor;return filter(descriptor.properties,function(p){var name=p.name;if(p.isVirtual)return!1;if(!element.hasOwnProperty(name))return!1;var value=element[name];return value!==p.default&&(null!==value&&(!p.isMany||value.length))})}function escapeAttr(str){return str=isString(str)?str:""+str,str.replace(ESCAPE_CHARS,function(str){return"&#"+ESCAPE_MAP[str]+";"})}function filterAttributes(props){return filter(props,function(p){return p.isAttr})}function filterContained(props){return filter(props,function(p){return!p.isAttr})}function ReferenceSerializer(parent,ns){this.ns=ns}function BodySerializer(){}function ValueSerializer(ns){this.ns=ns}function ElementSerializer(parent,ns){this.body=[],this.attrs=[],this.parent=parent,this.ns=ns}function TypeSerializer(parent,ns){ElementSerializer.call(this,parent,ns)}function SavingWriter(){this.value="",this.write=function(str){this.value+=str}}function FormatingWriter(out,format){var indent=[""];this.append=function(str){return out.write(str),this},this.appendNewLine=function(){return format&&out.write("\n"),this},this.appendIndent=function(){return format&&out.write(indent.join("  ")),this},this.indent=function(){return indent.push(""),this},this.unindent=function(){return indent.pop(),this}}function XMLWriter(options){function toXML(tree,writer){var internalWriter=writer||new SavingWriter,formatingWriter=new FormatingWriter(internalWriter,options.format);if(options.preamble&&formatingWriter.append(XML_PREAMBLE),(new ElementSerializer).build(tree).serializeTo(formatingWriter),!writer)return internalWriter.value}return options=assign({format:!1,preamble:!0},options||{}),{toXML:toXML}}var map=require("lodash/collection/map"),forEach=require("lodash/collection/forEach"),isString=require("lodash/lang/isString"),filter=require("lodash/collection/filter"),assign=require("lodash/object/assign"),Types=require("moddle/lib/types"),parseNameNs=require("moddle/lib/ns").parseName,common=require("./common"),nameToAlias=common.nameToAlias,serializeAsType=common.serializeAsType,serializeAsProperty=common.serializeAsProperty,XML_PREAMBLE='<?xml version="1.0" encoding="UTF-8"?>\n',ESCAPE_CHARS=/(<|>|'|"|&|\n\r|\n)/g,DEFAULT_NS_MAP=common.DEFAULT_NS_MAP,XSI_TYPE=common.XSI_TYPE,ESCAPE_MAP={"\n":"10","\n\r":"10",'"':"34","'":"39","<":"60",">":"62","&":"38"};ReferenceSerializer.prototype.build=function(element){return this.element=element,this},ReferenceSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append("<"+nsName(this.ns)+">"+this.element.id+"</"+nsName(this.ns)+">").appendNewLine()},BodySerializer.prototype.serializeValue=BodySerializer.prototype.serializeTo=function(writer){var escape=this.escape;escape&&writer.append("<![CDATA["),writer.append(this.value),escape&&writer.append("]]>")},BodySerializer.prototype.build=function(prop,value){return this.value=value,"String"===prop.type&&-1!==value.search(ESCAPE_CHARS)&&(this.escape=!0),this},ValueSerializer.prototype=new BodySerializer,ValueSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append("<"+nsName(this.ns)+">"),this.serializeValue(writer),writer.append("</"+nsName(this.ns)+">").appendNewLine()},ElementSerializer.prototype.build=function(element){this.element=element;var otherAttrs=this.parseNsAttributes(element);if(this.ns||(this.ns=this.nsTagName(element.$descriptor)),element.$descriptor.isGeneric)this.parseGeneric(element);else{var properties=getSerializableProperties(element);this.parseAttributes(filterAttributes(properties)),this.parseContainments(filterContained(properties)),this.parseGenericAttributes(element,otherAttrs)}return this},ElementSerializer.prototype.nsTagName=function(descriptor){return getElementNs(this.logNamespaceUsed(descriptor.ns),descriptor)},ElementSerializer.prototype.nsPropertyTagName=function(descriptor){return getPropertyNs(this.logNamespaceUsed(descriptor.ns),descriptor)},ElementSerializer.prototype.isLocalNs=function(ns){return ns.uri===this.ns.uri},ElementSerializer.prototype.nsAttributeName=function(element){var ns;if(ns=isString(element)?parseNameNs(element):element.ns,element.inherited)return{localName:ns.localName};var effectiveNs=this.logNamespaceUsed(ns);return this.isLocalNs(effectiveNs)?{localName:ns.localName}:assign({localName:ns.localName},effectiveNs)},ElementSerializer.prototype.parseGeneric=function(element){var self=this,body=this.body,attrs=this.attrs;forEach(element,function(val,key){"$body"===key?body.push((new BodySerializer).build({type:"String"},val)):"$children"===key?forEach(val,function(child){body.push(new ElementSerializer(self).build(child))}):0!==key.indexOf("$")&&attrs.push({name:key,value:escapeAttr(val)})})},ElementSerializer.prototype.parseNsAttributes=function(element){var self=this,genericAttrs=element.$attrs,model=element.$model,attributes=[];return forEach(genericAttrs,function(value,name){var ns,nameNs=parseNameNs(name);"xmlns"===nameNs.prefix&&(ns={prefix:nameNs.localName,uri:value}),nameNs.prefix||"xmlns"!==nameNs.localName||(ns={uri:value}),ns?model.getPackage(value)?self.logNamespace(ns,!0):self.logNamespaceUsed(ns):attributes.push({name:name,value:value})}),attributes},ElementSerializer.prototype.parseGenericAttributes=function(element,attributes){var self=this;forEach(attributes,function(attr){if(attr.name!==XSI_TYPE)try{self.addAttribute(self.nsAttributeName(attr.name),attr.value)}catch(e){console.warn("missing namespace information for ",attr.name,"=",attr.value,"on",element,e)}})},ElementSerializer.prototype.parseContainments=function(properties){var self=this,body=this.body,element=this.element;forEach(properties,function(p){var value=element.get(p.name),isReference=p.isReference,isMany=p.isMany,ns=self.nsPropertyTagName(p);if(isMany||(value=[value]),p.isBody)body.push((new BodySerializer).build(p,value[0]));else if(Types.isSimple(p.type))forEach(value,function(v){body.push(new ValueSerializer(ns).build(p,v))});else if(isReference)forEach(value,function(v){body.push(new ReferenceSerializer(self,ns).build(v))});else{var asType=serializeAsType(p),asProperty=serializeAsProperty(p);forEach(value,function(v){var serializer;serializer=asType?new TypeSerializer(self,ns):asProperty?new ElementSerializer(self,ns):new ElementSerializer(self),body.push(serializer.build(v))})}})},ElementSerializer.prototype.getNamespaces=function(){var namespaces=this.namespaces,parent=this.parent;return namespaces||(namespaces=this.namespaces=parent?parent.getNamespaces():{prefixMap:{},uriMap:{},used:{},wellknown:[],custom:[]}),namespaces},ElementSerializer.prototype.logNamespace=function(ns,wellknown){var namespaces=this.getNamespaces(),nsUri=ns.uri;return namespaces.uriMap[nsUri]||(namespaces.uriMap[nsUri]=ns,wellknown?namespaces.wellknown.push(ns):namespaces.custom.push(ns)),namespaces.prefixMap[ns.prefix]=nsUri,ns},ElementSerializer.prototype.logNamespaceUsed=function(ns){var element=this.element,model=element.$model,namespaces=this.getNamespaces(),prefix=ns.prefix,wellknownUri=DEFAULT_NS_MAP[prefix]||model&&(model.getPackage(prefix)||{}).uri,uri=ns.uri||namespaces.prefixMap[prefix]||wellknownUri;if(!uri)throw new Error("no namespace uri given for prefix <"+ns.prefix+">");return ns=namespaces.uriMap[uri],ns||(ns=this.logNamespace({prefix:prefix,uri:uri},wellknownUri)),namespaces.used[ns.uri]||(namespaces.used[ns.uri]=ns),ns},ElementSerializer.prototype.parseAttributes=function(properties){var self=this,element=this.element;forEach(properties,function(p){var value=element.get(p.name);if(p.isReference)if(p.isMany){var values=[];forEach(value,function(v){values.push(v.id)}),value=values.join(" ")}else value=value.id;self.addAttribute(self.nsAttributeName(p),value)})},ElementSerializer.prototype.addAttribute=function(name,value){var attrs=this.attrs;isString(value)&&(value=escapeAttr(value)),attrs.push({name:name,value:value})},ElementSerializer.prototype.serializeAttributes=function(writer){var attrs=this.attrs;!this.parent&&(attrs=getNsAttrs(this.namespaces).concat(attrs)),forEach(attrs,function(a){writer.append(" ").append(nsName(a.name)).append('="').append(a.value).append('"')})},ElementSerializer.prototype.serializeTo=function(writer){var hasBody=this.body.length,indent=!(1===this.body.length&&this.body[0]instanceof BodySerializer);writer.appendIndent().append("<"+nsName(this.ns)),this.serializeAttributes(writer),writer.append(hasBody?">":" />"),hasBody&&(indent&&writer.appendNewLine().indent(),forEach(this.body,function(b){b.serializeTo(writer)}),indent&&writer.unindent().appendIndent(),writer.append("</"+nsName(this.ns)+">")),writer.appendNewLine()},TypeSerializer.prototype=new ElementSerializer,TypeSerializer.prototype.build=function(element){var descriptor=element.$descriptor;this.element=element,this.typeNs=this.nsTagName(descriptor);var typeNs=this.typeNs,pkg=element.$model.getPackage(typeNs.uri),typePrefix=pkg.xml&&pkg.xml.typePrefix||"";return this.addAttribute(this.nsAttributeName(XSI_TYPE),(typeNs.prefix?typeNs.prefix+":":"")+typePrefix+descriptor.ns.localName),ElementSerializer.prototype.build.call(this,element)},TypeSerializer.prototype.isLocalNs=function(ns){return ns.uri===this.typeNs.uri},module.exports=XMLWriter},{"./common":527,"lodash/collection/filter":367,"lodash/collection/forEach":369,"lodash/collection/map":373,"lodash/lang/isString":499,"lodash/object/assign":502,"moddle/lib/ns":535,"moddle/lib/types":538}],530:[function(require,module,exports){module.exports=require("./lib/moddle")},{"./lib/moddle":534}],531:[function(require,module,exports){"use strict";function Base(){}Base.prototype.get=function(name){return this.$model.properties.get(this,name)},Base.prototype.set=function(name,value){this.$model.properties.set(this,name,value)},module.exports=Base},{}],532:[function(require,module,exports){"use strict";function DescriptorBuilder(nameNs){this.ns=nameNs,this.name=nameNs.name,this.allTypes=[],this.properties=[],this.propertiesByName={}}var pick=require("lodash/object/pick"),assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),parseNameNs=require("./ns").parseName;module.exports=DescriptorBuilder,DescriptorBuilder.prototype.build=function(){return pick(this,["ns","name","allTypes","properties","propertiesByName","bodyProperty","idProperty"])},DescriptorBuilder.prototype.addProperty=function(p,idx,validate){"boolean"==typeof idx&&(validate=idx,idx=void 0),this.addNamedProperty(p,!1!==validate);var properties=this.properties;void 0!==idx?properties.splice(idx,0,p):properties.push(p)},DescriptorBuilder.prototype.replaceProperty=function(oldProperty,newProperty,replace){var oldNameNs=oldProperty.ns,props=this.properties,propertiesByName=this.propertiesByName,rename=oldProperty.name!==newProperty.name;if(oldProperty.isId){if(!newProperty.isId)throw new Error("property <"+newProperty.ns.name+"> must be id property to refine <"+oldProperty.ns.name+">");this.setIdProperty(newProperty,!1)}if(oldProperty.isBody){if(!newProperty.isBody)throw new Error("property <"+newProperty.ns.name+"> must be body property to refine <"+oldProperty.ns.name+">");this.setBodyProperty(newProperty,!1)}var idx=props.indexOf(oldProperty);if(-1===idx)throw new Error("property <"+oldNameNs.name+"> not found in property list");props.splice(idx,1),this.addProperty(newProperty,replace?void 0:idx,rename),propertiesByName[oldNameNs.name]=propertiesByName[oldNameNs.localName]=newProperty},DescriptorBuilder.prototype.redefineProperty=function(p,targetPropertyName,replace){var nsPrefix=p.ns.prefix,parts=targetPropertyName.split("#"),name=parseNameNs(parts[0],nsPrefix),attrName=parseNameNs(parts[1],name.prefix).name,redefinedProperty=this.propertiesByName[attrName];if(!redefinedProperty)throw new Error("refined property <"+attrName+"> not found");this.replaceProperty(redefinedProperty,p,replace),delete p.redefines},DescriptorBuilder.prototype.addNamedProperty=function(p,validate){var ns=p.ns,propsByName=this.propertiesByName;validate&&(this.assertNotDefined(p,ns.name),this.assertNotDefined(p,ns.localName)),propsByName[ns.name]=propsByName[ns.localName]=p},DescriptorBuilder.prototype.removeNamedProperty=function(p){var ns=p.ns,propsByName=this.propertiesByName;delete propsByName[ns.name],delete propsByName[ns.localName]},DescriptorBuilder.prototype.setBodyProperty=function(p,validate){if(validate&&this.bodyProperty)throw new Error("body property defined multiple times (<"+this.bodyProperty.ns.name+">, <"+p.ns.name+">)");this.bodyProperty=p},DescriptorBuilder.prototype.setIdProperty=function(p,validate){if(validate&&this.idProperty)throw new Error("id property defined multiple times (<"+this.idProperty.ns.name+">, <"+p.ns.name+">)");this.idProperty=p},DescriptorBuilder.prototype.assertNotDefined=function(p,name){var propertyName=p.name,definedProperty=this.propertiesByName[propertyName];if(definedProperty)throw new Error("property <"+propertyName+"> already defined; override of <"+definedProperty.definedBy.ns.name+"#"+definedProperty.ns.name+"> by <"+p.definedBy.ns.name+"#"+p.ns.name+"> not allowed without redefines")},DescriptorBuilder.prototype.hasProperty=function(name){return this.propertiesByName[name]},DescriptorBuilder.prototype.addTrait=function(t,inherited){var allTypes=this.allTypes;-1===allTypes.indexOf(t)&&(forEach(t.properties,function(p){p=assign({},p,{name:p.ns.localName,inherited:inherited}),Object.defineProperty(p,"definedBy",{value:t});var replaces=p.replaces,redefines=p.redefines;replaces||redefines?this.redefineProperty(p,replaces||redefines,replaces):(p.isBody&&this.setBodyProperty(p),p.isId&&this.setIdProperty(p),this.addProperty(p))},this),allTypes.push(t))}},{"./ns":535,"lodash/collection/forEach":369,"lodash/object/assign":502,"lodash/object/pick":511}],533:[function(require,module,exports){"use strict";function Factory(model,properties){this.model=model,this.properties=properties}var forEach=require("lodash/collection/forEach"),Base=require("./base");module.exports=Factory,Factory.prototype.createType=function(descriptor){function ModdleElement(attrs){props.define(this,"$type",{value:name,enumerable:!0}),props.define(this,"$attrs",{value:{}}),props.define(this,"$parent",{writable:!0}),forEach(attrs,function(val,key){this.set(key,val)},this)}var model=this.model,props=this.properties,prototype=Object.create(Base.prototype);forEach(descriptor.properties,function(p){p.isMany||void 0===p.default||(prototype[p.name]=p.default)}),props.defineModel(prototype,model),props.defineDescriptor(prototype,descriptor);var name=descriptor.ns.name;return ModdleElement.prototype=prototype,ModdleElement.hasType=prototype.$instanceOf=this.model.hasType,props.defineModel(ModdleElement,model),props.defineDescriptor(ModdleElement,descriptor),ModdleElement}},{"./base":531,"lodash/collection/forEach":369}],534:[function(require,module,exports){"use strict";function Moddle(packages){this.properties=new Properties(this),this.factory=new Factory(this,this.properties),this.registry=new Registry(packages,this.properties),this.typeCache={}}var isString=require("lodash/lang/isString"),isObject=require("lodash/lang/isObject"),forEach=require("lodash/collection/forEach"),find=require("lodash/collection/find"),Factory=require("./factory"),Registry=require("./registry"),Properties=require("./properties"),parseNameNs=require("./ns").parseName;module.exports=Moddle,Moddle.prototype.create=function(descriptor,attrs){var Type=this.getType(descriptor);if(!Type)throw new Error("unknown type <"+descriptor+">");return new Type(attrs)},Moddle.prototype.getType=function(descriptor){var cache=this.typeCache,name=isString(descriptor)?descriptor:descriptor.ns.name,type=cache[name];return type||(descriptor=this.registry.getEffectiveDescriptor(name),type=cache[name]=this.factory.createType(descriptor)),type},Moddle.prototype.createAny=function(name,nsUri,properties){var nameNs=parseNameNs(name),element={$type:name},descriptor={name:name,isGeneric:!0,ns:{prefix:nameNs.prefix,localName:nameNs.localName,uri:nsUri}};return this.properties.defineDescriptor(element,descriptor),this.properties.defineModel(element,this),this.properties.define(element,"$parent",{enumerable:!1,writable:!0}),forEach(properties,function(a,key){isObject(a)&&void 0!==a.value?element[a.name]=a.value:element[key]=a}),element},Moddle.prototype.getPackage=function(uriOrPrefix){return this.registry.getPackage(uriOrPrefix)},Moddle.prototype.getPackages=function(){return this.registry.getPackages()},Moddle.prototype.getElementDescriptor=function(element){return element.$descriptor},Moddle.prototype.hasType=function(element,type){void 0===type&&(type=element,element=this);var descriptor=element.$model.getElementDescriptor(element);return!!find(descriptor.allTypes,function(t){return t.name===type})},Moddle.prototype.getPropertyDescriptor=function(element,property){return this.getElementDescriptor(element).propertiesByName[property]}},{"./factory":533,"./ns":535,"./properties":536,"./registry":537,"lodash/collection/find":368,"lodash/collection/forEach":369,"lodash/lang/isObject":497,"lodash/lang/isString":499}],535:[function(require,module,exports){"use strict";module.exports.parseName=function(name,defaultPrefix){var localName,prefix,parts=name.split(/:/);if(1===parts.length)localName=name,prefix=defaultPrefix;else{if(2!==parts.length)throw new Error("expected <prefix:localName> or <localName>, got "+name);localName=parts[1],prefix=parts[0]}return name=(prefix?prefix+":":"")+localName,{name:name,prefix:prefix,localName:localName}}},{}],536:[function(require,module,exports){"use strict";function Properties(model){this.model=model}function isUndefined(val){return void 0===val}function defineProperty(target,property,value){Object.defineProperty(target,property.name,{enumerable:!property.isReference,writable:!0,value:value,configurable:!0})}module.exports=Properties,Properties.prototype.set=function(target,name,value){var property=this.model.getPropertyDescriptor(target,name),propertyName=property&&property.name;isUndefined(value)?property?delete target[propertyName]:delete target.$attrs[name]:property?propertyName in target?target[propertyName]=value:defineProperty(target,property,value):target.$attrs[name]=value},Properties.prototype.get=function(target,name){var property=this.model.getPropertyDescriptor(target,name);if(!property)return target.$attrs[name];var propertyName=property.name;return!target[propertyName]&&property.isMany&&defineProperty(target,property,[]),target[propertyName]},Properties.prototype.define=function(target,name,options){Object.defineProperty(target,name,options)},Properties.prototype.defineDescriptor=function(target,descriptor){this.define(target,"$descriptor",{value:descriptor})},Properties.prototype.defineModel=function(target,model){this.define(target,"$model",{value:model})}},{}],537:[function(require,module,exports){"use strict";function Registry(packages,properties){this.packageMap={},this.typeMap={},this.packages=[],this.properties=properties,forEach(packages,this.registerPackage,this)}var assign=require("lodash/object/assign"),forEach=require("lodash/collection/forEach"),Types=require("./types"),DescriptorBuilder=require("./descriptor-builder"),parseNameNs=require("./ns").parseName,isBuiltInType=Types.isBuiltIn;module.exports=Registry,Registry.prototype.getPackage=function(uriOrPrefix){return this.packageMap[uriOrPrefix]},Registry.prototype.getPackages=function(){return this.packages},Registry.prototype.registerPackage=function(pkg){pkg=assign({},pkg),forEach(pkg.types,function(descriptor){this.registerType(descriptor,pkg)},this),this.packageMap[pkg.uri]=this.packageMap[pkg.prefix]=pkg,this.packages.push(pkg)},Registry.prototype.registerType=function(type,pkg){type=assign({},type,{superClass:(type.superClass||[]).slice(),extends:(type.extends||[]).slice(),properties:(type.properties||[]).slice()});var ns=parseNameNs(type.name,pkg.prefix),name=ns.name,propertiesByName={};forEach(type.properties,function(p){var propertyNs=parseNameNs(p.name,ns.prefix),propertyName=propertyNs.name;isBuiltInType(p.type)||(p.type=parseNameNs(p.type,propertyNs.prefix).name),assign(p,{ns:propertyNs,name:propertyName}),propertiesByName[propertyName]=p}),assign(type,{ns:ns,name:name,propertiesByName:propertiesByName}),forEach(type.extends,function(extendsName){var extended=this.typeMap[extendsName];extended.traits=extended.traits||[],extended.traits.push(name)},this),this.definePackage(type,pkg),this.typeMap[name]=type},Registry.prototype.mapTypes=function(nsName,iterator,trait){function traverseTrait(cls){return traverseSuper(cls,!0)}function traverseSuper(cls,trait){var parentNs=parseNameNs(cls,isBuiltInType(cls)?"":nsName.prefix);self.mapTypes(parentNs,iterator,trait)}var type=isBuiltInType(nsName.name)?{name:nsName.name}:this.typeMap[nsName.name],self=this;if(!type)throw new Error("unknown type <"+nsName.name+">")
;forEach(type.superClass,trait?traverseTrait:traverseSuper),iterator(type,!trait),forEach(type.traits,traverseTrait)},Registry.prototype.getEffectiveDescriptor=function(name){var nsName=parseNameNs(name),builder=new DescriptorBuilder(nsName);this.mapTypes(nsName,function(type,inherited){builder.addTrait(type,inherited)});var descriptor=builder.build();return this.definePackage(descriptor,descriptor.allTypes[descriptor.allTypes.length-1].$pkg),descriptor},Registry.prototype.definePackage=function(target,pkg){this.properties.define(target,"$pkg",{value:pkg})}},{"./descriptor-builder":532,"./ns":535,"./types":538,"lodash/collection/forEach":369,"lodash/object/assign":502}],538:[function(require,module,exports){"use strict";var BUILTINS={String:!0,Boolean:!0,Integer:!0,Real:!0,Element:!0},TYPE_CONVERTERS={String:function(s){return s},Boolean:function(s){return"true"===s},Integer:function(s){return parseInt(s,10)},Real:function(s){return parseFloat(s,10)}};module.exports.coerceType=function(type,value){var converter=TYPE_CONVERTERS[type];return converter?converter(value):value},module.exports.isBuiltIn=function(type){return!!BUILTINS[type]},module.exports.isSimple=function(type){return!!TYPE_CONVERTERS[type]}},{}],539:[function(require,module,exports){module.exports=require("./lib/refs"),module.exports.Collection=require("./lib/collection")},{"./lib/collection":540,"./lib/refs":541}],540:[function(require,module,exports){"use strict";function extend(collection,refs,property,target){var inverseProperty=property.inverse;return Object.defineProperty(collection,"remove",{value:function(element){var idx=this.indexOf(element);return-1!==idx&&(this.splice(idx,1),refs.unset(element,inverseProperty,target)),element}}),Object.defineProperty(collection,"contains",{value:function(element){return-1!==this.indexOf(element)}}),Object.defineProperty(collection,"add",{value:function(element){this.contains(element)||(this.push(element),refs.set(element,inverseProperty,target))}}),Object.defineProperty(collection,"__refs_collection",{value:!0}),collection}function isExtended(collection){return!0===collection.__refs_collection}module.exports.extend=extend,module.exports.isExtended=isExtended},{}],541:[function(require,module,exports){"use strict";function hasOwnProperty(e,property){return Object.prototype.hasOwnProperty.call(e,property.name||property)}function defineCollectionProperty(ref,property,target){Object.defineProperty(target,property.name,{enumerable:property.enumerable,value:Collection.extend(target[property.name]||[],ref,property,target)})}function defineProperty(ref,property,target){var inverseProperty=property.inverse,_value=target[property.name];Object.defineProperty(target,property.name,{enumerable:property.enumerable,get:function(){return _value},set:function(value){if(value!==_value){var old=_value;_value=null,old&&ref.unset(old,inverseProperty,target),_value=value,ref.set(_value,inverseProperty,target)}}})}function Refs(a,b){if(!(this instanceof Refs))return new Refs(a,b);a.inverse=b,b.inverse=a,this.props={},this.props[a.name]=a,this.props[b.name]=b}var Collection=require("./collection");Refs.prototype.bind=function(target,property){if("string"==typeof property){if(!this.props[property])throw new Error("no property <"+property+"> in ref");property=this.props[property]}property.collection?defineCollectionProperty(this,property,target):defineProperty(this,property,target)},Refs.prototype.ensureRefsCollection=function(target,property){var collection=target[property.name];return Collection.isExtended(collection)||defineCollectionProperty(this,property,target),collection},Refs.prototype.ensureBound=function(target,property){hasOwnProperty(target,property)||this.bind(target,property)},Refs.prototype.unset=function(target,property,value){target&&(this.ensureBound(target,property),property.collection?this.ensureRefsCollection(target,property).remove(value):target[property.name]=void 0)},Refs.prototype.set=function(target,property,value){target&&(this.ensureBound(target,property),property.collection?this.ensureRefsCollection(target,property).add(value):target[property.name]=value)},module.exports=Refs},{"./collection":540}],542:[function(require,module,exports){(function(Buffer){!function(sax){function SAXParser(strict,opt){if(!(this instanceof SAXParser))return new SAXParser(strict,opt);var parser=this;clearBuffers(parser),parser.q=parser.c="",parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH,parser.opt=opt||{},parser.opt.lowercase=parser.opt.lowercase||parser.opt.lowercasetags,parser.looseCase=parser.opt.lowercase?"toLowerCase":"toUpperCase",parser.tags=[],parser.closed=parser.closedRoot=parser.sawRoot=!1,parser.tag=parser.error=null,parser.strict=!!strict,parser.noscript=!(!strict&&!parser.opt.noscript),parser.state=S.BEGIN,parser.ENTITIES=Object.create(sax.ENTITIES),parser.attribList=[],parser.opt.xmlns&&(parser.ns=Object.create(rootNS)),parser.trackPosition=!1!==parser.opt.position,parser.trackPosition&&(parser.position=parser.line=parser.column=0),emit(parser,"onready")}function checkBufferLength(parser){for(var maxAllowed=Math.max(sax.MAX_BUFFER_LENGTH,10),maxActual=0,i=0,l=buffers.length;i<l;i++){var len=parser[buffers[i]].length;if(len>maxAllowed)switch(buffers[i]){case"textNode":closeText(parser);break;case"cdata":emitNode(parser,"oncdata",parser.cdata),parser.cdata="";break;case"script":emitNode(parser,"onscript",parser.script),parser.script="";break;default:error(parser,"Max buffer length exceeded: "+buffers[i])}maxActual=Math.max(maxActual,len)}parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH-maxActual+parser.position}function clearBuffers(parser){for(var i=0,l=buffers.length;i<l;i++)parser[buffers[i]]=""}function flushBuffers(parser){closeText(parser),""!==parser.cdata&&(emitNode(parser,"oncdata",parser.cdata),parser.cdata=""),""!==parser.script&&(emitNode(parser,"onscript",parser.script),parser.script="")}function createStream(strict,opt){return new SAXStream(strict,opt)}function SAXStream(strict,opt){if(!(this instanceof SAXStream))return new SAXStream(strict,opt);Stream.apply(this),this._parser=new SAXParser(strict,opt),this.writable=!0,this.readable=!0;var me=this;this._parser.onend=function(){me.emit("end")},this._parser.onerror=function(er){me.emit("error",er),me._parser.error=null},this._decoder=null,streamWraps.forEach(function(ev){Object.defineProperty(me,"on"+ev,{get:function(){return me._parser["on"+ev]},set:function(h){if(!h)return me.removeAllListeners(ev),me._parser["on"+ev]=h;me.on(ev,h)},enumerable:!0,configurable:!1})})}function charClass(str){return str.split("").reduce(function(s,c){return s[c]=!0,s},{})}function isRegExp(c){return"[object RegExp]"===Object.prototype.toString.call(c)}function is(charclass,c){return isRegExp(charclass)?!!c.match(charclass):charclass[c]}function not(charclass,c){return!is(charclass,c)}function emit(parser,event,data){parser[event]&&parser[event](data)}function emitNode(parser,nodeType,data){parser.textNode&&closeText(parser),emit(parser,nodeType,data)}function closeText(parser){parser.textNode=textopts(parser.opt,parser.textNode),parser.textNode&&emit(parser,"ontext",parser.textNode),parser.textNode=""}function textopts(opt,text){return opt.trim&&(text=text.trim()),opt.normalize&&(text=text.replace(/\s+/g," ")),text}function error(parser,er){return closeText(parser),parser.trackPosition&&(er+="\nLine: "+parser.line+"\nColumn: "+parser.column+"\nChar: "+parser.c),er=new Error(er),parser.error=er,emit(parser,"onerror",er),parser}function end(parser){return parser.closedRoot||strictFail(parser,"Unclosed root tag"),parser.state!==S.BEGIN&&parser.state!==S.TEXT&&error(parser,"Unexpected end"),closeText(parser),parser.c="",parser.closed=!0,emit(parser,"onend"),SAXParser.call(parser,parser.strict,parser.opt),parser}function strictFail(parser,message){if("object"!=typeof parser||!(parser instanceof SAXParser))throw new Error("bad call to strictFail");parser.strict&&error(parser,message)}function newTag(parser){parser.strict||(parser.tagName=parser.tagName[parser.looseCase]());var parent=parser.tags[parser.tags.length-1]||parser,tag=parser.tag={name:parser.tagName,attributes:{}};parser.opt.xmlns&&(tag.ns=parent.ns),parser.attribList.length=0}function qname(name,attribute){var i=name.indexOf(":"),qualName=i<0?["",name]:name.split(":"),prefix=qualName[0],local=qualName[1];return attribute&&"xmlns"===name&&(prefix="xmlns",local=""),{prefix:prefix,local:local}}function attrib(parser){if(parser.strict||(parser.attribName=parser.attribName[parser.looseCase]()),-1!==parser.attribList.indexOf(parser.attribName)||parser.tag.attributes.hasOwnProperty(parser.attribName))return parser.attribName=parser.attribValue="";if(parser.opt.xmlns){var qn=qname(parser.attribName,!0),prefix=qn.prefix,local=qn.local;if("xmlns"===prefix)if("xml"===local&&parser.attribValue!==XML_NAMESPACE)strictFail(parser,"xml: prefix must be bound to "+XML_NAMESPACE+"\nActual: "+parser.attribValue);else if("xmlns"===local&&parser.attribValue!==XMLNS_NAMESPACE)strictFail(parser,"xmlns: prefix must be bound to "+XMLNS_NAMESPACE+"\nActual: "+parser.attribValue);else{var tag=parser.tag,parent=parser.tags[parser.tags.length-1]||parser;tag.ns===parent.ns&&(tag.ns=Object.create(parent.ns)),tag.ns[local]=parser.attribValue}parser.attribList.push([parser.attribName,parser.attribValue])}else parser.tag.attributes[parser.attribName]=parser.attribValue,emitNode(parser,"onattribute",{name:parser.attribName,value:parser.attribValue});parser.attribName=parser.attribValue=""}function openTag(parser,selfClosing){if(parser.opt.xmlns){var tag=parser.tag,qn=qname(parser.tagName);tag.prefix=qn.prefix,tag.local=qn.local,tag.uri=tag.ns[qn.prefix]||"",tag.prefix&&!tag.uri&&(strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(parser.tagName)),tag.uri=qn.prefix);var parent=parser.tags[parser.tags.length-1]||parser;tag.ns&&parent.ns!==tag.ns&&Object.keys(tag.ns).forEach(function(p){emitNode(parser,"onopennamespace",{prefix:p,uri:tag.ns[p]})});for(var i=0,l=parser.attribList.length;i<l;i++){var nv=parser.attribList[i],name=nv[0],value=nv[1],qualName=qname(name,!0),prefix=qualName.prefix,local=qualName.local,uri=""==prefix?"":tag.ns[prefix]||"",a={name:name,value:value,prefix:prefix,local:local,uri:uri};prefix&&"xmlns"!=prefix&&!uri&&(strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(prefix)),a.uri=prefix),parser.tag.attributes[name]=a,emitNode(parser,"onattribute",a)}parser.attribList.length=0}parser.tag.isSelfClosing=!!selfClosing,parser.sawRoot=!0,parser.tags.push(parser.tag),emitNode(parser,"onopentag",parser.tag),selfClosing||(parser.noscript||"script"!==parser.tagName.toLowerCase()?parser.state=S.TEXT:parser.state=S.SCRIPT,parser.tag=null,parser.tagName=""),parser.attribName=parser.attribValue="",parser.attribList.length=0}function closeTag(parser){if(!parser.tagName)return strictFail(parser,"Weird empty close tag."),parser.textNode+="</>",void(parser.state=S.TEXT);if(parser.script){if("script"!==parser.tagName)return parser.script+="</"+parser.tagName+">",parser.tagName="",void(parser.state=S.SCRIPT);emitNode(parser,"onscript",parser.script),parser.script=""}var t=parser.tags.length,tagName=parser.tagName;parser.strict||(tagName=tagName[parser.looseCase]());for(var closeTo=tagName;t--;){if(parser.tags[t].name===closeTo)break;strictFail(parser,"Unexpected close tag")}if(t<0)return strictFail(parser,"Unmatched closing tag: "+parser.tagName),parser.textNode+="</"+parser.tagName+">",void(parser.state=S.TEXT);parser.tagName=tagName;for(var s=parser.tags.length;s-- >t;){var tag=parser.tag=parser.tags.pop();parser.tagName=parser.tag.name,emitNode(parser,"onclosetag",parser.tagName);var x={};for(var i in tag.ns)x[i]=tag.ns[i];var parent=parser.tags[parser.tags.length-1]||parser;parser.opt.xmlns&&tag.ns!==parent.ns&&Object.keys(tag.ns).forEach(function(p){var n=tag.ns[p];emitNode(parser,"onclosenamespace",{prefix:p,uri:n})})}0===t&&(parser.closedRoot=!0),parser.tagName=parser.attribValue=parser.attribName="",parser.attribList.length=0,parser.state=S.TEXT}function parseEntity(parser){var num,entity=parser.entity,entityLC=entity.toLowerCase(),numStr="";return parser.ENTITIES[entity]?parser.ENTITIES[entity]:parser.ENTITIES[entityLC]?parser.ENTITIES[entityLC]:(entity=entityLC,"#"===entity.charAt(0)&&("x"===entity.charAt(1)?(entity=entity.slice(2),num=parseInt(entity,16),numStr=num.toString(16)):(entity=entity.slice(1),num=parseInt(entity,10),numStr=num.toString(10))),entity=entity.replace(/^0+/,""),numStr.toLowerCase()!==entity?(strictFail(parser,"Invalid character entity"),"&"+parser.entity+";"):String.fromCodePoint(num))}function write(chunk){var parser=this;if(this.error)throw this.error;if(parser.closed)return error(parser,"Cannot write after close. Assign an onready handler.");if(null===chunk)return end(parser);for(var i=0,c="";parser.c=c=chunk.charAt(i++);)switch(parser.trackPosition&&(parser.position++,"\n"===c?(parser.line++,parser.column=0):parser.column++),parser.state){case S.BEGIN:"<"===c?(parser.state=S.OPEN_WAKA,parser.startTagPosition=parser.position):not(whitespace,c)&&(strictFail(parser,"Non-whitespace before first tag."),parser.textNode=c,parser.state=S.TEXT);continue;case S.TEXT:if(parser.sawRoot&&!parser.closedRoot){for(var starti=i-1;c&&"<"!==c&&"&"!==c;)(c=chunk.charAt(i++))&&parser.trackPosition&&(parser.position++,"\n"===c?(parser.line++,parser.column=0):parser.column++);parser.textNode+=chunk.substring(starti,i-1)}"<"===c?(parser.state=S.OPEN_WAKA,parser.startTagPosition=parser.position):(!not(whitespace,c)||parser.sawRoot&&!parser.closedRoot||strictFail(parser,"Text data outside of root node."),"&"===c?parser.state=S.TEXT_ENTITY:parser.textNode+=c);continue;case S.SCRIPT:"<"===c?parser.state=S.SCRIPT_ENDING:parser.script+=c;continue;case S.SCRIPT_ENDING:"/"===c?parser.state=S.CLOSE_TAG:(parser.script+="<"+c,parser.state=S.SCRIPT);continue;case S.OPEN_WAKA:if("!"===c)parser.state=S.SGML_DECL,parser.sgmlDecl="";else if(is(whitespace,c));else if(is(nameStart,c))parser.state=S.OPEN_TAG,parser.tagName=c;else if("/"===c)parser.state=S.CLOSE_TAG,parser.tagName="";else if("?"===c)parser.state=S.PROC_INST,parser.procInstName=parser.procInstBody="";else{if(strictFail(parser,"Unencoded <"),parser.startTagPosition+1<parser.position){var pad=parser.position-parser.startTagPosition;c=new Array(pad).join(" ")+c}parser.textNode+="<"+c,parser.state=S.TEXT}continue;case S.SGML_DECL:(parser.sgmlDecl+c).toUpperCase()===CDATA?(emitNode(parser,"onopencdata"),parser.state=S.CDATA,parser.sgmlDecl="",parser.cdata=""):parser.sgmlDecl+c==="--"?(parser.state=S.COMMENT,parser.comment="",parser.sgmlDecl=""):(parser.sgmlDecl+c).toUpperCase()===DOCTYPE?(parser.state=S.DOCTYPE,(parser.doctype||parser.sawRoot)&&strictFail(parser,"Inappropriately located doctype declaration"),parser.doctype="",parser.sgmlDecl=""):">"===c?(emitNode(parser,"onsgmldeclaration",parser.sgmlDecl),parser.sgmlDecl="",parser.state=S.TEXT):is(quote,c)?(parser.state=S.SGML_DECL_QUOTED,parser.sgmlDecl+=c):parser.sgmlDecl+=c;continue;case S.SGML_DECL_QUOTED:c===parser.q&&(parser.state=S.SGML_DECL,parser.q=""),parser.sgmlDecl+=c;continue;case S.DOCTYPE:">"===c?(parser.state=S.TEXT,emitNode(parser,"ondoctype",parser.doctype),parser.doctype=!0):(parser.doctype+=c,"["===c?parser.state=S.DOCTYPE_DTD:is(quote,c)&&(parser.state=S.DOCTYPE_QUOTED,parser.q=c));continue;case S.DOCTYPE_QUOTED:parser.doctype+=c,c===parser.q&&(parser.q="",parser.state=S.DOCTYPE);continue;case S.DOCTYPE_DTD:parser.doctype+=c,"]"===c?parser.state=S.DOCTYPE:is(quote,c)&&(parser.state=S.DOCTYPE_DTD_QUOTED,parser.q=c);continue;case S.DOCTYPE_DTD_QUOTED:parser.doctype+=c,c===parser.q&&(parser.state=S.DOCTYPE_DTD,parser.q="");continue;case S.COMMENT:"-"===c?parser.state=S.COMMENT_ENDING:parser.comment+=c;continue;case S.COMMENT_ENDING:"-"===c?(parser.state=S.COMMENT_ENDED,parser.comment=textopts(parser.opt,parser.comment),parser.comment&&emitNode(parser,"oncomment",parser.comment),parser.comment=""):(parser.comment+="-"+c,parser.state=S.COMMENT);continue;case S.COMMENT_ENDED:">"!==c?(strictFail(parser,"Malformed comment"),parser.comment+="--"+c,parser.state=S.COMMENT):parser.state=S.TEXT;continue;case S.CDATA:"]"===c?parser.state=S.CDATA_ENDING:parser.cdata+=c;continue;case S.CDATA_ENDING:"]"===c?parser.state=S.CDATA_ENDING_2:(parser.cdata+="]"+c,parser.state=S.CDATA);continue;case S.CDATA_ENDING_2:">"===c?(parser.cdata&&emitNode(parser,"oncdata",parser.cdata),emitNode(parser,"onclosecdata"),parser.cdata="",parser.state=S.TEXT):"]"===c?parser.cdata+="]":(parser.cdata+="]]"+c,parser.state=S.CDATA);continue;case S.PROC_INST:"?"===c?parser.state=S.PROC_INST_ENDING:is(whitespace,c)?parser.state=S.PROC_INST_BODY:parser.procInstName+=c;continue;case S.PROC_INST_BODY:if(!parser.procInstBody&&is(whitespace,c))continue;"?"===c?parser.state=S.PROC_INST_ENDING:parser.procInstBody+=c;continue;case S.PROC_INST_ENDING:">"===c?(emitNode(parser,"onprocessinginstruction",{name:parser.procInstName,body:parser.procInstBody}),parser.procInstName=parser.procInstBody="",parser.state=S.TEXT):(parser.procInstBody+="?"+c,parser.state=S.PROC_INST_BODY);continue;case S.OPEN_TAG:is(nameBody,c)?parser.tagName+=c:(newTag(parser),">"===c?openTag(parser):"/"===c?parser.state=S.OPEN_TAG_SLASH:(not(whitespace,c)&&strictFail(parser,"Invalid character in tag name"),parser.state=S.ATTRIB));continue;case S.OPEN_TAG_SLASH:">"===c?(openTag(parser,!0),closeTag(parser)):(strictFail(parser,"Forward-slash in opening tag not followed by >"),parser.state=S.ATTRIB);continue;case S.ATTRIB:if(is(whitespace,c))continue;">"===c?openTag(parser):"/"===c?parser.state=S.OPEN_TAG_SLASH:is(nameStart,c)?(parser.attribName=c,parser.attribValue="",parser.state=S.ATTRIB_NAME):strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_NAME:"="===c?parser.state=S.ATTRIB_VALUE:">"===c?(strictFail(parser,"Attribute without value"),parser.attribValue=parser.attribName,attrib(parser),openTag(parser)):is(whitespace,c)?parser.state=S.ATTRIB_NAME_SAW_WHITE:is(nameBody,c)?parser.attribName+=c:strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if("="===c)parser.state=S.ATTRIB_VALUE;else{if(is(whitespace,c))continue;strictFail(parser,"Attribute without value"),parser.tag.attributes[parser.attribName]="",parser.attribValue="",emitNode(parser,"onattribute",{name:parser.attribName,value:""}),parser.attribName="",">"===c?openTag(parser):is(nameStart,c)?(parser.attribName=c,parser.state=S.ATTRIB_NAME):(strictFail(parser,"Invalid attribute name"),parser.state=S.ATTRIB)}continue;case S.ATTRIB_VALUE:if(is(whitespace,c))continue;is(quote,c)?(parser.q=c,parser.state=S.ATTRIB_VALUE_QUOTED):(strictFail(parser,"Unquoted attribute value"),parser.state=S.ATTRIB_VALUE_UNQUOTED,parser.attribValue=c);continue;case S.ATTRIB_VALUE_QUOTED:if(c!==parser.q){"&"===c?parser.state=S.ATTRIB_VALUE_ENTITY_Q:parser.attribValue+=c;continue}attrib(parser),parser.q="",parser.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:is(whitespace,c)?parser.state=S.ATTRIB:">"===c?openTag(parser):"/"===c?parser.state=S.OPEN_TAG_SLASH:is(nameStart,c)?(strictFail(parser,"No whitespace between attributes"),parser.attribName=c,parser.attribValue="",parser.state=S.ATTRIB_NAME):strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(not(attribEnd,c)){"&"===c?parser.state=S.ATTRIB_VALUE_ENTITY_U:parser.attribValue+=c;continue}attrib(parser),">"===c?openTag(parser):parser.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(parser.tagName)">"===c?closeTag(parser):is(nameBody,c)?parser.tagName+=c:parser.script?(parser.script+="</"+parser.tagName,parser.tagName="",parser.state=S.SCRIPT):(not(whitespace,c)&&strictFail(parser,"Invalid tagname in closing tag"),parser.state=S.CLOSE_TAG_SAW_WHITE);else{if(is(whitespace,c))continue;not(nameStart,c)?parser.script?(parser.script+="</"+c,parser.state=S.SCRIPT):strictFail(parser,"Invalid tagname in closing tag."):parser.tagName=c}continue;case S.CLOSE_TAG_SAW_WHITE:if(is(whitespace,c))continue;">"===c?closeTag(parser):strictFail(parser,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:switch(parser.state){case S.TEXT_ENTITY:var returnState=S.TEXT,buffer="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:var returnState=S.ATTRIB_VALUE_QUOTED,buffer="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:var returnState=S.ATTRIB_VALUE_UNQUOTED,buffer="attribValue"}";"===c?(parser[buffer]+=parseEntity(parser),parser.entity="",parser.state=returnState):is(entity,c)?parser.entity+=c:(strictFail(parser,"Invalid character entity"),parser[buffer]+="&"+parser.entity+c,parser.entity="",parser.state=returnState);continue;default:throw new Error(parser,"Unknown state: "+parser.state)}return parser.position>=parser.bufferCheckPosition&&checkBufferLength(parser),parser}sax.parser=function(strict,opt){return new SAXParser(strict,opt)},sax.SAXParser=SAXParser,sax.SAXStream=SAXStream,sax.createStream=createStream,sax.MAX_BUFFER_LENGTH=65536;var buffers=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];sax.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(o){function f(){this.__proto__=o}return f.prototype=o,new f}),Object.getPrototypeOf||(Object.getPrototypeOf=function(o){return o.__proto__}),Object.keys||(Object.keys=function(o){var a=[];for(var i in o)o.hasOwnProperty(i)&&a.push(i);return a}),SAXParser.prototype={end:function(){end(this)},write:write,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){flushBuffers(this)}};try{var Stream=require("stream").Stream}catch(ex){var Stream=function(){}}var streamWraps=sax.EVENTS.filter(function(ev){return"error"!==ev&&"end"!==ev});SAXStream.prototype=Object.create(Stream.prototype,{constructor:{value:SAXStream}}),SAXStream.prototype.write=function(data){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(data)){if(!this._decoder){var SD=require("string_decoder").StringDecoder;this._decoder=new SD("utf8")}data=this._decoder.write(data)}return this._parser.write(data.toString()),this.emit("data",data),!0},SAXStream.prototype.end=function(chunk){return chunk&&chunk.length&&this.write(chunk),this._parser.end(),!0},SAXStream.prototype.on=function(ev,handler){var me=this;return me._parser["on"+ev]||-1===streamWraps.indexOf(ev)||(me._parser["on"+ev]=function(){var args=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);args.splice(0,0,ev),me.emit.apply(me,args)}),Stream.prototype.on.call(me,ev,handler)};var whitespace="\r\n\t ",number="0124356789",letter="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",quote="'\"",entity=number+letter+"#",attribEnd=whitespace+">",CDATA="[CDATA[",DOCTYPE="DOCTYPE",XML_NAMESPACE="http://www.w3.org/XML/1998/namespace",XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/",rootNS={xml:XML_NAMESPACE,xmlns:XMLNS_NAMESPACE};whitespace=charClass(whitespace),number=charClass(number),letter=charClass(letter);var nameStart=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameBody=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;quote=charClass(quote),entity=charClass(entity),attribEnd=charClass(attribEnd);var S=0;sax.STATE={BEGIN:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++},sax.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(sax.ENTITIES).forEach(function(key){var e=sax.ENTITIES[key],s="number"==typeof e?String.fromCharCode(e):e;sax.ENTITIES[key]=s});for(var S in sax.STATE)sax.STATE[sax.STATE[S]]=S;S=sax.STATE,String.fromCodePoint||function(){var stringFromCharCode=String.fromCharCode,floor=Math.floor,fromCodePoint=function(){var highSurrogate,lowSurrogate,codeUnits=[],index=-1,length=arguments.length;if(!length)return"";for(var result="";++index<length;){var codePoint=Number(arguments[index]);if(!isFinite(codePoint)||codePoint<0||codePoint>1114111||floor(codePoint)!=codePoint)throw RangeError("Invalid code point: "+codePoint);codePoint<=65535?codeUnits.push(codePoint):(codePoint-=65536,highSurrogate=55296+(codePoint>>10),lowSurrogate=codePoint%1024+56320,codeUnits.push(highSurrogate,lowSurrogate)),(index+1==length||codeUnits.length>16384)&&(result+=stringFromCharCode.apply(null,codeUnits),codeUnits.length=0)}return result};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:fromCodePoint,configurable:!0,writable:!0}):String.fromCodePoint=fromCodePoint}()}(void 0===exports?sax={}:exports)}).call(this,void 0)},{stream:void 0,string_decoder:void 0}],543:[function(require,module,exports){"use strict";function ScrollTabs($el,options){EventEmitter.call(this),this.options=options=assign({},DEFAULT_OPTIONS,options),this.container=$el,this._createScrollButtons($el,options),this._bindEvents($el)}function create($el,options){var scrollTabs=get($el);return scrollTabs||(scrollTabs=new ScrollTabs($el,options),$el.__scrollTabs=scrollTabs),scrollTabs}function get($el){return $el.__scrollTabs}var domify=require("min-dom/lib/domify"),domClasses=require("min-dom/lib/classes"),domMatches=require("min-dom/lib/matches"),domDelegate=require("min-dom/lib/delegate"),domQuery=require("min-dom/lib/query"),domEvent=require("min-dom/lib/event"),domAttr=require("min-dom/lib/attr"),filter=require("lodash/collection/filter"),assign=require("lodash/object/assign"),inherits=require("inherits"),EventEmitter=require("events"),DEFAULT_OPTIONS={scrollSymbolLeft:"‹",scrollSymbolRight:"›"};inherits(ScrollTabs,EventEmitter),ScrollTabs.prototype._createButton=function(parentNode,options){var className=options.className,direction=options.direction,button=domQuery("."+className,parentNode);return button||(button=domify('<span class="scroll-tabs-button '+className+'">'+options.label+"</span>"),parentNode.insertBefore(button,parentNode.childNodes[0])),domAttr(button,"data-direction",direction),button},ScrollTabs.prototype._createScrollButtons=function(parentNode,options){this._createButton(parentNode,{className:"scroll-tabs-left",label:options.scrollSymbolLeft,direction:-1}),this._createButton(parentNode,{className:"scroll-tabs-right",label:options.scrollSymbolRight,direction:1})},ScrollTabs.prototype.getActiveTabNode=function(){return domQuery(this.options.selectors.active,this.container)},ScrollTabs.prototype.getTabsContainerNode=function(){return domQuery(this.options.selectors.tabsContainer,this.container)},ScrollTabs.prototype.getAllTabNodes=function(){return domQuery.all(this.options.selectors.tab,this.container)},ScrollTabs.prototype.getVisibleTabs=function(){var allTabs=this.getAllTabNodes(),ignore=this.options.selectors.ignore;return filter(allTabs,function(tabNode){return!domMatches(tabNode,ignore)})},ScrollTabs.prototype.getAdjacentTab=function(referenceTabNode,n){var visibleTabs=this.getVisibleTabs();return visibleTabs[visibleTabs.indexOf(referenceTabNode)+n]},ScrollTabs.prototype._bindEvents=function(node){this._bindWheelEvent(node),this._bindTabClickEvents(node),this._bindScrollButtonEvents(node)},ScrollTabs.prototype._bindTabClickEvents=function(node){var selector=this.options.selectors.tab,self=this;domDelegate.bind(node,selector,"click",function(event){self.scrollToTabNode(event.delegateTarget)})},ScrollTabs.prototype._bindWheelEvent=function(node){var self=this;domEvent.bind(node,"wheel",function(e){var direction=Math.sign(e.deltaY),oldActiveTab=self.getActiveTabNode(),newActiveTab=self.getAdjacentTab(oldActiveTab,direction);newActiveTab&&(self.scrollToTabNode(newActiveTab),self.emit("scroll",newActiveTab,oldActiveTab,direction)),e.preventDefault()})},ScrollTabs.prototype._bindScrollButtonEvents=function(node){var self=this;domDelegate.bind(node,".scroll-tabs-button","click",function(event){var target=event.delegateTarget,direction=parseInt(domAttr(target,"data-direction"),10),oldActiveTabNode=self.getActiveTabNode(),newActiveTabNode=self.getAdjacentTab(oldActiveTabNode,direction);newActiveTabNode&&(self.scrollToTabNode(newActiveTabNode),self.emit("scroll",newActiveTabNode,oldActiveTabNode,direction)),event.preventDefault()})},ScrollTabs.prototype.scrollToTabNode=function(tabNode){if(tabNode){var tabsContainerNode=tabNode.parentNode,tabWidth=tabNode.offsetWidth,tabOffsetLeft=tabNode.offsetLeft,tabOffsetRight=tabOffsetLeft+tabWidth,containerWidth=tabsContainerNode.offsetWidth
;tabsContainerNode.scrollLeft>tabOffsetLeft?tabsContainerNode.scrollLeft=0:tabOffsetRight>containerWidth&&(tabsContainerNode.scrollLeft=tabOffsetRight-containerWidth)}},ScrollTabs.prototype.update=function(){var tabsContainerNode=this.getTabsContainerNode(),overflow=tabsContainerNode.scrollWidth>tabsContainerNode.offsetWidth;domClasses(this.container).toggle("scroll-tabs-overflow",overflow),overflow&&this.scrollToTabNode(this.getActiveTabNode())},module.exports=create,module.exports.get=get},{events:350,inherits:354,"lodash/collection/filter":367,"lodash/object/assign":502,"min-dom/lib/attr":517,"min-dom/lib/classes":518,"min-dom/lib/delegate":521,"min-dom/lib/domify":522,"min-dom/lib/event":523,"min-dom/lib/matches":524,"min-dom/lib/query":525}],544:[function(require,module,exports){"use strict";function calculateUpdate(currentSelection,currentValue,newValue){var currentCursor=currentSelection.start,newCursor=currentCursor,diff=newValue.length-currentValue.length,currentTail=(newValue.length,currentValue.length,currentValue.substring(currentCursor));newValue.lastIndexOf(currentTail)===newValue.length-currentTail.length&&(currentValue=currentValue.substring(0,currentValue.length-currentTail.length),newValue=newValue.substring(0,newValue.length-currentTail.length));var diff=createDiff(currentValue,newValue);return diff&&(newCursor="remove"===diff.type?diff.newStart:diff.newEnd),range(newCursor)}function createDiff(currentValue,newValue){var insert,l_str,l_char,s_str,s_char,l_idx=0,s_idx=0;for(newValue.length>currentValue.length?(l_str=newValue,s_str=currentValue):(l_str=currentValue,s_str=newValue);l_idx<l_str.length;)l_char=l_str.charAt(l_idx),s_char=s_str.charAt(s_idx),l_char!==s_char?(insert||(insert={l_start:l_idx,s_start:s_idx}),l_idx++):(insert&&!insert.complete&&(insert.l_end=l_idx,insert.s_end=s_idx,insert.complete=!0),s_idx++,l_idx++);if(insert&&!insert.complete&&(insert.complete=!0,insert.s_end=s_str.length,insert.l_end=l_str.length),insert)return newValue.length>currentValue.length?{newStart:insert.l_start,newEnd:insert.l_end,type:"add"}:{newStart:insert.s_start,newEnd:insert.s_end,type:newValue.length<currentValue.length?"remove":"replace"}}function range(start,end){return{start:start,end:void 0===end?start:end}}module.exports=calculateUpdate,module.exports.range=range},{}],545:[function(require,module,exports){!function(global){"use strict";function TinyStack(){this.data=[null],this.top=0}function factory(){return new TinyStack}TinyStack.prototype.clear=function(){return this.data=[null],this.top=0,this},TinyStack.prototype.length=function(){return this.top},TinyStack.prototype.peek=function(){return this.data[this.top]},TinyStack.prototype.pop=function(){return this.top>0?(this.top--,this.data.pop()):void 0},TinyStack.prototype.push=function(arg){return this.data[++this.top]=arg,this},void 0!==exports?module.exports=factory:"function"==typeof define?define(function(){return factory}):global.stack=factory}(this)},{}],546:[function(require,module,exports){function append(element,node){return appendTo(node,element),element}module.exports=append;var appendTo=require("./appendTo")},{"./appendTo":547}],547:[function(require,module,exports){function appendTo(element,target){return target.appendChild(ensureImported(element,target)),element}module.exports=appendTo;var ensureImported=require("./util/ensureImported")},{"./util/ensureImported":557}],548:[function(require,module,exports){function getAttribute(node,name){return CSS_PROPERTIES[name]?node.style[name]:node.getAttributeNS(null,name)}function setAttribute(node,name,value){var hyphenated=name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),type=CSS_PROPERTIES[hyphenated];type?(type===LENGTH_ATTR&&"number"==typeof value&&(value=String(value)+"px"),node.style[hyphenated]=value):node.setAttributeNS(null,name,value)}function setAttributes(node,attrs){var i,name,names=Object.keys(attrs);for(i=0,name;name=names[i];i++)setAttribute(node,name,attrs[name])}function attr(node,name,value){if("string"==typeof name){if(void 0===value)return getAttribute(node,name);setAttribute(node,name,value)}else setAttributes(node,name);return node}module.exports=attr;var LENGTH_ATTR=2,CSS_PROPERTIES={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":LENGTH_ATTR,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":LENGTH_ATTR,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1}},{}],549:[function(require,module,exports){function defined(o){return void 0!==o}function classes(el){return new ClassList(el)}function ClassList(el){if(!el||!el.nodeType)throw new Error("A DOM element reference is required");this.el=el,this.list=el.classList}module.exports=classes;var index=function(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1},re=/\s+/,toString=Object.prototype.toString;ClassList.prototype.add=function(name){if(this.list)return this.list.add(name),this;var arr=this.array();return~index(arr,name)||arr.push(name),defined(this.el.className.baseVal)?this.el.className.baseVal=arr.join(" "):this.el.className=arr.join(" "),this},ClassList.prototype.remove=function(name){if("[object RegExp]"===toString.call(name))return this.removeMatching(name);if(this.list)return this.list.remove(name),this;var arr=this.array(),i=index(arr,name);return~i&&arr.splice(i,1),this.el.className.baseVal=arr.join(" "),this},ClassList.prototype.removeMatching=function(re){for(var arr=this.array(),i=0;i<arr.length;i++)re.test(arr[i])&&this.remove(arr[i]);return this},ClassList.prototype.toggle=function(name,force){return this.list?(defined(force)?force!==this.list.toggle(name,force)&&this.list.toggle(name):this.list.toggle(name),this):(defined(force)?force?this.add(name):this.remove(name):this.has(name)?this.remove(name):this.add(name),this)},ClassList.prototype.array=function(){var className=this.el.getAttribute("class")||"",str=className.replace(/^\s+|\s+$/g,""),arr=str.split(re);return""===arr[0]&&arr.shift(),arr},ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name)}},{}],550:[function(require,module,exports){function clear(element){for(var child;child=element.firstChild;)remove(child);return element}module.exports=clear;var remove=require("./remove")},{"./remove":555}],551:[function(require,module,exports){function clone(element){return element.cloneNode(!0)}module.exports=clone},{}],552:[function(require,module,exports){function create(name,attrs){var element;return"<"===name.charAt(0)?(element=parse(name).firstChild,element=document.importNode(element,!0)):element=document.createElementNS(ns.svg,name),attrs&&attr(element,attrs),element}module.exports=create;var attr=require("./attr"),parse=require("./util/parse"),ns=require("./util/ns")},{"./attr":548,"./util/ns":558,"./util/parse":559}],553:[function(require,module,exports){function extend(object,props){var i,k,keys=Object.keys(props);for(i=0;k=keys[i];i++)object[k]=props[k];return object}function createPoint(x,y){var point=node.createSVGPoint();switch(arguments.length){case 0:return point;case 2:x={x:x,y:y}}return extend(point,x)}function createMatrix(a,b,c,d,e,f){var matrix=node.createSVGMatrix();switch(arguments.length){case 0:return matrix;case 6:a={a:a,b:b,c:c,d:d,e:e,f:f}}return extend(matrix,a)}function createTransform(matrix){return matrix?node.createSVGTransformFromMatrix(matrix):node.createSVGTransform()}module.exports={createPoint:createPoint,createMatrix:createMatrix,createTransform:createTransform};var create=require("./create"),node=create("svg")},{"./create":552}],554:[function(require,module,exports){function set(element,svg){var node,documentElement=parse(svg).documentElement;if(clear(element),svg)for(node=documentElement.firstChild;node;)appendTo(node,element),node=node.nextSibling}function get(element){for(var child=element.firstChild,output=[];child;)serialize(child,output),child=child.nextSibling;return output.join("")}function innerSVG(element,svg){if(void 0!==svg){try{set(element,svg)}catch(e){throw new Error("error parsing SVG: "+e.message)}return element}return get(element)}module.exports=innerSVG;var clear=require("./clear"),appendTo=require("./appendTo"),parse=require("./util/parse"),serialize=require("./util/serialize")},{"./appendTo":547,"./clear":550,"./util/parse":559,"./util/serialize":560}],555:[function(require,module,exports){function remove(element){return element.parentNode.removeChild(element),element}module.exports=remove},{}],556:[function(require,module,exports){function wrapMatrix(transformList,transform){return transform instanceof SVGMatrix?transformList.createSVGTransformFromMatrix(transform):transform}function setTransforms(transformList,transforms){var i,t;for(transformList.clear(),i=0;t=transforms[i];i++)transformList.appendItem(wrapMatrix(transformList,t));transformList.consolidate()}function transform(node,transforms){var transformList=node.transform.baseVal;if(1===arguments.length)return transformList.consolidate();transforms.length?setTransforms(transformList,transforms):transformList.initialize(wrapMatrix(transformList,transforms))}module.exports=transform},{}],557:[function(require,module,exports){function ensureImported(element,target){if(element.ownerDocument!==target.ownerDocument)try{return target.ownerDocument.importNode(element,!0)}catch(e){}return element}module.exports=ensureImported},{}],558:[function(require,module,exports){var ns={svg:"http://www.w3.org/2000/svg"};module.exports=ns},{}],559:[function(require,module,exports){function parse(svg){return"<svg"===svg.substring(0,4)?-1===svg.indexOf(ns.svg)&&(svg=SVG_START+svg.substring(4)):svg=SVG_START+">"+svg+"</svg>",parseDocument(svg)}function parseDocument(svg){var parser;return parser=new DOMParser,parser.async=!1,parser.parseFromString(svg,"text/xml")}module.exports=parse;var ns=require("./ns"),SVG_START='<svg xmlns="'+ns.svg+'"'},{"./ns":558}],560:[function(require,module,exports){function escape(str,pattern){function replaceFn(match,entity){return ENTITY_REPLACEMENT[entity]||entity}return str.replace(pattern,replaceFn)}function serialize(node,output){var i,len,attrMap,attrNode,childNodes;switch(node.nodeType){case 3:output.push(escape(node.textContent,TEXT_ENTITIES));break;case 1:if(output.push("<",node.tagName),node.hasAttributes())for(attrMap=node.attributes,i=0,len=attrMap.length;i<len;++i)attrNode=attrMap.item(i),output.push(" ",attrNode.name,'="',escape(attrNode.value,ATTR_ENTITIES),'"');if(node.hasChildNodes()){for(output.push(">"),childNodes=node.childNodes,i=0,len=childNodes.length;i<len;++i)serialize(childNodes.item(i),output);output.push("</",node.tagName,">")}else output.push("/>");break;case 8:output.push("\x3c!--",escape(node.nodeValue,TEXT_ENTITIES),"--\x3e");break;case 4:output.push("<![CDATA[",node.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+node.nodeType)}return output}module.exports=serialize;var TEXT_ENTITIES=/([&<>]{1})/g,ATTR_ENTITIES=/([\n\r"]{1})/g,ENTITY_REPLACEMENT={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"}},{}]},{},[1]);
//# sourceMappingURL=jsr-352.min.js.map